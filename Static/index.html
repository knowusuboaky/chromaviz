<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChromaFlowStudio</title>
    <style>
        /* Define the variable at the top of the file */
        :root {
            --theme-colour-accent1: #333;
            --theme-colour-accent1hover: #444;
            --theme-colour-accent1down: #1f1f1f;
            
            --theme-colour-accent2: #327EFF;
            --theme-colour-accent2hover: #4e8ffc;
            --theme-colour-accent2down: #235ab8;
            
            --theme-colour-blue: #327EFF;
            --theme-colour-bluehover:  #4e8ffc;
            --theme-colour-bluedown:  #235ab8;
            
            --theme-colour-green: #2ecc71;
            --theme-colour-greenhover: #2ecc71;
            --theme-colour-greendown: #27ae60;
            
            --theme-colour-yellow: #f1c40f;
            --theme-colour-yellowhover: #f1c40f;
            --theme-colour-yellowdown: #f39c12;
            
            --theme-colour-red: #e74c3c;
            --theme-colour-redhover: #e74c3c;
            --theme-colour-reddown: #c0392b;
            
        }
        

        /* COMMON EASY SWITCHES FOR IN-LINE AD-HOC STYLES */
        .floatLeft      {float:left;}
        .floatRight     {float:right;}
        .clearFloats    {clear:both;}
        .show           {display:block;}
        .hide           {display:none;}
        
        
        /* Global Styles */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #1f1f1f;
            color: #ddd;
            overflow-x: hidden;
            transition: all 0.3s ease-in-out;
        }
        
        #titlebar{
            position:fixed;
            width:calc(100% - 10px);
            min-width:640px;
            height:60px;
            padding:5px;
            z-index:1003;
            background:black; 
        }
        
        #titlebarSpacer{
            position:relative;
            width:calc(100% - 10px);
            height:60px;
            padding:5px;
            background:none; 
        }
    
        
        #titleLogo{
            position:absolute;
            height: 55px;
            left:calc(100% - 80px);
        }
        
        #titleText{
            position:absolute;
            top:25px;
            left:calc(100% - 270px);
            color:white;
            font-weight:600;
            font-size:18px;
        }
        
        .titlebar-icon{
            position:absolute;
            width:30px;
            left:16%;
            top:11%;
        }
        
        #connectionLight{
            position:absolute;
            width:30px;
            top:calc(50% - 15px);
            left:220px;
        }
        
        #connectionLightText{
            position:absolute;
            top:26px;
            left:calc(265px);
            color:white;
            font-weight:500;
            font-size:14px;    
        }
        
        
        #loading-icon-wrap{
            position:absolute;
            top:12px;
            left:212px;
            width:calc(40px - 8px);
            height:calc(40px - 8px);
            padding:5px;

        }
        
        #loading-icon-wrap img{
            top:-2px;
            width:100%;
            height:100%;
        }
        


        #notification-container {
          position: fixed;
          right: 10px; 
          z-index: 10000;
        }

        .notification {
          position: relative;
          margin: 10px 0; /* Adjust margin based on stacking direction */
          padding: 15px;
          border-radius: 8px;
          color: white;
          font-size: 12px;
          line-height: 1.5;
          overflow: hidden;
          opacity: 0;
          transform: translateY(-20px);
          transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .notification.show {
          opacity: 1;
          transform: translateY(0);
        }

        .notification.hide {
          opacity: 0;
          transform: translateY(10px);
          transition: opacity 1s ease, transform 1s ease;
        }
        
        
        
        .warning{
            color:#e74c3c;
            font-size:12px;
        }
        
        
        
        h1 {
            font-size: 2.5em;
            text-align: center;
            color: #f1f1f1;
            margin-top: 30px;
        }

        h2 {
            font-size: 1.8em;
            color: #f1f1f1;
            margin-bottom: 10px;
        }

        /* Toggle Button */
        .titlebar-button {
            position: relative;
            width: calc(100px - 55px);
            height:38px; 
            top:-5px;
            z-index: 1003;
            background: var(--theme-colour-accent1);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .titlebar-button:hover {
            background-color: var(--theme-colour-accent1hover);
        }


        /* Sidebar */
        .sidebar {
            width: 250px;
            height: 100vh;
            background: #222;
            position: fixed;
            top: 0;
            left: -250px;
            transition: left 0.3s ease;
            padding-top: 80px;
            z-index: 100;
            overflow-y:auto;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar .menu-item {
            padding: 15px;
            color: #ddd;
            text-align: center;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .sidebar .menu-item-spacer {
            padding: 15px;
            color: #ddd;
            text-align: center;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .sidebar .menu-item:hover {
            background: #444;
        }

        .sidebar .menu-item.active {
            background: #333;
            font-weight: bold;
        }

        /* Main Content */
        .main-content {
            margin-left: 0;
            margin-top:40px;
            padding: 20px 20px 20px 20px;
            width: calc(100% - 40px);
            transition: margin-left 0.3s ease;
        }

        .main-content.sidebar-active {
            margin-left: 250px;
            width: calc(100% - 290px);
        }

        .main-content .dashboard-btn {
            padding: 10px;
            background: var(--theme-colour-accent1);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: auto;
            margin: 5px;
        }
        
        .main-content .dashboard-btn:hover {
            background-color: var(--theme-colour-accent1hover);
        }

        
        .main-content .dashboard-btn:active {
            background-color: var(--theme-colour-accent1down);
        }
        
        
        .main-content .copy-btn {
            padding: 5px 15px 5px 15px;
            background: var(--theme-colour-accent1);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 70px;
            margin: 10px 0px 10px 0px;
        }
        
        .main-content .copy-btn:hover {
            background-color: var(--theme-colour-accent1hover);
        }
        
        
        
        .dashboard-icon{
            height:80px;
        }
        
        
        
        
        .main-content .table-btn {
            padding: 5px;
            background: var(--theme-colour-accent1);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: auto;
            margin: 10px;
        }
        
        .main-content .table-btn:hover {
            background-color: var(--theme-colour-accent1hover);
        }

        
        
        
        /* Forms and Inputs */
        input, select, textarea {
            background: #333;
            border: 1px solid #444;
            color: #ddd;
            padding: 10px;
            margin: 10px;
            width: calc(100% - 44px);
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            background: #222;
            outline: none;
        }
        
        .dashboard-input{
            width:auto; 
        }
        
        button{
            background: var(--theme-colour-accent2);
            outline: none;
            border: 1px solid #444;
            color: #ddd;
            padding: 10px;
            margin: 10px;
            width: calc(100% - 22px);
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        
        button:hover{
            background: var(--theme-colour-accent2hover);
        }
        
        button:active{
            background: var(--theme-colour-accent2down);
        }

        
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table, th, td {
            border: 1px solid #444;
        }

        th, td {
            padding: 10px;
            text-align: center;
        }

        th {
            background: #444;
        }

        tr:nth-child(even) {
            background: #333;
        }

        tr:hover {
            background: #555;
        }

        

        
        
        
        #page_connect_test_connection{
            width:150px; 
            height:40px; 
            margin-top:37px;
            line-height: 80%; 
        }
        
        
        #page_settings_default_cpuram_interval_button{
            width:150px; 
            height:40px; 
            margin-top:37px;
            margin-right:0px;
            margin-left:10px;
            line-height: 80%;            
        }
        
        #page_settings_default_language_button{
            width:150px; 
            height:40px; 
            margin-top:37px;
            margin-right:0px;
            margin-left:10px;
            line-height: 80%;            
        }
        
        
        #page_settings_enable_cpuram_checkbox{
            width:22px; 
            height:22px; 
            margin-top:41px;
            margin-right:0px;
            margin-left:0px;
            padding:0px;

        }
                
        
        #page_settings_enable_bugix_batch_sizes_checkbox{
            width:22px; 
            height:22px; 
            margin-top:41px;
            margin-right:0px;
            margin-left:0px;
            padding:0px;

        }
        
        
        #page_settings_enable_cpuram_checkbox_label{   
            line-height:700%;
        }        
        
        
        #page_settings_enable_bugix_batch_sizes_checkbox_label{   
            line-height:700%;
        }        
        
        #page_settings_bugfix_batch_sizes_selecttag{
            margin:0px;
            width:200px;
        }
        
        
        
        
        

        
        
        /* Container to wrap all form elements */
        .form-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            max-width: 100%;
            padding: 20px;
        }

        /* Form group styling */
        .form-group {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 250px; /* Minimum width of each input field */
        }

        /* Styling for the labels */
        label {
            font-size: 1rem;
            margin-bottom: 5px;
        }

        /* Styling for the inputs */
        .dashboard-input {
            padding: 10px;
            font-size: 1rem;
            border-radius: 5px;
            width: 100%;
            box-sizing: border-box;
        }

        
        #createCollectionButton{
            background:var(--theme-colour-green);
        }
        
        #createCollectionButton:hover{
            background:var(--theme-colour-greenhover);
        }
        
        #createCollectionButton:active{
            background:var(--theme-colour-greendown);
        }
        
        
        
        #addCollectionMetadata{
            min-height: 250px;
            min-width: 250px;
        }
        
        
        #page_collections_config_metadata{
            min-height:200px;
            min-width:250px;
            height:420px;
        }
        
        
        #page_collections_create_metadata{
            min-height:200px;
            min-width:250px;
            height:250px;
        }
        
        
        .darker-info-label{
            color:grey;
        }
        
        
        
        
        
        
        
        #page_adddocs_document_metadata{
            min-height: 200px;
            height: 600px;
            min-width: 250px;   
            width:calc(100% - 50px);
        }
        
        
        #page_adddocs_document_text{
            min-height: 250px;
            min-width: 250px;  
            width:calc(100% - 25px);
            font-family:sans-serif;
        }
        
        
        
        
        
        
        #page_adddocs_autogen_uuid_button{
            background:var(--theme-colour-yellow);
            width:150px; 
            height:40px; 
            margin-top:37px;
            line-height:80%;
        }
        
        #page_adddocs_autogen_uuid_button:hover{
            background:var(--theme-colour-yellowhover);
        }
        
        #page_adddocs_autogen_uuid_button:active{
            background:var(--theme-colour-yellowdown);
        }
        

        
        
        

        #page_documents_table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            table-layout: fixed;
            border: 1px solid #ccc;
        }

        #page_documents_table th {
            padding: 5px;
            text-align: center;
            word-wrap: break-word;
            font-size: 15px;
        }
        
        #page_documents_table th:nth-child(1) {
            width: 80px;
            text-align: center;
        }
        
        #page_documents_table th:nth-child(2) {
            width: auto
        }
        
        #page_documents_table th:nth-child(3) {
            width: auto
        }
        
        #page_documents_table th:nth-child(4) {
            white-space: pre-wrap !important; /* Ensures newlines and spaces are preserved */
            word-wrap: break-word; /* Prevents long lines from overflowing */
            line-height: 1.4; /* Optional: adjust line height to make the content more readable */
            padding: 8px; /* Optional: add some padding around the text */
            width: auto
        }
        
        #page_documents_table th:nth-child(5) {
            width:180px;
        }
        
        #page_documents_table th:nth-child(6) {
            width:150px;
        }
        
        
        #page_documents_table td {
            max-height: 200px;
            padding: 5px;
            text-align: left;
            word-wrap: break-word;
        }
        
        #page_documents_table td div {
            max-height: 200px;
            overflow: auto;
            text-overflow: ellipsis;
            padding-right: 10px;
            font-size:12px;
        }

        #page_documents_table td:nth-child(4),
        #page_documents_table td:nth-child(5){
            max-height: 200px;
        }

        
        #page_documents_table td:nth-child(3) div {
            max-height: 200px;
            overflow: auto;
            text-overflow: ellipsis;
            padding-right: 10px;
            font-size:12px;
            white-space:pre-wrap;
        }
        
        #page_documents_table td:nth-child(4) div {
            max-height: 200px;
            overflow: auto;
            text-overflow: ellipsis;
            padding-right: 10px;
            font-size:12px;
            white-space:pre-wrap;
        }
        
        #page_documents_table td:nth-child(5) div {
            max-height: 200px;
            overflow: auto;
            text-overflow: ellipsis;
            padding-right: 10px;
            font-size:12px;
        }
        
        

        
        #page_documents_table td:nth-child(6) {
            text-align: center; /* Centers the button container */
        }

        #page_documents_table td:nth-child(6) .action-buttons {
            /* gap: 10px; */
            /* ustify-content: center; */
            width:calc(100% - 0px);
        }

        #page_documents_table td:nth-child(6) button {
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            background-color: #f5f5f5;
            border-radius: 5px;
            transition: background-color 0.3s ease;
            width:60px;
            margin:0px 5px 0px 5px;
            
        }

        #page_documents_table td:nth-child(6) button:hover {
            background-color: #e0e0e0;
        }
        

        
        
        
        
        
        
        /* Container for the form */
        .form-container {
            width:calc(100% - 30px);
            padding: 10px;
        }

        /* Style for each group */
        .group {
            display: flex;            /* Use flexbox to arrange elements horizontally */
            flex-direction: row;      /* Ensure that child elements (select, input) are in a row */
            align-items: center;      /* Align items vertically centered */
        }

        /* Style for select and input elements inside each group */
        .group select {
            padding: 5px 10px;        /* Add padding for better appearance */
            font-size: 14px;          /* Font size for the select and input fields */
            width:120px;
        }
        

        .group input {
            padding: 5px 10px;        /* Add padding for better appearance */
            font-size: 14px;          /* Font size for the select and input fields */
        }

        /* Style for the form label */
        .form-group label {
            display: block;
            font-size: 16px;
            margin-bottom: 10px;
        }

        /* Style for the button to add a group */
        .form-container button {
            padding: 10px 20px;
            background-color: var(--theme-colour-green); /* Green background */
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 20px;
            width:120px;
        }

        .form-container button:hover {
            background-color: var(--theme-colour-greenhover); /* Slightly darker green on hover */
        }
        
        .form-container button:active {
            background-color: var(--theme-colour-greendown); /* Slightly darker green on hover */
        }
        
        
       
        
        
        
        
        #page_updatedocs_document_metadata{
            min-height: 430px;
            min-width: 250px;   
            width:calc(100% - 50px);
        }
        
        
        #page_updatedocs_document_text{
            min-height: 250px;
            min-width: 250px;  
            width:calc(100% - 25px);
            font-family:sans-serif;
        }
        
        
        
        /* Default styles for the button */
        #page_updatedocs_autogen_uuid_button {
            background: var(--theme-colour-yellow);
            width: 150px;
            height: 40px;
            line-height: 80%;
        }

        /* For Webkit-based browsers like Chrome, Safari */
        @media screen and (-webkit-min-device-pixel-ratio: 0) {
            #page_updatedocs_autogen_uuid_button {
                margin-top: 110px;
            }
        }

        /* For Firefox */
        @-moz-document url-prefix() {
            #page_updatedocs_autogen_uuid_button {
                margin-top: 93px;
            }
        }
        
        
        #page_updatedocs_autogen_uuid_button:hover{
            background:var(--theme-colour-yellowhover);
        }
        
        #page_updatedocs_autogen_uuid_button:active{
            background:var(--theme-colour-yellowdown);
        }
        
        
        
        
        
        
        
        #page_search_table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            table-layout: fixed;
            border: 1px solid #ccc;
        }

        #page_search_table th {
            padding: 5px;
            text-align: center;
            word-wrap: break-word;
            font-size: 15px;
        }

        #page_search_table th:nth-child(1) {
            width: 60px;
        }

        #page_search_table th:nth-child(2) {
            width: 120px;
        }

        #page_search_table th:nth-child(3) {

        }

        #page_search_table th:nth-child(4) {
            
        }
        

        #page_search_table th:nth-child(5) {
            width: 80px;
        }

        #page_search_table td {
            max-height: 200px;
            padding: 5px;
            text-align: left;
            word-wrap: break-word;
            overflow:auto;
        }

        #page_search_table td div {
            max-height: 200px;
            text-overflow: ellipsis;
            padding-right: 10px;
            font-size: 12px;
            
        }


        
        

        #page_search_table td:nth-child(3),
        #page_search_table td:nth-child(4) {
            max-height: 200px;
        }

        #page_search_table td:nth-child(3) div {
            max-height: 200px;
            text-overflow: ellipsis;
            padding-right: 10px;
            font-size: 12px;
        }
        
        
        #page_search_table td:nth-child(3) div {
            max-height: 200px;
            overflow: auto;
            padding-right: 10px;
            font-size: 12px;
        }
        
        #page_search_table td:nth-child(3) pre {
            max-height: 200px;
            overflow: auto;
            padding-right: 10px;
            font-size: 12px;
        }
        
        #page_search_table td:nth-child(4) div {
            max-height: 200px;
            overflow: auto;
            padding-right: 10px;
            font-size: 12px;
        }
        
        #page_search_table td:nth-child(4) pre {
            max-height: 200px;
            overflow: auto;
            padding-right: 10px;
            font-size: 12px;
        }

        #page_search_table td:nth-child(5) {
            text-align: center; /* Centers the button container */
        }

        #page_search_table td:nth-child(5) .action-buttons {
            /* gap: 10px; */
            /* justify-content: center; */
            width: calc(100% - 0px);
        }

        #page_search_table td:nth-child(5) button {
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            background-color: #f5f5f5;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        #page_search_table td:nth-child(5) button:hover {
            background-color: #e0e0e0;
        }

        
        
        #page_search_similarity{
            width:calc(100% - 20px);
            min-height:200px;
            font-family: sans-serif;
        }
        
        
        
        
        

        .small-inline-checkbox {
            display: inline;
            width:150px;
            padding:2px 2px 0px 2px;
            margin-left:20px;
        }

        .small-inline-checkbox input {
            width:18px;
            height:18px;
            display: inline-block;
            vertical-align: middle; /* Aligns the checkbox vertically to the middle of the text */
            margin: 0 5px 0 0; /* Optional: Adds some spacing between the checkbox and text */
        }

        .small-inline-checkbox label {
            display: inline-block;
        }
        
        
        
        
        
        #page_settings_cpu_ram_interval_input{
            margin:10px 10px 10px 0px;
            width:auto;
        }


        
        
        /* For Webkit-based browsers like Chrome, Safari */
        @media screen and (-webkit-min-device-pixel-ratio: 0) {
            #page_settings_default_cpuram_interval_button {
                margin-top: 82px;
            }
        }

        /* For Firefox */
        @-moz-document url-prefix() {
            #page_settings_default_cpuram_interval_button {
                margin-top: 66px;
            }
        }
        
        
        
        #page_settings_bugfix_default_batch_size_button{
            width:150px; 
            height:40px; 
            margin-top:100px;
            margin-right:0px;
            margin-left:10px;
            line-height: 80%;            
        }


        #page_settings_app_language_input{
            margin:10px 10px 10px 0px;  
            width:auto;
        }


        
        /* For Webkit-based browsers like Chrome, Safari */
        @media screen and (-webkit-min-device-pixel-ratio: 0) {
            #page_settings_default_language_button {
                margin-top: 82px;
            }
        }

        /* For Firefox */
        @-moz-document url-prefix() {
            #page_settings_default_language_button {
                margin-top: 66px;
            }
        }

        #page_settings_flask_endpoint_input{
            margin:10px 10px 10px 0px; 
        }

        #page_settings_chromadb_path_input{
            margin:10px 10px 10px 0px; 
        }


        #page_settings_proxy_server_input{
            margin:10px 10px 10px 0px; 
        }


        #page_settings_embed_model_input{
            margin:10px 10px 10px 0px; 
        }


        #page_settings_embed_context_window_input{
            margin:10px 10px 10px 0px; 
        }


        #page_settings_embed_model_path_input{
            margin:10px 10px 10px 0px; 
        }

        
        #page_settings_embed_dimension_input{
            margin:10px 10px 10px 0px; 
        }
        
        
        #page_settings_autogen_colname_input{
            margin:10px 10px 10px 0px; 
        }

        
        
        #page_tools_token_counter_textarea{
            min-height:300px;
            white-space: pre;
        }
        
  
        
        
        
        
        #page_tools_embedding_textarea_text{
            min-height:300px;   
            white-space: pre;
        }



        #page_tools_embedding_textarea_embedding{
            min-height:200px;
            min-width:550px;
            overflow: auto;
            width:570px;
            text-overflow: ellipsis;
            
        }


        
        
        
        
        #page_search_similarity_doc_count{

        }



        #page_search_similarity_embed_model{

        }



        #page_search_similarity_embed_context_window{


        }




        #page_tools_hash_text_textarea{
            min-height:200px;
            overflow: auto;
            min-width:200px;
            max-width:500px;
            text-overflow: ellipsis;
        }
        
        
        
        
        
        
        #page_search_document_filters_gui_wrapper {
            width: calc(100% - 40px);
            margin-top: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 10px;
        }



        .filter-parent-container {
            margin-top: 0px;
        }

        /* Group Styles */
        .document-group {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 10px;    
            margin-top:10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        
        .string-value{
            padding:5px;
            border-radius: 5px;
            width:calc(200px - 0px);
            margin:0px 0px 0px 10px;
        }
        
        
        .document-group .document-operator-and-or {
            padding: 5px;
            width:70px;
            margin:0px;
            font-size: 13px;
            border-radius: 5px;
            position:absolute;
        }
        
        .document-group .document-operator-contains {
            padding: 5px;
            font-size: 13px;
            border-radius: 5px;
            margin:0px;
            width:100px;
        }

        .document-group .document-nested-group-container {
            margin-top: 30px;
            display:inline-block;
            width:calc(100% - 0px);
        }

        .document-group button {
            margin-bottom: 0px;
            margin-top:10px;
        }

        /* Nested group and condition styles */
        .document-nested-group-container-group {
            background-color: #f1f1f1;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.1);
        }

        .document-nested-group-container-group .operator {
            margin:0px;
            padding: 5px;
            font-size: 1rem;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        .document-nested-group-container-group input {
            padding: 8px;
            font-size: 1rem;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        
        

        .condition-wrapper {
            display: flex;
            align-items: center;
            margin-bottom: 0px;
        }

        
        .condition-wrapper button.removeNestedButton {
            margin-left: 10px;
            margin-top:8px;
            background-color: #f44336;
            color: white;
            width:26px;
            height:24px;
            border-radius:5px;
            line-height:80%;
            padding:5px;
        }

        .condition-wrapper button.removeNestedButton:hover {
            background-color: #e53935;
        }

        /* Clear and add nested condition buttons */
        .document-nested-group-container-group button {
            width: 48%;
            margin-right: 4%;
        }

        .document-nested-group-container-group button:last-child {
            margin-right: 0;
        }

        
        
        
        
        
        
        /* General styles for clear button */
        .addNestedButton {
            padding: 5px 10px 5px 10px;
            border-radius:5px;
            width: auto;
            margin:0px 0px 0px 0px;
        }
                
        
        /* General styles for clear button */
        .clearNestedButton {
            padding: 5px 10px 5px 10px;
            border-radius:5px;
            width: auto;
            margin:0px;
        }

        
        /* Styled remove group button */
        .addNestedGroupButton {
            padding: 5px 10px 5px 10px;
            border-radius:5px;
            width: auto;
            margin:0px;
        }

        
        /* Styled remove group button */
        .removeGroupButton {
            padding: 5px 10px 5px 10px;
            border-radius:5px;
            width: auto;
            margin:0px;
        }


        
        
        
        
        /* Add group button at the top */
        #page_search_document_filters_add_first_button {
            margin-top: 10px;
            width:auto;
            padding: 8px 15px 8px 15px;
        }
        
        
        
        
        
        
        
        #page_search_python_code_query_structure_wrapper{
            width:calc(100% - 0px);
            padding:0px;
            border-radius:5px;
            /*border:1px solid #f1c40f;*/
            box-shadow: 0px 6px 21px -3px rgba(0,0,0,0.75);
            -webkit-box-shadow: 0px 6px 21px -3px rgba(0,0,0,0.75);
            -moz-box-shadow: 0px 6px 21px -3px rgba(0,0,0,0.75);
            overflow:hidden;
            margin-bottom:60px;
        }
        
        
        #page_search_python_code_query_structure_titlebar{
            width:calc(100% - 30px);
            padding:15px;
            background:#1f1f1f;
            color:#f1c40f;
            font-size:13px;
            font-weight:600;
            
        }
        
        
        #page_search_python_code_query_structure_windowbody{
            padding:20px;
            background:#333;
        }
        
        
        
        .page_search_python_code_query_structure{
            width:calc(100% - 0px);
            white-space: pre-wrap;
            font-size: 14px;
            font-family: consolas;
            color: #a89f87;
        }
        
        
        
        
        .search_python_code_copy_button {
            margin: -5px -5px 0px 0px !important;
            float: right;
        }

        
      
        
        
        
        #page_search_python_code_expanded_wrapper{
            width:calc(100% - 0px);
            padding:0px;
            border-radius:5px;
            /*border:1px solid #f1c40f;*/
            box-shadow: 0px 6px 21px -3px rgba(0,0,0,0.75);
            -webkit-box-shadow: 0px 6px 21px -3px rgba(0,0,0,0.75);
            -moz-box-shadow: 0px 6px 21px -3px rgba(0,0,0,0.75);
            overflow:hidden;
            margin-bottom:60px;
        }
        
        
        #page_search_python_code_expanded_titlebar{
            width:calc(100% - 30px);
            padding:15px;
            background:#1f1f1f;
            color:#f1c40f;
            font-size:13px;
            font-weight:600;
            
        }
        
        
        #page_search_python_code_expanded_windowbody{
            padding:20px;
            background:#333;
        }
        

        

        

        
        
        
        #page_search_python_code_fullexample_wrapper{
            width:calc(100% - 0px);
            padding:0px;
            border-radius:5px;
            /*border:1px solid #f1c40f;*/
            box-shadow: 0px 6px 21px -3px rgba(0,0,0,0.75);
            -webkit-box-shadow: 0px 6px 21px -3px rgba(0,0,0,0.75);
            -moz-box-shadow: 0px 6px 21px -3px rgba(0,0,0,0.75);
            overflow:hidden;
            margin-bottom:60px;
        }
        
        
        #page_search_python_code_fullexample_titlebar{
            width:calc(100% - 30px);
            padding:15px;
            background:#1f1f1f;
            color:#f1c40f;
            font-size:13px;
            font-weight:600;
            
        }
        
        
        #page_search_python_code_fullexample_windowbody{
            padding:20px;
            background:#333;
        }
        
        
        
        
        
        
        
        
        
        
    
        
        .page_help_panel_type2_wrapper{
            width:calc(100% - 0px);
            padding:0px;
            border-radius:5px;
            /*border:1px solid #f1c40f;*/
            box-shadow: 0px 6px 21px -3px rgba(0,0,0,0.75);
            -webkit-box-shadow: 0px 6px 21px -3px rgba(0,0,0,0.75);
            -moz-box-shadow: 0px 6px 21px -3px rgba(0,0,0,0.75);
            overflow:hidden;
            margin-bottom:30px;
        }
        
        
        .page_help_panel_type2_titlebar{
            width:calc(100% - 30px);
            padding:15px;
            background:#1f1f1f;
            color:#f1c40f;
            font-size:14px;
            font-weight:600;
            
        }
        
        .page_help_panel_type2_titlebar label{
            color:white;
            font-size:14px;
            font-weight:100;
        }
        
        
        .page_help_panel_type2_windowbody{
            padding:20px;
            background:#333;
            font-size:13px;
        }
        
        .page_help_panel_type2_windowbody label{
            font-size:13px;
        }
        
        
        
        
        
        
        
 
        
        .page_help_panel_bug_wrapper{
            width:calc(100% - 0px);
            padding:0px;
            border-radius:5px;
            border:1px solid #e74c3c;
            box-shadow: 0px 6px 21px -3px rgba(0,0,0,0.75);
            -webkit-box-shadow: 0px 6px 21px -3px rgba(0,0,0,0.75);
            -moz-box-shadow: 0px 6px 21px -3px rgba(0,0,0,0.75);
            overflow:hidden;
            margin-bottom:30px;
        }
        
        
        .page_help_panel_bug_titlebar{
            width:calc(100% - 30px);
            padding:15px;
            background:#1f1f1f;
            color:#e74c3c;
            font-size:14px;
            font-weight:600;
            
        }
        
        .page_help_panel_bug_titlebar label{
            color:#e74c3c;
            font-size:14px;
            font-weight:100;
        }
        
        
        .page_help_panel_bug_windowbody{
            padding:20px;
            background:#333;
            font-size:13px;
        }
        
        .page_help_panel_bug_windowbody label{
            font-size:13px;
        }
        
        
        
        
        
        

        
        .page_help_panel_info_wrapper{
            width:calc(100% - 0px);
            padding:0px;
            border-radius:5px;
            border:1px solid #3498db;
            box-shadow: 0px 6px 21px -3px rgba(0,0,0,0.75);
            -webkit-box-shadow: 0px 6px 21px -3px rgba(0,0,0,0.75);
            -moz-box-shadow: 0px 6px 21px -3px rgba(0,0,0,0.75);
            overflow:hidden;
            margin-bottom:30px;
        }
        
        
        .page_help_panel_info_titlebar{
            width:calc(100% - 30px);
            padding:15px;
            background:#1f1f1f;
            color:grey;
            font-size:14px;
            font-weight:600;
            
        }
        
        .page_help_panel_info_titlebar label{
            color:grey;
            font-size:14px;
            font-weight:100;
        }
        
        
        .page_help_panel_info_windowbody{
            padding:20px;
            background:#333;
            font-size:13px;
        }
        
        .page_help_panel_info_windowbody label{
            font-size:13px;
        }
        
        
        
        
        



        .content_panel_wrapper {
          padding: 30px;
          border-radius: 10px;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
          text-align: center;
          width:calc(100% - 60px);
          min-width: 800px;
        }

        .file_upload_input_tag {
          display: none;
        }

        .data_file_read_file_button {
          background-color: #007BFF;
          color: white;
          padding: 8px 15px;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          transition: all 0.3s ease;
          font-size: 16px;
          width: auto;
        }

        .data_file_read_file_button:hover {
          background-color: #0056b3;
        }

        .data_file_upload_error_message {
          color: #e74c3c;
          font-size: 16px;
          margin-top: 20px;
          visibility: hidden;
          opacity: 0;
          transition: all 0.3s ease;
        }

        .data_file_upload_error_message.show {
          visibility: visible;
          opacity: 1;
        }

        .data_file_upload_info_label {
          font-size: 14px;
          margin-bottom: 10px;
          font-weight: bold;
        }

        /* Container that wraps the table */
        .data_file_upload_table_container {
            width: 100%;
            max-height: 400px;  /* Set a max height for the table */
            overflow-y: auto;   /* Enable vertical scrolling */
            border-radius:6px;
            position: relative; /* Makes it easier to position the table header */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Container that wraps the table */
        .data_file_upload_table_container table {
            width: 100%;
            border-collapse: collapse;
            margin-top:0px;
        }


        /* Table headers */
        .data_file_upload_table_container th {
          padding: 6px;
          text-align: left;
          position: sticky; /* This keeps the header fixed while scrolling */
          top: -2px; /* Keeps it at the top of the table container */
          z-index: 1; /* Ensures the header stays above the rows */
        }

        /* Table cells */
        .data_file_upload_table_container td {
            padding: 6px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            border:none;
            font-size:12px;
        }

        /* Progress Bar Styles */
        #data_file_upload_progress_container {
          width:calc(100% - 20px);
          border-radius: 5px;
          margin:20px 0px 0px 0px;
        }

        #data_file_upload_progress_bar {
          width: 0;
          height: 10px;
          background-color: #2ecc71;
          border-radius: 5px;
          transition: width 0.3s ease-in-out;
        }

        #file_upload_input_tag{
          display:none;
        }

        .information_panel{
            width:calc(100% - 40px);
            text-align: left;
            border-radius:5px;
            background:#333;
            padding:20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-size:14px;
            color:#999;
        }

        
        .information_panel label {
            font-size:14px;
        }

        .information_panel label ul {
            font-size:14px;
        }
        
        .information_panel label li {
            font-size:14px;
        }
        
        
        #data_file_upload_info_label_file_value{
            color:white;
        }
        
        #data_file_upload_info_label_extension_value{
            color:white;
        }


        #imported_record_count_label_value{
            color:white;
        }   

        
        
        
        .colourBlue {
            background: var(--theme-colour-blue) !important;
        }

        .colourBlue:hover {
            background: var(--theme-colour-bluehover) !important;
        }

        .colourBlue:active {
            background: var(--theme-colour-bluedown) !important;
        }

        .colourGreen {
            background: var(--theme-colour-green) !important;
        }

        .colourGreen:hover {
            background: var(--theme-colour-greenhover) !important;
        }

        .colourGreen:active {
            background: var(--theme-colour-greendown) !important;
        }

        .colourYellow {
            background: var(--theme-colour-yellow) !important;
        }

        .colourYellow:hover {
            background: var(--theme-colour-yellowhover) !important;
        }

        .colourYellow:active {
            background: var(--theme-colour-yellowdown) !important;
        }

        .colourRed {
            background: var(--theme-colour-red) !important;
        }

        .colourRed:hover {
            background: var(--theme-colour-redhover) !important;
        }

        .colourRed:active {
            background: var(--theme-colour-reddown) !important;
        }

        
        
        
        
        #toolStripWrapper {
            background:#1f1f1f;
            position:fixed;
            width:calc(100% - 0px);
            top:70px;
            padding:10px;
            display: flex;
            justify-content: flex-start
            align-items: center;
            gap: 20px; /* Space between buttons */
            left:10px;
        }
        
        
        #toolstrip_WarningNotification{
            display:none;
            padding:2px 10px 2px 10px;
            margin:1px 0px 0px 20px;
            border:1px solid #c0392b;
            border-radius:3px;
            font-size:14px;
            color:#e74c3c;
            height:20px;
            
        }
        

        
        .navButton {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 32px;
            height: 32px;
            font-size: 30px;
            background-color: #333;
            color: white;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.3s ease, background-color 0.3s ease;
            user-select: none;
        }

        /* Hover effect */
        .navButton:hover {
            background-color: #555;
            transform: scale(1.1); /* Slightly enlarge the button */
        }

        /* Active effect (when clicked) */
        .navButton:active {
            background-color: #777;
            transform: scale(0.9); /* Slightly shrink when clicked */
        }

        /* Focus outline for accessibility */
        .navButton:focus {
            outline: 2px solid #ffcc00;
        }

        /* Additional animation if you want them to "fade in" when the page loads */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        #mainBackButton, #mainForwardButton {
            animation: fadeIn 1s ease-out;
        }
        
        
        
        #bugfix100docDisabledLabel{
            position:absolute;
            display:inline-block;
            color: #e74c3c;
        }
        
        
        #generatedJSONOutputTextarea{
            min-height:200px;
            height:600px;
        }
        
        
        #clone_collection_modal_wrap{
            position:fixed;
            z-index:2000;
            background-color: rgba(0, 0, 0, 0.7);
            width:calc(100% - 0px);
            height:calc(100% - 0px);
            
        }
        
        
        #clone_collection_modal{
            position:relative;
            width:calc(70% - 0px);
            left:calc(15% - 0px);
            top:100px;
            background:#222222;
            padding:20px;
            border-radius:10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index:2001;
        }
        
        
        
        #page_collections_clone_collection_new_name_input{
            width:300px; 
            display:inline-block;
        }
        
        #page_collections_modal_clone_button{
            
        }
        
        .page_collections_modal_clone_button{
            width:100px;
        }
        
        
        #page_collections_clone_collection_dropdown{
            width:300px;
            display:inline-block;
        }
        
        
        
        
        #clone_collection_modal_wrap {
            display: none;            /* Start hidden */
            opacity: 0;               /* Start with invisible element */
            transition: opacity 0.5s ease;  /* Transition effect for opacity */
        }

        #clone_collection_modal_wrap.show {
            display: block;           /* Make the element block level when showing */
            opacity: 1;               /* Make the element fully visible */
            transition: opacity 0.5s ease; 
        }


        #page_collections_clone_dialog_refresh_button{
            width:100px;
            padding: 15px;
            background: var(--theme-colour-accent1);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: auto;
            margin: 10px;
        }

        #page_collections_clone_dialog_refresh_button:hover{
            background-color: var(--theme-colour-accent1hover);
        }
        
        

        
        #clone_collection_loading_gif{
            position:relative;
            width:30px; 
            top:9px;
            left:10px;
            display:none;
        }
        
        
        
        
        
        
        #search_filters_choice_gui_radio_button{
            display:inline-block;
            width:20px;
            height:20px;
        }
        
        
        
        
        #search_filters_choice_fallback_radio_button{
            display:inline-block;
            width:20px;
            height:20px;
        }
        
        
        
        
        
        
        
        
        #fallback_enable_where_document_json_textarea{
            margin:0px;
            min-height:100px;
            height:150px;
        }
        
        
        
        #fallback_enable_where_metadata_json_textarea{
            margin:0px;
            min-height:100px;
            height:150px;
        }
        

        #fallback_enable_where_document_json_checkbox{

        }
        
        

        #fallback_enable_where_metadata_json_checkbox{

        }
        
        
        
        
        
        

        #fallback_where_document_example_value_input{
            width:200px;
            margin:10px 0px 20px 0px;
        }


        #fallback_where_metadata_example_key_input{
            width:200px;
            margin:10px 0px 20px 0px;
        }

        
        #fallback_where_metadata_example_value_input{
            width:200px;
            margin:10px 0px 20px 0px;
        }
        
        
        
        
        
        
        
        
        
        #page_export_choices_content_options_wrapper label {
            font-size: 14px;
            margin-right: 15px;
            display: inline-block;
            line-height: 20px; /* Ensure text aligns well with checkboxes */
        }

        #page_export_choices_content_options_documents,
        #page_export_choices_content_options_metadata,
        #page_export_choices_content_options_embeddings,
        #page_export_choices_content_options_ids {
            width: 20px;
            height: 20px;
            vertical-align: middle; /* Ensures alignment with text */
            margin-right: 5px; /* Space between the checkbox and label text */
        }

        #page_export_choices_record_options_wrapper label {
            font-size: 14px;
            margin-right: 15px;
            display: inline-block;
            line-height: 20px; /* Ensure text aligns well with radio buttons */
        }

        #page_export_choices_record_options_all_documents,
        #page_export_choices_record_options_list_of_ids,
        #page_export_choices_record_options_from_to_record {
            width: 20px;
            height: 20px;
            vertical-align: middle; /* Ensures alignment with text */
            margin-right: 5px; /* Space between the radio button and label text */
        }

        #page_export_choices_output_options_wrapper label {
            font-size: 14px;
            margin-right: 15px;
            display: inline-block;
            line-height: 20px; /* Ensure text aligns well with radio buttons */
        }

        #page_export_choices_output_options_one_file,
        #page_export_choices_output_options_split_files {
            width: 20px;
            height: 20px;
            vertical-align: middle; /* Ensures alignment with text */
            margin-right: 5px; /* Space between the radio button and label text */
        }


        
        
        
        #export_from_record_input{
            display:inline-block;
            width:auto;
        }
        
        #export_to_record_input{
            display:inline-block;
            width:auto;
        }
        
        
        
        
        
        
        

        /* Container that wraps the table */
        #data_file_export_table_container {
            width: 100%;
            max-height: 600px;  /* Set a max height for the table */
            overflow-y: auto;   /* Enable vertical scrolling */
            border-radius:6px;
            position: relative; /* Makes it easier to position the table header */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Container that wraps the table */
        #data_file_export_table_container table {
            width: 100%;
            border-collapse: collapse;
            margin-top:0px;
        }


        /* Table headers */
        #data_file_export_table_container table th {
            padding: 6px;
            text-align: left;
            position: sticky; /* This keeps the header fixed while scrolling */
            top: -2px; /* Keeps it at the top of the table container */
            z-index: 1; /* Ensures the header stays above the rows */
            width:auto;
        }
        
        
        
        /* Table headers */
        #data_file_export_table_container table th:nth-child(5){
            width:200px
        }
        
        

        /* Table cells */
        #data_file_export_table_container table td {
            padding: 6px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            border:none;
            font-size:12px;
            width:auto;
        }
        
        

        #data_file_export_table_container table td:nth-child(3) div {
            max-height: 100px;
            text-overflow: ellipsis;
            padding-right: 10px;
            font-size: 12px;
            overflow: auto;
            white-space: collapse;
            width:auto;
            word-wrap: anywhere;
        }
        
        
        #data_file_export_table_container table td:nth-child(3) pre {
            max-height: 100px;
            overflow: auto;
            padding-right: 10px;
            font-size: 12px;
        }
        
        
        
        
        
        #data_file_export_table_container table td:nth-child(4) div {
            max-height: 100px;
            text-overflow: ellipsis;
            padding-right: 10px;
            font-size: 12px;
            overflow: auto;
            white-space: collapse;
            width:auto;
            word-wrap: anywhere;
        }
        
        #data_file_export_table_container table td:nth-child(4) pre {
            max-height: 100px;
            text-overflow: ellipsis;
            padding-right: 10px;
            font-size: 12px;
            overflow: auto;
            white-space: collapse;
            width:auto;
            word-wrap: anywhere;
        }
        
        
        
        
        
        #data_file_export_table_container table td:nth-child(5) div {
            max-height: 100px;
            text-overflow: ellipsis;
            padding-right: 10px;
            font-size: 12px;
            overflow: auto;
            white-space: collapse;
            width: 200px;
            word-wrap: anywhere;
        }
        
        #data_file_export_table_container table td:nth-child(5) pre {
            max-height: 100px;
            overflow: auto;
            padding-right: 10px;
            font-size: 12px;
        }
        
        
        
        
        
        
        #page_settings_embed_model_preset_selecttag{
            margin:0px;
            width:500px;
        }
        
        
        #page_settings_embed_model_preset_default_button{
            padding: 10px;
            background: var(--theme-colour-accent1);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 150px;
            margin: 10px 0px 0px 0px;
            display: inline-block;
        }
        
        
        #page_settings_embed_model_preset_default_button:hover{
            background: var(--theme-colour-accent1hover);
        }
        
        
        #page_settings_embed_model_preset_default_button:active{
            background: var(--theme-colour-accent1down);
        }
        
        
        
        
        #githubChroma{
            width:24px;
            position:relative;
            left:0px;
            top:7px;
            margin-right:10px;
        }        
        
        #githubChromaFlowStudio{
            width:24px;
            position:absolute;
            right:290px;
            top:23px;
        }
        
        
        
        .inner-info-panel{
            border:1px solid #3498db;
            border-radius:5px;
            padding:10px;
            background:#2c3e50;
        }
        
        .inner-info-panel2{
            border:1px solid #2ecc71;
            border-radius:5px;
            padding:10px;
            background:#315c35;
            width:400px;
        }
        
        
        .floating-dashboard-panel{
            border:1px solid #444;
            border-radius:5px;
            padding:10px;
            background:#1c1c1c;
            font-size:12px;
        }
        
        .floating-info-panel{
            border:1px solid #444;
            border-radius:5px;
            padding:10px;
            background:#1c1c1c;
        }
        
        
        
        #page_collections_create_name_autogenbutton{
            margin: 0px;
            position: absolute;
            left: 180px;
        }
        
        
        
        
        /* Animations */
        .fadeIn {
            animation: fadeIn 1s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        
        /* For screens 800px wide or smaller */
        @media (max-width: 800px) {
            #clone_collection_modal {
                width: calc(80% - 0px);
                left: calc(10% - 0px);
            }
        }

        /* For screens 600px wide or smaller */
        @media (max-width: 600px) {
            #clone_collection_modal {
                width: calc(90% - 0px);
                left: calc(5% - 0px);
            }
        }

        

        /* For Chrome, Safari, and other Webkit-based browsers */
        @media screen and (-webkit-min-device-pixel-ratio: 0) {
          .titlebar-button {
            top: 3px; /* Adjust positioning for Webkit browsers */
          }
        }

        /* For Firefox */
        @-moz-document url-prefix() {
          .titlebar-button {
            top: -5px; /* Adjust for Firefox */
          }
        }

        
    </style>
</head>
<body>
    
    
    <div id="clone_collection_modal_wrap" style="display:none">
        <div id="clone_collection_modal">
            
            <h3>Clone Collection:</h3>
            <br>
            <label class="darker-info-label">Cloning a collection includes copying all documents.<br>
            If you want to clone an empty collection, cancel this dialog, and use the 'copy details' button in the 'create collection' section instead.
            <br>
            <br>

            Select a Collection to <b style="color:white">clone from</b><br>
            Enter a <b style="color:white">unique name</b> for the Cloned Collection<br>
            Set an <b style="color:white">import batch size</b>, if unsure, set to 100.<br>
            </label>
            <Br>
            <br>
                
            <label class="warning">
                NOTE:<Br>
                <ul>
                    <!--<li>Text files won't take metadata into account, it'll treat each new line as its own document and come up with its own IDs for you, metadata will be null</li>
                    <li>CSV files expect 3 x columns of "ID, Document, Metadata" separated by commas</li>-->
                    <li>Import batch size must be lower than the Collections Batch Size.</li>
                    <li>Documents and their metadata are extracted WITHOUT embeddings, then re-embedded during the insert into the Cloned Collection, this will take a while for large datasets</li>
                    <li>Chroma still reports max batch size 166 even if collection batch size is bigger, so actually 166 is the maximum import batch size you can have until ChromaDB releases a fix.</li>
                </ul>
            </label>
            
            <br>

            <label>Clone From:</label>
            <select id="page_collections_clone_collection_dropdown" class="dashboard-input" name="page_collections_clone_collection_dropdown" onchange="handleCollectionChange('page_collections_clone_collection_dropdown')">
            </select>
            <button id="page_collections_clone_dialog_refresh_button" class="dashboard-btn" onclick="loadCollections()">Refresh</button>

            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <label for="page_collections_clone_collection_new_name_input">New Name: </label>
            <input id="page_collections_clone_collection_new_name_input" class="dashboard-input" type="text" placeholder="New Collection Name">
            <button id="page_collections_clone_dialog_refresh_button" class="dashboard-btn" onclick="setNewCollectionFields()">Generate</button>
            <br>
            <br>
            <label for="">Document Count:</label> 
            <label for="" id="clone_collection_from_doc_count">0</label> 
            
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <label for="">Collection Batch Size:</label> 
            <label for="" id="clone_collection_from_batch_size">0</label>
            <br>
            <br>
            <br>
            <br>
                
            <label for="">Import Batch Size:&nbsp;&nbsp;</label>
            <select id="page_collections_clone_batch_size_dropdown" class="dashboard-input" name="page_collections_clone_batch_size_dropdown" style="width:100px;" onchange="">
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="50">50</option>
                <option value="100" selected="selected">100</option>
                <option value="200">200</option>
                <option value="500">500</option>
                <option value="1000">1000</option>
                <option value="2000">2000</option>
                <option value="5000">5000</option>
                <option value="10000">10000</option>
                <option value="20000">20000</option>
                <option value="30000">30000</option>
                <option value="40000">40000</option>
                <option value="50000">50000</option>
                <option value="100000">100000</option>
            </select>
            
            <button id="page_collections_modal_clone_button" class="dashboard-btn page_collections_modal_clone_button colourRed" onclick="hideCloneCollectionModal()">Cancel</button>
            <button id="page_collections_modal_clone_button" class="dashboard-btn page_collections_modal_clone_button colourGreen" onclick="cloneCollection()">Clone</button>
            <img id="clone_collection_loading_gif" class="" src="/static/images/loading.gif">
        </div>
    </div>   
    
    
    
    <!-- Title Bar -->
    <div id="titlebar">
        <button id="titleButton_Hamburger" class="titlebar-button colourBlue" onclick="toggleSidebar()" style="top:-1px;">
            ☰
        </button>
        
        <button id="titleButton_Dashboard" class="titlebar-button colourRed" onclick="showPage('dashboard'); updateCPURamInterval(); updateVariousLabels()" >
            <img id="" class="titlebar-icon" src="/static/images/dashboard_white.png">
        </button>
        
        <button id="titleButton_Search" class="titlebar-button colourYellow" onclick="showPage('search'); stopRefreshingSystemStats(); updateVariousLabels(); toggleCheckboxBasedOnDisplay(); toggleSearchPageFilterChoices();">
            <img id="" class="titlebar-icon" src="/static/images/search_white.png">
        </button>
        
        <!--
        <img id="connectionLight" class="" onclick="showPage('connect')" src="/static/images/status_disconnected.png">
        <div id="connectionLightText" onclick="showPage('connect')"></div>
        -->
        
        <div id="loading-icon-wrap" class="hide">
            <img src="static/images/loading.gif"/>
        </div>
        
        
        <a href="https://github.com/coffeecodeconverter/ChromaFlowStudio" target="_blank">
          <img id="githubChromaFlowStudio" src="/static/images/github.png" title="Chroma Flow Studio Github">
        </a>
        
        <div id="titleText">Chroma Flow Studio</div>
        <img id="titleLogo" src="/static/images/logo.png" onclick="">
    </div>
    <div id="titlebarSpacer"></div>
    

    
    
    
    
    <!-- Sidebar -->
    <div id="sideBarWrap" class="sidebar" onmouseleave="closeSidebar()";>
        <div class="menu-item" onclick="showPage('dashboard'); updateCPURamInterval(); updateVariousLabels()">Dashboard</div>
        <div class="menu-item" onclick="showPage('collections'); updateCollectionDocumentCount(); stopRefreshingSystemStats(); fetchCollectionOverview()">Collections</div>
        <div class="menu-item" onclick="showPage('adddocuments'); updateCollectionDocumentCount(); stopRefreshingSystemStats(); calculateTokens('page_adddocs_document_text', 'page_adddocs_token_counter_label')">Add Document</div>
        <div class="menu-item" onclick="showPage('updatedocuments'); stopRefreshingSystemStats(); calculateTokens('page_updatedocs_document_text', 'page_updatedocs_token_counter_label')">Update Document</div>
        <div class="menu-item" onclick="showPage('import'); stopRefreshingSystemStats(); updateVariousLabels()">Import</div>
        <div class="menu-item" onclick="showPage('export'); stopRefreshingSystemStats(); updateVariousLabels()">Export</div>
        <div class="menu-item" onclick="showPage('documents'); loadDocuments(); stopRefreshingSystemStats()">View Documents</div>
        <div class="menu-item" onclick="showPage('search'); stopRefreshingSystemStats(); updateVariousLabels(); toggleCheckboxBasedOnDisplay(); toggleSearchPageFilterChoices();">Search</div>
        <div class="menu-item" onclick="showPage('visualize'); stopRefreshingSystemStats(); updateVariousLabels()">Visualize</div>
        <!-- <div class="menu-item" onclick="showPage('rag'); stopRefreshingSystemStats(); updateVariousLabels();">RAG</div> -->
        <div class="menu-item" onclick="showPage('tools'); stopRefreshingSystemStats(); calculateTokens('page_tools_token_counter_textarea', 'page_tools_token_counter_label')">Tools</div>
        <div class="menu-item" onclick="showPage('settings'); stopRefreshingSystemStats(); fetchAppSettingsJSON()">Settings</div>
        <div class="menu-item" onclick="showPage('help'); stopRefreshingSystemStats(); updateVariousLabels()">Help</div>
        <br>
        <br>
        <br>
        <div class="menu-item" onclick="clearConsoleFlask()" style="font-size:11px; color:#e74c3c">Clear Flask Console</div>
        <div class="menu-item-spacer"></div>
        <div class="menu-item-spacer"></div>
        <div class="menu-item-spacer"></div>
    </div>
    

    
    
    
    <!-- Main Content -->
    <div class="main-content" >
        
        
        
        
        <!-- Forward and Back Buttons -->
        <div id="toolStripWrapper">
            <div id="mainBackButton" class="navButton" onclick="goBack()"> &lt; </div>
            <div id="mainForwardButton" class="navButton" onclick="goForward()"> &gt; </div>
            
            <label id="toolstrip_WarningNotification" onclick="jumpToSettings_EmbedModel()">WARNING: System and Collection Embedding Models Mismatch - Amend here</label>
        </div>

        
        
        
        
        
        
        
        
        <!-- PAGE -->
        <div id="dashboard" class="page fadeIn">
            <h2>Dashboard</h2>
            
            <div class="form-container">

                <div class="form-group">
                    <div class="floating-dashboard-panel">
                        <label for="page_dashboard_chroma_version" class="darker-info-label">ChromaDB Version</label>
                        <div id="page_dashboard_chroma_version">?</div>
                    </div>
                </div>
        
                <div class="form-group">
                    <div class="floating-dashboard-panel">
                        <label for="page_dashboard_flask_server" class="darker-info-label">Flask Server:</label>
                        <div id="page_dashboard_flask_server">?</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="floating-dashboard-panel">
                        <label for="page_dashboard_flask_app_version" class="darker-info-label">Python App Version:</label>
                        <div id="page_dashboard_flask_app_version">?</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="floating-dashboard-panel">
                        <label for="page_dashboard_web_app_version" class="darker-info-label">Web UI Version:</label>
                        <div id="page_dashboard_web_app_version">?</div>
                    </div>
                </div>
                
            </div>
            
            
            <div class="form-container">
                <div class="form-group">
                    <div class="floating-dashboard-panel">
                        <label for="page_dashboard_stats_dbpath" class="darker-info-label">Chroma DB SQLLite Path:</label>
                        <div id="page_dashboard_stats_dbpath">?</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="floating-dashboard-panel">
                        <label for="page_dashboard_stats_embed_model" class="darker-info-label">Embedding Model:</label>
                        <div id="page_dashboard_stats_embed_model">?</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="floating-dashboard-panel">
                        <label for="page_dashboard_stats_embed_model_path" class="darker-info-label">Embedding Model Path:</label>
                        <div id="page_dashboard_stats_embed_model_path">?</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="floating-dashboard-panel">
                        <label for="page_dashboard_stats_embed_context_window" class="darker-info-label">Embedding Context Window:</label>
                        <div id="page_dashboard_stats_embed_context_window">?</div>
                    </div>
                </div>
            </div>
            
            <br>
            <br>
            <br>

            <button id="page_dashboard_quick_button_collections" class="dashboard-btn" onclick="showPage('collections'); updateCollectionDocumentCount(); stopRefreshingSystemStats(); fetchCollectionOverview()" style="width:150px;">
                <img class="dashboard-icon"  src="/static/images/database_white.png"/>
                <br>
                Collections
            </button>
                
            <button id="page_dashboard_quick_button_add_docs" class="dashboard-btn" onclick="showPage('adddocuments'); updateCollectionDocumentCount(); stopRefreshingSystemStats(); calculateTokens('page_adddocs_document_text', 'page_adddocs_token_counter_label')" style="width:150px;">
                <img class="dashboard-icon"  src="/static/images/adddoc_white.png"/>
                <br>
                Add Document
            </button>
                
                
            <button id="page_dashboard_quick_button_documents" class="dashboard-btn" onclick="showPage('documents'); loadDocuments(); stopRefreshingSystemStats()" style="width:150px;">
                <img class="dashboard-icon"  src="/static/images/document_white.png"/>
                <br>
                View Documents
            </button>
                
            <button id="page_dashboard_quick_button_update_docs" class="dashboard-btn" onclick="showPage('updatedocuments'); stopRefreshingSystemStats(); calculateTokens('page_updatedocs_document_text', 'page_updatedocs_token_counter_label')" style="width:150px;">
                <img class="dashboard-icon"  src="/static/images/updatedoc_white.png"/>
                <br>
                Update Document
            </button>
                
                
            <button id="page_dashboard_quick_button_import_docs" class="dashboard-btn" onclick="showPage('import'); stopRefreshingSystemStats(); updateVariousLabels()" style="width:150px;">
                <img class="dashboard-icon"  src="/static/images/importdata2_white.png"/>
                <br>
                Import
            </button>
                
            <button id="page_dashboard_quick_button_export_docs" class="dashboard-btn" onclick="showPage('export'); stopRefreshingSystemStats(); updateVariousLabels()" style="width:150px;">
                <img class="dashboard-icon"  src="/static/images/exportdata_white.png"/>
                <br>
                Export
            </button>
                
                
            <button id="page_dashboard_quick_button_search" class="dashboard-btn" onclick="showPage('search'); stopRefreshingSystemStats(); updateVariousLabels(); toggleCheckboxBasedOnDisplay(); toggleSearchPageFilterChoices();" style="width:150px;">
                <img class="dashboard-icon"  src="/static/images/search_white.png"/>
                <br>
                Search
            </button>
                
                
            <button id="page_dashboard_quick_button_visualize" class="dashboard-btn" style="width:150px;" onclick="showPage('visualize'); stopRefreshingSystemStats(); updateVariousLabels()">
                <img class="dashboard-icon"  src="/static/images/eye_white.png"/>
                <br>
                Visualize
            </button>
                
            <!--
            <button id="page_dashboard_quick_button_rag" class="dashboard-btn" onclick="showPage('rag'); stopRefreshingSystemStats(); updateVariousLabels();" style="width:150px;">
                <img class="dashboard-icon"  src="/static/images/rag_white.png"/>
                <br>
                RAG
            </button>
            -->
                
            <button id="page_dashboard_quick_button_visualize" class="dashboard-btn" style="width:150px;" onclick="showPage('tools'); stopRefreshingSystemStats(); calculateTokens('page_tools_token_counter_textarea', 'page_tools_token_counter_label')">
                <img class="dashboard-icon"  src="/static/images/tools_white.png"/>
                <br>
                Tools
            </button>
                
            <button id="page_dashboard_quick_button_settings" class="dashboard-btn" onclick="showPage('settings'); stopRefreshingSystemStats(); fetchAppSettingsJSON()" style="width:150px;">
                <img class="dashboard-icon"  src="/static/images/settings_white.png"/>
                <br>
                Settings
            </button>
                
            <button id="page_dashboard_quick_button_help" class="dashboard-btn" onclick="showPage('help'); stopRefreshingSystemStats(); updateVariousLabels();" style="width:150px;">
                <img class="dashboard-icon"  src="/static/images/help_white.png"/>
                <br>
                Help
            </button>
                
            <br>
            <br>
            
            
            <h3>Statistics:</h3>
                
            <div class="form-container">
                <div class="form-group">
                    <div class="floating-dashboard-panel">
                        <label for="page_dashboard_stats_collection_count" class="darker-info-label">Total Collections in DB</label>
                        <div id="page_dashboard_stats_collection_count">?</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="floating-dashboard-panel">
                        <label for="page_dashboard_stats_document_count" class="darker-info-label">Total Documents in DB</label>
                        <div id="page_dashboard_stats_document_count">?</div>
                    </div>
                </div>
            </div>
                
            <div class="form-container">
                <div class="form-group">
                    <div class="floating-dashboard-panel">
                        <label for="page_dashboard_stats_cpu" class="darker-info-label">CPU</label>
                        <div id="page_dashboard_stats_cpu">?</div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="floating-dashboard-panel">
                        <label for="page_dashboard_stats_ram" class="darker-info-label">RAM</label>
                        <div id="page_dashboard_stats_ram">?</div>
                    </div>
                </div>
                
            </div>

                
            <br>
            <br>
            <br>
            <br>
            
        </div>
                
                
                
                
                


        
            
            
            
            
            
        <!-- PAGE -->    
        <div id="search" class="page fadeIn" style="display:none;">
            <h2>Search</h2>
            
            <h3>Select Collection:</h3>
            <select id="page_search_collection_dropdown" class="dashboard-input" name="page_search_collection_dropdown" style="min-width:200px; max-width:500px;" onchange="handleCollectionChange('page_search_collection_dropdown')">
            </select>
            <button id="page_search_refresh_button" class="dashboard-btn" onclick="loadCollections(); updateVariousLabels()">Refresh</button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <label class="darker-info-label">Results to Return: </label>
            <input id="page_search_num_of_results" class="dashboard-btn" onclick="" value="10" style="width:40px;"/>

            <Br>

                
            <br>
            <div id="page_search_document_count">
                &nbsp;&nbsp;
                <label id="page_search_similarity_doc_count"><label class="darker-info-label">Document Count:</label>0</label>
                <!-- ADD these new elements to css, the copy the adddocs version of it, then it shoudl line up horizaontally -->

                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <label id="page_search_similarity_embed_model"><label class="darker-info-label">Model: </label>all-MiniLM-L6-v2</label>

                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <label id="page_search_similarity_embed_context_window"><label class="darker-info-label">Context Window: </label>512 tokens</label>
            </div>
            <br>
                
            <br>
            <label for="">&nbsp;&nbsp; Similarity Search:</label>
            <br>
            <div class="form-container">
                <div class="form-group">
                    <!-- <input id="page_search_similarity" type="text" placeholder="Similarity Search">-->
                    <textarea id="page_search_similarity" placeholder="Similarity Search"></textarea>
                </div>
            </div>
            <Br>
            <br>

            <h3>Filters:</h3>
            <br>
            <div class="small-inline-checkbox">
                <input type="checkbox" id="page_search_checkbox_enable_filter" name="filterscheckbox" onchange="toggleSearchPageFilterChoices();">
                <label for="page_search_checkbox_enable_filter">Enable</label>
            </div>
            <br>      
            <br>      



            <div id="page_search_document_filters_choices_wrapper" style="display:none">
                
                <!-- REMOVE the disaply noen from this tag, when ready to implement the GUI filters -->
                <div style="display:none">
                    <label for="option1">GUI Filters</label>
                    <input type="radio" id="search_filters_choice_gui_radio_button" name="search_filters_choice" value="search_filters_choice_gui" onchange="toggleWrapperVisibility()">

                    <label for="option2">Fallback Method</label>
                    <input type="radio" id="search_filters_choice_fallback_radio_button" name="search_filters_choice" value="search_filters_choice_fallback" onchange="toggleWrapperVisibility()">
                </div> 
                
                
                <div id="page_search_document_filters_gui_wrapper"  style="display:none">
                    <h4>Where_Document Filters:</h4>
                    <div class="filter-parent-container" id="filter-parent-container-where-document"></div>
                    <button id="page_search_document_filters_add_first_button" class="dashboard-btn" onclick="addGroupDocument()">Add Filter</button>
                </div>  
                
                
                <div id="page_search_document_filters_fallback_wrapper"  >
                    <div class="page_help_panel_type2_windowbody">
                        <h3>About Filters:</h3>
                        <label for="option1" class="darker-info-label">
                            Document Contents are filtered using a <B style="color:white">Where_Document</B> object, and Metadata Fields are filtered using a <B style="color:white">Where</B> object.<br>
                            Below, you can specify your filters using JSON objects. <br>
                            <i class="warning">However, you must manually edit the JSON in the textarea yourself...</i><br>
                            <br>
                            <div class="inner-info-panel" style="max-width:400px">
                                For more info on filters and their syntax see 
                                    <a href="https://cookbook.chromadb.dev/core/filters/" target="_blank" style="color: white">Here</a>
                                    and
                                    <a href="https://how.wtf/how-to-use-chroma-db-step-by-step-guide.html" target="_blank" style="color: white">Here</a>                           
                                    and
                                    <a href="https://docs.trychroma.com/docs/querying-collections/metadata-filtering" target="_blank" style="color: white">Here</a><br>
                            </div>
                        </label>
                    </div>
                    <br>
                    <br>
                    
                    <div id="fallback_where_document_filters_wrap">
                        <h4>Where_Document Filters:</h4>
                        <div class="small-inline-checkbox">
                            <input type="checkbox" id="fallback_enable_where_document_json_checkbox" name="" onchange="">
                            <label for="">Filter Contents</label>
                        </div> 
                        <br>
                        <br>
                        <div class="page_help_panel_type2_windowbody">
                            <label for="option1" class="darker-info-label">
                                Paste a JSON object of your Document filters, or use the quick buttons below to help you out.<Br>
                                <br>
                                These quick buttons generate several common examples to show the syntax - you can edit it as much as you like.<br>
                                The input field is used with the quick buttons to demonstrate populating the JSON, and to save you retyping your search term while exploring the different examples.<br>
                                <i class="warning">Remeber, you need to edit the JSON in the textarea yourself, these buttons just show you the expected structure...</i><br>
                            </label>
                        </div>
                        <Br>
                            
                        <button class="copy-btn " id="fallback_where_document_button_contains" onclick="fallBackFiltersDocument_Contains()" style="width:80px;">Contains</button>
                        <button class="copy-btn " id="fallback_where_document_button_not_contains" onclick="fallBackFiltersDocument_NotContains()" style="width:120px;">Not Contains</button>
                        <button class="copy-btn " id="fallback_where_document_button_and_contains" onclick="fallBackFiltersDocument_AndContains()" style="width:120px;">And Contains</button>
                        <button class="copy-btn " id="fallback_where_document_button_or_contains" onclick="fallBackFiltersDocument_OrContains()" style="width:100px;">Or Contains</button>
                        <button class="copy-btn " id="fallback_where_document_button_and_not_contains" onclick="fallBackFiltersDocument_AndNotContains()" style="width:150px;">And Not Contains</button>
                        <button class="copy-btn " id="fallback_where_document_button_or_not_contains" onclick="fallBackFiltersDocument_OrNotContains()" style="width:150px;">Or Not Contains</button>
                        <button class="copy-btn " id="fallback_where_document_button_nested" onclick="fallBackFiltersDocument_Nested()" style="width:100px;">Nested</button>
                        <br>
                        <input type="text" id="fallback_where_document_example_value_input" name="" onchange="" placeholder="example keyword or phrase">
                        <textarea id="fallback_enable_where_document_json_textarea"></textarea>
                        <br>
                    </div>
                    <br>
                    <br>
                    <br>
                            
                    <div id="fallback_where_metadata_filters_wrap">
                        <h4>Where Filters <i class="darker-info-label">(metadata fields)</i>:</h4>
                        <div class="small-inline-checkbox">
                            <input type="checkbox" id="fallback_enable_where_metadata_json_checkbox" name="" onchange="">
                            <label for="">Filter Metadata</label>
                        </div> 
                        <br>
                        <br>
                        <div class="page_help_panel_type2_windowbody">
                            <label for="option1" class="darker-info-label">
                                Paste a JSON object of your Metadata filters, or use the quick buttons below to help you out.<Br>
                                <br>
                                The input fields (metadata field, and value) are used with the quick buttons to demonstrate populating the JSON.<br>
                                <i class="warning">Remeber, you need to edit the JSON in the textarea yourself, these buttons just show you the expected structure...</i><br>
                            </label>
                        </div>
                        <br>
                            
                        <button class="copy-btn " onclick="fallBackFiltersMetadata_Equals()" id="fallback_where_metadata_button_equal" style="width:80px;">Equal</button>
                        <button class="copy-btn " onclick="fallBackFiltersMetadata_NotEquals()" id="fallback_where_metadata_button_not_equal" style="width:100px;">Not Equal</button>
                        <button class="copy-btn " onclick="fallBackFiltersMetadata_Or()" id="fallback_where_metadata_button_or" style="width:80px;">Or</button>
                        <button class="copy-btn " onclick="fallBackFiltersMetadata_And()" id="fallback_where_metadata_button_and" style="width:80px;">And</button>
                        <button class="copy-btn " onclick="fallBackFiltersMetadata_Nested()" id="fallback_where_metadata_button_nested" style="width:80px;">Nested</button>
                        <br>
                        <input type="text" id="fallback_where_metadata_example_key_input" name="" onchange="" placeholder="metadata field">
                        <input type="text" id="fallback_where_metadata_example_value_input" name="" onchange="" placeholder="value">
                        <textarea id="fallback_enable_where_metadata_json_textarea"></textarea>
                        <br>
                    </div>
                    
                </div>  
                            
            </div>
            <br>
            <br>
            <br>
                
                
            <button id="page_search_search_button" class="dashboard-btn colourBlue" style="width:100px;" onclick="queryDocumentsNew()">Search</button>
            <br>
            <br>
            <Br>
            <br>
                
                
            <h3>Results:</h3>
            <table id="page_search_table">
                <thead>
                    <tr>
                        <th>Result</th>
                        <th>DocID</th>
                        <th>Document</th>
                        <th>Metadata</th>
                        <th>Similarity</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Document rows will be here -->
                </tbody>
            </table>
            <br>
            <br>            
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            
        
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 1 - Query Similarity Search:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_searchpage_python_code_query_1')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_searchpage_python_code_query_1">
import chromadb
from chromadb.utils import embedding_functions

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Define a query, and a number of results to return 
query_text = "How is artificial intelligence improving healthcare?"

# Define the number of results to return 
num_of_returned_results = 5

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Get the Collection and assign the Embedding Function to it
pycollection = persistentChromaClient.get_collection(
    COLLECTION_NAME, embedding_function=pyEmbedFunction
)

# Perform a vector search for the most similar documents in the collection using the query text
results = pycollection.query(
    query_texts=[query_text],
    n_results=num_of_returned_results
)

# See Search Results
print(f"{results}")

                    </div>
                </div>
            </div> 
                
                
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 2 - Query Similarity Search - Where Document Contains:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_searchpage_python_code_query_2')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_searchpage_python_code_query_2">
import chromadb
from chromadb.utils import embedding_functions

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Define a query, and a number of results to return 
query_text = "sport"

# Define the number of results to return 
num_of_returned_results = 10

# Define filter string 
document_filter_string_1 = "ball"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Get the Collection and assign the Embedding Function to it
pycollection = persistentChromaClient.get_collection(
    COLLECTION_NAME, embedding_function=pyEmbedFunction
)

# Perform a vector search and filter where document contains keyword
results = pycollection.query(
    query_texts=[query_text],
    n_results=num_of_returned_results,
    where_document={
        "$contains": document_filter_string_1
    }
)

# See Search Results
print(f"{results}")
                    </div>
                </div>
            </div> 
                
                
                
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 3 - Query Similarity Search - Where Document Contains or Contains:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_searchpage_python_code_query_3')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_searchpage_python_code_query_3">
import chromadb
from chromadb.utils import embedding_functions

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Define a query, and a number of results to return 
query_text = "sport"

# Define the number of results to return 
num_of_returned_results = 10

# Define filter strings
document_filter_string_1 = "ball"
document_filter_string_2 = "health"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Get the Collection and assign the Embedding Function to it
pycollection = persistentChromaClient.get_collection(
    COLLECTION_NAME, embedding_function=pyEmbedFunction
)

# Perform a vector search and filter where document contains keyword
results = pycollection.query(
    query_texts=[query_text],
    n_results=num_of_returned_results,
    where_document={
        "$or": [
            {"$contains": document_filter_string_1}, 
            {"$contains": document_filter_string_2}
        ]
    }
)

# See Search Results
print(f"{results}")
                    </div>
                </div>
            </div> 
                
                
                
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 4 - Query Similarity Search - Where Document Contains and Contains:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_searchpage_python_code_query_4')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_searchpage_python_code_query_4">
import chromadb
from chromadb.utils import embedding_functions

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Define a query, and a number of results to return 
query_text = "sport"

# Define the number of results to return 
num_of_returned_results = 10

# Define filter strings
document_filter_string_1 = "ball"
document_filter_string_2 = "team"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Get the Collection and assign the Embedding Function to it
pycollection = persistentChromaClient.get_collection(
    COLLECTION_NAME, embedding_function=pyEmbedFunction
)

# Perform a vector search and filter where document contains keyword
results = pycollection.query(
    query_texts=[query_text],
    n_results=num_of_returned_results,
    where_document={
        "$and": [
            {"$contains": document_filter_string_1}, 
            {"$contains": document_filter_string_2}
        ]
    }
)

# See Search Results
print(f"{results}")
                    </div>
                </div>
            </div> 
                
             
                
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 5 - Query Similarity Search - Where Document Contains and Not Contains:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_searchpage_python_code_query_5')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_searchpage_python_code_query_5">
import chromadb
from chromadb.utils import embedding_functions

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Define a query, and a number of results to return 
query_text = "sport"

# Define the number of results to return 
num_of_returned_results = 10

# Define filter strings
document_filter_string_1 = "ball"
document_filter_string_2 = "team"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Get the Collection and assign the Embedding Function to it
pycollection = persistentChromaClient.get_collection(
    COLLECTION_NAME, embedding_function=pyEmbedFunction
)

# Perform a vector search and filter where document contains keyword
results = pycollection.query(
    query_texts=[query_text],
    n_results=num_of_returned_results,
    where_document={
        "$and": [
            {"$contains": document_filter_string_1}, 
            {"$not_contains": document_filter_string_2}
        ]
    }
)

# See Search Results
print(f"{results}")
                    </div>
                </div>
            </div> 
                
                
                
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 6 - Query Similarity Search - Where Document Not Container either Or, and Contains either or:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_searchpage_python_code_query_6')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_searchpage_python_code_query_6">
import chromadb
from chromadb.utils import embedding_functions

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Define a query, and a number of results to return 
query_text = "sport"

# Define the number of results to return 
num_of_returned_results = 10

# Define filter strings
document_filter_string_1 = "technology"
document_filter_string_2 = "thrill"
document_filter_string_3 = "team"
document_filter_string_4 = "game"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Get the Collection and assign the Embedding Function to it
pycollection = persistentChromaClient.get_collection(
    COLLECTION_NAME, embedding_function=pyEmbedFunction
)

# Perform a vector search and filter where document contains keyword
results = pycollection.query(
    query_texts=[query_text],
    n_results=num_of_returned_results,
    where_document={
        "$or": [
            {"$and": [{"$not_contains": document_filter_string_1}, {"$not_contains": document_filter_string_2}]},
            {"$and": [{"$contains": document_filter_string_3}, {"$contains": document_filter_string_4}]}
        ]
    }
)

# See Search Results
print(f"{results}")
                    </div>
                </div>
            </div> 
                
                
            <br>
            <br>
            <br>
            <br>
            <br> 
        </div>
            
            
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
            
        
        <!-- PAGE -->
        <!-- COLLECTIONS -->
        <div id="collections" class="page fadeIn" style="display:none;">
            <h2 id="heading_to_scrollTo_Collections">
                Collections</h2>
            
            <div>
                <select id="page_collections_collection_dropdown" class="dashboard-input" name="page_collections_collection_dropdown" style="min-width:200px; max-width:500px;" onchange="handleCollectionChange('page_collections_collection_dropdown'); updateCollectionDocumentCount()">
                </select>
                <button id="page_collections_refresh_button" class="dashboard-btn" onclick="loadCollections(); updateVariousLabels()">Refresh</button>
                <button id="page_collections_add_collection_button" class="dashboard-btn colourGreen" onclick="setNewCollectionFields(); myScrollTo('emptydivtoScrollto');">New</button>
                <button id="page_collections_clone_button" class="dashboard-btn" onclick="showCloneCollectionModal()">Clone</button>
                <button id="page_collections_delete_button" class="dashboard-btn colourRed" onclick="deleteCollectionFlask(); clearViewDocumentsTableBody()">Delete</button>
                <button id="page_collections_delete_all_button" class="dashboard-btn colourRed" onclick="deleteAllCollectionsFlask(); clearViewDocumentsTableBody()">Delete All</button>
                <button id="page_collections_add_docs_button" class="dashboard-btn colourGreen" onclick="showPage('adddocuments'); updateCollectionDocumentCount(); stopRefreshingSystemStats()">Add Documents</button>
                <button id="page_collections_import_button" class="dashboard-btn" onclick="showPage('import'); stopRefreshingSystemStats(); updateVariousLabels()">Import</button>
                <button id="page_collections_export_button" class="dashboard-btn" onclick="showPage('export'); stopRefreshingSystemStats(); updateVariousLabels()">Export</button>
                <button id="page_collections_documents_button" class="dashboard-btn" onclick="showPage('documents'); loadDocuments(); stopRefreshingSystemStats()">View Documents</button>
                <br>
                <br>
                <div id="page_collections_system_embed_wrap">
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <label id="page_collections_system_embed_model"><label class="darker-info-label">System Embed Model: </label>all-MiniLM-L6-v2</label>

                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <label id="page_collections_system_embed_dimension"><label class="darker-info-label">System Embed Dimension: </label>512 tokens</label>
                </div>
                
                <div class="content_panel_wrapper">

                    <div class="information_panel">
                        <label style="color:white">Overview:</label> 
                            &nbsp;&nbsp;
                            <label class="darker-info-label" >Collection Count: </label>
                            <label id="page_collections_labels_collection_count">0</label>
                        <br>

                        <div class="collectionoverview-container">

                            <table class="collection_overview_table">
                                <thead>
                                    <tr>
                                        <th>Row</th>
                                        <th>Collection ID</th>
                                        <th>Name</th>
                                        <th>Documents</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>

                    </div> 
                            
                </div>
                    
                    

                
                <Br>    
                <Br>    
                
                <!-- Containers for Collection Info -->
                <h3>Collection Details:</h3>
                <div class="form-container">
                    
                    <div class="form-group">
                        <div class="floating-info-panel">
                            <label for="page_collections_details_name" class="darker-info-label">Name</label>
                            <div id="page_collections_details_name">?</div>
                            <button id="page_collections_details_name_copy_button" class="copy-btn" onclick="copyToClipboardById('page_collections_details_name')">Copy</button>
                        </div>
                    </div>
                                            
                    <div class="form-group">
                        <div class="floating-info-panel">
                            <label for="page_collections_details_id" class="darker-info-label">ID</label>
                            <div id="page_collections_details_id">?</div>
                            <button id="page_collections_details_id_copy_button" class="copy-btn" onclick="copyToClipboardById('page_collections_details_id')">Copy</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="floating-info-panel">
                            <label for="page_collections_details_tenant" class="darker-info-label">Tenant</label>
                            <div id="page_collections_details_tenant">?</div>
                            <button class="copy-btn" onclick="copyToClipboardById('page_collections_details_tenant')">Copy</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="floating-info-panel">
                            <label for="page_collections_details_database" class="darker-info-label">Database</label>
                            <div id="page_collections_details_database">?</div>
                            <button class="copy-btn" onclick="copyToClipboardById('page_collections_details_database')">Copy</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="floating-info-panel">
                            <label for="page_collections_details_embed_model" class="darker-info-label">Collection Embed Model</label>
                            <div id="page_collections_details_embed_model">?</div>
                            <button class="copy-btn" onclick="copyToClipboardById('page_collections_details_embed_model')">Copy</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="floating-info-panel">
                            <label for="page_collections_details_embed_dimension" class="darker-info-label">Collection Embed Dimension</label>
                            <div id="page_collections_details_embed_dimension">?</div>
                            <button class="copy-btn" onclick="copyToClipboardById('page_collections_details_embed_dimension')">Copy</button>
                        </div>
                    </div>
                    
                    <!--
                    <div class="form-group">
                        <label for="page_collections_details_dimension" class="darker-info-label">Dimension</label>
                        <div id="page_collections_details_dimension">?</div>
                    </div>
                    -->
                    
                </div>
                <Br>
                <br>
                <br>    
                    
                    
                <h3>Collection Documents:</h3>
                <div class="form-container">
                                            
                    <div class="form-group">
                        <div class="floating-info-panel">
                            <label for="page_collections_docinfo_count" class="darker-info-label">Documents</label>
                            <div id="page_collections_docinfo_count">?</div>
                        </div>
                    </div>
                </div>
                <Br>
                <br>
                <br>
                    
                    
                    
                <h3>Collection Configuration</h3>
                <div class="form-container">
                  
                    <div class="form-group">
                        <div class="floating-info-panel">
                            <label for="page_collections_config_name" class="darker-info-label">Name</label>
                            <div id="page_collections_config_name">?</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="floating-info-panel">
                            <label for="page_collections_config_space" class="darker-info-label">Space (Distance Metric)</label>
                            <div id="page_collections_config_space">?</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="floating-info-panel">
                            <label for="page_collections_config_efconstruction" class="darker-info-label">EF Construction</label>
                            <div id="page_collections_config_ef_construction">?</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="floating-info-panel">
                            <label for="page_collections_config_efsearch" class="darker-info-label">EF Search</label>
                            <div id="page_collections_config_ef_search">?</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="floating-info-panel">
                            <label for="page_collections_config_numofthreads" class="darker-info-label">Number of Threads</label>
                            <div id="page_collections_config_num_of_threads">?</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="floating-info-panel">
                            <label for="page_collections_config_m" class="darker-info-label">M</label>
                            <div id="page_collections_config_m">?</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="floating-info-panel">
                            <label for="page_collections_config_resize_factor" class="darker-info-label">Resize Factor</label>
                            <div id="page_collections_config_resize_factor">?</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="floating-info-panel">
                            <label for="page_collections_config_batch_size" class="darker-info-label">Batch Size</label>
                            <div id="page_collections_config_batch_size">?</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="floating-info-panel">
                            <label for="page_collections_config_sync_threshold" class="darker-info-label">Sync Threshold Factor</label>
                            <div id="page_collections_config_sync_threshold">?</div>
                        </div>
                    </div>
                
                </div>
                <Br>
                <br>
                <br>
                    
                <label for="page_collections_config_metadata">&nbsp;&nbsp; Collection Metadata</label>
                &nbsp;&nbsp;&nbsp; <button id="page_collections_config_metadata_copy_button" class="copy-btn" onclick="copyToClipboardById('page_collections_config_metadata')">Copy</button>
                <br>
                <textarea id="page_collections_config_metadata" disabled></textarea>
                <Br>
                    <div id="emptydivtoScrollto"></div>
                <br>
                <br>
                <br>
                <br>
                <br>
                <Br>
                <br>   
                    
                    
                <!-- Container for Collection Details / Input Fields -->
                <h3 id="subheading_create_collection">Create Collection:</h3>
                <div class="form-container">
                                            
                    <div class="form-group">
                        <label for="page_collections_create_name">&nbsp;&nbsp; Collection Name</label>
                        <button id="page_collections_create_name_autogenbutton" class="copy-btn colourYellow" onclick="setNewCollectionFields()">Auto</button>
                        <input id="page_collections_create_name" class="dashboard-input" type="text" placeholder="Enter Collection Name">
                    </div>

                    <div class="form-group">
                        <label for="page_collections_create_space">&nbsp;&nbsp; Space (Distance Metric)</label>
                        <select id="page_collections_create_space" class="dashboard-input" name="page_collections_create_space">
                            <option value="l2" selected>L2</option>
                            <option value="ip">IP</option>
                            <option value="cosine">Cosine</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="page_collections_create_ef_construction">&nbsp;&nbsp; EF Construction</label>
                        <input id="page_collections_create_ef_construction" class="dashboard-input" type="text" placeholder="Blank - Will Autogenerate">
                    </div>

                    <div class="form-group">
                        <label for="page_collections_create_ef_search">&nbsp;&nbsp; EF Search</label>
                        <input id="page_collections_create_ef_search" class="dashboard-input" type="text" placeholder="Blank - Will Autogenerate">
                    </div>

                    <div class="form-group">
                        <label for="page_collections_create_num_of_threads">&nbsp;&nbsp; Number of Threads</label>
                        <input id="page_collections_create_num_of_threads"  class="dashboard-input" type="text" placeholder="Blank - Will Autogenerate">
                    </div>

                    <div class="form-group">
                        <label for="page_collections_create_m">&nbsp;&nbsp; M</label>
                        <input id="page_collections_create_m" class="dashboard-input" type="text" placeholder="Blank - Will Autogenerate">
                    </div>

                    <div class="form-group">
                        <label for="page_collections_create_resize_factor">&nbsp;&nbsp; Resize Factor</label>
                        <input id="page_collections_create_resize_factor" class="dashboard-input" type="text" placeholder="Blank - Will Autogenerate">
                    </div>

                    <div class="form-group">
                        <label for="page_collections_create_batch_size">&nbsp;&nbsp; Batch Size &nbsp;&nbsp;&nbsp;&nbsp;<label class="warning" for="" id="bugfix100docDisabledLabel" onclick="jumpToSettings_BugFix100Docs()">Disabled in Settings - See <b><u>Here</u></b></label></label>
                       
                        
                        <input id="page_collections_create_batch_size" class="dashboard-input" type="text" placeholder="Blank - Will Autogenerate">
                    </div>

                    <div class="form-group">
                        <label for="page_collections_create_sync_threshold">&nbsp;&nbsp; Sync Threshold Factor</label>
                        <input id="page_collections_create_sync_threshold" class="dashboard-input" type="text" placeholder="Blank - Will Autogenerate">
                    </div>
                    
                </div>
                <br>
                <br> 
                    <label for="page_collections_create_metadata" >&nbsp;&nbsp; Metadata 
                    <div class="small-inline-checkbox">
                        <input type="checkbox" id="page_collections_checkbox_include_metadata" name="myCheckbox" onchange="toggleTextarea('page_collections_checkbox_include_metadata', 'page_collections_create_metadata')">
                        <label for="page_collections_checkbox_include_metadata">Include</label>
                    </div>
                    <br>
                    &nbsp;&nbsp; <i class="darker-info-label">(Optional) accepts a JSON structure</i></label>
                    &nbsp;&nbsp;&nbsp; <button id="page_collections_create_copy_button_metadata" class="copy-btn" onclick="copyToClipboardById('page_collections_create_metadata')">Copy</button>
                <br>
                <textarea id="page_collections_create_metadata">
             </textarea>
                <Br>
                <button id="page_collections_add_collection_button2" class="dashboard-btn colourGreen" onclick="setNewCollectionFields(); myScrollTo('emptydivtoScrollto');">New</button>
                <button id="page_collections_create_default_button" class="dashboard-btn" onclick="confirmSetDefaultNewCollectionFields()">Defaults</button>
                <button id="page_collections_create_default_empty_button" class="dashboard-btn" onclick="confirmSetDefaultNewCollectionFieldsEmpty()">Empty Defaults</button>
                <button id="page_collections_create_copy_details_button" class="dashboard-btn" onclick="copyCollectionDetails()">Copy Details</button>
                <button id="page_collections_create_clear_button" class="dashboard-btn colourRed" onclick="clearAndFocusCollectionFields()">Clear Fields</button>
                <button id="page_collections_create_save_button" class="dashboard-btn colourGreen" onclick="createCollectionFlask()">Create Collection</button>
                <button id="page_collections_create_topofpage_button" class="dashboard-btn" onclick="myScrollToTop()">Top of Page</button>
                <br>
                <br>
                <br>
            </div>

                    
                    
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>   
            <br>   
            <br>   
            <br>   
            <br>   
 
                    
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 1 - Create a Collection:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_search_python_code_query_1')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_search_python_code_query_1">
import chromadb
from chromadb.utils import embedding_functions

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Create the Collection
pycollection = persistentChromaClient.get_or_create_collection(
    COLLECTION_NAME, embedding_function=pyEmbedFunction
)
print(f"Created '{COLLECTION_NAME}' Successfully")
                    </div>
                </div>
            </div>
                
                    
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 2 - Count all Collections:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_search_python_code_query_2')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_search_python_code_query_2">
import chromadb
from chromadb.utils import embedding_functions

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Retrieve all collections
allCollections = persistentChromaClient.list_collections()

# Count the collections
collectionCount = len(allCollections)

# Print Collection Count
print(f"Number of collections: {collectionCount}")
                    </div>
                </div>
            </div>
                
                    
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 3 - Get Collection and Print its Details:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_search_python_code_query_3')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_search_python_code_query_3">
import chromadb
from chromadb.utils import embedding_functions

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Fetch the collection
coll = persistentChromaClient.get_collection(COLLECTION_NAME)

# Print basic collection information
print(f"Getting Collection")
print(f"==============================================================")
print(f" ID:        {coll.id}")
print(f" Name:      {coll.name}")
print(f" tenant:    {coll.tenant}")
print(f" database:  {coll.database}")
print(f"--------------------------------------------------------------")
print(f"Metadata: {coll.metadata}")
print(f"--------------------------------------------------------------")

                    </div>
                </div>
            </div>
                    
                    
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 4 - Get Overview of all Collections: <i class="darker-info-label">(Names, IDs, Document Count)</i>
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_search_python_code_query_4')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_search_python_code_query_4">
import chromadb
from chromadb.utils import embedding_functions

# Configuration variables
CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Retrieve all collections
allCollections = persistentChromaClient.list_collections()

# Count the collections
collectionCount = len(allCollections)

# Print the number of collections
print(f"Overview of All Collections:")
print(f"==========================================================================================")
print(f"Number of collections: {collectionCount}")
print(f"----------------------------------------")

# Optionally: Print the names, IDs, and document counts of the collections
if collectionCount > 0:
    for collection in allCollections:
        # Check if collection is valid before accessing it
        try:
            collection_name = collection.name
            collection_id = collection.id

            # Avoid trying to count documents in empty or corrupted collections
            if collection.count() is not None:
                document_count = collection.count()
                print(f"ID: {collection_id}   Name: {collection_name}   DocCount: {document_count}")
            else:
                print(f"ID: {collection_id}   Name: {collection_name}   DocCount: [Invalid]")

        except Exception as e:
            print(f"Error accessing collection {collection.name}: {str(e)}")
else:
    print("No collections found.")

# Print a closing line
print(f"==========================================================================================")


                    </div>
                </div>
            </div>
                
                    
                    
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 5 - Delete a Collection:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_search_python_code_query_5')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_search_python_code_query_5">
import chromadb
from chromadb.utils import embedding_functions

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Delete the collection
try:
    # Try to retrieve the collection first to check if it exists
    pycollection = persistentChromaClient.get_collection(COLLECTION_NAME)

    # If the collection exists, delete it
    persistentChromaClient.delete_collection(COLLECTION_NAME)
    print(f"Collection '{COLLECTION_NAME}' deleted successfully.")

except Exception as e:
    print(f"Error: Collection '{COLLECTION_NAME}' not found or couldn't be deleted. {e}")
                    </div>
                </div>
            </div>
        
                    
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 6 - Delete all Collections:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_search_python_code_query_6')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_search_python_code_query_6">
import chromadb
from chromadb.utils import embedding_functions

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Delete ALL Collections
print(f"Deleting ALL Collections...")

try:
    # Retrieve all collections (this returns a list of Collection objects)
    collections = persistentChromaClient.list_collections()

    if collections:
        # Iterate through and delete each collection by name
        for collection in collections:
            collection_name = collection.name  # Extract the collection name
            persistentChromaClient.delete_collection(collection_name)
            print(f"Collection '{collection_name}' deleted successfully.")

    else:
        print("No collections found to delete.")
        
except Exception as e:
    print(f"Error: Could not delete collections. {e}")
                    </div>
                </div>
            </div>
              
                    
        </div>

        
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
        
            
        <!-- PAGE -->
        <div id="adddocuments" class="page fadeIn" style="display:none;">

            <h2>Add Document</h2>
            <br>
            
            <h3>Add to Collection:</h3>
            <select id="page_adddocs_collection_dropdown" class="dashboard-input" name="page_adddocs_collection_dropdown" style="min-width:200px; max-width:500px;" onchange="handleCollectionChange('page_adddocs_collection_dropdown')">
            </select>
            <button id="page_adddocs_refresh_button" class="dashboard-btn" onclick="loadCollections(); updateVariousLabels()">Refresh</button>
            <button id="page_adddocs_import_button" class="dashboard-btn" onclick="showPage('import'); stopRefreshingSystemStats()">Import</button>
            <button id="page_adddocs_export_button" class="dashboard-btn" onclick="showPage('export'); stopRefreshingSystemStats()">Export</button>
            <button id="page_adddocs_documents_button" class="dashboard-btn" onclick="showPage('documents'); loadDocuments(); stopRefreshingSystemStats()">View Documents</button>
            <br>
            <br>
            <div id="page_adddocs_document_count">
                &nbsp;&nbsp;
                <label id="page_adddocs_labels_doc_count"><label class="darker-info-label">Document Count: </label>0</label>
                
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <label id="page_adddocs_labels_embed_model"><label class="darker-info-label">Model: </label>all-MiniLM-L6-v2</label>
                
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <label id="page_adddocs_labels_embed_context_window"><label class="darker-info-label">Context Window: </label>512 tokens</label>
            </div>
            <Br>
                
            <div class="form-container">
                
                <!-- Document ID Section -->
                <div class="form-group">
                    <label for="page_adddocs_document_id">&nbsp;&nbsp; Document ID</label>
                    <input id="page_adddocs_document_id" class="dashboard-input" type="text" placeholder="Document ID">
                </div>
                
                <button id="page_adddocs_autogen_uuid_button" class="dashboard-btn colourYellow" onclick="generateUUID('page_adddocs_document_id')" >Auto-generate UUID</button>
            </div>
                
                
        <!--   
            <div class="form-container">
        -->        
                <!-- URI Path Section -->
        <!--    <div class="form-group">
                    <label for="page_adddocs_uri_path">&nbsp;&nbsp; URI Path (Optional)</label>
                    <input id="page_adddocs_uri_path" class="dashboard-input" type="text" placeholder="Optional URI Path">
                </div>
            </div>
         -->
                
            <Br>
                
                
            <label for="page_adddocs_document_text">&nbsp;&nbsp; Document Text / Contents</label>
            &nbsp;&nbsp;&nbsp; <button id="page_adddocs_document_text_copy_button" class="copy-btn" onclick="copyToClipboardById('page_adddocs_document_text')">Copy</button>
            <br>
            <textarea id="page_adddocs_document_text" class="dashboard-input" type="text" placeholder="Document Text" required oninput="calculateTokens('page_adddocs_document_text', 'page_adddocs_token_counter_label')"></textarea>
            <label for="" class="darker-info-label">&nbsp;&nbsp; Token Count:</label>
            <label id="page_adddocs_token_counter_label"  for="" class="">0</label>
            <Br>
            <br>
            <br>
                
                <label for="page_adddocs_document_metadata">&nbsp;&nbsp; Metadata
                <div class="small-inline-checkbox">
                    <input type="checkbox" id="page_adddocs_checkbox_include_metadata" name="myCheckbox" onchange="toggleTextarea('page_adddocs_checkbox_include_metadata', 'page_adddocs_document_metadata');">
                    <label for="page_adddocs_checkbox_include_metadata">Include</label>
                </div>
                <Br>
                &nbsp;&nbsp; <i class="darker-info-label">(Optional) accepts a JSON structure</i></label>
                &nbsp;&nbsp;&nbsp; <button id="page_adddocuments_copy_button_metadata" class="copy-btn" onclick="copyToClipboardById('page_adddocs_document_metadata')">Copy</button>
            <br>
            <textarea id="page_adddocs_document_metadata">
            </textarea>
            <br>
            <br>
                
            <button id="page_adddocs_defaults_button" class="dashboard-btn" onclick="confirmSetDefaultAddDocumentFields();">Defaults</button>
            <button id="page_adddocs_defaults_empty_button" class="dashboard-btn" onclick="confirmSetDefaultAddDocumentFieldsEmpty();">Empty Defaults</button>
            <button id="page_adddocs_clear_button" class="dashboard-btn colourRed" onclick="confirmClearAddDocumentFields()">Clear Fields</button>
            <button id="page_adddocs_save_button" class="dashboard-btn colourGreen" onclick="addDocument()">Add Document</button>
            <button id="page_adddocs_addmany_test_button" class="dashboard-btn" onclick="addManyTestDocuments()">Add Many Test Documents</button>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
                    
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 1 - Add a Document:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_adddocuments_python_code_query_1')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_adddocuments_python_code_query_1">
import chromadb
from chromadb.utils import embedding_functions

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Get the Collection
pycollection = persistentChromaClient.get_collection(
    COLLECTION_NAME, embedding_function=pyEmbedFunction
)

# Create a Document to add
test_document = {
    "id": "test_doc_1",
    "document": "This is a test document for checking the collection.",
}

# Add Document to the Collection
pycollection.add(
    documents=[test_document["document"]],
    ids=[test_document["id"]]
)

print("Test document added to the collection.")
                    </div>
                </div>
            </div>      
                    
                    
                  
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 2 - Add Multiple Documents:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_adddocuments_python_code_query_2')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_adddocuments_python_code_query_2">
import chromadb
from chromadb.utils import embedding_functions

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Get the Collection
pycollection = persistentChromaClient.get_collection(
    COLLECTION_NAME, embedding_function=pyEmbedFunction
)

# create documents
documents = [
    {"id": "doc_1", "document": "The football team trained intensely for the upcoming match. The players are preparing to face their strongest opponents this season.", "metadata": {"source": "sports"}},
    {"id": "doc_2", "document": "The basketball game was thrilling. The team made an impressive comeback in the second half, winning the championship after a fierce battle.", "metadata": {"source": "sports"}},
    {"id": "doc_3", "document": "Technology is constantly evolving, and innovations like AI and machine learning are driving much of the progress in modern industries.", "metadata": {"source": "technology"}},
    {"id": "doc_4", "document": "The latest smartphone models feature cutting-edge AI capabilities, allowing for better image recognition and voice assistance.", "metadata": {"source": "technology"}},
    {"id": "doc_5", "document": "Artificial intelligence is reshaping how businesses approach problems, from customer service to data analysis and predictive maintenance.", "metadata": {"source": "technology"}},
    {"id": "doc_6", "document": "Good health is important for longevity, and exercise plays a vital role in maintaining a healthy body and mind. Regular physical activity improves cardiovascular health.", "metadata": {"source": "health"}},
    {"id": "doc_7", "document": "A balanced diet, rich in vegetables, proteins, and healthy fats, is key to staying in good shape. Health professionals recommend eating a variety of foods.", "metadata": {"source": "health"}},
    {"id": "doc_8", "document": "The integration of artificial intelligence in healthcare is revolutionizing diagnostics, treatment planning, and patient care management.", "metadata": {"source": "technology-health"}},
    {"id": "doc_9", "document": "AI-powered applications in healthcare are helping doctors diagnose diseases faster and with more accuracy, leading to better patient outcomes.", "metadata": {"source": "technology-health"}},
    {"id": "doc_10", "document": "The growing impact of technology on sports is evident in how teams use data analytics to optimize their performance and scout for talent.", "metadata": {"source": "sports-technology"}}
]

# Add the documents to the collection
document_texts = [doc["document"] for doc in documents]
document_ids = [doc["id"] for doc in documents]
document_metadatas = [doc["metadata"] for doc in documents]

pycollection.upsert(
    documents=document_texts,
    metadatas=document_metadatas,
    ids=document_ids
)

print("10 dummy documents added to the collection.")
                    </div>
                </div>
            </div>     
                 
                    
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 3 - Get a Document:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_adddocuments_python_code_query_3')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_adddocuments_python_code_query_3">
import chromadb
from chromadb.utils import embedding_functions
import sys

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Get the Collection
pycollection = persistentChromaClient.get_collection(
    COLLECTION_NAME, embedding_function=pyEmbedFunction
)

# Check if the collection is empty, if so, abort script 
if pycollection.count() == 0:
    print(f"No documents found in collection {COLLECTION_NAME}.")
    print(f"Aborting script.")
    sys.exit()

# Fetch all the documents and their embeddings
results = pycollection.get(include=["embeddings", "documents"])

# Find the document with the specific ID
doc_found = False
for i, doc_id in enumerate(results['ids']):
    if doc_id == TARGET_DOC_ID:
        embedding = results['embeddings'][i]
        document = results['documents'][i]
        print(f"ID: {doc_id}")
        print(f"Document:\n{document}")
        print(f"Embedding:\n{embedding}")
        doc_found = True
        break

# If the document ID was not found
if not doc_found:
    print(f"Document with ID '{TARGET_DOC_ID}' not found in the collection.")
                    </div>
                </div>
            </div>   
                    
                
                    
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 4 - Delete a Document:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_adddocuments_python_code_query_4')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_adddocuments_python_code_query_4">
import chromadb
from chromadb.utils import embedding_functions

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Document ID to Delete
doc_id_to_delete = "test_doc_1"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Get the Collection
pycollection = persistentChromaClient.get_collection(
    COLLECTION_NAME, embedding_function=pyEmbedFunction
)

pycollection.delete([doc_id_to_delete])
print(f"Document with ID {doc_id_to_delete} has been deleted.")
                    </div>
                </div>
            </div>  
                    
                    
                    
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 5 - Delete All Documents from a Collection:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_adddocuments_python_code_query_5')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_adddocuments_python_code_query_5">
import chromadb
from chromadb.utils import embedding_functions
import sys

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Get the Collection
pycollection = persistentChromaClient.get_collection(
    COLLECTION_NAME, embedding_function=pyEmbedFunction
)

pycollection.delete([doc_id_to_delete])
print(f"Document with ID {doc_id_to_delete} has been deleted.")

# Check if the collection is empty, if so, abort script 
if pycollection.count() == 0:
    print(f"No documents found in collection {COLLECTION_NAME}.")
    print(f"Aborting script.")
    sys.exit()

# Fetch all document IDs in the collection
results = pycollection.get(include=["documents"])

# Extract the document IDs
doc_ids_to_delete = results['ids']

# If there are any documents, delete them
if doc_ids_to_delete:
    pycollection.delete(ids=doc_ids_to_delete)
    print(f"All documents in collection '{COLLECTION_NAME}' have been deleted.")

else:
    print(f"No documents found to delete in collection '{COLLECTION_NAME}'.")
                    </div>
                </div>
            </div>  
                    
                    
        </div>
                
                
                
                
                
                
                
                
                
                
                   
        
            
        <!-- PAGE -->
        <div id="updatedocuments" class="page fadeIn" style="display:none;">

            <h2>Update Document</h2>
            <br>
            
            <h3>From Collection:</h3>
            <select id="page_updatedocs_collection_dropdown" class="dashboard-input" name="page_updatedocs_collection_dropdown" style="min-width:200px; max-width:500px;" onchange="handleCollectionChange('page_updatedocs_collection_dropdown')">
            </select>
            <button id="page_updatedocs_refresh_button" class="dashboard-btn" onclick="loadCollections(); updateVariousLabels()">Refresh</button>
            <button id="page_updatedocs_import_button" class="dashboard-btn" onclick="showPage('import'); stopRefreshingSystemStats()">Import</button>
            <button id="page_updatedocs_export_button" class="dashboard-btn" onclick="showPage('export'); stopRefreshingSystemStats()">Export</button>
            <button id="page_updatedocs_documents_button" class="dashboard-btn" onclick="showPage('documents'); loadDocuments(); stopRefreshingSystemStats()">View Documents</button>
            <br>
            <Br>

                <div class="inner-info-panel" style="font-size:13px; max-width:630px;" >
                    NOTE:<br>
                    If you set a non-existent ID, then Update acts as "Upsert" and will insert that document with the specified ID
                </div>
                <br>
                
            <div class="form-container">
                <!-- Update Document ID Section -->
                <div class="form-group">
                    <label for="page_updatedocs_document_id">&nbsp;&nbsp; Document ID to Update:</label>
                    <br>
                    <label for="page_updatedocs_document_id" class="darker-info-label">&nbsp;&nbsp; <i style="font-size:14px;">(enter an ID, or edit an existing document)</i>&nbsp;&nbsp; <button id="page_updatedocs_documents_button" class="copy-btn colourBlue" onclick="showPage('documents'); loadDocuments(); stopRefreshingSystemStats()">Get ID</button></label>
                    <input id="page_updatedocs_document_id" class="dashboard-input" type="text" placeholder="Document ID">
                </div>
                <button id="page_updatedocs_autogen_uuid_button" class="dashboard-btn colourYellow" onclick="generateUUID('page_updatedocs_document_id')" >New UUID</button>
            </div>
                
            <Br>
                
            <label for="page_updatedocs_document_text">&nbsp;&nbsp; Update Document Text / Contents</label>
            &nbsp;&nbsp;&nbsp; <button id="page_updatedocs_document_text_copy_button" class="copy-btn" onclick="copyToClipboardById('page_updatedocs_document_text')">Copy</button>
            <br>
            <textarea id="page_updatedocs_document_text" class="dashboard-input" type="text" placeholder="Document Text" required oninput="calculateTokens('page_updatedocs_document_text', 'page_updatedocs_token_counter_label')"></textarea>
            <label for="" class="darker-info-label">&nbsp;&nbsp; Token Count:</label>
            <label id="page_updatedocs_token_counter_label"  for="" class="">0</label>
            <Br>
            <br>
            <br>
                
                <label for="page_updatedocs_document_metadata">&nbsp;&nbsp; Update Metadata 
                <div class="small-inline-checkbox">
                    <input type="checkbox" id="page_updatedocs_checkbox_include_metadata" name="myCheckbox" onchange="toggleTextarea('page_updatedocs_checkbox_include_metadata', 'page_updatedocs_document_metadata')">
                    <label for="page_updatedocs_checkbox_include_metadata">Include</label>
                </div>
                <!--
                <div class="small-inline-checkbox">
                    <input type="checkbox" id="page_updatedocs_checkbox_wipe_on_update" name="wipeupdatecheckbox" onchange="">
                    <label for="page_updatedocs_checkbox_wipe_on_update">Wipe on Update</label>
                </div>
                -->
                <Br>
                &nbsp;&nbsp; <i class="darker-info-label" style="font-size:14px;">(Optional) accepts a JSON structure</i></label>
                &nbsp;&nbsp;&nbsp; <button id="page_adddocuments_copy_button_metadata" class="copy-btn" onclick="copyToClipboardById('page_updatedocs_document_metadata')">Copy</button>
            <br>
            <br>
            <label for="page_updatedocs_document_metadata" class="warning">&nbsp;&nbsp; WARNING: <Br>&nbsp;&nbsp; ALL Metadata is Overwritten!<Br>&nbsp;&nbsp; Must re-iterate any key value pairs you want to keep</label>
            <br>
            <textarea id="page_updatedocs_document_metadata">
      </textarea>
            <br>
            <br>
                
            <!-- <button id="" class="dashboard-btn" onclick="">Defaults</button> -->
            <button id="page_updatedocs_defaults_button" class="dashboard-btn" onclick="confirmSetDefaultUpdateDocumentFields()">Defaults</button>
            <button id="page_updatedocs_defaults_empty_button" class="dashboard-btn" onclick="confirmSetDefaultUpdateDocumentFieldsEmpty()">Empty Defaults</button>
            <button id="page_updatedocs_clear_button" class="dashboard-btn colourRed" onclick="confirmClearUpdateDocumentFields()">Clear Fields</button>
            <button id="page_updatedocs_save_button" class="dashboard-btn colourGreen" onclick="updateDocument()">Update Document</button>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>

            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 1 - Update a Document:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_updatedocuments_python_code_query_1')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_updatedocuments_python_code_query_1">
import chromadb
from chromadb.utils import embedding_functions
import sys

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Get the Collection
pycollection = persistentChromaClient.get_collection(
    COLLECTION_NAME, embedding_function=pyEmbedFunction
)

# Check if the collection is empty, if so, abort script 
if pycollection.count() == 0:
    print(f"No documents found in collection {COLLECTION_NAME}.")
    print(f"Aborting script.")
    sys.exit()

# Changing the text, and its metadata
test_document = {
    "id": "test_doc_1",
    "document": "changing all of the text so it should have an entirely different embedding. This is an amended document content but using the same document ID.",
    "metadata": {
        "uuid": "b573e65b-3e23-45c6-9129-9b8639f689d3",
        "hash": "e06e32ab-06ca-4aba-b3b1-99c0c622f868",
        "created_date": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
        "modified_date": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
        "file_extension": ".txt",
        "title": "title value",
        "description": "description value",
        "sentiment": "sentiment description here",
        "topic": "topic value",
        "authors": "author1, author2, author3",
        "doc_length": "integer count of all characters helps performance as a pre-calculation",
        "token_count": "tokens needed to make up the document useful to know for llm context sizes",
        "embedding_model": "name of embedding model used, VERY helpful, critical in some cases",
        "embedding_model_version": "version of embedding model if not apparent in its name",
        "language": "might be useful, use common shorthand version like en-GB, en-US etc.",
        "tags": "MUST, be, written, as, a, delimited, string, DOESN'T, accept, nested, lists, like, [tag,tag,tag]",
        "keywords": "MUST, be, written, as, a, delimited, string, DOESN'T, accept, nested, lists, like, [keyword,keyword,keyword]",
        "type": "something to describe a type or categorise it",
        "source": "something about the origin of the document",
        "notes": "can be about anything, or even used as miscellaneous but related info",
        "version": "1.0",
        "uri": "file:///c:/temp/example/path"
    }
}

pycollection.update(
    documents=[test_document["document"]],
    metadatas=[test_document["metadata"]],
    ids=[test_document["id"]]
)

print("Test document contents and metadata updated")
                    </div>
                </div>
            </div> 
                
                
                
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 2 - Update Multiple Documents:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_updatedocuments_python_code_query_2')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_updatedocuments_python_code_query_2">
import chromadb
from chromadb.utils import embedding_functions
import sys

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Get the Collection
pycollection = persistentChromaClient.get_collection(
    COLLECTION_NAME, embedding_function=pyEmbedFunction
)

# Check if the collection is empty, if so, abort script 
if pycollection.count() == 0:
    print(f"No documents found in collection {COLLECTION_NAME}.")
    print(f"Aborting script.")
    sys.exit()

# Prepare a list of documents to update
documents_to_update = [
    {"id": "doc_1", "document": "The football team is gearing up for the national championship game. They have been working hard and are excited about the opportunity.", "metadata": {"source": "sports", "updated": True}},
    {"id": "doc_2", "document": "The basketball team celebrated their recent victory in the tournament. Their teamwork and resilience led them to a strong finish.", "metadata": {"source": "sports", "updated": True}},
    {"id": "doc_3", "document": "The field of artificial intelligence continues to evolve rapidly, with new advancements in neural networks, data processing, and automation.", "metadata": {"source": "technology", "updated": True}},
    {"id": "doc_4", "document": "The newest smartphone models feature enhanced AI, enabling users to take better photos and make smarter decisions using voice commands.", "metadata": {"source": "technology", "updated": True}},
    {"id": "doc_5", "document": "The future of artificial intelligence lies in its integration into various industries. AI is helping businesses automate processes and improve customer service.", "metadata": {"source": "technology", "updated": True}},
    {"id": "doc_6", "document": "Maintaining a healthy lifestyle involves not only regular exercise but also managing stress and sleeping well. Mental health is as important as physical health.", "metadata": {"source": "health", "updated": True}},
    {"id": "doc_7", "document": "Eating a balanced diet is crucial for long-term health. It’s important to include a variety of foods in your diet to ensure you're getting all the necessary nutrients.", "metadata": {"source": "health", "updated": True}},
    {"id": "doc_8", "document": "AI is transforming healthcare by assisting doctors in diagnosing diseases earlier, predicting outcomes, and improving patient care strategies.", "metadata": {"source": "technology-health", "updated": True}},
    {"id": "doc_9", "document": "With advancements in machine learning, AI-powered healthcare applications are becoming more effective in managing patient health and predicting treatment responses.", "metadata": {"source": "technology-health", "updated": True}},
    {"id": "doc_10", "document": "Data analytics is revolutionizing the world of sports. Teams use performance data to strategize and recruit the best talent, making the sport more competitive.", "metadata": {"source": "sports-technology", "updated": True}},
]

# Update the documents in the collection
document_texts = [doc["document"] for doc in documents_to_update]
document_ids = [doc["id"] for doc in documents_to_update]
document_metadatas = [doc["metadata"] for doc in documents_to_update]


# Using the `update` method to update multiple documents at once - but can also user `upsert`
pycollection.update(
    documents=document_texts,
    metadatas=document_metadatas,
    ids=document_ids
)

print("Multiple documents updated in the collection.")
                    </div>
                </div>
            </div> 
                
                
                
        </div>
                
                
                
                
                
                
                
                
                
            
        <!-- PAGE -->
        <div id="import" class="page fadeIn" style="display:none;">

            <h2>Import</h2>
            <br>

            <label for="">&nbsp;&nbsp; Into Collection:&nbsp;&nbsp;</label>
            <select id="page_import_collection_dropdown" class="dashboard-input" name="page_import_collection_dropdown" style="min-width:200px; max-width:500px;" onchange="handleCollectionChange('page_import_collection_dropdown'); ">
            </select>
            <button id="page_import_load_documents_button" class="dashboard-btn" onclick="loadCollections(); updateVariousLabels()">Refresh</button>
            <button id="page_import_view_documents_button" class="dashboard-btn" onclick="showPage('collections'); stopRefreshingSystemStats(); fetchCollectionOverview()">View Collections</button>
            <button id="page_import_view_collections_button" class="dashboard-btn" onclick="showPage('documents'); loadDocuments(); stopRefreshingSystemStats()">View Documents</button>
            <button id="page_import_export_button" class="dashboard-btn" onclick="showPage('export'); stopRefreshingSystemStats()">Export</button>
            <Br>
            <br>
                
            <div id="page_import_document_count">
                &nbsp;&nbsp;
                <label id="page_import_labels_doc_count"><label class="darker-info-label">Document Count: </label>0</label>
                
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <label id="page_import_labels_embed_model"><label class="darker-info-label">Model: </label>all-MiniLM-L6-v2</label>
                
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <label id="page_import_labels_embed_context_window"><label class="darker-info-label">Context Window: </label>512 tokens</label>
                
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <label id="page_import_labels_batch_size_window"><label class="darker-info-label">Collection Batch Size: </label>?</label>
            </div>
                
            <div class="content_panel_wrapper">

                <div class="information_panel">
                    <h3 style="color:white">Importing a Data File:</h3>
                    <br>
                        Upload a .JSON containing multiple ID's, Documents and Metadata to import records in bulk.<br>
                        You can also update multiple documents using this method, as long as the ID's match existing documents.<br>
                        <br>
                        The JSON format should be:<br>
                        <textarea style="width:500px; min-width:400px; height:250px; min-height:250px;  font-size:11px;">
[
  {
    "id": "1",
    "document": "the document 1",
    "metadata": {
      "key": "value 1",
      "additionalInfo": "info for 1"
    }
  },
  {
    "id": "2",
    "document": "the document 2",
    "metadata": {
      "key": "value 2",
      "additionalInfo": "info for 2"
    }
  }
]
                        </textarea>
                        <br>
                        <br>

                        Click <b style="color:white">Browse for a File</b><br>
                            
                        The table below lets you preview the data before importing to Chroma.<br>
                        <br>
                        When you're ready, click <b style="color:white">Import Data to Chroma</b><br>
                        <br>
                        <br>
                        <label class="warning">
                            <div class="inner-info-panel" style="max-width:1600px">
                                NOTE:<Br>
                                <ul>
                                    <!--<li>Text files won't take metadata into account, it'll treat each new line as its own document and come up with its own IDs for you, metadata will be null</li>
                                    <li>CSV files expect 3 x columns of "ID, Document, Metadata" separated by commas</li>-->
                                    <li>Expects JSON items to contain an "id" and "document" key, and optionally a "metadata" json object nested as a value</li>
                                    <li>Import batch size must be lower than the Collections Batch Size.</li>
                                    <li>Chroma still reports max batch size 166 even if collection batch size is bigger, so actually 166 is the maximum import batch size you can have until ChromaDB releases a fix. See more <b onclick="jumpToHelp_BugFix166BatchLimit()"><u>HERE</u></b></li>
                                    <li>Bug in Chroma 0.5.4+ with HNSW config crashes python when documents exceed 100 - workaround is increasing collection batch size, this basically serves as document limit for now until ChromaDB releases a fix. See more <b onclick="jumpToSettings_BugFix100Docs()"><u>HERE</u></b></li>
                                </ul>
                            </div>
                        </label>
                </div> 
                <Br>
                <br>
                <Br>
                <Br>

                <form id="data_file_upload_form_wrapper" enctype="multipart/form-data">

                    <button type="button" class="data_file_read_file_button dashboard-btn" onclick="clickHiddenFileInput()">Browse for File</button>

                    <input type="file" id="file_upload_input_tag" name="file_upload_input_tag" accept=".json" required onchange="updateChosenFilenameAndExt(); handleFileUpload()"/>

                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <label id="data_file_upload_info_label_file" class="data_file_upload_info_label darker-info-label">File: <span id="data_file_upload_info_label_file_value">None</span></label>

                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <label id="data_file_upload_info_label_extension" class="data_file_upload_info_label darker-info-label">Type: <span id="data_file_upload_info_label_extension_value">None</span></label>

                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <label id="imported_record_count_label" class="data_file_upload_info_label darker-info-label">Records: <span id="imported_record_count_label_value">0</span></label>

                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <button type="button" class="data_file_read_file_button dashboard-btn colourRed" onclick="resetTableAndFileInput()">Clear Table</button>

                    <p id="data_file_upload_error_message" class="data_file_upload_error_message"></p>
                    
                    <!-- Progress Bar -->
                    <div id="data_file_upload_progress_container">
                        <div id="data_file_upload_progress_bar"></div>
                    </div>
                    <br>
                    <br>
                    
                </form>


                <!-- Table to display file data -->
                <div class="data_file_upload_table_container">
                    <table id="file-data-table">
                        <thead>
                            <tr>
                                <th>Count</th>
                                <th>ID</th>
                                <th>Document</th>
                                <th>Metadata</th>
                            </tr>
                        </thead>
                        <tbody>
                          <!-- Table rows will be populated dynamically -->
                        </tbody>
                    </table>
                </div>

                <br>
                <br>
                    
                <label for="">Import Batch Size:&nbsp;&nbsp;</label>
                <select id="page_import_batch_size_dropdown" class="dashboard-input" name="page_import_batch_size_dropdown" style="width:100px;" onchange="">
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                    <option value="100" selected="selected">100</option>
                    <option value="200">200</option>
                    <option value="500">500</option>
                    <option value="1000">1000</option>
                    <option value="2000">2000</option>
                    <option value="5000">5000</option>
                    <option value="10000">10000</option>
                    <option value="20000">20000</option>
                    <option value="30000">30000</option>
                    <option value="40000">40000</option>
                    <option value="50000">50000</option>
                    <option value="100000">100000</option>
                </select>
                <button id="import_data_file_to_chroma_button" type="button" class="data_file_read_file_button dashboard-btn colourGreen" onclick="importDataToChroma()">Import Data to Chroma</button>
            </div>
        </div>
                
            
            
            
            
                    
                    
                    
                    
                    
                    
                    
                    
                    
   
        <!-- PAGE -->
        <div id="export" class="page fadeIn" style="display:none;">

            <h2>Export</h2>
            <br>

            <label for="">&nbsp;&nbsp; From Collection:&nbsp;&nbsp;</label>
            <select id="page_export_collection_dropdown" class="dashboard-input" name="page_export_collection_dropdown" style="min-width:200px; max-width:500px;" onchange="handleCollectionChange('page_export_collection_dropdown'); ">
            </select>
            <button id="page_export_load_documents_button" class="dashboard-btn" onclick="loadCollections(); updateVariousLabels()">Refresh</button>
            <button id="page_export_view_collections_button" class="dashboard-btn" onclick="showPage('collections'); stopRefreshingSystemStats(); fetchCollectionOverview()">View Collections</button>
            <button id="page_export_view_documents_button" class="dashboard-btn" onclick="showPage('documents'); loadDocuments(); stopRefreshingSystemStats()">View Documents</button>
            <button id="page_export_import_button" class="dashboard-btn" onclick="showPage('import'); stopRefreshingSystemStats()">Import</button>
            <Br>
            <br>
                
            <div id="page_export_document_count">
                &nbsp;&nbsp;
                <label id="page_export_labels_doc_count"><label class="darker-info-label">Document Count: </label>0</label>
                
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <label id="page_export_labels_embed_model"><label class="darker-info-label">Model: </label>all-MiniLM-L6-v2</label>
                
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <label id="page_export_labels_embed_context_window"><label class="darker-info-label">Context Window: </label>512 tokens</label>
                
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <label id="page_export_labels_batch_size_window"><label class="darker-info-label">Collection Batch Size: </label>?</label>
            </div>
                
            <div class="content_panel_wrapper">

                <div class="information_panel">
                    <h3 style="color:white">Exporting Data to JSON:</h3>
                    
                    <label>This page allows you to export your data in JSON format, offering flexibility in selecting the specific information you'd like to include.<br> 
                    You can choose from several data contexts, including <strong style="color:white">Documents</strong>, <strong style="color:white">Metadata</strong>, or <strong style="color:white">Embeddings</strong></label>
                    <br>
                    <br>
                    
                    <label>Define the scope of the export by selecting one of the following options:</label>
                    <ul>
                      <li><strong>All records</strong>: Export the entire dataset.</li>
                      <li><strong>Specified list of IDs</strong>: Export records based on a list of unique IDs you provide.</li>
                      <li><strong>Range of record indexes</strong>: Export records within a specific range by defining a starting and ending index.</li>
                    </ul>

                    <label>You can customize the exported <strong>filename</strong> and output <strong>directory</strong></label>
                    <br>
                    <br>
                    
                    <label>Lastly, you can preview the data using the <strong style="color:white">Preview Export Data</strong> button. <Br>
                    This allows you to confirm the contents before proceeding with the final export to file.</label>
                    <br>
                    <br>
                        
                    <label>Once you're ready, click <strong style="color:white">Export to JSON</strong></label>
                    <Br>
                    <Br>
                    <Br>
                    <label class="warning">
                        <div class="inner-info-panel" style="max-width:620px">
                            NOTE:<Br>
                            <ul>
                                <li>At least ONE option must be selected from 'Documents', 'Metadata', and/or 'Embeddings'</li>
                            </ul>
                        </div>
                    </label>
                </div> 
            </div>
            <br>
            <br>
                
            <div id="page_export_choices_parent_wrapper">
                
                <div id="page_export_choices_content_options_wrapper">
                    <h3>Include in the Export:</h3>
                    <label for="ids" style="display:none">
                        <input type="checkbox" id="page_export_choices_content_options_ids" name="content_options" value="ids" checked> IDs
                    </label><br>
                    <label for="documents">
                        <input type="checkbox" id="page_export_choices_content_options_documents" name="content_options" value="documents" checked> Documents
                    </label><br>
                    <label for="metadata">
                        <input type="checkbox" id="page_export_choices_content_options_metadata" name="content_options" value="metadata" checked> Metadata
                    </label><br>
                    <label for="embeddings">
                        <input type="checkbox" id="page_export_choices_content_options_embeddings" name="content_options" value="embeddings" checked> Embeddings
                    </label><br>
                </div>
                <br>
                
                <div id="page_export_choices_record_options_wrapper">
                    <h3>Exporting:</h3>
                    <label for="all_documents">
                        <input type="radio" id="page_export_choices_record_options_all_documents" name="record_options" value="all_documents" onchange="toggleNestedExportOptions()" checked> All Documents
                    </label>
                    <label for="list_of_ids">
                        <input type="radio" id="page_export_choices_record_options_list_of_ids" name="record_options" value="list_of_ids" onchange="toggleNestedExportOptions()"> List of ID's
                    </label>
                    <label for="from_to_record">
                        <input type="radio" id="page_export_choices_record_options_from_to_record" name="record_options" value="from_to_record" onchange="toggleNestedExportOptions()"> From and To Record
                    </label><br>

                    <!-- Nested div for "List of ID's" -->
                    <div id="list_of_ids_options" class="nested_option" style="display:none;">
                        <Br>
                        <label for="id_list_input">&nbsp;&nbsp; Enter List of IDs:</label><br>
                        <input type="text" id="export_list_of_ids_input" name="id_list_input" placeholder="Comma separated IDs"><br>
                    </div>

                    <!-- Nested div for "From and To Record" -->
                    <div id="from_to_record_options" class="nested_option" style="display:none;">
                        <br>
                        <label for="from_record">From Record:</label>
                        <input type="number" id="export_from_record_input" name="from_record">
                        <label for="to_record">To Record:</label>
                        <input type="number" id="export_to_record_input" name="to_record"><br>
                    </div>
                </div>
                <br>
                
                <button id="page_export_to_json_preview_button" type="button" class="data_file_read_file_button dashboard-btn" onclick="sendExportOptionsToFlask()">Preview Export Data</button>
                <br>
                <br>
                <div id="data_file_export_table_container">
                    <table id="file_data_export_table">
                        <thead>
                            <tr>
                                <th>Count</th>
                                <th>ID</th>
                                <th>Document</th>
                                <th>Metadata</th>
                                <th>Embedding</th>
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </div>
                <Br>
                <Br>
                <Br>
                
                
                <div id="page_export_choices_output_options_wrapper">
                    <h3>File Options</h3>
                    <label for="one_file">
                        <input type="radio" id="page_export_choices_output_options_one_file" name="output_options" value="one_file" checked> One File
                    </label>
                    <!--
                    <label for="split_files">
                        <input type="radio" id="page_export_choices_output_options_split_files" name="output_options" value="split_files"> Split Files
                    </label><br>
                    -->
                </div>
                <Br>
                <Br>
                <Br>
                
                    
                <div id="page_export_choices_output_filename_wrapper">
                    <h3>Ouput File:</h3>
                    <Br>
                    <label for="one_file">File Name:</label>
                    <input type="text" id="page_export_choices_output_filename_input" name="" value="chromaflow_export_data.json">
                    <Br>
                    <br>
                    <label for="one_file">Output Directory:</label>
                    <input type="text" id="page_export_choices_output_folder_input" name="" value="">
                </div>
                    
            </div>
            <br> 
            <br>
            <br>
                    
            <button id="page_export_to_json_button" type="button" class="data_file_read_file_button dashboard-btn colourGreen" onclick="exportDataToJson()">Export to JSON</button>   
            <br>
            <br>
            <br>
            <br>
            <br>
        </div>
                    
                    
                    
                    
                    
                    
                    
            
            
   
            
        <!-- PAGE -->
        <div id="documents" class="page fadeIn" style="display:none;">

            <h2>View Documents</h2>
            <br>
            
            <!-- <label for="">&nbsp;&nbsp; Select Collection:&nbsp;&nbsp;</label> -->
            <label id="page_documents_labels_doc_count"><label class="darker-info-label">Document Count: </label>0</label>
            <Br>
            <Br>
            <label class="darker-info-label">Showing: </label>
            <label id="showing_document_count">0</label>
            &nbsp;&nbsp;&nbsp;
            <select id="page_documents_collection_dropdown" class="dashboard-input" name="page_documents_collection_dropdown" style="min-width:120px; max-width:250px;" onchange="handleCollectionChange('page_documents_collection_dropdown'); loadDocuments()">
            </select>
            <button id="page_documents_load_documents_button" class="dashboard-btn" onclick="loadDocuments(); clearFilter(); updateVariousLabels()">Refresh</button>
            <button id="page_documents_goto_collections_button" class="dashboard-btn" onclick="showPage('collections'); stopRefreshingSystemStats(); updateVariousLabels(); fetchCollectionOverview()">Collections</button>
            <button id="page_documents_add_doc_button" class="dashboard-btn colourGreen" onclick="showPage('adddocuments'); defaultAddDocumentFields(); updateCollectionDocumentCount(); stopRefreshingSystemStats()"> Add </button>
            <button id="page_documents_import_button" class="dashboard-btn" onclick="showPage('import'); stopRefreshingSystemStats(); updateVariousLabels()">Import</button>
            <button id="page_documents_export_button" class="dashboard-btn" onclick="showPage('export'); stopRefreshingSystemStats(); updateVariousLabels()">Export</button>
            <button id="page_documents_delete_shown_button" class="dashboard-btn colourRed" onclick="confirmDeleteShownDocuments()">Delete Shown</button>
            <button id="page_documents_delete_all_button" class="dashboard-btn colourRed" onclick="confirmDeleteAllDocuments()">Delete All</button>
            <input id="page_documents_filter_input" class="dashboard-input" type="text" style="width:150px" placeholder="Filter" onkeydown="pressEnterToApplyDocFilter()">
            <button id="page_documents_apply_button" class="dashboard-btn" onclick="applyFilter()">Apply Filter</button>
            <button id="page_documents_clear_filter_button" class="dashboard-btn colourRed" onclick="clearFilter()">Clear Filter</button>
            <div style="display:inline-block">
                <label class="darker-info-label">Show: </label>
                <select id="page_documents_results_to_return_selecttag" class="dashboard-btn" onchange="loadDocuments()">
                  <option value="10">10</option>
                  <option value="20">20</option>
                  <option value="30">30</option>
                  <option value="40">40</option>
                  <option value="50">50</option>
                  <option value="100" selected>100</option>
                  <option value="200">200</option>
                  <option value="300">300</option>
                  <option value="400">400</option>
                  <option value="500">500</option>
                  <option value="600">600</option>
                  <option value="700">700</option>
                  <option value="800">800</option>
                  <option value="900">900</option>
                  <option value="1000">1000</option>
                  <option value="2000">2000</option>
                </select>
            </div>
            <Br>



            <!-- Documents Table Section -->
            <table id="page_documents_table">
                <thead>
                    <tr>
                        <th>Row</th>
                        <th>ID</th>
                        <th>Document</th>
                        <th>Metadata</th>
                        <th class="doc_table_col_embedding">Embedding</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Document rows will be here -->
                </tbody>
            </table>
                
                
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
                
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 1 - Get all Documents and Metadata WITHOUT Embeddings:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_viewdocuments_python_code_query_1')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_viewdocuments_python_code_query_1">
import chromadb
from chromadb.utils import embedding_functions
import sys

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Get the Collection
pycollection = persistentChromaClient.get_collection(
    COLLECTION_NAME, embedding_function=pyEmbedFunction
)

# Check if the collection is empty, if so, abort script 
if pycollection.count() == 0:
    print(f"No documents found in collection {COLLECTION_NAME}.")
    print(f"Aborting script.")
    sys.exit()

# Fetch the documents and metadata WITHOUT embeddings
results = pycollection.get(include=["documents", "metadatas"])

# Print Results
for i, doc_id in enumerate(results['ids']):
    document = results['documents'][i]
    metadata = results['metadatas'][i]
    print(f"ID: {doc_id}")
    print(f"Document:\n{document}")
    print(f"Metadata:\n{metadata}")
                    </div>
                </div>
            </div> 
                
                
                
            <div id="page_search_python_code_query_structure_wrapper">
                <div id="page_search_python_code_query_structure_titlebar">
                    Python Snippet 2 - Get all Documents and Metadata WITH Embeddings:
                    <button class="copy-btn search_python_code_copy_button" id="search_python_code_copy_button" onclick="copyToClipboardById('page_viewdocuments_python_code_query_2')">Copy</button>
                </div>
                <div id="page_search_python_code_query_structure_windowbody">
                    <div class="page_search_python_code_query_structure" id="page_viewdocuments_python_code_query_2">
import chromadb
from chromadb.utils import embedding_functions
import sys

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"
COLLECTION_NAME = "testCollection1"

# Create a persistent Chroma client
persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)

# Initialize the embedding function
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

# Get the Collection
pycollection = persistentChromaClient.get_collection(
    COLLECTION_NAME, embedding_function=pyEmbedFunction
)

# Check if the collection is empty, if so, abort script 
if pycollection.count() == 0:
    print(f"No documents found in collection {COLLECTION_NAME}.")
    print(f"Aborting script.")
    sys.exit()

# Fetch the documents and metadata WITH embeddings
results = pycollection.get(include=["embeddings", "documents", "metadatas"])

# Print Results
for i, doc_id in enumerate(results['ids']):
    embedding = results['embeddings'][i]
    document = results['documents'][i]
    metadata = results['metadatas'][i]
    print(f"ID: {doc_id}")
    print(f"Document:\n{document}")
    print(f"Metadata:\n{metadata}")
    print(f"Embedding:\n{embedding}")
                    </div>
                </div>
            </div> 
                
                
                
        </div>
                
                

            
            
            
            
            
            
               
        <!-- PAGE -->
        <div id="visualize" class="page fadeIn" style="display:none;">

            <h2>Visualize</h2>
            <br>


            <label for="">&nbsp;&nbsp; Visualize Collection:&nbsp;&nbsp;</label>
            <select id="page_visualize_collection_dropdown" class="dashboard-input" name="page_visualize_collection_dropdown" style="min-width:200px; max-width:500px;" onchange="handleCollectionChange('page_visualize_collection_dropdown'); ">
            </select>
            <button id="page_visualize_load_documents_button" class="dashboard-btn" onclick="loadCollections(); updateVariousLabels()">Refresh</button>
            <Br>
            <Br>
                
            <div id="page_visualize_document_count">
                &nbsp;&nbsp;
                <label id="page_visualize_labels_doc_count"><label class="darker-info-label">Document Count: </label>0</label>
                
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <label id="page_visualize_labels_embed_model"><label class="darker-info-label">Model: </label>all-MiniLM-L6-v2</label>
                
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <label id="page_visualize_labels_embed_context_window"><label class="darker-info-label">Context Window: </label>512 tokens</label>
                
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <label id="page_visualize_labels_dimension"><label class="darker-info-label">Dimensionality: </label>?</label>
            </div>

            <Br>
            <Br>
                
            <div class="information_panel">
                <h3 style="color:white">Visualize Data with ChromazViz:</h3>
                <br>
                    ChromaViz is a seperate project thats been integrated into Chroma Flow Studio.<br>
                    You can find more information about ChromaViz here: <br>
                    <a style="color:white" href="https://github.com/mtybadger/chromaviz" target="_blank">https://github.com/mtybadger/chromaviz</a>
                    <br>
                    <br>
                    <br>
                
                    To visualise your data:<br>
                    <br>
                     - <b style="color:white">Select a Collection</b> <br>
                     - Then click <b style="color:white">Visualise Data</b> <Br>
                    <br>
                    <br>
                
                <div class="inner-info-panel">
                    <label class="warning">
                        NOTE:<Br>
                        <ul>
                            <li>Doesn't work in all Browsers - Works in Google Chrome, Mozilla Firefox, and Microsoft Edge though. If you have issues, try another browser.</li>
                            <li>Collection must have at least 50 x Documents to visualize.</li>
                        </ul>
                    </label>
                </div>
            </div>
            <br>
            <Br>
                
            <button id="page_visualize_chromaviz_data_button" type="button" class="data_file_read_file_button dashboard-btn colourGreen" onclick="visualizeCollection()">Visualize Data</button>
            <Br>
            <Br>
            <Br>
            <Br>
            <Br>
            <Br>
            <Br>
                
        </div>
                
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
          
        <!-- PAGE -->
        <div id="rag" class="page fadeIn" style="display:none;">

            <h2>RAG</h2>
            <br>

            
            <label for="">&nbsp;&nbsp; Select Collection:&nbsp;&nbsp;</label>
            <select id="page_rag_collection_dropdown" class="dashboard-input" name="page_rag_collection_dropdown" style="min-width:200px; max-width:500px;" onchange="handleCollectionChange('page_rag_collection_dropdown'); ">
            </select>
            <button id="page_rag_load_documents_button" class="dashboard-btn" onclick="">Refresh</button>
            <Br>
            <Br>
                
            <div class="information_panel">
                <h3 style="color:white">Retrieval Augmented Generation (RAG)</h3>
                    RAG (Retrieval-Augmented Generation) is a method of providing external information to an AI Large Language Model (LLM) to improve how it answers questions.<br>
                    Specifically, RAG provides information that wasn't part of the AI's training data - as a means of expanding its knowledge and capabilities without the need to retrain. <br>
                    <br>

                    <label class="warning">
                        NOTE:<Br>
                        <ul>
                            <li>You must configure an LLM model in settings for this to work. Chroma Flow Studio supports using Local Models for free (LM Studio / Ollama) or OpenAI's API if you have a paid account and API Key</li>
                        </ul>
                    </label>
            </div>
                
                
            <h2>** FEATURE TO ADD **</h2>
            <Br>
            <br>
            Idea would be to implement a quick RAG system<br>
            So you just quickly import a bunch of data, to see how it would work in a RAG.<Br>
            Allowing you to quickly try different LLM models, different embedding models, all on the fly<br>
            Can help identify if your chunking method is sufficient, and if similarity searches are accurate. <br>
                
        </div>
            
            
            
            
            
            
            
            
                
                
                
                
                
                
                
                
                
            
            
                
                
        <!-- PAGE -->
        <div id="tools" class="page fadeIn" style="display:none;">

            <h2>Tools</h2>
            <Br>
                
            <h3>Add Test Documents:</h3>
            <div class="page_help_panel_type2_windowbody">
                <label for="" class="darker-info-label">Adds 10 x hard coded test documents with ids and metadata, to whatever collection you've selected.<Br>
                    For demonstration purposes
                </label>
            </div>
            <label for="">&nbsp;&nbsp; Select Collection:&nbsp;&nbsp;</label>
            <select id="page_tools_collection_dropdown" class="dashboard-input" name="page_tools_collection_dropdown" style="min-width:200px; max-width:500px;" onchange="handleCollectionChange('page_tools_collection_dropdown')">
            </select>
            <button id="page_tools_load_documents_button" class="dashboard-btn" onclick="loadCollections()">Refresh</button>
            <button id="page_tools_add_multiple_test_docs_button" class="dashboard-btn" onclick="addManyTestDocuments()">Add Multiple Test Documents</button>
            <button id="page_tools_view_documents" class="dashboard-btn" onclick="showPage('documents'); getAllDocuments()">View Documents</button>
            <Br>


            <br>
            <br>
            <br>
            <br>
            <br>
                
                        
            <h3>UUID Generator:</h3>
            <label for="" class="darker-info-label">Generate a UUID</label>
            <input id="page_tools_uuid_input" class="" type="text" style="width:500px;" onchange="" />
            <button id="page_tools_uuid_generate_button" class="dashboard-btn" onclick="generateUUID('page_tools_uuid_input')">Generate UUID</button>
            <button id="page_tools_uuid_copy_button" class="dashboard-btn" onclick="copyToClipboardById('page_tools_uuid_input')">Copy</button>
            <br>
            <label for="" class="darker-info-label">Other Online Tools:</label>
            <br>
            <br>
            <div class="inner-info-panel">
                &nbsp;&nbsp;
                <a href="https://www.uuidgenerator.net/" target="_blank" style="color: white; font-size:13px;">UUID Generator</a> <br> &nbsp;&nbsp;
                <a href="https://www.uuidtools.com/" target="_blank" style="color: white; font-size:13px;">UUID</a>
            </div>
            <Br>
 
                
            <br>
            <br>
            <br>
            <br>
            <br>
                
                        
            <h3>Hash Generator:</h3>
            <label for="" class="darker-info-label">Text to Hash</label>
            <Br>
            <br>
            <textarea id="page_tools_hash_text_textarea" class=""></textarea>
            <br>
            <br>
            <label for="" class="darker-info-label">Generated SHA-256 Hash</label>
            <br>
                
            <input id="page_tools_hash_input" class="" type="text" style="width:500px;" onchange="" />
            <button id="page_tools_hash_clear_text_button" class="dashboard-btn" onclick="clearToolsHashText()">Clear Text</button>
            <button id="page_tools_hash_generate_button" class="dashboard-btn" onclick="setElementHashById('page_tools_hash_input', 'page_tools_hash_text_textarea')">Generate Hash</button>
            <button id="page_tools_hash_copy_button" class="dashboard-btn" onclick="copyToClipboardById('page_tools_hash_input')">Copy</button>
            <br>
            <br>
            <label for="" class="darker-info-label">Other Online Tools:</label>
            <br>
            <br>
            <div class="inner-info-panel">
                &nbsp;&nbsp;
                <a href="https://www.browserling.com/tools/all-hashes" target="_blank" style="color: white; font-size:13px;">Check all Hashes at once</a> <br> &nbsp;&nbsp;
                <a href="https://hashes.com/en/generate/hash" target="_blank" style="color: white; font-size:13px;">Another that checks all Hashes at once</a> <br> &nbsp;&nbsp;
                <a href="https://www.sordum.org/hashgenerator/" target="_blank" style="color: white; font-size:13px;">Check any Hash</a> 
            </div>
            <Br>
                
                
            <br>
            <br>
            <br>
            <br>
            <br>
                
                        
            <h3>Timestamp Generator:</h3>
            <label for="" class="darker-info-label">Generate a Timestamp</label>
            <Br>
            <Br>
            <input id="page_tools_timestamp_input" class="" type="text" style="width:300px;" onchange="" />
            <button id="page_tools_timestamp_generate_button" class="dashboard-btn" onclick="generateTimestamp('page_tools_timestamp_input')">Generate</button>
            <button id="page_tools_timestamp_copy_button" class="dashboard-btn" onclick="copyToClipboardById('page_tools_timestamp_input')">Copy</button>
            <Br>
                
                
            <br>
            <br>
            <br>
            <br>
            <br>
                
                        
            <h3>Token Counter:</h3>
            <label for="" class="darker-info-label">Paste or type text to measure how  many tokens it costs</label>
            <Br>
            <Br>
            <label for="" class="darker-info-label">Token Count:</label>
            <label id="page_tools_token_counter_label"  for="" class="">0</label>
            <br>
            <br>
            <textarea id="page_tools_token_counter_textarea" class="" oninput="calculateTokens('page_tools_token_counter_textarea', 'page_tools_token_counter_label')"></textarea>
            <br>
            <button id="page_tools_token_counter_textarea_clear_button" class="dashboard-btn colourRed" onclick="clearToolsTokenCounter()">Clear Token Counter</button>
            <br>
            <br>
            <label for="" class="darker-info-label">Other Online Tools:</label>
            <br>
            <br>
            <div class="inner-info-panel">
                &nbsp;&nbsp;
                <a href="https://platform.openai.com/tokenizer" target="_blank" style="color: white; font-size:13px;">OpenAI Token Counter</a> <br> &nbsp;&nbsp;
                <a href="https://tokencounter.org/" target="_blank" style="color: white; font-size:13px;">Token Counter</a>
            </div>
            <Br>
                
                
            <br>
            <br>
            <br>
            <br>
            <br>
                
                        
            <h3>Embedding Generator:</h3>
            <div class="page_help_panel_type2_windowbody">
                <label for="" class="darker-info-label">Paste or type some text, and use the ChromaDB Embedding model to generate an embedding.<br>
                Useful to generate on the fly, for comparisons, or troubleshooting, etc.<br>
                Can even be used as a crude embedding generator for other applications</label>
            </div>
            <Br>
            <br>
            <label for="" class="darker-info-label">Text:</label>
            <Br>
            <br>
            <label for="" class="darker-info-label">Token Count:</label>
            <label id="page_tools_embedding_textarea_token_count_label" for="" class="">0</label>
            <br>
            <br>
            <textarea id="page_tools_embedding_textarea_text" class="" oninput="calculateTokens('page_tools_embedding_textarea_text', 'page_tools_embedding_textarea_token_count_label')"></textarea>
            <br>
            <br>
            <label for="" class="darker-info-label">Embedding:</label>
            <br>
            <br>
            <label for="" class="darker-info-label">Model:</label>
            <label id="page_tools_embedding_generator_model_name" for="" class="">?</label>
            &nbsp;&nbsp;&nbsp;&nbsp;    
            <label for="" class="darker-info-label">Context Window:</label>
            <label id="page_tools_embedding_generator_context_window" for="" class="">?</label>
            <br>
            <br>
            <textarea id="page_tools_embedding_textarea_embedding" class=""></textarea>
            <br>
            <button id="page_tools_embedding_generate_embedding_button" class="dashboard-btn" onclick="generateEmbedding()">Generate Embedding</button>
            <button id="page_tools_embedding_copy_embedding_button" class="dashboard-btn" onclick="copyToClipboardById('page_tools_embedding_textarea_embedding')">Copy Embedding</button>
            <button id="page_tools_embedding_clear_text_button" class="dashboard-btn colourRed" onclick="clearToolsEmbeddingText()">Clear Text</button>
            <button id="page_tools_embedding_clear_embedding_button" class="dashboard-btn colourRed" onclick="clearToolsEmbedding()">Clear Embedding</button>
            <br>
            <br>
            <label for="" class="darker-info-label">Other Online Tools:</label>
            <br>
            <br>
            <div class="inner-info-panel">
                &nbsp;&nbsp;
                <a href="https://huggingface.co/spaces/coffeecodeconverter/sentence-transformers-all-MiniLM-L6-v2" target="_blank" style="color: white; font-size:13px;">Embedding Generator on HuggingFace Spaces</a>
            </div>
            <Br>
            <Br>
            <Br>
            <Br>
            <Br>
            <Br>
            <Br>
                
                
            <div class="data_generator_container">
                <h3>Synthetic JSON Generator</h3>
                <br>

                    
                <div class="controls">
                    <!-- Start Record -->
                    <label for="start-record">Start Record:</label>
                    <input type="number" id="start-record" value="1" min="1" onchange="getGeneratedDataCount()" style="width:100px">

                    <!-- End Record -->
                    <label for="end-record">End Record:</label>
                    <input type="number" id="end-record" value="5" min="1" onchange="getGeneratedDataCount()" style="width:100px">
                    
                    <!-- Generating Record Count (Grouped Pair) -->
                    <label for="recordCountLabel">Generating: </label>
                    <label id="recordCountLabel" class="value-label">0</label>
                    <br>
                    <br>                    
                    
                    <!-- Filename -->
                    <label for="filename">Filename:</label>
                    <input type="text" id="generate_data_filename_input" name="filename" placeholder="Enter filename">
                </div>


                <div class="content-section" id="content-placeholder-json" style="display:none">
                    <div class="wrapper">
                      <div class="control">
                          <br>
                          <br>
                        <label for="id">ID:</label>
                        <input type="text" id="document_id_for_autogen_json" name="id" />
                      </div>
                    <br>
                      <div class="control">
                        <label for="document">Document:</label>
                          <br>
                          <br>
                        <textarea id="document_text_for_autogen_json" name="document">the document text for json</textarea>
                      </div>
                    </div>
                </div>
                <br>
                
                <label for="filename">Generated Data:</label>
                <textarea id="generatedJSONOutputTextarea" rows="10" placeholder="Generated output will appear here..."></textarea>

                <button id="generate-button" class="dashboard-btn" onclick="generateSyntheticData()">Generate</button>
                <button id="copy-button" class="dashboard-btn" onclick="copyGeneratedTextToClipboard()">Copy to Clipboard</button>
                <button id="save-button" class="dashboard-btn colourGreen" onclick="saveGeneratedDataToFile()">Save</button>
            </div>

                
                
                
            <br>
            <br>
            <br>
            <br>
            <br>
        </div>
                
                
            
            
                
                
            
            
        <!-- PAGE -->
        <div id="settings" class="page fadeIn" style="display:none;">
            <h2>Settings</h2>

            <div class="form-container">
                
                <div class="form-group">
                    <div class="floating-info-panel">
                        <label for="page_settings_chroma_server_version" class="darker-info-label">ChromaDB Version</label>
                        <div id="page_settings_chroma_server_version">?</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="floating-info-panel">
                        <label for="page_settings_flask_app_version" class="darker-info-label">Python App Version:</label>
                        <div id="page_settings_flask_app_version">?</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="floating-info-panel">
                        <label for="page_settings_app_version" class="darker-info-label">Web UI Version:</label>
                        <div id="page_setting_app_version">?</div>
                    </div>
                </div>
                
            </div>
            
            <Br>
            <br>
                
            <Br>
                <label for="" class="warning"><big>Restart App for changes to Take Effect. <br> OR, click Restart Server at the Bottom of this page after making changes</big></label>
            <br>
                
            <br>
            <br>
            <br>
                
                
            <div class="form-container">
                <div class="form-group">
                    <label for="page_settings_flask_endpoint_input">Flask Server Endpoint</label>
                    <br>
                    <label for="" class="darker-info-label" style="font-size:12px;">Change if Chroma Flow Studio conflicts with other processes</label>
                    <input id="page_settings_flask_endpoint_input" class="dashboard-input" type="text" placeholder="http://127.0.0.1:5000" value="http://127.0.0.1:5000" onchange=""/>
                </div>
                
                <div class="form-group">
                    <label for="page_settings_chromadb_path_input">ChromaDB Path</label>
                    <br>
                    <label for="" class="darker-info-label" style="font-size:12px;">Easily switch between SQLLite DB files</label>
                    <input id="page_settings_chromadb_path_input" class="dashboard-input" type="text" placeholder="C:\temp" value="C:\temp" onchange=""/>
                </div>
                
                <div class="form-group">
                    <label for="page_settings_proxy_server_input">Proxy Server Endpoint</label>
                    <br>
                    <label for="" class="darker-info-label" style="font-size:12px;" >Leave blank if you're not using a proxy</label>
                    <input id="page_settings_proxy_server_input" class="dashboard-input" type="text" placeholder="i.e. http://127.0.0.1:3128" value="http://127.0.0.1:3128" onchange=""/>
                </div>
            </div>

            <Br>
            <br>
            <br>
                
                
            <div class="form-container">
                <div class="form-group">
                    <label for="page_settings_autogen_colname_input">Auto-Generated New Collection Name</label>
                    <br>
                    <label for="" class="darker-info-label" style="font-size:12px;">Used when creating a new collection to automate the naming process.</label>
                    <input id="page_settings_autogen_colname_input" class="dashboard-input" type="text" placeholder="testCollection" value="testCollection" onchange=""/>
                </div>
            </div>
                
            <br>
            <br>
            <br>
                
                
            <div class="form-container">
                <div class="form-group">
                    <label for="page_settings_app_language_input">Language</label>
                    <br>
                    <label for="" class="darker-info-label" style="font-size:12px;">Optional, can be auto included in metadata if you provide an empty 'language' json key</label>
                    <input id="page_settings_app_language_input" class="dashboard-input" type="text" placeholder="en-GB" value="en-GB" onchange=""/>
                </div>
                <button id="page_settings_default_language_button" class="dashboard-btn" onclick="setPageLanguage()" >Default Language</button>
            </div>
                
            <br>
            <br>
            <br>
            <br>
                

                
            <div id="scrollToThisEmbedPresets" class="form-container">
                <div class="form-group">
                    <label for="page_settings_embed_model_preset_input_label">Embedding Model Presets</label>
                    <br>
                    <label for="" class="darker-info-label" style="font-size:12px;">Presets of compatible models - also populates the fields for you</label><br>
                    <label for="" class="darker-info-label" style="font-size:12px;">Listed in brackets are the models parameters <i>(in millions)</i> <b style="color: white">m</b>, dimensionality <b style="color: white">d</b>, and token limit <b style="color: white">t</b></label><br>
                    <br>
                    <select id="page_settings_embed_model_preset_selecttag" onchange="settingsUpdateEmbedModelChangeSelection()">
                      <option value="all-MiniLM-L6-v2" selected>all-MiniLM-L6-v2 - (23m 384d 512t) - Default</option>
                      <option value="sentence-transformers/all-MiniLM-L12-v2">all-MiniLM-L12-v2 - (33m 384d 512t)</option>
                      <option value="sentence-transformers/all-mpnet-base-v2">all-mpnet-base-v2 - (110m 768d 512t)</option>
                      <option value="TaylorAI/bge-micro-v2">bge-micro-v2 - (17m 384d 512t)</option>
                      <option value="BAAI/bge-small-en-v1.5">bge-small-en-v1.5 - (33m 384d 512t)</option>
                      <option value="GIST-all-MiniLM-L6-v2">GIST-all-MiniLM-L6-v2 - (23m 384d 512t) - recommend small</option>
                      <option value="avsolatorio/GIST-small-Embedding-v0">GIST-small-Embedding-v0 - (33m 384d 512t) - recommend medium</option>
                      <option value="thenlper/gte-large">gte-large - (335m 1024d 512t)</option> 
                      <option value="Mihaiii/gte-micro-v4">gte-micro-v4 - (19m 384d 512t)</option>
                      <option value="HIT-TMG/KaLM-embedding-multilingual-mini-instruct-v1">KaLM-embedding-multilingual-mini-instruct-v1 - (494m 896d 131072t) - recommend large</option>
                      <option value="dunzhang/stella_en_1.5B_v5">stella_en_1.5B_v5 - (1543m 8192d 131072t)</option>
                      <option value="infgrad/stella-base-en-v2">stella-base-en-v2 - (55m 768d 512t) - recommend medium</option>
                    </select>
                    <button id="page_settings_embed_model_preset_default_button" class="dashboard-btn" onclick="setttingsSetDefaultEmbeddingModel()" >Default Model</button>
                </div>
            </div>
            <br>

            <div class="form-container">
                <div class="form-group">
                    <label for="page_settings_embed_model_input">Embedding Model</label>
                    <br>
                    <label for="" class="darker-info-label" style="font-size:12px;">Can override and enter other models below, but it's trial and error - <big class="warning"><b>Amend model path as well!</b></big></label>
                    <label for="" class="darker-info-label" style="font-size:12px;">See: <a href="https://huggingface.co/spaces/mteb/leaderboard" target="_blank" style="color:white">Visit the Hugging Face Leaderboard</a> </label>
                    <input id="page_settings_embed_model_input" class="dashboard-input" type="text" placeholder="all-MiniLM-L6-v2" value="all-MiniLM-L6-v2" onchange=""/>
                </div>
                
                <div class="form-group">
                    <label for="page_settings_embed_context_window_input">Model Context Window</label>
                    <br>
                    <label for="" class="warning" style="font-size:12px;">Must be researched and entered manually, if you override with a custom model</label>
                    <label for="" class="darker-info-label" style="font-size:12px;">See: <a href="https://huggingface.co/spaces/mteb/leaderboard" target="_blank" style="color:white">Visit the Hugging Face Leaderboard</a> </label>
                    <input id="page_settings_embed_context_window_input" class="dashboard-input" type="numm" placeholder="512" value="512" onchange=""/>
                </div>
            </div>
                
                
                
            <div class="form-container">                
                <div class="form-group">
                    <label for="page_settings_embed_model_path_input">Model Path</label>
                    <br>
                    <label for="" class="darker-info-label" style="font-size:12px;">Downloads on first run, then runs locally</label>
                    <label for="" class="warning" style="font-size:12px;">When entering a custom model, include the model name in the path</label>
                    <input id="page_settings_embed_model_path_input" class="dashboard-input" type="text" placeholder="C:\temp" value="C:\temp" onchange=""/>
                </div>
                
                <div class="form-group">
                    <label for="page_settings_embed_dimension_input">Model Dimensionality</label>
                    <br>
                    <label for="" class="warning" style="font-size:12px;">Must be researched and entered manually, if you override with a custom model</label>
                    <label for="" class="darker-info-label" style="font-size:12px;">See: <a href="https://huggingface.co/spaces/mteb/leaderboard" target="_blank" style="color:white">Visit the Hugging Face Leaderboard</a> </label>
                    <input id="page_settings_embed_dimension_input" class="dashboard-input" type="text" placeholder="384" value="384" onchange=""/>
                </div>
            </div>
            <Br>
            <br>
            <br>
            <br>
            <br>
                
                
            <div class="form-container">
                <label id="page_settings_enable_cpuram_checkbox_label">Enable</label>
                <input id="page_settings_enable_cpuram_checkbox" class="" type="checkbox" onchange="toggleCPURAMInterval()" />
                <div class="form-group">
                    <label for="page_settings_cpu_ram_interval_input">CPU and RAM Refresh interval</label>
                    <br>
                    <label for="" class="darker-info-label" style="font-size:12px;">Optional, gives statistics on dashboard</label>
                    <input id="page_settings_cpu_ram_interval_input" class="dashboard-input" type="numer" placeholder="2000" value="2000" onchange=""/>
                </div>
                <button id="page_settings_default_cpuram_interval_button" class="dashboard-btn" onclick="setDefaultCPURAMInterval()" >Default Interval</button>
            </div>
            
            
            <br>
            <br>
            <br>
                
            <div id="scrollToThisForBugFix100DocsSetting"></div>
                
            <div class="form-container">
                <label id="page_settings_enable_bugix_batch_sizes_checkbox_label">Enable</label>
                <input id="page_settings_enable_bugix_batch_sizes_checkbox" class="" type="checkbox" onchange="bugFIX100Docs_DisbaleBatchSizes()" />
                <div class="form-group">
                    
                    <label for="page_settings_cpu_ram_interval_input" class="warning">CHROMA BUG - WORKAROUND:<br><label style="font-size:12px;">Causes python to crash when number of Documents exceeds collection batch size - <b>STRONGLY RECOMMENDED TO KEEP ENABLED</b></label><br>
                    <br>
                    <b onclick="jumpToHelp_BugFix100Docs()" style="font-size:12px;">More info <u>HERE</u></b></label>
                    <br>
                    <label for="" class="darker-info-label" style="font-size:12px;">Enforces newly created collection batch sizes to use this value </label>
                    <br>
                    <label for="" class="darker-info-label" style="font-size:12px;">Disabling Means you can freely enter your own batch sizes when creating a collection</label>
                    <select id="page_settings_bugfix_batch_sizes_selecttag">
                      <option value="5000">5000</option>
                      <option value="10000" selected>10000</option>
                      <option value="20000">20000</option>
                      <option value="50000">50000</option>
                      <option value="100000">100000</option>
                      <option value="500000">500000</option>
                      <option value="1000000">1000000</option>
                    </select>
                </div>
                <button id="page_settings_bugfix_default_batch_size_button" class="dashboard-btn" onclick="setDefaultBatchsizeBUGFIX100Docs()" >Default Interval</button>
            </div>
                
            <br>
            <br>
            <br> 

            <Br>
            <br>
            <button id="page_settings_save_button" class="dashboard-btn colourGreen" onclick="restartServer();" style="width:150px; height:40px; margin-top:30px;">Save Settings</button>
            <button id="page_settings_defaults_button" class="dashboard-btn" onclick="setDefaultSettingsFields()" style="width:150px; height:40px; margin-top:30px;">Defaults</button>
            <button id="page_settings_reload_from_file_button" class="dashboard-btn" onclick="reloadSettingsFromFile()" style="width:150px; height:40px; margin-top:30px;">Reload</button>
            <button id="page_settings_write_default_file_button" class="dashboard-btn" onclick="writeDefaultConfig()" style="width:150px; height:40px; margin-top:30px;">Write Default File</button>
            <!-- <button id="page_settings_restart_server_button" class="dashboard-btn colourRed" onclick="restartServer()" style="width:150px; height:40px; margin-top:30px;">Restart Server</button> -->
                
            <Br>
            <br>
            <br>
            <Br>
            <br>
            <br>
            <br>
        </div>
            
            
       
            
            
            
             
                
        <!-- PAGE -->
        <div id="help" class="page fadeIn" style="display:none;">
            <h2>Help</h2>
            <br>
            <div class="form-container">
                
                <div class="form-group">
                    <div class="floating-info-panel">
                        <label for="page_help_chroma_server_version" class="darker-info-label">ChromaDB Version</label>
                        <div id="page_help_chroma_server_version">?</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="floating-info-panel">
                        <label for="page_help_flask_app_version" class="darker-info-label">Python App Version:</label>
                        <div id="page_help_flask_app_version">?</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="floating-info-panel">
                        <label for="page_help_app_version" class="darker-info-label">Web UI Version:</label>
                        <div id="page_help_app_version">?</div>
                    </div>
                </div>
                
            </div>
            
            <br>
            <br>
            <br>
                
                
            <h3>About this App:</h3>
            
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>
                        <div class="inner-info-panel2">
                            Author: CoffeeCodeConverter <br>

                            <a href="https://github.com/chroma-core/chroma" target="_blank">
                              <img id="githubChroma" src="/static/images/github.png" title="Chroma Core Github">
                            </a>

                            GitHub: <a style="color:white" href="https://github.com/coffeecodeconverter" target="_blank">https://github.com/coffeecodeconverter</a> <br>
                        </div>
                        <br>
                        <br>
                        
                        Introducing <b style="color:#3498db">Chroma</b> <b style="color:#e74c3c">Flow</b> <b style="color:#f1c40f">Studio</b><br>
                        The swiss-army knife to <b style="color:white">ChromaDB</b> - with every management task at your fingertips! <br>
                        <br>
                        Whether you're a total beginner or veteran,<br>
                        The aim is to lower the barrier to entry, and make learning, using, or developing with <b style="color:white">ChromaDB</b> fast, easy, and, dare I say, even a little fun?<br>
                        <br> 
                        
                        With over 15,000 Lines of code, this is one mighty App!<Br>
                        Here's a peek at what <b style="color:#3498db">Chroma</b> <b style="color:#e74c3c">Flow</b> <b style="color:#f1c40f">Studio</b> can do for you:<br>
                        <ul>
                            <li><strong>Dashboard Overview:</strong> Get a clear, concise snapshot of your entire ChromaDB setup right from the dashboard.</li>
                            <li><strong>Collections Page:</strong> View all your collections, and perform essential actions like adding, copying, cloning, or deleting them – all with just a click. Plus, we've got handy templates for metadata and default settings to help you hit the ground running without the fuss.</li>
                            <li><strong>Add Documents with Ease:</strong> No need to manually assign IDs! Documents can be added with auto-generated IDs, plus customizable metadata templates to save you time.</li>
                            <li><strong>Bulk Document Imports and Updates:</strong> Need to add or update a lot of documents at once? No problem. Import documents in bulk with a simple JSON file, or update them in bulk too.</li>
                            <li><strong>Document Management:</strong> Whether you need to update a single document, copy one, or delete them (individually, in groups, or all at once), Chroma Flow Studio makes it easy to manage your documents at lightning speed.</li>
                            <li><strong>Document Overview:</strong> See all the important details of your documents – from IDs and contents to metadata and embeddings. Want to filter, edit, delete, or review your documents? It's all at your fingertips.</li>
                            <li><strong>Document Export:</strong> You can easily export documents to JSON, select the content and records you want, and even choose where to send them. Simple as that!</li>
                            <li><strong>Similarity Searches:</strong> Run similarity searches - including the ability to filter for both documents and metadata. Precision searching has never been easier.</li>
                            <li><strong>Quick Embedding Model Swaps:</strong> Test out different embedding models and compare their performance in mere seconds – perfect for finding the best one for your use case.</li>
                            <li><strong>Cloning and Re-Embedding:</strong> Clone your data and re-embed it with a different model – a feature that ChromaDB's Python library doesn't even support natively, but I've added it here just for you!</li>
                            <li><strong>Bulk Deletions</strong> Another feature that ChromaDB's Python library doesn't support natively - Clear all documents from a Collection instantly in just a click!</li>
                            <li><strong>Flask Server Configuration:</strong> Easily configure the Flask server endpoint to suit your needs, with the flexibility to point to any ChromaDB SQLite file. Switching between them is as easy as flipping a switch.</li>
                            <li><strong>Proxy Support:</strong> Using a proxy? No problem! Chroma Flow Studio supports that too.</li>
                            <li><strong>Built-in Tools:</strong> UUIDs, Hashes, Timestamps, Embedding generation – all available on the fly. Need to generate synthetic data for testing? It's all ready to go. Plus, there's a handy token counter built right in.</li>
                            <li><strong>Visualize your Data!:</strong> Get a graphical representation of your collections by Visualizing your data points! <i class="darker-info-label">(NOTE: requires chrome/firefox/edge to render, if you have issues, try other browsers)</i></li>
                            <li><strong>Python Code Snippets:</strong> At the bottom of the Collections / Documents / Update / Search Pages are Python code snippets showing how to perform those actions programatically. Just copy, paste, run, and done!</li>
                            <li><strong>And More!</li>
                        </ul>
                        <br>
                        <b style="color:#3498db">Chroma</b> <b style="color:#e74c3c">Flow</b> <b style="color:#f1c40f">Studio</b> brings everything you need in one place, wrapped in a simple UI,<br>
                        with a range of tools built-in, detailed overviews, and embedded knowledge, everything is just a click away.<Br>
                        <Br>
                        <div class="inner-info-panel" style="max-width:660px">
                            This application supports ChromaDB <b style="color:#e74c3c">Versions 0.5.20+</b><br>
                            <i class="darker-info-label">(if later versions of chromadb introduce a breaking change, try downgrading)</i>
                        </div>
                    </div>
                </div>
            </div>
            <br>
            <br>
            <br>
            <br>
            <br>
                        
                        
            <h3>Getting Started:</h3>
            
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_windowbody">
                    <div class="" style="font-size:12px;">
                        Some guidance steps on using <b style="color:#3498db">Chroma</b> <b style="color:#e74c3c">Flow</b> <b style="color:#f1c40f">Studio</b><br>
                        <br>
                        <br>
                        <br>
                        <strong>Configure Settings:</strong><br>
                        You can configure the port number used by the Python Flask server if it conflicts with something else you're running.<br>
                        <br>
                        Specify a file path to store the <b>chroma.sqlite3</b> file, or point to an existing one if you wish.<br>
                        Defaults to "C:\Program Files\ChromaDB\Data\TestDB"<br>
                        <br>
                        If you use a proxy, you can configure that in the settings too—leave blank if not used.<br>
                        <br>
                        You can select an embedding model in the settings. The default is <b>all-MiniLM-L6-v2</b>, which is very light and very fast, but it's not very accurate.<br>
                        In fact, there are other models with the same parameters that are faster AND more accurate (GIST-all-MiniLM-L6-v2) due to better fine-tuning.<br>
                        Beware: larger models take longer to generate embeddings and slow down searches more, so test a range of them to see what suits your needs best.<br>
                        <br>
                        You can set a custom model not defined in the presets, but you have to remember to manually confirm and input the context window and dimension sizes.<br>
                        Not all models work, but many do—the preset list isn't exhaustive; it's just for the ones that have been tested and are known to work with <b style="color:#3498db">Chroma</b> <b style="color:#e74c3c">Flow</b> <b style="color:#f1c40f">Studio</b>.<br>
                        <br>
                        The CPU and RAM refresh interval setting is just a nice feature that optionally shows your CPU and RAM usage on the dashboard at the interval specified.<br>
                        It is disabled by default to save resources.<br>
                        <br>
                        The Chroma bug fix workaround for batch sizes enforces a high batch size for new collections to avoid Python crashes.<br>
                        You can disable the setting and set whatever batch size you want, but until Chroma fixes the underlying issue on Windows machines (I don't believe Linux is affected), it’s a necessary workaround to keep enabled.<br>
                        <br>
                        <br>
                        <br>
                        <strong>Creating Collections:</strong><br>
                        On the collections page, creating a collection is simple and easy.<br>
                        Collection names are autogenerated for convenience, as are the configuration fields and metadata—but you can still configure all of them.<br>
                        There are options to copy a collection's details to a new empty collection, or clone an existing collection, including all its data.<br>
                        Deleting collections one at a time or in bulk is just a single button click.<br>
                        <br>
                        <strong>Adding Documents:</strong><br>
                        You can add documents one at a time, including setting metadata.<br>
                        There are quick buttons to set metadata templates with many useful attributes you could apply for a document.<br>
                        Or, import documents in bulk.<br>
                        You can also update documents individually or in bulk.<br>
                        <br>
                        <strong>Viewing Documents:</strong><br>
                        On the view documents page, select your collection, apply filters, choose how many results to return, and quickly see your document IDs, contents, metadata, and embeddings.<br>
                        <br>
                        <strong>Searching:</strong><br>
                        Similarity search is simple and easy to use.<br>
                        Plus, there are filter options for specific document contents and/or metadata fields to create dynamic and specific queries.<br>
                        Quick buttons are provided to create your desired filters with speed, with full customization.<br>
                        <br>
                        <strong>Visualize Data:</strong><br>
                        The Visualize page gives you a graphical representation of your collections so you can see how similar groups of documents are to one another.<br>
                        It's also helpful to see how different embedding models generate different visuals on the same data, as a quicker way to see if they’re more accurate for your use case.<br>
                        <br>
                        <strong>Tools:</strong><br>
                        A list of optional tools such as importing multiple test documents, generating timestamps, hashes, or UUIDs, checking how many tokens a piece of text costs, generating embeddings on the fly,<br>
                        or even generating synthetic JSON data that can be imported directly into <b style="color:#3498db">Chroma</b> <b style="color:#e74c3c">Flow</b> <b style="color:#f1c40f">Studio</b> for faster testing.<br>
                        <br>
                        <strong>Exporting Data:</strong><br>
                        The export page lets you pick documents, metadata, embeddings, or all of them to export into a JSON file.<br>
                        You can preview what data would be exported before committing to it<br>
                        And configure the filename and output directory.<br>
                        Simple.<br>
                        <br>

                    </div>
                </div>
            </div>
            <br>
            <br>
            <br>
            <br>
            <br>
                        
                        

                        
            <h3>About ChromaDB:</h3>
            
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>

                        <b>ChromaDB</b> <Br>
                        
                        <a href="https://github.com/chroma-core/chroma" target="_blank">
                          <img id="githubChroma" src="/static/images/github.png" title="Chroma Core Github">
                        </a>
                        
                        Github: <a style="color:white" href="https://github.com/chroma-core/chroma" target="_blank">https://github.com/chroma-core/chroma</a><br>
                    </div>
                </div>
            </div>
            <br>
            <br>

                        
                        
            <br>
            <br>
            <br>
            <Br>
                
            <!--
            <h3>Getting Started:</h3>
            <div class="form-container">
                <div class="form-group">
                    <label for="">&nbsp;&nbsp; **get chatgpt to write you something **</label>
                </div>
            </div>
            
            <br>
            <br>

            
            <br>
            <Br>
            <br>
            <br>
            <Br>
            -->
                

            <h3>External ChromaDB Documentation</h3>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>
                        <label for="page_help_chroma_docs" class="darker-info-label">Chroma Core Github Project</label>
                        <Br>
                        <a style="color:white" href="https://github.com/chroma-core/chroma" target="_blank">https://github.com/chroma-core/chroma</a>
                        <div id="page_help_chroma_docs"><br>Navigates to "Chroma Core Github" page, you can view the "Discussions" section for all sorts of help and information.
                        </div>
                    </div>
                </div>
            </div>

            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>
                        <label for="page_help_chroma_docs" class="darker-info-label">Chroma Docs</label>
                        <Br>
                        <a style="color:white" href="https://docs.trychroma.com/docs/overview/introduction" target="_blank">https://docs.trychroma.com/docs/overview/introduction</a>
                        <div id="page_help_chroma_docs"><br>Navigates to "Chroma Docs" website, providing documentation for writing your own clients in a range of languages such as python, Node.JS, .NET, etc.
                        </div>
                    </div>
                </div>
            </div>

            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>
                    <label for="page_help_chroma_db_cookbook" class="darker-info-label">Chroma DB CookBook</label>
                    <br>
                    <a style="color:white" href="https://cookbook.chromadb.dev/" target="_blank">https://cookbook.chromadb.dev/</a>
                    <div id="page_help_chroma_db_cookbook"><br>Navigates to "Cookbook Chroma" website - the unoffical guide to ChromaDB. Also provides documentation on writing your own clients in other languages.</div>
                    </div>
                </div>
            </div>

            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>
                    <label for="page_help_chroma_db_cookbook" class="darker-info-label">ChromaDB Tutorials</label>
                    <br>
                    <a style="color:white" href="https://github.com/neo-con/chromadb-tutorial" target="_blank">https://github.com/neo-con/chromadb-tutorial</a>
                    <div id="page_help_chroma_db_cookbook"><br>Seperate Github project that lists many tutorials on using ChromaDB. Very good resource. </div>
                    </div>
                </div>
            </div>

                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_windowbody">
                    <label for="page_help_chroma_db_cookbook" class="darker-info-label">How to Use ChromaDB</label>
                    <br>
                    <a style="color:white" href="https://how.wtf/how-to-use-chroma-db-step-by-step-guide.html" target="_blank">https://how.wtf/how-to-use-chroma-db-step-by-step-guide.html</a>
                    <div id="page_help_chroma_db_cookbook"><br>Good, concise python library guide for creating a Database and inserting documents for searching.</div>
                </div>
            </div>
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_windowbody">
                    <label for="page_help_chroma_db_cookbook" class="darker-info-label">ChromaDB Step by Step Guide</label>
                    <br>
                    <a style="color:white" href="https://www.datacamp.com/tutorial/chromadb-tutorial-step-by-step-guide" target="_blank">https://www.datacamp.com/tutorial/chromadb-tutorial-step-by-step-guide</a>
                    <div id="page_help_chroma_db_cookbook"><br>Andother good walkthrough guide.</div>
                </div>
            </div>
            <br>
            <br>


            <Br>
            <Br>
            <br>
            <br>
            <br>
                
                
  
            <h3>Points to Note:</h3>
                
            <div id="" class="page_help_panel_info_wrapper">
                <div id="bug100DocsTitleBar" class="page_help_panel_info_titlebar">
                    <label>Chroma vs Langchain-Chroma</label>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button> -->
                </div>
                <div id="" class="page_help_panel_info_windowbody">
                    <div>
                        When searching online for documentation on ChromaDB, it's easy to come across results related to Langchain Chroma and isnt always 100% cross-compatible code.<br>
                        <br>
                        This can be confusing because the example code and instructions you find for Langchain Chroma may look very similar to ChromaDB's, but they aren't the same.<Br>
                        If you're following these examples thinking you're working with ChromaDB, you might run into issues where things don't work as expected.<br>
                        <bR>
                        The confusion doesn't end there—when you try to troubleshoot by Googling, you'll likely end up asking the wrong questions, as the two projects are subtly different.<br>
                        So, it's important to double-check which version you're working with, as mixing them up can lead to unnecessary frustration and wasted time.
                    </div>
                </div>
            </div>
                
           
                        
            <br>
            <br>
            <br>
            <br>
            <Br>
            <Br>
            <br>
 
                
            <h3>About Embedding Models</h3>
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    <label>TryChroma Docs - Embedding Functions</label>
                    <br>
                    <br>
                    <a style="color:white" href="https://docs.trychroma.com/docs/embeddings/embedding-functions" target="_blank">https://docs.trychroma.com/docs/embeddings/embedding-functions</a>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>The "Embedding Functions" section of the TryChroma documentation provides information on how to use embedding models</div>
                </div>
            </div>
            <br>
            <br>
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    <label>Chroma Cookbook - Embeddings</label>
                    <br>
                    <br>
                    <a style="color:white" href="https://cookbook.chromadb.dev/embeddings/bring-your-own-embeddings/" target="_blank">https://cookbook.chromadb.dev/embeddings/bring-your-own-embeddings/</a>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>More information on embedding models, and the python code to use them</div>
                </div>
            </div>
            <br>
            <br>
                
            
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    <label>Hugging Face - Embedding Models Leaderboard:</label>
                    <br>
                    <br>
                    <a style="color:white" href="https://huggingface.co/spaces/mteb/leaderboard" target="_blank">https://huggingface.co/spaces/mteb/leaderboard</a>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                
                
                
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>The Hugging Face "Embedding Models Leaderboard" showcases a ranking of various embedding models based on their performance across multiple benchmark tasks.<br>
                        It allows users to compare models' effectiveness in generating high-quality embeddings for classification, generalization, summarization, and more<br>
                        <br>
                        You can also try the models in Chroma Flow Studio - not all will work, its trial and error, but pasting a models name into the settings page will attempt to download and use it. <br>
                        If it errors, just revert back to another working model, or the default one (all-MiniLM-L6-v2). 
                    </div>
                </div>
            </div>
                
            <div id="scrollToHereBugFix100Docs"></div>
                
            <Br>
            <Br>
            <Br>
            <Br>
            <Br>
            <br>
                
                
                
            <h3>Tutorials</h3>
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    <label>Sources for Other ChromaDB tutorials</label>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_bug_windowbody">
                    <div>
                        <a href="https://how.wtf/how-to-use-chroma-db-step-by-step-guide.html" target="_blank">How to Use Chroma DB Guide</a><br>
                        <a href="https://github.com/neo-con/chromadb-tutorial" target="_blank">Chroma DB GitHub Tutorial</a><br><br>
                        <a href="https://www.datacamp.com/tutorial/chromadb-tutorial-step-by-step-guide" target="_blank">DataCamp Chroma DB Tutorial</a><br>
                        <a href="https://tabbas97.medium.com/a-simple-but-not-introduction-to-chromadb-c066cfd320e7" target="_blank">Medium Article on Chroma DB</a><br>
                        <a href="https://www.youtube.com/watch?v=QSW2L8dkaZk&list=PL58zEckBH8fA-R1ifTjTIjrdc3QKSk6hI" target="_blank">YouTube Video</a><br>
                         <a href="https://www.youtube.com/watch?v=QSW2L8dkaZk" target="_blank">YouTube Video</a><br>
                    </div>
                </div>
            </div>
                

            <br>
            <br>
            <Br>
            <Br>
            <Br>
            <Br>
            <br>
                
                
            <h3>Chroma Bugs</h3>
                
            <div id="" class="page_help_panel_bug_wrapper">
                <div id="bug100DocsTitleBar" class="page_help_panel_bug_titlebar">
                    <label>BUG - 100 Documents Crash - Python Crashes with exit code -1073741819 (0xC0000005) - On 100th Insert / Deletetion / Search</label>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_bug_windowbody">
                    <div>
                        This seems to be specific to Windows, as far as github discussions suggest. <Br>
                        <br>
                        Symptoms:<Br>
                        Upon inserting the 100th document, or deleting 100+ document in a row, or updating 100+ x documents at once, results in python abruptly closing, and no error message is captured.<br>
                        Using the same underlying code when collections are under 100 x documents works without issue, confirming its not a coding issue in your script for example.<br>
                        The same data inserts just fine when rearranged, and the error always occurs on the "nth 100" document, meaning the problem has nothing to do with the document itself.<br>
                        <br>
                        The problem lies in some incompatibility with <b>chroma-hnswlib</b> - and crashes when a collections batch limit is reached as its flushing the buffer.<Br>
                        The intended behaviour, is for the batch limit to set how many "transactions" should be buffered (think of a 'transaction' as a 'data change' i.e. insertions, deletions, etc) before flushing.<br>
                        Batch size defaults to 100, but whatever its limit is, the crash occurs when the "transactions" (or "batch") exceeds that threshold - which indicates a bug during the flush.<br>
                        <br>
                        The Workaround is to simply increase the batch limit of your collections to something higher than any insert/delete opteration would ever take in one go, for example 10,000, or 50,000.<br>
                        The cost of this results in a slight performance hit, especially as the dataset grows, and higher memory consumption, but thats currently the only way to insert more than 100 x documents into ChromaDB, if you're running Windows at least. <br>
                        <b id="scrollToThisForBugFix166BatchLimit"></b>
                        <br>
                        See these Github Discussion URLs for more, offical, informaiton about this bug:<br>
                        <Br>
                        <a style="color:white" href="https://github.com/chroma-core/chroma/issues/3058" target="_blank">https://github.com/chroma-core/chroma/issues/3058</a>
                        <br>
                        <a style="color:white" href="https://github.com/chroma-core/chroma/issues/2513" target="_blank">https://github.com/chroma-core/chroma/issues/2513</a>
                        <Br>
                        <a style="color:white" href="https://github.com/chroma-core/chroma/issues/2534" target="_blank">https://github.com/chroma-core/chroma/issues/2534</a>
                        <Br>
                        <a style="color:white" href="https://github.com/chroma-core/chroma/issues/2856" target="_blank">https://github.com/chroma-core/chroma/issues/2856</a>
                        <br>
                    </div>
                </div>
            </div>
                        

            <div id="" class="page_help_panel_bug_wrapper">
                <div id="" class="page_help_panel_bug_titlebar">
                    <label>BUG - ValueError: Batch size "X" exceeds maximum batch size 166</label>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_bug_windowbody">
                    <div>
                        May be related to how a collections' "HNSW configuration" is implemented in python client.<Br>
                        <br>
                        Symptoms:<Br>
                        Your collection has a batch size higher than 166.<Br>
                        You attempt to perform a bulk deletion/insert/update of more than 166 x documents<br>
                        Error occurs "ValueError: Batch size "X" exceeds maximum batch size 166"<br>
                        Despite the collections batch size being larger than 166.<br>
                        <br>
                        Not sure why this occurs, i believe its related to how the HNSW configuration settings not yet being fully implemented in the python library/client, given it uses metadata fields as a workaround for the time being (i.e. "hnws:space", "hnws:num_threads", "hnsw:M", etc in Chroma 0.5.20+ a collections HNWS config are all metadata fields)<br>
                        See more on HNSW Metadata Config with these links:<br>
                        <a style="color:white" href="https://cookbook.chromadb.dev/core/configuration/#hnsw-configuration" target="_blank">https://cookbook.chromadb.dev/core/configuration/#hnsw-configuration</a><br>
                        <a style="color:white" href="https://cookbook.chromadb.dev/core/collections/#copying-collections" target="_blank">https://cookbook.chromadb.dev/core/collections/#copying-collections</a><br>
                        <a style="color:white" href="https://github.com/chroma-core/chroma/issues/2638" target="_blank">https://github.com/chroma-core/chroma/issues/2638</a><br>
                        <br>
                        Whereas, in the HTTPClient the HNWS configuration is fully implemented as seperate attributes to the collection itself, rather than metadata. <br>
                        So i therefore also believe this error only comes about when using the python client.<br>
                        <br>
                        The Workaround is to break your batches into 166 or or less. <br>
                        This means if youre doing a collection.add() for example for over 166 documents, you need to wrap that in a loop, and make the loop do no more than 166 per iteration, to break it up sufficiently. <br>
                        This has proven to work in Chroma Flow Studio's Import function, also when Cloning a Collection Data, or deleting 100+ documents. <br>
                        <br>
                        See these Github Discussion URLs for more, offical, informaiton about this bug:<br>
                        <Br>
                        <a style="color:white" href="https://github.com/Marker-Inc-Korea/AutoRAG/issues/372" target="_blank">https://github.com/Marker-Inc-Korea/AutoRAG/issues/372</a><br>
                        <a style="color:white" href="https://github.com/chroma-core/chroma/issues/1049" target="_blank">https://github.com/chroma-core/chroma/issues/1049</a><Br>
                        <a style="color:white" href="https://github.com/langchain-ai/langchain/discussions/12325" target="_blank">https://github.com/langchain-ai/langchain/discussions/12325</a>
                        <br>
                    </div>
                </div>
            </div>
                        

            <br>
            <br>
            <Br>
            <Br>
            <Br>
            <Br>
            <br>
                
    
                
            <h3>Chroma Breaking Changes</h3>
                
            <div id="" class="page_help_panel_bug_wrapper">
                <div id="" class="page_help_panel_bug_titlebar">
                    <label>0.6.0+ Changes to .list_collections() Function</label>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_bug_windowbody">
                    <div>
                        From ChromaDB version 0.6.0+ the <b>.list_collections()</b> function no longer returns ids, it only returns collection names<br>
                        as a result, anything that was referecing "collection.name" will fail, it needs to be amended to just "collection" <br>
                        <br>
                        furthermore, any code that referenced the ID's from <b>.list_collections()</b> must be amended by creating a new variable that does .get_collection(collection_name) instead, <br>
                        that still returns id's<br>
                        <div class="nowiki">
                            
                        </div>
                    </div>
                </div>
            </div>
                    
                

            <br>
            <br>
            <Br>
            <Br>
            <Br>
            <Br>
            <br>
                

                
            <h3>FAQ's:</h3>
                 
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    TL'DR - What's all the hype with ChromaDB then?
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>ChromaDB is a fast, lightweight vector database, written in Python (but offers HTTP and Node.js clients too).<br>
                        It's open-source, free, and designed to easily handle high-dimensional data, and is geared up for AI tasks like similarity search, recommendation engines, and natural language processing.<br>
                        What sets it apart? Built-in tools that streamline the embedding process making working with vectors a breeze.<br>
                        Sounds Promising, right?... Read on...</div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                   What types of data can be stored in ChromaDB?
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>ChromaDB can store a variety of data types, including text, images, and audio,<br>
                        allowing applications to perform similarity search and other Machine Learning (ML) tasks.<br>
                        <br>
                        Text is easy, as its already in a format that can be processed by an embedding model,<br>
                        but video, images and audio must first be converted to a textual format.<br>
                        <br>
                        For example, images can be converted to base64, and then create the embedding from that as opposed to the original image file.<br>
                        Then it works the same as it does for embedding text, in principle at least - there are specific models that have been trained on certain data formats that would perform better than others. <br>
                        Requires a bit of research into the various models and their intended purposes.
                    </div>
                </div>
            </div>

                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    What's a Vector Database anyway? How's it different from a Traditional Database?
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>A vector database stores data as a "vector" or an "embedding", which are numerical representations of data like text, images, or audio.<br>
                        The Key difference, is that traditional databases store data as specific data types (string, integer, float, boolean, blob, etc.) whereas vector databases store theirs as "embeddings" (long arrays of numbers) that merely represent the original data.<Br>
                    <br>
                    In a vector database, data is organized into collections, which contain documents; each document has an ID, text, metadata, and an embedding.<br>
                        In contrast, a traditional database organizes data in tables, where each table has rows that contain columns of structured data, typically including an ID for relational linking.<Br>
                    <br>
                    Vector databases specialize in performing similarity searches using vector embeddings to measures how "close" or "similar" vectors are to each other - this becomes easy when all data is represented as numbers (embeddings).<br>Traditional databases, however, focus on lexical searches and structured queries to extract specific data based on predefined conditions.<br>
                        While vector databases are ideal for AI applications like searching for similar content or understanding semantic relationships, traditional databases excel in organizing and retrieving highly structured data.<br>
                    <br>
                    You can potentially have both types of databases working together,<br>
                        where raw data is kept in the tradidtional database along with a vector ID, and have an embedding representation of the same data in the vector database mapped to the same ID - although this isnt the only possibility, just one example use case.<br>
                        <br>
                        In ChromaDB though, you're able to store the original text of a "chunk" and its embedding alongside it, as well as additional metadata, and keep all of that as a single "document" within a "collection".<br>
                        This makes it easy to return the original text when performing similarity searches for example, and is just another reason why ChromaDB is a good choice for a vector database.
                    </div>
                </div>
            </div>

                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    What's an Embedding, or Embedding Model?
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>
                        An embedding is a way to represent words (or other data) as numbers, so that a computer can understand their meaning and process them.<br>
                        <br>
                        An embedding model is a type of AI system that creates these number representations (embeddings) from words (or other data).<br>
                        It takes in words and turns them into their corresponding "secret codes" or embeddings.<br>
                        <br>
                        
                        Principally, Embedding data into a vector is similar to how hashing works: in the sense they both transform a given piece of data — whether text, image, audio, or other formats — into a new representation through a one-way process. Just as different hash algorithms generate unique hashes for the same data, different embedding models produce distinct vector embeddings for the same input data, and some are better than others - with the trade-off being speed for accuracy. <br>
                        However, the distinct purpose of an "embedding" is to capture the "meaning" of a piece of text - and "embed" that meaning into an "array of numbers" (vector).<br>
                        
                        For example, If you feed the word "apple" to an embedding model, it might return an embedding like [0.3, -0.7, 0.5]. The model learns these embeddings by analyzing a huge amount of text and figuring out which words have similar meanings or are used in similar contexts.
                    <ul>
                      <li><strong>Think of it like this:</strong>
                        <ul>
                          <li>Words are great for humans, but computers need numbers to do any sort of calculation or decision-making.</li>
                          <li>Embeddings are like secret codes that turn words into numbers, but these numbers are special because they capture the meaning of the words in a way that's useful for the computer.</li>
                        </ul>
                      </li>
                      <li><strong>For example:</strong>
                        <ul>
                          <li>The word "dog" might be turned into a series of numbers like [0.5, 1.2, -0.3].</li>
                          <li>The word "cat" might be turned into [0.4, 1.1, -0.3].</li>
                        </ul>
                      </li>
                    </ul>
                      The important thing is that dog and cat are similar in meaning, so their numbers (or embeddings) are similar too.<br>
                        "Dog" and "cat" are close to each other in the embedding space, which means the computer knows that they're related.<br>
                        <Br>
                    </div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    Whats a Collection?
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>In Chromadb (and many other vector databases), a collection is a logical grouping or container for documents and their corresponding embeddings (other vector databases use different terminology, but in chroma they call them collections).<br>
                        It's essentially the primary unit for storing and organizing your data within the database.<br>
                        When you're working with Chromadb, you're typically interacting with collections to store, query, and retrieve documents<br>
                        <br>
                        In short, a collection in a vector database, is much like a table in a traditional database - just a way of grouping data<br>
                        <br>
                        Collections can have different embedding models applied to them, but cant contain documents with mixed embeddings.<br>
                        All documents in a given collectiton must use the same embedding model as that collection.<Br>
                        Think of it as "decoder" of sorts, if you have the wrong model (decoder) it wont interpret the embeddings properly, or not at all.
                    </div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    What's a Document in ChromaDB? What's does it mean specifically?
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    In ChromaDB, a document refers to a unit of data composed of text that can be indexed and searched.<br>
                    a Single "document" within the database contains:<br>
                    - ID<br>
                    - The Textual content <br>
                    - Metadata (optional)<br>
                    - Embedding (optional)<br>
                    <br>
                    The "text" is usually a "chunk" such as a paragraph, partly due to the Content Window Limit of embedding models being so small, but also because more granular chunks can result in an overall improvement on data retrieval.
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    What's makes Chroma DB so special then? Why is it a good choice over others?
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>
                    <div>What makes ChromaDB stand out, is the built-in embedding functions that streamline the process of importing data without the need for pre-embedding documents, unlike other vector databases.<br>
                    <br>
                    Its Python client boasts an intuitive, English-like syntax that requires just a few lines of code, making it incredibly easy to use.<br>
                    <br>
                    With flexible metadata filtering, ChromaDB allows for efficient querying tailored to specific needs.<br>
                    Lightweight and fast, it operates in-memory, ensuring rapid performance even when persisting data to disk, as it loads working datasets into memory for blazing-fast access.<br>
                    <br>
                    This combination of ease-of-use, speed, and flexibility makes ChromaDB a compelling choice over the competition.</div>
                    </div>
                </div>
            </div>

                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    What's Chroma DB's best use cases?
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>Chroma DB is best suited for handling and managing large-scale embeddings for machine learning applications, such as semantic search, recommendation systems, and data retrieval. It excels at storing, indexing, and querying high-dimensional vectors efficiently. Ideal use cases include natural language processing tasks, image similarity searches, and AI-driven content personalization.</div>
                </div>
            </div>

                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    What's Chroma DB's limitations? Or not suited for?
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>Chroma DB may not be ideal for real-time, low-latency applications requiring instant responses due to its focus on vector storage and indexing, which can introduce some delay in large datasets. It also lacks full transactional support, making it less suitable for applications requiring strong consistency and ACID compliance. Additionally, it's not designed for traditional relational database use cases, such as complex joins or structured data storage</div>
                </div>
            </div>


            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                   Can ChromaDB be used with large datasets?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>Yes, but up to a limit.<br>
                        Chroma works in-memory so large dataset require sufficently more RAM, and this may or may not be a problem for you.<br>
                        Secondly, chroma is subject to any limitation for SQLLite too, such as concurrency and being single threaded.<Br>
                        <br>
                        Chroma is better suited towards small to medium projects.</div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    About Chroma Clients
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>
                        <b style="color:white">ChromaDB</b> offers multiple clients including HTTP, python and NodeJS.<br>
                        Each of them can be initialised as an "In-Memory Client" <i class="darker-info-label">(temporarily held in RAM)</i> or "Persistent Client" <i class="darker-info-label">(persisted to disk)</i>. <Br>
                        <br>
                        <div class="inner-info-panel">
                            Note:<br>
                            <b style="color:#3498db">Chroma</b> <b style="color:#e74c3c">Flow</b> <b style="color:#f1c40f">Studio</b> uses a Persistent Python Client.<br>
                            And has the ability to configure the path and load an existing chroma.sqlite3 database too.
                        </div>
                    </div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    What Backend does ChromaDB Use?
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>ChromaDB primarily employs SQLite as its storage engine for managing data at the core. However, the system is optimized for handling high-dimensional vector data and supports indexing and retrieval of embeddings efficiently</div>
                </div>
            </div>

            <!--
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    Wait a minute, SQLLite? But i thought Chroma DB is a Vector Database? How can that be if its running SQL?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>SQLLite</div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    Where is ChromaDB's Database Stored?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>in memory, or persisted to disk as an SQLLite file - dpeends where youve installed chroma</div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    Whats actually contained in the SQLLite File? 
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>tenants, databases, collections, embeddings - elaborate on this</div>
                </div>
            </div>
                
            
                

            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    How do the Chroma Clients work on a technical level?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>
          
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    Whats a Tenant? and How do I configure it?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>

                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    About Chroma's 'Database' and 'Tenants' <i>(Default_Database / Default_Tenant)</i>, can you elaborate?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>

                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    Hang on, if everything is in a single SQLLite file, why can it contain multiple databases? thats confusing
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>
            -->
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    Wait a minute, if its an SQLLite File, surely i can use existing SQLLite Management tools to view and interact with the database?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>You sure can! BUT, a word of WARNING - I'd hold off on this until you've at least created a collection, added some documents, and thrown in a few embeddings. Why? Because at that point, you’ll actually be able to see how all that data plays together in the SQL Lite tables. Don’t get me wrong, I’m not saying you should dive headfirst into the SQL Lite file like it’s your new best friend. But if you happen to have a bit of SQL experience, it might help you see how things are connected beneath the surface. <br>

That being said, I’m also NOT advising anyone to start mucking around in the SQL Lite file unless you’re basically a wizard with SQL (you know, studied the schemas, foreign keys, and could recite stored procedures in your sleep). Even then, I’d still strongly advise against it. This is really just another GUI way to peek at your data if vector databases are all new to you and making your head spin. So, take a look, but don’t touch anything unless you’re absolutely sure you want to summon a database dragon.</div>
                </div>
            </div>
                
            <!--
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    Ive installed chromadb and started it with "chroma --run" then connected to 127.0.0.1:8000 in my browser, now what?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    Whats the "Swagger API" / "FastAPI" ? When you append "/api/docs" to the "127.0.0.1:8000" address? 
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>
                
                


            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    What do all the HNSW Configuration options Mean for a Collection?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    How to Set a Collections' HNSW Configuration?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    How to Amend a Collections' HNSW Configuration?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    How to Set a Collections' Metadata?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    How to amend a Collections' Metadata?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>

                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    How to Delete a Collections' Metadata?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>

                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    My Collections' Dimension is NULL? How do I set it?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    How to Copy a Collection?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>
            -->
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    What's a Context Window? What does it Mean?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>With regards to AI models, such as natural language processing (NLP) and embeddings (like sentence transformers, GPT or BERT), a context window refers to the portion of text or data that the model considers at a given time when processing or generating predictions.<br>
                        Essentially, it defines the amount of information the model uses to understand the context of the current sequence.<br>
                    Key Points About a Context Window:
                    <ul>
                      <li><strong>Size of the Window:</strong> The context window is typically a fixed-size window of words or tokens that the model "sees" at once. For example, if you're using a model with a context window of 512 tokens, the model can only consider 512 tokens in its input when making predictions. It can't look at any information outside of that window directly unless the window is shifted or extended.</li>

                      <li><strong>Relevance in NLP:</strong> In language models, context is crucial because the meaning of words often depends on surrounding words. A larger context window allows the model to capture long-range dependencies and understand the meaning of a word in relation to a broader portion of the text.</li>

                      <li><strong>Fixed vs. Sliding Window:</strong>
                        <ul>
                          <li><strong>Fixed Window:</strong> In some models, the context window is fixed, meaning the model only processes a set number of tokens at a time. If the text exceeds that limit, it might either truncate the text or use some form of sliding window to capture different parts of the text sequentially.</li>
                          <li><strong>Sliding Window:</strong> For models that work with long sequences, the context window might "slide" over the text in chunks. For example, a 512-token context window might start at token 0 and go to token 511, and then slide over to tokens 1 to 512, continuing in this manner until the entire text is processed.</li>
                        </ul>
                      </li>

                      <li><strong>Trade-off:</strong> A larger context window can lead to better understanding and more accurate predictions since the model has access to more information. However, it also requires more computational resources and memory. Models with larger context windows are generally slower and more resource-intensive.</li>

                      <li><strong>Embeddings:</strong> When discussing embeddings (vector representations of words or tokens), the context window is relevant because the meaning of a word in a specific context can change based on surrounding words. For example, the word "bank" might mean a financial institution or the side of a river depending on the context. The context window helps the model generate appropriate embeddings by considering surrounding words.</li>
                    </ul>
                    </div>
                </div>
            </div>


            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    What does Chunking mean?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>In AI and Natural Language Processing (NLP), chunking refers to breaking documents or large texts into smaller segments (chunks) to make them suitable for processing by models, particularly embedding models. This process is crucial for tasks such as document retrieval, semantic search, and question answering.<Br>
                    Embedding models like Transformers (e.g., BERT, GPT) typically work with fixed-length input sequences. If a document or text is too long, it may exceed the model's input size limit, which is usually somewhere between 512 and 2048 tokens (depending on the model). While chunking can enhance performance, there are challenges, such as:
                    <ul>
                        <li><strong>Choosing the optimal chunk size:</strong> If chunks are too small, you may lose significant context. If they are too large, they may still exceed the model’s input size limit or reduce granularity.</li>
                        <li><strong>Managing overlap:</strong> While overlap helps with context, too much overlap can make chunks redundant, leading to inefficiencies.</li>
                        <li><strong>Handling documents with variable structures:</strong> In cases like scientific papers or technical documentation, where section breaks are important, chunking should account for these structures to maintain logical integrity.</li>
                    </ul>
                    </div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    Are Many Small Chunks Better than Fewer Large Chunks?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>When you break a document into many smaller chunks, each chunk captures specific details and context from a smaller portion of the text.<br>
                        This makes the embeddings more granular and potentially more accurate because: <br>
                        <ul>
                            <li><strong>Precision:</strong> Smaller chunks allow the model to better focus on key information. The embeddings for smaller chunks tend to represent more specific concepts or topics.</li>
                            <li><strong>Flexibility:</strong> When you have many smaller chunks, you can retrieve or analyze them individually, improving the system’s flexibility. For instance, in search or question answering tasks, retrieving smaller chunks that are highly relevant can provide more accurate results than retrieving large chunks that might contain irrelevant information.</li>
                            <li><strong>Faster Processing:</strong> Smaller chunks are easier and quicker for the model to process and generate embeddings for, as they fit well within the model's input limits and can be computed in parallel.</li>
                        </ul>
                    </div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    Should there be any overlap between chunks?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>Overlap between chunks involves including a small portion of text from the end of one chunk at the beginning of the next. This helps to address potential problems like context loss between chunks. Overlap is important for the following reasons: <br>
                    <ul>
                        <li><strong>Maintaining Context:</strong> In many cases, the meaning of a sentence or concept depends on the surrounding text. If chunks are cut in the middle of an important context, the model might fail to grasp the full meaning of the chunk. By having overlap, important context is preserved across chunks.</li>
                        <li><strong>Improved Embedding Quality:</strong> The embeddings generated for overlapping chunks can share similar features, which helps maintain semantic coherence between adjacent chunks. The model can pick up on relationships between chunks that might otherwise seem disconnected.</li>
                        <li><strong>Reducing Fragmentation:</strong> Without overlap, chunks might become isolated fragments of text that lose continuity. With overlap, you ensure that the boundaries between chunks don't break important narrative or logical connections.</li>
                    </ul>
                    </div>
                </div>
            </div>
                
            <!--
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    How to Update a Document?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>

                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    Can I Add multiple Documents?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>

            
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    Can I Update multiple Documents?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>

            
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    How to Copy a Document?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>

                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    How to Delete a Document?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                   How to Delete Multiple Documents?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>


            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                   How to Delete ALL Documents at Once?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>recreate collection, sama params, but empty</div>
                </div>
            </div>

                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                   How to Delete or Remove a Documents' Metadata?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>

               
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                   Should I really be using metadata? or just leave it, seeing as it's optional?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>...</div>
                </div>
            </div>
            -->

   
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                   Chroma Flow Studio Application not working offline? Isn't it supposed to be a local app?
                    
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>You must first be connected to the intenet to download the embedding model, once downloaded it then runs locally and you can disconnect from the internet on subequent launches.</div>
                </div>
            </div>
                
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    Does ChromaDB have any, shall we say, "Quirks" ?
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>  
                        <div>
                            <label><strong>1. Client Differences</strong></label><Br>
                            <label>The <strong>HTTP client</strong> handles HNSW collection config well, but struggles with embeddings. The <strong>Python client</strong> does the opposite. To fix this in Python, just add HNSW parameters as metadata alongside your other fields.</label>
                        </div>
                        <br>
                        <div>
                            <label><strong>2. Linux vs. Windows</strong></label><br>
                            <label>Linux users get smooth sailing with HNSW support. On Windows, though, if you exceed the batch limit, Python might crash unexpectedly. The workaround? Just bump up the batch limit. The issue is tied to how Windows syncs data from memory to disk, and it’s less reliable there.</label>
                        </div>
                        <br>
                        <div>
                            <label><strong>3. No Bulk Deletion</strong></label><br>
                            <label>ChromaDB doesn’t have a native "bulk delete" function for documents. However, the workaround is to simply recreate the entire collection, which is near instant.</label>
                        </div>
                        <br>
                        <div>
                            <label><strong>4. Metadata: Optional, but Handy</strong></label><br>
                            <label>While metadata isn’t mandatory, it’s highly recommended. Collections and documents would benefit from fields like embedding model info, creation dates, and chunk numbers. Skipping metadata can lead to bad habits in managing your data.</label>
                        </div>
                        <br>
                        <label><strong>In short:</strong> ChromaDB has a few quirks, but with a little work, it’s smooth sailing ahead.</label>
                    
                    </div>
                </div>
            </div>
                
            <br>
            <br>
            <Br>
            <Br>
            <br>
        
            <h3>Alternative GUI's for ChromaDB:</h3>
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    <label>ChromaDash</label>
                    <br>
                    <br>
                    <a style="color:white" href="https://github.com/coffeecodeconverter/ChromaDash" target="_blank">https://github.com/coffeecodeconverter/ChromaDash</a>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>This is a HTTP Client UI, only works if you also have a HTTP ChromaDB Server running (default listens on 127.0.0.1:8000). <br>
                    Ignore, if you're interested in python clients.</div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    <label>Chroma UI</label>
                    <br>
                    <br>
                    <a style="color:white" href="https://github.com/thakkaryash94/chroma-ui" target="_blank">https://github.com/thakkaryash94/chroma-ui</a><br>
                    <a style="color:white" href="https://chroma-ui.vercel.app/" target="_blank">https://chroma-ui.vercel.app/</a>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>This is a HTTP Client UI, only works if you also have a HTTP ChromaDB Server running (default listens on 127.0.0.1:8000). <br>
                    Ignore, if you're interested in python clients.</div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    <label>Chroma Peek</label>
                    <br>
                    <br>
                    <a style="color:white" href="https://github.com/Pawandeep-prog/chroma-peek" target="_blank">https://github.com/Pawandeep-prog/chroma-peek</a>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>A Python client for quickly viewing documents in your collections. Can run basic queries for similarity search</div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    <label>Chromagraphic</label>
                    <br>
                    <br>
                    <a style="color:white" href="https://github.com/msteele3/chromagraphic" target="_blank">https://github.com/msteele3/chromagraphic</a>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>A Python client for quickly viewing documents in your collections. Can add documents, but not search them. </div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    <label>Vector Admin</label>
                    <br>
                    <br>
                    <a style="color:white" href="https://github.com/Mintplex-Labs/vector-admin" target="_blank">https://github.com/Mintplex-Labs/vector-admin</a>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>This is a universal management tool that supports Chroma and pinecone databases, with the aim to support more in future.<br>
                    Good UI that aims to simplify managing multiple vector databases through a unified interface.</div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    <label>Chroma DB Viewer</label>
                    <br>
                    <br>
                    <a style="color:white" href="https://github.com/ill-yes/chromadb-viewer" target="_blank">https://github.com/ill-yes/chromadb-viewer</a>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>This application is a simple ChromaDB viewer developed with Streamlit and Python. It allows you to visualize and manipulate collections from ChromaDB. You can select collections, add, update, and delete items.</div>
                </div>
            </div>

               
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    <label>Chroma Viewer</label>
                    <br>
                    <br>
                    <a style="color:white" href="https://github.com/avantrio/chroma-viewer" target="_blank">https://github.com/avantrio/chroma-viewer</a>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>A quick viewer for local Chrome DB</div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    <label>Chroma View Master</label>
                    <br>
                    <br>
                    <a style="color:white" href="https://github.com/clearsitedesigns/chromaViewMaster" target="_blank">https://github.com/clearsitedesigns/chromaViewMaster</a>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>ChromaView Master is a Streamlit-based tool designed to help you understand, visualize, and manipulate Chroma database collections. </div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    <label>ChromaDB Web UI</label>
                    <br>
                    <br>
                    <a style="color:white" href="https://github.com/treeleaves30760/chromadb-WebUI" target="_blank">https://github.com/treeleaves30760/chromadb-WebUI</a>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>This is a NodeJS Client with a Web UI Front End for viewing Chroma Collections.</div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    <label>ChromaDB UI</label>
                    <br>
                    <br>
                    <a style="color:white" href="https://github.com/BlackyDrum/chromadb-ui" target="_blank">https://github.com/BlackyDrum/chromadb-ui</a>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>This is a NodeJS Client with a Web UI Front End for viewing Chroma Collections.</div>
                </div>
            </div>
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    <label>ChromaDB UI</label>
                    <br>
                    <br>
                    <a style="color:white" href="https://github.com/seancheong/chroma-ui" target="_blank">https://github.com/seancheong/chroma-ui</a>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>This is a NodeJS Client with a Web UI Front End for viewing Chroma Collections.</div>
                </div>
            </div>
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    <label>ChromaDB UI</label>
                    <br>
                    <br>
                    <a style="color:white" href="https://github.com/keval9098/chromadb-ui" target="_blank">https://github.com/keval9098/chromadb-ui</a>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>This is a Python Client with a Web UI Front End for viewing Chroma Collections.</div>
                </div>
            </div>
                
                
                
            <div id="" class="page_help_panel_type2_wrapper">
                <div id="" class="page_help_panel_type2_titlebar">
                    <label>ChromaDB RAG</label>
                    <br>
                    <br>
                    <a style="color:white" href="https://github.com/leporejoseph/streamlit_Rag" target="_blank">https://github.com/leporejoseph/streamlit_Rag</a>
                    <!-- <button class="copy-btn search_python_code_copy_button" id="page_help_panel_type2_button" onclick="">Help</button>-->
                </div>
                <div id="" class="page_help_panel_type2_windowbody">
                    <div>RAG System using ChromaDB to drive it</div>
                </div>
            </div>
                
            <br>
            <br>
            <Br>
            <Br>
            <br>
                
                
  
        </div>
     
             
    </div>
            
    <!-- Popup Notification Bubble -->       
    <div id="notification-container"></div>  
                
                

 
                
                
    <script>
        
        
        // ===========================================================
        // GLOBAL VARIABLES
        // ===========================================================
        var webAppVersion = "1.0.0.3000";
        var webAppName = "ChromaFlowStudio";
        var appHasBootedUp = false;
        
        var masterAPIKey = "ABC123";    // not actually needed for chroma, but included in the http request structure as a formality, can be anything, its ignored, but must be present.

        let intervalId;                     // to keep track of the interval ID for the connection Status timer. 
        var networkCheckInterval = 20000;   // in milliseconds
        
        let statsIntervalId = null;         // interval for the CPU RAM updater

        // Global variable to store the collection ID and Name
        let selectedCollectionId = null;
        let selectedCollectionName = null;
        let selectedCollectionBatchSize = "N/A";

        // Global Variable for trakcing how many "text filters" are on screen 
        let filterCounter = 0;

        // counts of the query filters agasint documents and metadata on search page
        let documentFilterCount = 0;
        let metadataFilterCount = 0;
        
        let groupId = 0;
        
        // Global array to store navigation history
        let history = [];
        let currentIndex = -1; // Track current position in history
        const MAX_HISTORY_SIZE = 50; // Set the maximum size for the history

        
        // DATA GENERATOR GLOBAL VARIABLES
        // =================================================================
        const generateButton = document.getElementById('generate-button');
        const copyButton = document.getElementById('copy-button');
        const outputTextarea = document.getElementById('generatedJSONOutputTextarea');
        const startRecordInput = document.getElementById('start-record');
        const endRecordInput = document.getElementById('end-record');
        const radioButtons = document.querySelectorAll('input[name="data-type"]');
        const contentPlaceholdertxt = document.getElementById('content-placeholder-txt');
        const contentPlaceholdercsv = document.getElementById('content-placeholder-csv');
        const contentPlaceholderjson = document.getElementById('content-placeholder-json');
        // =================================================================
        
        


        

        // Modified fetchData function with notifications
        async function fetchData(endpoint, method = 'GET', body = null) {
            //alert("troubleshooting fetch\n\n" + endpoint);
            try {
                const response = await fetch(endpoint, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: body ? JSON.stringify(body) : null,
                });

                // Check if the response was successful
                if (response.ok) {
                    const data = await response.json();
                    return data;
                } else {

                    // Optionally, you can throw an error or return a failure message here
                    throw new Error(`Request failed with status: ${response.status}`);
                }
            } catch (error) {
                
                if (error.message.includes('543')) {
                        // Show error notification on network or other unexpected errors
                        showNotification({
                            message: `Document ID Already Exists`,
                            backgroundColor: "#e74c3c",
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });
                    
                } else  if (error.message.includes('566')) {
                    
                        // Show error notification on network or other unexpected errors
                        showNotification({
                            message: `Error during upsert: Batch size exceeds maximum batch size 166 - Keep Import Batch size under 166`,
                            backgroundColor: "#e74c3c",
                            opacity: 90,
                            duration: 10000,
                            stackFromTop: false
                        });

                        console.error("Error:", error);
                    
                } else  if (error.message.includes('567')) {
                        showNotification({
                            message: "Clone Name already exists, pick a different Name",
                            backgroundColor: "#e74c3c", // Red for failure
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });
                        
                         console.error("Error:", error);
                    
                } else {
                        // Show error notification on network or other unexpected errors
                        showNotification({
                            message: `Request failed: ${error.message}`,
                            backgroundColor: "#e74c3c",
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });

                        console.error("Error:", error);
                }
                
                    
            }
            
        }

        


        
        
        
        // Reset Entire App UI to default values. 
        function resetEntireApp() {
            
        }

        


        function showPage(page) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');

            // Show the requested page
            document.getElementById(page).style.display = 'block';

            fetchAppSettingsJSON();

            // Check if the page is 'collections' and alert
            if (page === 'collections') {
                //alert("collections page");
                bugFIX100Docs_DisbaleBatchSizes();
                compareEmbedModelsSystemAndCollection();
            }

            // Check if the page is 'View Documents' and show Loading
            if (page === 'documents') {
                //alert("collections page");
                showLoading(true);
            }
            
            
            // Check if the page is 'View Documents' and show Loading
            if (page === 'adddocuments') {
                calculateTokens('page_adddocs_document_text', 'page_adddocs_token_counter_label');
            }
            
            // Check if the page is 'View Documents' and show Loading
            if (page === 'updatedocuments') {
                calculateTokens('page_updatedocs_document_text', 'page_updatedocs_token_counter_label');
            }
            
            
            


            // Check if the page is the most recent in the history
            if (currentIndex === -1 || history[currentIndex] !== page) {
                // Add the new page to history, removing forward history if we're not at the end
                if (currentIndex < history.length - 1) {
                    history = history.slice(0, currentIndex + 1); // Trim any forward history
                }

                // If the history has reached the max size, remove the oldest entry
                if (history.length >= MAX_HISTORY_SIZE) {
                    history.shift(); // Remove the oldest page from history
                }

                // Add the new page to history
                history.push(page);
                currentIndex++;
            }
        }


        
        // Go Back Functionality (called on back button click)
        function goBack() {
            if (currentIndex > 0) {
                currentIndex--;
                const previousPage = history[currentIndex];
                showPage(previousPage);
            } else {
                showNotification({
                    message: "Most recent page",
                    backgroundColor: "#2ecc71", // Success green for most recent
                    opacity: 90,
                    duration: 700,
                    stackFromTop: false
                });
            }
        }

        
        
        
        // Go Forward Functionality (called on forward button click)
        function goForward() {
            if (currentIndex < history.length - 1) {
                currentIndex++;
                const nextPage = history[currentIndex];
                showPage(nextPage);
            } else {
                showNotification({
                    message: "You are on the last page",
                    backgroundColor: "#e74c3c", // Red for last page
                    opacity: 90,
                    duration: 700,
                    stackFromTop: false
                });
            }
        }

        
        // Scroll to an element, by passing its ID string
        function myScrollTo(elementId) {
            // Get the element by ID
            const element = document.getElementById(elementId);

            // Check if the element exists
            if (element) {
                // Scroll the page to the element using scrollIntoView
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
                console.error(`Element with id "${elementId}" not found.`);
            }
        }

        
        // Scroll to an element, by passing its ID string
        function myScrollToTop() {
            window.scrollTo({
              top: 0,
              behavior: 'smooth' // Optional: for smooth scrolling
            });
        }
        
        
        
        // Sidebar Toggle
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const mainContent = document.querySelector('.main-content');
            sidebar.classList.toggle('active');
            mainContent.classList.toggle('sidebar-active');
        }
        
        
        // Close Sidebar
        function closeSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const mainContent = document.querySelector('.main-content');
            sidebar.classList.remove('active'); // Remove the active class to close the sidebar
            mainContent.classList.remove('sidebar-active'); // Optionally, remove the effect on main content if desired
        }

        
        
        
        
        // Generate UUID for documents
        function generateUUID(passedElemIDToUpdate) {
            // Get the element by ID
            const element = document.getElementById(passedElemIDToUpdate);

            // Check if the element exists
            if (!element) {
                console.error('Element with the specified ID not found:', passedElemIDToUpdate);
                return;
            }

            // Generate the UUID
            const uuid = crypto.randomUUID();

            // Check the tag type and set the appropriate property
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                element.value = uuid;  // Set value for input or textarea elements
            } else if (element.tagName === 'DIV' || element.tagName === 'SPAN' || element.tagName === 'P') {
                element.innerText = uuid;  // Set innerText for div, span, or paragraph elements
            } else {
                console.warn('Unsupported element type:', element.tagName);
            }
        }

        
        
        // Generate timestamp in yyyy-mm-dd hh:mm:ss:uuu format
        function generateTimestamp(passedElemIDToUpdate) {
            const now = new Date();

            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are zero-indexed
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            const milliseconds = String(now.getMilliseconds()).padStart(3, '0');

            const timestamp = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}:${milliseconds}`;

            const elem = document.getElementById(passedElemIDToUpdate);

            // Check if the element is an input or textarea (use value), otherwise use innerText
            if (elem instanceof HTMLInputElement || elem instanceof HTMLTextAreaElement) {
                elem.value = timestamp;
            } else {
                elem.innerText = timestamp;
            }
        }

        
        
  
        function showNotification({ 
          message, 
          backgroundColor = "#333", 
          opacity = 100, 
          duration = 3000, 
          stackFromTop = true 
        }) {
          const container = document.getElementById('notification-container');

          // Create notification element
          const notification = document.createElement('div');
          notification.className = 'notification';
          notification.style.backgroundColor = backgroundColor;
          notification.style.opacity = opacity / 100;
          notification.innerHTML = message;

          // Apply stacking direction
          if (stackFromTop) {
            // Stack from top-right
            container.style.top = '10px';
            container.style.bottom = 'auto';
            notification.style.marginTop = '10px'; // Margin for spacing
            container.prepend(notification); // Add new notification to the top
          } else {
            // Stack from bottom-right
            container.style.bottom = '10px';
            container.style.top = 'auto';
            notification.style.marginBottom = '10px'; // Margin for spacing
            container.append(notification); // Add new notification to the bottom
          }

          // Trigger the show animation
          setTimeout(() => notification.classList.add('show'), 10);

          // Automatically hide the notification after the duration
          setTimeout(() => {
            notification.classList.add('hide');
            notification.addEventListener('transitionend', () => notification.remove());
          }, duration);
        }

        /*
        // Example usage
        showNotification({
          message: "This is a top-right notification!",
          backgroundColor: "#3498db",
          opacity: 90,
          duration: 4000,
          stackFromTop: false
        });
        
        // Example usage
        showNotification({
          message: "This is a succes or confirmation notification!",
          backgroundColor: "#2ecc71",
          opacity: 90,
          duration: 4000,
          stackFromTop: false
        });
        
        // Example usage
        showNotification({
          message: "This is an error or failure or deletion notification!",
          backgroundColor: "#e74c3c",
          opacity: 90,
          duration: 4000,
          stackFromTop: false
        });
        */
        
        
        
        

        function showLoading(show){
            if (show){
                    document.getElementById("loading-icon-wrap").style.display = 'block';
                    document.getElementById("clone_collection_loading_gif").style.display = 'inline-block';
            } else {
                    document.getElementById("loading-icon-wrap").style.display = 'none';
                    document.getElementById("clone_collection_loading_gif").style.display = 'none';
            }   
        }

        
        

        
        
        // Function to test heartbeat
        async function testHeartbeatFlask() {
            showLoading(true);
            try {
                const addressFlask = `${window.location.origin}/flask-heartbeat`; // Construct the URL with /flask-heartbeat
                const data = await fetchData(addressFlask); // Fetch data from the constructed URL

                console.log(data); // Log the response data to verify structure

                // Check if the flaskAppVersion is present in the response data
                if (data && data.heartbeat) {
                    // Success: show a success notification
                    showNotification({
                        message: `Flask Heartbeat: ${data.heartbeat}`,
                        backgroundColor: "#2ecc71",
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });

                    return data.flaskAppVersion;
                } else {
                    throw new Error('Flask Heartbeat failed');
                }
            } catch (error) {
                console.error('Error fetching Flask Heartbeat:', error);

                // Failure: show an error notification
                showNotification({
                    message: "Failed to fetch Flask Heartbeat!",
                    backgroundColor: "#e74c3c",
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });

                return null; // Return null if there's an error
            }

            setTimeout(function() {
                showLoading(false);
            }, 1600);
        }



        

        // Function to fetch the app version and update the HTML element
        async function getFlaskVersion() {
            showLoading(true);
            const baseUrl = window.location.origin;
            const versionUrl = `${baseUrl}/version`;

            try {
                const response = await fetch(versionUrl);

                if (response.ok) {
                    // Parse the JSON response
                    const versionData = await response.json();
                    const flaskAppVersion = versionData.flaskAppVersion;

                    // Update the HTML elements with the version
                    document.getElementById("page_dashboard_flask_app_version").innerHTML = flaskAppVersion;
                    document.getElementById("page_help_flask_app_version").innerHTML = flaskAppVersion;  
                    document.getElementById("page_settings_flask_app_version").innerHTML = flaskAppVersion;  
                    
                    /*
                    if (appHasBootedUp == true){
                        // Show success notification
                        showNotification({
                            message: "Successfully fetched Flask app version!",
                            backgroundColor: "#2ecc71", // Green for success
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });
                    }
                    */


                } else {
                    // Handle unsuccessful response
                    console.error("Failed to fetch version:", response.statusText);

                    // Show error notification
                    showNotification({
                        message: `Failed to fetch version: ${response.statusText}`,
                        backgroundColor: "#e74c3c", // Red for error
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                }

            } catch (error) {
                // Handle network or other errors
                console.error("Error fetching version:", error);

                // Show error notification
                showNotification({
                    message: `Error fetching version: ${error.message}`,
                    backgroundColor: "#e74c3c", // Red for error
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
            }

            // Hide loading indicator after a delay
            setTimeout(function() {
                showLoading(false);
            }, 1600);
        }

        
        
        
        
        
        async function getChromaServerVersion() {
            showLoading(true);

            const baseUrl = window.location.origin;
            const chromaVersionUrl = `${baseUrl}/version-chroma`;

            // Simulate a small delay before making the fetch call
            setTimeout(async function() {
                try {
                    // Make a GET request to the Flask endpoint
                    const response = await fetch(chromaVersionUrl);

                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }

                    const data = await response.text();

                    // Output the version or handle the response data
                    console.log(data);
                    var pureVersion = data.replace(/Version: /g, "");

                    document.getElementById('page_dashboard_chroma_version').innerHTML =  pureVersion;
                    document.getElementById('page_help_chroma_server_version').innerHTML =  pureVersion;
                    document.getElementById('page_settings_chroma_server_version').innerHTML =  pureVersion;

                    /*
                    if (appHasBootedUp == true) {
                        // Success notification
                        showNotification({
                            message: "Chroma server version fetched successfully!",
                            backgroundColor: "#2ecc71", // Green for success
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });
                    }
                    */

                } catch (error) {
                    console.error('There was a problem with the fetch operation:', error);

                    // Error notification
                    showNotification({
                        message: "Failed to fetch Chroma server version.",
                        backgroundColor: "#e74c3c", // Red for error
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                }
            }, 1600);  // Delay before fetching the version (in ms)

            // Simulate another delay before hiding the loading spinner
            setTimeout(function() {
                showLoading(false);  // Hide loading after another delay
            }, 1600);  // Delay before hiding the loading spinner (in ms)
        }

        

        
        
        
        
        async function updateTotalCollectionCount() {
            try {
                // Call the Flask endpoint to get the collection count
                const data = await fetchData('/count-collections');

                // If the response data is a number (collection count)
                if (typeof data === 'number') {
                    // Update the HTML element with the collection count
                    document.getElementById('page_dashboard_stats_collection_count').innerHTML = data;
                    document.getElementById('page_collections_labels_collection_count').innerHTML = data;
                } else {
                    // Handle case where the response is not a number (e.g. error response)
                    document.getElementById('page_dashboard_stats_collection_count').innerHTML = 'Error fetching collection count';
                    document.getElementById('page_collections_labels_collection_count').innerHTML = 'Error fetching collection count';
                }
            } catch (error) {
                // Handle any errors that occur in the process
                document.getElementById('page_dashboard_stats_collection_count').innerHTML = 'Error fetching collection count';
                document.getElementById('page_collections_labels_collection_count').innerHTML = 'Error fetching collection count';
            }
        }


        
        

        // New function to fetch the document count and update the HTML element
        async function updateTotalDocumentCount() {
            try {
                const data = await fetchData('/count-all-documents');

                if (data && data.total_document_count !== undefined) {
                    // Update the HTML element with the total document count
                    document.getElementById('page_dashboard_stats_document_count').innerHTML = data.total_document_count;
                } else {
                    // Handle case where the total_document_count is missing or invalid
                    console.error('Error: Total document count not available');
                }
            } catch (error) {
                console.error('Error fetching document count:', error);
            }
        }
        
        
        
        
        // New function to fetch the document count and update the HTML element
        async function updateCollectionDocumentCount() {
            try {
                // Get the collection name from the dropdown
                var collectionName = "";

                var tempselect = document.getElementById('page_collections_collection_dropdown');
                // Check if a valid selection exists
                if (tempselect.selectedIndex >= 0) {
                    collectionName = tempselect.options[tempselect.selectedIndex].text;
                }
                
                if (!collectionName) {
                    const dropdown = document.getElementById('page_collections_collection_dropdown');
                    const optionCount = dropdown ? dropdown.options.length : 0;
                    
                    if (appHasBootedUp == true) {
                        if (optionCount === 0) {
                            // Show notification for no collections in DB
                            showNotification({
                                message: "No Collections in DB - Create a Collection First.",
                                backgroundColor: "#f39c12",  // Yellow background color for this case
                                opacity: 90,
                                duration: 4000,
                                stackFromTop: false
                            });
                            console.warn('Warning: No collections in the database.');
                        } else {
                            // Show notification for missing collection name
                            showNotification({
                                message: "Error: Collection name not provided.",
                                backgroundColor: "#e74c3c", // Red background color for error
                                opacity: 90,
                                duration: 4000,
                                stackFromTop: false
                            });
                            console.error('Error: Collection name is missing.');
                        }
                    }
                    
                    return;
                }

                // Fetch the document count from the backend with the collection name
                
                const data = await fetchData(`/count-documents?collection_name=${collectionName}`);

                // Handle the response and update the HTML element with the document count
                if (data && data.document_count !== undefined) {
                    
                    // Document Count on Collections Page
                    document.getElementById('page_collections_docinfo_count').innerHTML = data.document_count;
                    
                    // Document Count on Add Documents Page
                    document.getElementById('page_adddocs_labels_doc_count').innerHTML = '<label class="darker-info-label">Document Count: </label>' + data.document_count;

                    // Document Count on View Documents Page
                    document.getElementById('page_documents_labels_doc_count').innerHTML = '<label class="darker-info-label">Document Count: </label>' + data.document_count;
                    
                    // Document Count on Search Page
                    document.getElementById('page_search_similarity_doc_count').innerHTML = '<label class="darker-info-label">Document Count: </label>' + data.document_count;
                    
                    // Document Count on import Page
                    document.getElementById('page_import_labels_doc_count').innerHTML = '<label class="darker-info-label">Document Count: </label>' + data.document_count;                    
                    
                    // Document Count on Clone Collectin Dialog
                    document.getElementById('clone_collection_from_doc_count').innerHTML = data.document_count;                    
                    
                    // Document Count on Export Page
                    document.getElementById('page_export_labels_doc_count').innerHTML = '<label class="darker-info-label">Document Count: </label>' + data.document_count; 
                    
                    // Document Count on Visualize Page
                    document.getElementById('page_visualize_labels_doc_count').innerHTML = '<label class="darker-info-label">Document Count: </label>' + data.document_count; 

                    /*
                    // Show success notification
                    showNotification({
                        message: `Document count for ${collectionName}: ${data.document_count}`,
                        backgroundColor: "#2ecc71",
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    */
                    console.log(`Document count for ${collectionName}: ${data.document_count}`);
                    
                } else if (data && data.error) {
                    // Show error notification if an error is returned in the response
                    showNotification({
                        message: data.error,
                        backgroundColor: "#e74c3c",
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    console.error('Error fetching document count:', data.error);
                } else {
                    // Handle unexpected response structure
                    showNotification({
                        message: "Unexpected error occurred while fetching document count.",
                        backgroundColor: "#e74c3c",
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    console.error('Unexpected response structure:', data);
                }
            } catch (error) {
                // Handle any unexpected errors during the fetch process
                showNotification({
                    message: "Error fetching document count from the server.",
                    backgroundColor: "#e74c3c",
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
                console.error('Error fetching document count:', error);
            }
        }
        
        
        
        
        
        
        
        // Function to fetch data from the /chromadb-path-sqllite endpoint
        async function updateDbPath() {
            try {
                // Fetch the data from the /chromadb-path-sqllite endpoint
                const data = await fetchData('/chromadb-path-sqllite', 'GET');

                // Check if data exists and the key is present
                if (data && data.chromadb_path_sqllite) {
                    // Update the innerHTML of the div with the ID 'page_dashboard_stats_dbpath'
                    document.getElementById('page_dashboard_stats_dbpath').innerHTML = data.chromadb_path_sqllite;
                } else {
                    // In case the data structure is not as expected
                    console.error("Invalid data received:", data);
                    document.getElementById('page_dashboard_stats_dbpath').innerHTML = 'Error: Invalid data.';
                }
            } catch (error) {
                // Handle any unexpected errors during the fetch process
                console.error("Error updating DB path:", error);
                document.getElementById('page_dashboard_stats_dbpath').innerHTML = 'Error: Unable to fetch data.';
            }
        }
        
        

        
        

        function updateEmbeddingModelInfo() {
            // Make the GET request to the Flask route
            fetch('/embedmodelinfo', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch embedding model info');
                }
                return response.json();
            })
            .then(data => {
                // Check if the response has the expected keys
                if (data.embedding_model && data.embedding_model_path && data.embedding_model_context_window) {
                    // Populate the HTML elements with the fetched data
                
                    // On the Dashboard Page
                    document.getElementById('page_dashboard_stats_embed_model_path').innerHTML = data.embedding_model_path;
                    document.getElementById('page_dashboard_stats_embed_model').innerHTML = data.embedding_model;
                    document.getElementById('page_dashboard_stats_embed_context_window').innerHTML = data.embedding_model_context_window;
                    
                    // --------------
                    // Labels on the collections page - AMENDED - NO LONGER USING the collection config labels - i.e. .the 2 lines below, as they get that from the collections metadata...
                    //document.getElementById('page_collections_details_embed_model').innerHTML = data.embedding_model;
                    //document.getElementById('page_collections_details_embed_dimension').innerHTML = data.embedding_model_context_window;
                    
                    // INSTEAD we'll update 2 NEW labels on collections page, that indicate the SYSTEMS current embed model details. 
                    document.getElementById('page_collections_system_embed_model').innerHTML = "&nbsp;&nbsp;&nbsp; <label class='darker-info-label'>System Embed Model: </label> " + document.getElementById('page_settings_embed_model_input').value;
                    
                    document.getElementById('page_collections_system_embed_dimension').innerHTML = "&nbsp;&nbsp;&nbsp; <label class='darker-info-label'>System Embed Dimension: </label> " + document.getElementById('page_settings_embed_dimension_input').value;
                    
                    document.getElementById('page_visualize_labels_dimension').innerHTML = "&nbsp;&nbsp;&nbsp; <label class='darker-info-label'>Dimensionality: </label> " + document.getElementById('page_settings_embed_dimension_input').value;
                    // --------------

                    // On the Add Documents Page
                    document.getElementById('page_adddocs_labels_embed_model').innerHTML = "&nbsp;&nbsp;&nbsp; <label class='darker-info-label'>Model:</label> " + data.embedding_model;
                    document.getElementById('page_adddocs_labels_embed_context_window').innerHTML = "&nbsp;&nbsp;&nbsp; <label class='darker-info-label'>Context Window:</label> " + data.embedding_model_context_window;
                    
                    // Labels on the tools page
                    document.getElementById('page_tools_embedding_generator_model_name').innerHTML = data.embedding_model;
                    document.getElementById('page_tools_embedding_generator_context_window').innerHTML = data.embedding_model_context_window;
                    
                    // Labels on the search page
                    document.getElementById('page_search_similarity_embed_model').innerHTML =  "&nbsp;&nbsp;&nbsp; <label class='darker-info-label'>Model:</label> " + data.embedding_model;
                    document.getElementById('page_search_similarity_embed_context_window').innerHTML = "&nbsp;&nbsp;&nbsp; <label class='darker-info-label'>Context Window:</label> " +data.embedding_model_context_window;
                    
                    // Labels on the Import page
                    document.getElementById('page_import_labels_embed_model').innerHTML =  "&nbsp;&nbsp;&nbsp; <label class='darker-info-label'>Model:</label> " + data.embedding_model;
                    document.getElementById('page_import_labels_embed_context_window').innerHTML = "&nbsp;&nbsp;&nbsp; <label class='darker-info-label'>Context Window:</label> " +data.embedding_model_context_window;
                    
                    // Labels on the Export page
                    document.getElementById('page_export_labels_embed_model').innerHTML =  "&nbsp;&nbsp;&nbsp; <label class='darker-info-label'>Model:</label> " + data.embedding_model;
                    document.getElementById('page_export_labels_embed_context_window').innerHTML = "&nbsp;&nbsp;&nbsp; <label class='darker-info-label'>Context Window:</label> " +data.embedding_model_context_window;
                    
                    // Labels on the Visualize page
                    document.getElementById('page_visualize_labels_embed_model').innerHTML =  "&nbsp;&nbsp;&nbsp; <label class='darker-info-label'>Model:</label> " + data.embedding_model;
                    document.getElementById('page_visualize_labels_embed_context_window').innerHTML = "&nbsp;&nbsp;&nbsp; <label class='darker-info-label'>Context Window:</label> " +data.embedding_model_context_window;
                    
                    
                    /*
                    if (appHasBootedUp == true){
                        // Show success notification
                        showNotification({
                            message: "Embedding model information loaded successfully!",
                            backgroundColor: "#2ecc71",  // Green for success
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });
                    }
                    */
    
                } else {
                    // Handle missing or incomplete data
                    console.error('Missing data fields in the response');

                    // Show error notification
                    showNotification({
                        message: "Failed to load embedding model information!",
                        backgroundColor: "#e74c3c",  // Red for error
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                }
            })
            .catch(error => {
                // Handle any errors that occur during the fetch or data processing
                console.error('Error fetching embedding model info:', error);

                // Show error notification
                showNotification({
                    message: "An error occurred while fetching embedding model information!",
                    backgroundColor: "#e74c3c",  // Red for error
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
            });
        }

        
        
        
        
        
        
        // CHROMA ACTION - Load Collections
        function loadCollections() {
            showLoading(true);
            
            try {
                fetchData('/get-collections')
                    .then(data => {                    
                        // Get the dropdown elements
                        var collectionDropdown1 = document.getElementById('page_search_collection_dropdown');
                        var collectionDropdown2 = document.getElementById('page_collections_collection_dropdown');
                        var collectionDropdown3 = document.getElementById('page_adddocs_collection_dropdown');
                        var collectionDropdown4 = document.getElementById('page_documents_collection_dropdown');
                        var collectionDropdown5 = document.getElementById('page_updatedocs_collection_dropdown');
                        var collectionDropdown6 = document.getElementById('page_tools_collection_dropdown');
                        var collectionDropdown7 = document.getElementById('page_import_collection_dropdown');
                        var collectionDropdown8 = document.getElementById('page_collections_clone_collection_dropdown');
                        var collectionDropdown9 = document.getElementById('page_export_collection_dropdown');
                        var collectionDropdown10 = document.getElementById('page_visualize_collection_dropdown');
                        var collectionDropdown11 = document.getElementById('page_rag_collection_dropdown');

                        // Clear existing options
                        collectionDropdown1.innerHTML = '';
                        collectionDropdown2.innerHTML = '';
                        collectionDropdown3.innerHTML = '';
                        collectionDropdown4.innerHTML = '';
                        collectionDropdown5.innerHTML = '';
                        collectionDropdown6.innerHTML = '';
                        collectionDropdown7.innerHTML = '';
                        collectionDropdown8.innerHTML = '';
                        collectionDropdown9.innerHTML = '';
                        collectionDropdown10.innerHTML = '';
                        collectionDropdown11.innerHTML = '';

                        // Only add collection options if data is returned
                        if (data && Array.isArray(data)) {
                            data.forEach(collection => {
                                // Create a new option element for each collection
                                const option = document.createElement('option');
                                option.textContent = collection.name;
                                option.value = collection.id;

                                // Append the option to each dropdown
                                collectionDropdown1.appendChild(option);
                                collectionDropdown2.appendChild(option.cloneNode(true));
                                collectionDropdown3.appendChild(option.cloneNode(true));
                                collectionDropdown4.appendChild(option.cloneNode(true));
                                collectionDropdown5.appendChild(option.cloneNode(true));
                                collectionDropdown6.appendChild(option.cloneNode(true));
                                collectionDropdown7.appendChild(option.cloneNode(true));
                                collectionDropdown8.appendChild(option.cloneNode(true));
                                collectionDropdown9.appendChild(option.cloneNode(true));
                                collectionDropdown10.appendChild(option.cloneNode(true));
                                collectionDropdown11.appendChild(option.cloneNode(true));
                                
                            });

                            console.log("Successfully loaded collections:", data);
                            fetchCollectionOverview();
                            
                        } else {
                            console.error("Received invalid data:", data);

                            // Error notification for invalid data
                            showNotification({
                                message: "Failed to load collections. Invalid data received.",
                                backgroundColor: '#e74c3c',  // Error color
                                opacity: 80,
                                duration: 4000,
                                stackFromTop: false
                            });
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching collections:", error);

                        // Error notification for network issues
                        showNotification({
                            message: "Network issue: Unable to load collections.",
                            backgroundColor: '#e74c3c',  // Error color
                            opacity: 80,
                            duration: 4000,
                            stackFromTop: false
                        });
                    });
            } catch (error) {
                console.error("An error occurred while loading collections:", error);

                // Error notification for unexpected errors
                showNotification({
                    message: "An unexpected error occurred while loading collections.",
                    backgroundColor: '#e74c3c',  // Error color
                    opacity: 80,
                    duration: 4000,
                    stackFromTop: false
                });
            
            }
            

            try {
                var tempselect = document.getElementById('page_search_collection_dropdown');

                // Check if the dropdown element exists
                if (!tempselect) {
                    console.error('Dropdown element with id "page_search_collection_dropdown" not found.');
                    setTimeout(function() {
                        showLoading(false);
                    }, 1600);    
                    if (appHasBootedUp == true){ 
                        showNotification({
                            message: 'Dropdown element with id "page_search_collection_dropdown" not found.',
                            backgroundColor: '#e74c3c',  
                            opacity: 80,
                            duration: 4000,
                            stackFromTop: false
                        });
                    }
                    return;
                }

                // Check if the dropdown has any options at all
                if (tempselect.options.length === 0) {
                    console.error('No Collections in Database - Create one');
                    setTimeout(function() {
                        showLoading(false);
                    }, 1600);       
                    if (appHasBootedUp == true){ 
                        showNotification({
                            message: 'No Collections in Database - Create one',
                            backgroundColor: '#e74c3c',  
                            opacity: 80,
                            duration: 4000,
                            stackFromTop: false
                        });
                    }
                    return;
                }

                // Check if a valid option is selected
                if (tempselect.selectedIndex >= 0) {
                    var selectedText = tempselect.options[tempselect.selectedIndex].text;
                    selectedCollectionName = selectedText;

                    setTimeout(function() {
                        forceCollectionSelection(selectedCollectionName);
                    }, 100); // 100ms delay
                    
                } else {
                    // Handle the case when no option is selected
                    console.error('No collection selected in page_search_collection_dropdown');
                }
            } catch (error) {
                console.error('An error occurred:', error);
            }

            
            if (appHasBootedUp == true){    
               // Success notification
                showNotification({
                    message: 'Collections loaded successfully!',
                    backgroundColor: '#2ecc71',  // Success color
                    opacity: 80,
                    duration: 4000,
                    stackFromTop: false
                });
            }

            setTimeout(function() {
                showLoading(false);
            }, 1600);            
            
        }
      
        
        
        

        // Whatever Dropdown is changed, all others update to the same, and it updates the global variables for collection ID and Name for easy reference in other functions 
        function handleCollectionChange(idOfSelectTag) {
            showLoading(true);
            
            try {
            
                // Check if the select element exists
                var select = document.getElementById(idOfSelectTag);
                if (!select) {
                    throw new Error(`Select element with id '${idOfSelectTag}' not found`);
                }

                var selectedText = '';

                // Check if the select element has any options
                if (select.options.length > 0) {
                    // Check if there's a selected option
                    if (select.selectedIndex >= 0) {
                        selectedText = select.options[select.selectedIndex].text;
                    } else {
                        // Handle case where no option is selected
                        selectedText = 'No option selected';  // Example fallback message
                    }
                } else {
                    // Handle case where the select element is empty
                    selectedText = 'No options available';  // Example fallback message
                }

                // Define target select elements
                var selectElements = [
                    'page_search_collection_dropdown',
                    'page_collections_collection_dropdown',
                    'page_adddocs_collection_dropdown',
                    'page_documents_collection_dropdown',
                    'page_updatedocs_collection_dropdown',
                    'page_tools_collection_dropdown',
                    'page_import_collection_dropdown',
                    'page_collections_clone_collection_dropdown',
                    'page_export_collection_dropdown',
                    'page_visualize_collection_dropdown',
                    'page_rag_collection_dropdown'
                ];

                // Loop through target select elements and update their selection
                selectElements.forEach(function(id) {
                    try {
                        var targetSelect = document.getElementById(id);
                        if (!targetSelect) {
                            throw new Error(`Target select element with id '${id}' not found`);
                        }

                        var found = false;
                        for (var i = 0; i < targetSelect.options.length; i++) {
                            if (targetSelect.options[i].text === selectedText) {
                                targetSelect.selectedIndex = i; // Set selected index
                                found = true;
                                break;
                            }
                        }

                        if (!found) {
                            console.warn(`Option with text '${selectedText}' not found in select element with id '${id}'`);
                        }

                    } catch (error) {
                        console.error(`Error in updating select element with id '${id}':`, error);
                    }
                });

                // Update Global Variable
                selectedCollectionName = selectedText;

                try {
                    getCollectionDetailsFlask(); // Ensure this function exists and works as expected
                } catch (error) {
                    console.error("Error in getCollectionDetailsFlask:", error);
                }

                try {
                    updateCollectionDocumentCount(); // Ensure this function exists and works as expected
                } catch (error) {
                    console.error("Error in updateCollectionDocumentCount:", error);
                }
                
                compareEmbedModelsSystemAndCollection();
                
                // Show loading and hide after delay
                setTimeout(function() {
                    showLoading(false);
                }, 1600);

            } catch (error) {
                console.error("An error occurred in handleCollectionChange:", error);
                showLoading(false); // Ensure loading is hidden in case of an error
            }
        }
        
        
        
        
        
        // Force a Collection to be selected in a drop-down, which should then propagate to all other drop-downs and sync up
        function forceCollectionSelection(passedCollectionName) {
            // List of all select element IDs to update
            var selectElements = [
                'page_search_collection_dropdown',
                'page_collections_collection_dropdown',
                'page_adddocs_collection_dropdown',
                'page_documents_collection_dropdown',
                'page_updatedocs_collection_dropdown',
                'page_tools_collection_dropdown',
                'page_import_collection_dropdown',
                'page_collections_clone_collection_dropdown',
                'page_export_collection_dropdown',
                'page_visualize_collection_dropdown',
                'page_rag_collection_dropdown'
            ];

            // Flag to check if a match is found
            var isMatchFound = false;

            // Loop through each select element
            selectElements.forEach(function(selectId) {
                var selectElement = document.getElementById(selectId);

                // Loop through the options of the select element
                for (var i = 0; i < selectElement.options.length; i++) {
                    // Check if the option text matches the passed string
                    if (selectElement.options[i].text === passedCollectionName) {
                        // Set the selected index to the matched option
                        selectElement.selectedIndex = i;

                        // Mark that a match was found
                        isMatchFound = true;
                        break; // Stop looping through options once a match is found
                    }
                }
            });

            // Show success or error notification based on the result
            if (isMatchFound) {
                showNotification({
                    message: "Collection selected: " + passedCollectionName,
                    backgroundColor: "#2ecc71",  // Green for success
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
            } else {
                showNotification({
                    message: "No matching collection found: " + passedCollectionName,
                    backgroundColor: "#e74c3c",  // Red for error
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
            }
        }
        
        
      
        
    
        
    


        async function getCollectionDetailsFlask() {
            showLoading(true);
            // Send GET request to fetch collection details
            fetch(`/api/get-collection-details?collection_name=${encodeURIComponent(selectedCollectionName)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error("Error fetching collection details:", data.error);

                        // Check if the error message contains "Collection null does not exist"
                        if (data.error.includes("Collection null does not exist")) {
                            // Show a specific notification for this error
                            showNotification({
                                message: "No Collections In Database - Create a Collection First",
                                backgroundColor: "#f39c12",  // Changed to a more suitable color for this message
                                opacity: 90,
                                duration: 4000,
                                stackFromTop: false
                            });
                        } else {
                            // Show the general error notification
                            showNotification({
                                message: `Error fetching collection details: ${data.error}`,
                                backgroundColor: "#e74c3c",  // Red for general errors
                                opacity: 90,
                                duration: 4000,
                                stackFromTop: false
                            });
                        }

                        return;
                    }

                    // Extract ID from the response and set the global variable
                    selectedCollectionId = data.id;

                    // troubleshooting 
                    //alert(data.id + '\n' + data.name + '\n' + data.tenant + '\n' + data.database);

                    // Update the HTML elements with the fetched data
                    document.getElementById("page_collections_details_id").textContent = `${data.id}`;
                    document.getElementById("page_collections_details_name").textContent = `${data.name}`;
                    document.getElementById("page_collections_details_tenant").textContent = `${data.tenant}`;
                    document.getElementById("page_collections_details_database").textContent = `${data.database}`;

                    // Update configuration details (no need to reference 'hnsw_configuration' anymore)
                    document.getElementById("page_collections_config_name").textContent = `${data.name}`;
                
                    // Update configuration details from metadata
                    const metadata = data.metadata || {};

                    try {
                        document.getElementById("page_collections_config_space").textContent = metadata["hnsw:space"] || "N/A";
                        document.getElementById("page_collections_config_ef_construction").textContent = metadata["hnsw:construction_ef"] || "N/A";
                        document.getElementById("page_collections_config_ef_search").textContent = metadata["hnsw:search_ef"] || "N/A";
                        document.getElementById("page_collections_config_num_of_threads").textContent = metadata["hnsw:num_threads"] || "N/A";
                        document.getElementById("page_collections_config_m").textContent = metadata["hnsw:M"] || "N/A";
                        document.getElementById("page_collections_config_resize_factor").textContent = metadata["hnsw:resize_factor"] || "N/A";
                        document.getElementById("page_collections_config_batch_size").textContent = metadata["hnsw:batch_size"] || "N/A";
                        document.getElementById("page_collections_config_batch_size").textContent = metadata["hnsw:batch_size"] || "N/A";
                        
                        // also update global variable, and other labels for Batch Size
                        selectedCollectionBatchSize = metadata["hnsw:batch_size"] || "N/A";
                        document.getElementById("page_import_labels_batch_size_window").innerHTML = `<label class="darker-info-label">Collection Batch Size: </label>` + metadata["hnsw:batch_size"] || "N/A";
                        document.getElementById("clone_collection_from_batch_size").innerHTML = metadata["hnsw:batch_size"] || "N/A";
                        document.getElementById("page_export_labels_batch_size_window").innerHTML = `<label class="darker-info-label">Collection Batch Size: </label>` + metadata["hnsw:batch_size"] || "N/A";
                        
                        document.getElementById("page_collections_config_sync_threshold").textContent = metadata["hnsw:sync_threshold"] || "N/A";
                        
                    } catch (error) {
                        console.error("Error updating configuration details:", error);

                        // Show an error notification for catching issues with metadata fields
                        showNotification({
                            message: `Error updating configuration details: ${error.message}`,
                            backgroundColor: "#e74c3c",
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });
                    }

                    
                    // now try to update the collections embedding model and dimension from the metadata  
                    try {
                        document.getElementById('page_collections_details_embed_model').innerHTML = metadata["embedding_model"] || "N/A";
                        document.getElementById('page_collections_details_embed_dimension').innerHTML = metadata["embedding_model_dimension"] || "N/A";
 
                    } catch (error) {
                        console.error("Error updating configuration details:", error);

                        // Show an error notification for catching issues with metadata fields
                        showNotification({
                            message: `Error displaying collections embedding models details from metadata: ${error.message}`,
                            backgroundColor: "#e74c3c",
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });
                    }
                
                
                    // If metadata exists, populate the textarea
                    document.getElementById("page_collections_config_metadata").textContent = data.metadata ? JSON.stringify(data.metadata, null, 2) : "";

                    if (appHasBootedUp == true){
                        // Show a success notification
                        showNotification({
                            message: "Collection details fetched successfully!",
                            backgroundColor: "#2ecc71",
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });
                    }

                })
                .catch(error => {
                    console.error("Error:", error);

                    // Show an error notification for catch block
                    showNotification({
                        message: `Error occurred: ${error.message}`,
                        backgroundColor: "#e74c3c",
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                });

            setTimeout(function() {
                showLoading(false);
            }, 1600);
        }

        
        
        
        
        
        
        function copyCollectionDetails() {
            // Function to validate the fields
            function validateFields() {
                const fields = {
                    id: document.getElementById('page_collections_details_id').innerText.trim(),
                    name: document.getElementById('page_collections_details_name').innerText.trim(),
                    tenant: document.getElementById('page_collections_details_tenant').innerText.trim(),
                    database: document.getElementById('page_collections_details_database').innerText.trim(),
                    collectionName: document.getElementById('page_collections_config_name').innerText.trim(),
                    space: document.getElementById('page_collections_config_space').innerText.trim(),
                    efConstruction: document.getElementById('page_collections_config_ef_construction').innerText.trim(),
                    efSearch: document.getElementById('page_collections_config_ef_search').innerText.trim(),
                    numThreads: document.getElementById('page_collections_config_num_of_threads').innerText.trim(),
                    m: document.getElementById('page_collections_config_m').innerText.trim(),
                    resizeFactor: document.getElementById('page_collections_config_resize_factor').innerText.trim(),
                    batchSize: document.getElementById('page_collections_config_batch_size').innerText.trim(),
                    syncThreshold: document.getElementById('page_collections_config_sync_threshold').innerText.trim(),
                    metadata: document.getElementById('page_collections_config_metadata').value.trim() // Use .value for <textarea>
                };

                // Check if any field is empty or contains "?"
                for (const [key, value] of Object.entries(fields)) {
                    if (value === "" || value === "?") {
                        // Show error notification
                        showNotification({
                            message: `Error: The field '${key}' is invalid or empty.`,
                            backgroundColor: "#e74c3c",  // Red for error
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });
                        return false;  // Stop further execution if any field is invalid
                    }
                }

                return true;  // All fields are valid
            }

            // Validate fields before proceeding
            if (!validateFields()) {
                return;  // Stop execution if validation fails
            }

            // Confirm if the user wants to proceed
            const confirmClone = window.confirm("Copy details from the current collection?\n\nThis will overwrite the field values");

            if (confirmClone) {
                // Get values from the first set (Collection Details)
                const details = {
                    id: document.getElementById('page_collections_details_id').innerText.trim(),
                    name: document.getElementById('page_collections_details_name').innerText.trim(),
                    tenant: document.getElementById('page_collections_details_tenant').innerText.trim(),
                    database: document.getElementById('page_collections_details_database').innerText.trim(),
                    collectionName: document.getElementById('page_collections_config_name').innerText.trim(),
                    space: document.getElementById('page_collections_config_space').innerText.trim(),
                    efConstruction: document.getElementById('page_collections_config_ef_construction').innerText.trim(),
                    efSearch: document.getElementById('page_collections_config_ef_search').innerText.trim(),
                    numThreads: document.getElementById('page_collections_config_num_of_threads').innerText.trim(),
                    m: document.getElementById('page_collections_config_m').innerText.trim(),
                    resizeFactor: document.getElementById('page_collections_config_resize_factor').innerText.trim(),
                    batchSize: document.getElementById('page_collections_config_batch_size').innerText.trim(),
                    syncThreshold: document.getElementById('page_collections_config_sync_threshold').innerText.trim(),
                    metadata: document.getElementById('page_collections_config_metadata').value.trim() // Use .value for <textarea>
                };

                // Set values into the second set (Collection Creation)
                document.getElementById('page_collections_create_name').value = details.name;
                document.getElementById('page_collections_create_space').value = details.space;
                document.getElementById('page_collections_create_ef_construction').value = details.efConstruction;
                document.getElementById('page_collections_create_ef_search').value = details.efSearch;
                document.getElementById('page_collections_create_num_of_threads').value = details.numThreads;
                document.getElementById('page_collections_create_m').value = details.m;
                document.getElementById('page_collections_create_resize_factor').value = details.resizeFactor;
                document.getElementById('page_collections_create_batch_size').value = details.batchSize;
                document.getElementById('page_collections_create_sync_threshold').value = details.syncThreshold;
                document.getElementById('page_collections_create_metadata').value = details.metadata; // Ensure metadata is copied

                // Show success notification
                showNotification({
                    message: "Collection details have been successfully copied!",
                    backgroundColor: "#2ecc71",  // Green for success
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
            } else {
                // Show cancel notification
                showNotification({
                    message: "Copy Details was cancelled.",
                    backgroundColor: "#3498db",  // Orange for cancellation
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
                console.log("Copy Details was cancelled..");
            }
        }

        
        
        



        function clearAndFocusCollectionFields() {
            // Confirm if the user wants to clear the fields
            const confirmClear = window.confirm("Are you sure you want to clear all fields?");

            if (confirmClear) {
                // Clear all input fields, select fields, and textareas in the second set
                document.getElementById('page_collections_create_name').value = '';
                //document.getElementById('page_collections_create_space').value = 'l2';  // Reset to default "L2"
                //document.getElementById('page_collections_create_ef_construction').value = '';
                //document.getElementById('page_collections_create_ef_search').value = '';
                //document.getElementById('page_collections_create_num_of_threads').value = '';
                //document.getElementById('page_collections_create_m').value = '';
                //document.getElementById('page_collections_create_resize_factor').value = '';
                //document.getElementById('page_collections_create_batch_size').value = '';
                //document.getElementById('page_collections_create_sync_threshold').value = '';
                document.getElementById('page_collections_create_metadata').value = '';
                
                // Set the focus to the Collection Name field
                document.getElementById('page_collections_create_name').focus();
            } else {
                console.log("Clearing fields has been canceled.");
            }
        }
        
        
        
        
        
        
        
        function confirmSetDefaultNewCollectionFields(){
            // Confirm if the user wants to clear the fields
            const confirmClear = window.confirm("Set Default Values for all fields?");
            
            if (confirmClear) {
                defaultCollectionFields();
                setNewCollectionFields();
            } 
        }
        
        
        
        
        
        function defaultCollectionFields() {
            // Clear all input fields, select fields, and textareas in the second set
            document.getElementById('page_collections_create_name').value = '';
            document.getElementById('page_collections_create_space').value = 'l2';  // Reset to default "L2"
            document.getElementById('page_collections_create_ef_construction').value = '100';
            document.getElementById('page_collections_create_ef_search').value = '10';
            document.getElementById('page_collections_create_num_of_threads').value = '8';
            document.getElementById('page_collections_create_m').value = '16';
            document.getElementById('page_collections_create_resize_factor').value = '1.2';
            
            var bugFixCheckbox = document.getElementById('page_settings_enable_bugix_batch_sizes_checkbox');
            if (bugFixCheckbox.checked == true){
                document.getElementById('page_collections_create_batch_size').value = document.getElementById('page_settings_bugfix_batch_sizes_selecttag').value;
            } else {
                document.getElementById('page_collections_create_batch_size').value = '100';
            }
            
            document.getElementById('page_collections_create_sync_threshold').value = '1000';

            setMetadataCollection();
            // Set the focus to the Collection Name field
            document.getElementById('page_collections_create_name').focus();

        }
        
        
        
        
        function setMetadataCollection() {
            var systemModelName = document.getElementById('page_settings_embed_model_input').value;
            var systemModelContextWindow = document.getElementById('page_settings_embed_context_window_input').value;
            var systemModelDimension = document.getElementById('page_settings_embed_dimension_input').value;
            
            /*
            var jsonData = `{
    "uuid": "b573e65b-3e23-45c6-9129-9b8639f689d3",
    "modified_date": "getDateTimeNow",
    "description": "description value",
    "embedding_model": "all-MiniLM-L6-v2",
    "embedding_model_context_window": 512,
    "language": "might be useful, use common shorthand version like en-GB, en-US etc.",
    "tags": "MUST, be, written, like, this, as, a, delimited, string, DOESN'T, accept, [tag,tag,tag]",
    "keywords": "MUST, be, written, as, a, delimited, string, DOESN'T, accept, nested, lists, like, [keyword,keyword,keyword]",
    "type": "something to describe a type or categorise it",
    "source": "something about the origin of the data it contains",
    "notes": "can be about anything, or even used as miscellaneous but related info",
    "version": "1.0",
    "hnsw:space": "l2",
    "hnsw:construction_ef": 100,
    "hnsw:search_ef": 10,
    "hnsw:num_threads": 4,
    "hnsw:M": 8,
    "hnsw:resize_factor": 1.2,
    "hnsw:batch_size": 100,
    "hnsw:sync_threshold": 1000
}`;
   */         
            var jsonData = `{
    "uuid": "b573e65b-3e23-45c6-9129-9b8639f689d3",
    "date_modified": "getDateTimeNow",
    "description": "description value",
    "embedding_model_parameters_in_millions": 23,
    "language": "might be useful, use common shorthand version like en-GB, en-US etc.",
    "tags": "MUST, be, written, like, this, as, a, delimited, string, DOESN'T, accept, [tag,tag,tag]",
    "keywords": "MUST, be, written, as, a, delimited, string, DOESN'T, accept, nested, lists, like, [keyword,keyword,keyword]",
    "type": "something to describe a type or categorise it",
    "source": "something about the origin of the data it contains",
    "category": "something to categorize",
    "sub_category": "something to sub-categorize",
    "group": "something to group by",
    "notes": "can be about anything, or even used as miscellaneous but related info",
    "version": "1.0"
}`;
            document.getElementById('page_collections_create_metadata').value = jsonData;
              
          }
        
        
        
        
        
        

        
        
        
        function confirmSetDefaultNewCollectionFieldsEmpty(){
            // Confirm if the user wants to clear the fields
            const confirmClear = window.confirm("Set Default Values for all fields?");
            
            if (confirmClear) {
                defaultCollectionFieldsEmpty();
                setNewCollectionFields();
            } 
        }
        
        
        function defaultCollectionFieldsEmpty() {
            // Clear all input fields, select fields, and textareas in the second set
            document.getElementById('page_collections_create_name').value = '';
            document.getElementById('page_collections_create_space').value = 'l2';  // Reset to default "L2"
            document.getElementById('page_collections_create_ef_construction').value = '100';
            document.getElementById('page_collections_create_ef_search').value = '10';
            document.getElementById('page_collections_create_num_of_threads').value = '8';
            document.getElementById('page_collections_create_m').value = '16';
            document.getElementById('page_collections_create_resize_factor').value = '1.2';
            
            var bugFixCheckbox = document.getElementById('page_settings_enable_bugix_batch_sizes_checkbox');
            if (bugFixCheckbox.checked == true){
                document.getElementById('page_collections_create_batch_size').value = document.getElementById('page_settings_bugfix_batch_sizes_selecttag').value;
            } else {
                document.getElementById('page_collections_create_batch_size').value = '100';
            }
            
            document.getElementById('page_collections_create_sync_threshold').value = '1000';

            setMetadataCollectionEmpty();
            // Set the focus to the Collection Name field
            document.getElementById('page_collections_create_name').focus();

        }
        
        
        
        
        function setMetadataCollectionEmpty() {
            var systemModelName = document.getElementById('page_settings_embed_model_input').value;
            var systemModelContextWindow = document.getElementById('page_settings_embed_context_window_input').value;
            var systemModelDimension = document.getElementById('page_settings_embed_dimension_input').value;
            
            /*
            var jsonData = `{
    "uuid": "",
    "modified_date": "",
    "description": "",
    "embedding_model": "all-MiniLM-L6-v2",
    "embedding_model_context_window": 512,
    "language": "en-GB",
    "tags": "",
    "keywords": "",
    "type": "",
    "source": "",
    "notes": "",
    "version": "",
    "hnsw:space": "l2",
    "hnsw:construction_ef": 100,
    "hnsw:search_ef": 10,
    "hnsw:num_threads": 4,
    "hnsw:M": 8,
    "hnsw:resize_factor": 1.2,
    "hnsw:batch_size": 100,
    "hnsw:sync_threshold": 1000
}`;
            */
            
            var jsonData = `{
    "uuid": "",
    "date_modified": "",
    "description": "",
    "embedding_model_parameters_in_millions": 23,
    "language": "en-GB",
    "tags": "",
    "keywords": "",
    "type": "",
    "source": "",
    "category": "",
    "sub_category": "",
    "group": "",
    "notes": "",
    "version": ""
}`;
            document.getElementById('page_collections_create_metadata').value = jsonData;
              
          }
        
        
        
        
        
        
        
        
        
        
        function confirmSetDefaultAddDocumentFields(){
            // Confirm if the user wants to clear the fields
            const confirmClear = window.confirm("Set Default Values for all fields?");

            if (confirmClear) {
                defaultAddDocumentFields();
            } 
        }

        
        
        function defaultAddDocumentFields() {
            // Clear all input fields, select fields, and textareas in the second set
            //document.getElementById('page_adddocs_document_id').value = '';
            generateUUID('page_adddocs_document_id');
            
            // Clear New Document Text
            //document.getElementById('page_adddocs_document_text').value = ''; 

            setMetadataAddDocument();
            
            // Set the focus to the Document Text Name field
            document.getElementById('page_adddocs_document_text').focus();
        }

        
        
        
        function setMetadataAddDocument() {
            var jsonData = `{
    "uuid": "b573e65b-3e23-45c6-9129-9b8639f689d3",
    "hash": "e06e32ab-06ca-4aba-b3b1-99c0c622f868",
    "code": "12345",
    "date_created": "getDateTimeNow",
    "date_modified": "getDateTimeNow",
    "file_name": "MyDocument.txt",
    "file_extension": ".txt",
    "title": "title value",
    "description": "description value",
    "sentiment": "sentiment description here",
    "topic": "topic value",
    "authors": "author1, author2, author3",
    "doc_length": "integer count of all characters helps performance as a per-calculation",
    "paragraph": 1,
    "page": 1,
    "page_total": 50,
    "chunk_total": 100,
    "chunk_num": 1,
    "token_count": "tokens needed to make up the document useful to know for LLM context sizes",
    "embedding_model": "all-MiniLM-L6-v2",
    "embedding_model_context_window": 512,
    "embedding_model_dimension": 384,
    "embedding_model_parameters_in_millions": 23,
    "language": "might be useful, use common shorthand version like en-GB, en-US etc.",
    "tags": "MUST, be, written, as, a, delimited, string, DOESN'T, accept, nested, lists, like, [tag,tag,tag]",
    "keywords": "MUST, be, written, as, a, delimited, string, DOESN'T, accept, nested, lists, like, [keyword,keyword,keyword]",
    "type": "something to describe a type or categorize it",
    "source": "something about the origin of the document",
    "category": "something to categorize",
    "sub_category": "something to sub-categorize",
    "group": "something to group by",
    "notes": "can be about anything, or even used as miscellaneous but related info",
    "version": "1.0",
    "uri": "file:///c:/temp/example/path"
}`;
            document.getElementById('page_adddocs_document_metadata').value = jsonData;
              
          }
        
        
        
        
        function confirmSetDefaultAddDocumentFieldsEmpty(){
            // Confirm if the user wants to clear the fields
            const confirmClear = window.confirm("Set Default Values for all fields, and with empty metadata?");

            if (confirmClear) {
                defaultAddDocumentFieldsEmpty();
            } 
        }

        
        
        function defaultAddDocumentFieldsEmpty() {
            // Clear all input fields, select fields, and textareas in the second set
            //document.getElementById('page_adddocs_document_id').value = '';
            generateUUID('page_adddocs_document_id');
            
            // Clear New Document Text
            //document.getElementById('page_adddocs_document_text').value = ''; 

            setMetadataAddDocumentEmtpy();
            
            // Set the focus to the Document Text Name field
            document.getElementById('page_adddocs_document_text').focus();
        }
        
        
        
        function setMetadataAddDocumentEmtpy() {
            var jsonData = `{
    "uuid": "",
    "hash": "",
    "code": "",
    "date_created": "",
    "date_modified": "",
    "file_name": "",
    "file_extension": ".txt",
    "title": "",
    "description": "",
    "sentiment": "",
    "topic": "",
    "authors": "",
    "doc_length": "",
    "paragraph": 1,
    "page": 1,
    "page_total": 1,
    "chunk_total": 1,
    "chunk_num": 1,
    "token_count": 1,
    "embedding_model": "all-MiniLM-L6-v2",
    "embedding_model_context_window": 512,
    "embedding_model_dimension": 384,
    "embedding_model_parameters_in_millions": 23,
    "language": "en-GB",
    "tags": "",
    "keywords": "",
    "type": "",
    "source": "",
    "category": "",
    "sub_category": "",
    "group": "",
    "notes": "",
    "version": "1.0",
    "uri": "file:///c:/temp"
}`;
            document.getElementById('page_adddocs_document_metadata').value = jsonData;
              
          }
        
        

        
        
        

        
        
        
        
        
        function confirmClearAddDocumentFields(){
            // Confirm if the user wants to clear the fields
            const confirmClear = window.confirm("Clear all fields?");

            if (confirmClear) {
                // Clear New Document Text
                document.getElementById('page_adddocs_document_id').value = ''; 
                document.getElementById('page_adddocs_document_text').value = ''; 
                document.getElementById('page_adddocs_document_metadata').value = ''; 
                // Set the focus to the Document Text Name field
                document.getElementById('page_adddocs_document_text').focus();
            } 
        }

        
      
        
        
    
        
        
        
        
        
        
        

        
        
        
        
        function confirmSetDefaultUpdateDocumentFields(){
            // Confirm if the user wants to clear the fields
            const confirmClear = window.confirm("Set Default Values for all fields?");

            if (confirmClear) {
                defaultUpdateDocumentFields();
            } 
        }

        
        
        function defaultUpdateDocumentFields() {
            // Clear all input fields, select fields, and textareas in the second set
            //document.getElementById('page_adddocs_document_id').value = '';
            //generateUUID('page_updatedocs_document_id');
            
            // Clear New Document Text
            //document.getElementById('page_updatedocs_document_id').value = ''; 
            //document.getElementById('page_updatedocs_document_text').value = ''; 

            setMetadataUpdateDocument();
            
            // Set the focus to the Document Text Name field
            document.getElementById('page_updatedocs_document_id').focus();
        }

        
        
        
        function setMetadataUpdateDocument() {
            var jsonData = `{
    "uuid": "b573e65b-3e23-45c6-9129-9b8639f689d3",
    "hash": "e06e32ab-06ca-4aba-b3b1-99c0c622f868",
    "code": "12345",
    "date_modified": "getDateTimeNow",
    "file_name": "MyDocument.txt",
    "file_extension": ".txt",
    "title": "title value",
    "description": "description value",
    "sentiment": "sentiment description here",
    "topic": "topic value",
    "authors": "author1, author2, author3",
    "doc_length": "integer count of all characters helps performance as a per-calculation",
    "paragraph": 1,
    "page": 1,
    "page_total": 1,
    "chunk_total": 100,
    "chunk_num": 1,
    "token_count": "tokens needed to make up the document useful to know for LLM context sizes",
    "embedding_model": "all-MiniLM-L6-v2",
    "embedding_model_context_window": 512,
    "embedding_model_dimension": 384,
    "embedding_model_parameters_in_millions": 23,
    "language": "might be useful, use common shorthand version like en-GB, en-US etc.",
    "tags": "MUST, be, written, as, a, delimited, string, DOESN'T, accept, nested, lists, like, [tag,tag,tag]",
    "keywords": "MUST, be, written, as, a, delimited, string, DOESN'T, accept, nested, lists, like, [keyword,keyword,keyword]",
    "type": "something to describe a type or categorize it",
    "source": "something about the origin of the document",
    "category": "something to categorize",
    "sub_category": "something to sub-categorize",
    "group": "something to group by",
    "notes": "can be about anything, or even used as miscellaneous but related info",
    "version": "1.0",
    "uri": "file:///c:/temp/example/path"
}`;
            document.getElementById('page_updatedocs_document_metadata').value = jsonData;
              
          }
        
        
        
        
        function confirmSetDefaultUpdateDocumentFieldsEmpty(){
            // Confirm if the user wants to clear the fields
            const confirmClear = window.confirm("Set Default Values for all fields, and with empty metadata?");

            if (confirmClear) {
                defaultUpdateDocumentFieldsEmpty();
            } 
        }

        
        
        function defaultUpdateDocumentFieldsEmpty() {
            // Clear all input fields, select fields, and textareas in the second set
            //document.getElementById('page_adddocs_document_id').value = '';
            //generateUUID('page_updatedocs_document_id');
            
            // Clear New Document Text
            //document.getElementById('page_updatedocs_document_id').value = ''; 
            //document.getElementById('page_updatedocs_document_text').value = ''; 

            setMetadataUpdateDocumentEmtpy();
            
            // Set the focus to the Document Text Name field
            document.getElementById('page_updatedocs_document_id').focus();
        }
        
        
        
        function setMetadataUpdateDocumentEmtpy() {
            var jsonData = `{
    "uuid": "",
    "hash": "",
    "code": "",
    "date_modified": "",
    "file_name": "",
    "file_extension": ".txt",
    "title": "",
    "description": "",
    "sentiment": "",
    "topic": "",
    "authors": "",
    "doc_length": "",
    "paragraph": 1,
    "page": 1,
    "page_total": 1,
    "chunk_total": 1,
    "chunk_num": 1,
    "token_count": 1,
    "embedding_model": "all-MiniLM-L6-v2",
    "embedding_model_context_window": 512,
    "embedding_model_dimension": 384,
    "embedding_model_parameters_in_millions": 23,
    "language": "en-GB",
    "tags": "",
    "keywords": "",
    "type": "",
    "source": "",
    "category": "",
    "sub_category": "",
    "group": "",
    "notes": "",
    "version": "1.0",
    "uri": "file:///c:/temp"
}`;
            document.getElementById('page_updatedocs_document_metadata').value = jsonData;
              
          }
        
        
        
        
        
        function confirmClearUpdateDocumentFields(){
            // Confirm if the user wants to clear the fields
            const confirmClear = window.confirm("Clear all fields?");

            if (confirmClear) {
                // Clear New Document Text
                document.getElementById('page_updatedocs_document_id').value = ''; 
                document.getElementById('page_updatedocs_document_text').value = ''; 
                document.getElementById('page_updatedocs_document_metadata').value = ''; 
                // Set the focus to the Document Text Name field
                document.getElementById('page_updatedocs_document_id').focus();
            } 
        }

        
        
        
        
    
        
        
        
        
        async function createCollectionFlask() {
            showLoading(true);

            // Gather values from the HTML form
            const name = document.getElementById('page_collections_create_name').value;
            const space = document.getElementById('page_collections_create_space').value;
            const efConstruction = document.getElementById('page_collections_create_ef_construction').value;
            const efSearch = document.getElementById('page_collections_create_ef_search').value;
            const numThreads = document.getElementById('page_collections_create_num_of_threads').value;
            const m = document.getElementById('page_collections_create_m').value;
            const resizeFactor = document.getElementById('page_collections_create_resize_factor').value;
            const batchSize = document.getElementById('page_collections_create_batch_size').value;
            const syncThreshold = document.getElementById('page_collections_create_sync_threshold').value;
            const metadataCheckbox = document.getElementById('page_collections_checkbox_include_metadata');
            const metadataInput = document.getElementById('page_collections_create_metadata').value;

            // Validate fields
            if (!name) {
                showNotification({
                    message: "Collection name is required.",
                    backgroundColor: "#e74c3c",  // Red color for error
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
                showLoading(false);
                return;
            }

            // Validate positive integers for specific fields
            const positiveIntegerFields = [
                { value: efConstruction, name: 'EF Construction' },
                { value: efSearch, name: 'EF Search' },
                { value: numThreads, name: 'Number of Threads' },
                { value: m, name: 'M' },
                { value: batchSize, name: 'Batch Size' },
                { value: syncThreshold, name: 'Sync Threshold' }
            ];

            for (const field of positiveIntegerFields) {
                if (!Number.isInteger(parseInt(field.value)) || parseInt(field.value) <= 0) {
                    showNotification({
                        message: `${field.name} must be a positive integer.`,
                        backgroundColor: "#e74c3c",
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    showLoading(false);
                    return;
                }
            }

            // Validate resize factor as a positive float
            if (isNaN(resizeFactor) || parseFloat(resizeFactor) <= 0) {
                showNotification({
                    message: "Resize Factor must be a positive floating point number.",
                    backgroundColor: "#e74c3c",
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
                showLoading(false);
                return;
            }

            // Prepare the "hnsw" parameters from the form values
            const hnswDefaults = {
                "hnsw:space": "l2",
                "hnsw:construction_ef": 100,
                "hnsw:search_ef": 10,
                "hnsw:num_threads": 4,
                "hnsw:M": 8,
                "hnsw:resize_factor": 1.2,
                "hnsw:batch_size": 100,
                "hnsw:sync_threshold": 1000
            };

            // Override hnsw keys with the form values
            const hnswValues = {
                "hnsw:space": space,
                "hnsw:construction_ef": parseInt(efConstruction),
                "hnsw:search_ef": parseInt(efSearch),
                "hnsw:num_threads": parseInt(numThreads),
                "hnsw:M": parseInt(m),
                "hnsw:resize_factor": parseFloat(resizeFactor),
                "hnsw:batch_size": parseInt(batchSize),
                "hnsw:sync_threshold": parseInt(syncThreshold)
            };

            // Check if metadata is provided
            let metadata = {};
            if (metadataCheckbox.checked) {
                try {
                    if (metadataInput) {
                        metadata = JSON.parse(metadataInput);
                    }
                } catch (error) {
                    showNotification({
                        message: "Metadata is not valid JSON.",
                        backgroundColor: "#e74c3c",
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    showLoading(false);
                    return;
                }
            }

            // Additional Metadata Fields

            // 1. UUID (Unique Identifier)
            const uuid = crypto.randomUUID();

            // 2. Modified Date (Current Date-Time in ISO format)
            const modifiedDate = new Date().toISOString();

            // 3. Embedding Model & Context Window, dimension
            const embeddingModel = document.getElementById('page_settings_embed_model_input').value;
            const embeddingModelContextWindow = document.getElementById('page_settings_embed_context_window_input').value;
            const embeddingModelDimension = document.getElementById('page_settings_embed_dimension_input').value;

            // 4. Language (from settings page)
            const language = document.getElementById('page_settings_app_language_input').innerText.trim().toLowerCase();

            if (metadataCheckbox.checked) {
                // Add these fields to metadata if checked
                metadata = {
                    ...metadata,
                    "uuid": uuid,
                    "date_modified": modifiedDate,
                    "embedding_model": embeddingModel,
                    "embedding_model_context_window": embeddingModelContextWindow,
                    "embedding_model_dimension": embeddingModelDimension,
                    "language": language,
                    ...hnswValues  // Include the HNSW values
                };
            } else {
                // If not checked, still enforce the HNSW values and embedding model details
                metadata = {
                    ...metadata,
                    "embedding_model": embeddingModel,
                    "embedding_model_context_window": embeddingModelContextWindow,
                    "embedding_model_dimension": embeddingModelDimension,
                    ...hnswValues  // Include the HNSW values
                };
            }


            // Prepare the data object for the collection
            const collectionData = {
                collection_name: name,
                space: space,
                ef_construction: parseInt(efConstruction),
                ef_search: parseInt(efSearch),
                num_of_threads: parseInt(numThreads),
                m: parseInt(m),
                resize_factor: parseFloat(resizeFactor),
                batch_size: parseInt(batchSize),
                sync_threshold: parseInt(syncThreshold),
                metadata: metadata
            };

            // Call the Flask endpoint using the fetchData function
            try {
                const response = await fetchData('/api/create-new-collection', 'POST', collectionData);

                // Check if the response contains a success message or a success indicator
                if (response && response.message && response.message.includes("successfully")) {
                    loadCollections();
                    setTimeout(function() {
                        updateCollectionDocumentCount();
                        forceCollectionSelection(name);
                        handleCollectionChange('page_collections_collection_dropdown');
                        window.scrollTo({
                            top: 0,
                            behavior: 'smooth' // Optional: adds smooth scrolling
                        });
                        updateVariousLabels();
                        
                        // If the message indicates success
                        showNotification({
                            message: response.message,  // Use the message from the response
                            backgroundColor: "#2ecc71",  // Green color for success
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });
                    }, 500);
                } else {
                    if (response && response.message && response.message.includes("already exists")) {
                        // Show an error notification with a custom message
                        showNotification({
                            message: "Collection Already Exists - pick a unique name " + JSON.stringify(response, null, 2),
                            backgroundColor: "#e74c3c",  // Red color for error
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });
                    } else {
                        // Show an error notification with a custom message
                        showNotification({
                            message: "001 Failed to create collection." + JSON.stringify(response, null, 2),
                            backgroundColor: "#e74c3c",  // Red color for error
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });
                    }
                }
            } catch (error) {
                console.error("Error creating collection:", error);
                // Show an error notification if an exception is thrown
                showNotification({
                    message: "Error creating the collection. " + JSON.stringify(response, null, 2),
                    backgroundColor: "#e74c3c",  // Red color for error
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
            }

            setTimeout(function() {
                showLoading(false);
            }, 1600);
        }

        


        
        
        
        function setNewCollectionFields() {
            // Come up with an auto-generated collection name, using collection count as an index
            var tempselect = document.getElementById('page_collections_collection_dropdown');
            var collectionCount = tempselect.options.length;

            // Increment the collection count
            collectionCount += 1;

            // Get the configurable auto-gen name from settings
            var autoGenPrefix = document.getElementById('page_settings_autogen_colname_input').value;
            var autoGenName = autoGenPrefix + collectionCount;

            // Check if the auto-gen name already exists in the collection
            var valueExists = false;

            // Loop through each option in the select element
            for (var i = 0; i < tempselect.options.length; i++) {
                // Compare against the innerText (or textContent) of each option
                if (tempselect.options[i].innerText === autoGenName) {
                    valueExists = true;
                    break; // No need to continue once we've found a match
                }
            }

            if (valueExists) {
                console.log("The value already exists as an option.");
                autoGenName = autoGenName + collectionCount;  // Modify if needed
            }

            // Set the new auto-generated name in the form fields
            document.getElementById('page_collections_create_name').value = autoGenName;
            document.getElementById('page_collections_clone_collection_new_name_input').value = autoGenName;

            // Show notification (as per your original code)
            showNotification({
                message: "Auto Generated New Collection Name",
                backgroundColor: "#3498db", // Blue for success
                opacity: 90,
                duration: 2000,
                stackFromTop: false
            });
        }

        

        
        async function deleteCollectionFlask() {

            // Ask for confirmation before proceeding
            const confirmDelete = window.confirm("Are you sure you want to delete collection?\n" + selectedCollectionName);

            // If the user cancels, stop the function execution
            if (!confirmDelete) {
                return;
            }
            
            // Get the collection name from the dropdown
            var collectionName = "";

            var tempselect = document.getElementById('page_collections_collection_dropdown');
            // Check if a valid selection exists
            if (tempselect.selectedIndex >= 0) {
                collectionName = tempselect.options[tempselect.selectedIndex].text;
            }
            
            // Get the count of options - if its only 1, then deleting this is pointless to load collections and avoid misleading error notifications
            var optionCount = tempselect.options.length;

            const selectedCollection = collectionName;

            if (!selectedCollection) {
                console.error('No collection selected');

                // Show error notification if no collection is selected
                showNotification({
                  message: "No collection selected!",
                  backgroundColor: "#e74c3c",  // Red background for error
                  opacity: 90,
                  duration: 4000,
                  stackFromTop: false
                });
                return;
            }

            // Prepare the request body
            const requestBody = {
                collection_name: selectedCollection
            };

            // Call the fetchData function to make the API call
            const response = await fetchData('/api/delete-collection-v2', 'POST', requestBody);

            // Handle the response from the Flask API
            if (response && response.message) {
                console.log(response.message);  // Log success message

                if (optionCount <= 1){
                    setTimeout(function() {
                        window.scrollTo({
                            top: 0,
                            behavior: 'smooth' // Optional: adds smooth scrolling
                        });

                         // Show success notification
                        showNotification({
                          message: response.message,
                          backgroundColor: "#3498db",  // Green background for success
                          opacity: 90,
                          duration: 4000,
                          stackFromTop: false
                        });
                        
                        updateVariousLabels();
                        emptyAllCollectionDropDowns();
                    }, 500); 
                    
                } else {
                    loadCollections();
                    setTimeout(function() {
                        //forceCollectionSelection(name);
                        handleCollectionChange('page_collections_collection_dropdown')
                        window.scrollTo({
                            top: 0,
                            behavior: 'smooth' // Optional: adds smooth scrolling
                        });

                         // Show success notification
                        showNotification({
                          message: response.message,
                          backgroundColor: "#3498db",  // Green background for success
                          opacity: 90,
                          duration: 4000,
                          stackFromTop: false
                        });

                        updateVariousLabels();
                    }, 500); 
                }
   
            } else if (response && response.error) {
                console.error(response.error);  // Log error message

                // Show error notification
                showNotification({
                  message: response.error,
                  backgroundColor: "#e74c3c",  // Red background for error
                  opacity: 90,
                  duration: 4000,
                  stackFromTop: false
                });
            }
        }


        
        
        
        
        
        



        async function deleteAllCollectionsFlask() {
            
            // Ask for confirmation before proceeding
            const confirmDelete = window.confirm("Delete ALL Collections?\nAre you sure?\n\nThis CANNOT be undone!");

            // If the user cancels, stop the function execution
            if (!confirmDelete) {
                return;
            }
            
            try {
                // Call the /api/delete-all-collections-v2 endpoint using the fetchData function
                const data = await fetchData('/api/delete-all-collections-v2', 'POST');

                // Check the result and log the information
                if (data.deleted_collections && data.deleted_collections.length > 0) {
                    console.log('Deleted collections:', data.deleted_collections);

                    // Success notification
                    showNotification({
                        message: `ALL Collections Deleted! Count: ${data.deleted_collections.length}!`,
                        backgroundColor: "#3498db",
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    /*
                    loadCollections();
                    setTimeout(function() {
                        //forceCollectionSelection(name);
                        handleCollectionChange('page_collections_collection_dropdown')
                        window.scrollTo({
                            top: 0,
                            behavior: 'smooth' // Optional: adds smooth scrolling
                        });
                        console.log("done deleting all collections");
                        updateVariousLabels();
                        resetCollectionLabels();
                        document.getElementById('toolstrip_WarningNotification').style.display = "none";
                    }, 500);
                    */
                    
                    emptyAllCollectionDropDowns();
                    
                } else {
                    console.log('No collections were deleted.');

                    // No collections deleted notification
                    showNotification({
                        message: "No collections were deleted.",
                        backgroundColor: "#f39c12",  // You can adjust the color for "No action taken"
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                }

                if (data.failed_collections && data.failed_collections.length > 0) {
                    console.log('Failed to delete collections:', data.failed_collections);

                    // Failure notification
                    showNotification({
                        message: `Failed to delete ${data.failed_collections.length} collection(s).`,
                        backgroundColor: "#e74c3c",
                        opacity: 90,
                        duration: 8000,
                        stackFromTop: false
                    });
                }

            } catch (error) {
                // Handle any errors (e.g., network or server issues)
                console.error('Error:', error);

                // Error notification
                showNotification({
                    message: "An error occurred while trying to delete collections.",
                    backgroundColor: "#e74c3c",
                    opacity: 90,
                    duration: 8000,
                    stackFromTop: false
                });
            }
        }

        

        
        

        
        
         async function addDocument() {
            // Select the <select> element
            var selectElement = document.getElementById("page_adddocs_collection_dropdown");

            // Check if the <select> element is empty
            if (selectElement && selectElement.options.length === 0) {
                console.log("No Collection Selected to add Document to - Create Collection first");
                
                showNotification({
                    message: "No Collection Selected - Create/Select a Collection first",
                    backgroundColor: "#e74c3c", // Red background for error
                    opacity: 90,
                    duration: 8000,
                    stackFromTop: false
                });
                
                return;
            } 
             
            var metadataCheckbox = document.getElementById('page_adddocs_checkbox_include_metadata');

            // Get the collection name from the dropdown
            var collectionName = "";

            var tempselect = document.getElementById('page_adddocs_collection_dropdown');
            // Check if a valid selection exists
            if (tempselect.selectedIndex >= 0) {
                collectionName = tempselect.options[tempselect.selectedIndex].text;
            }

            // Get the document ID from the input field
            const docId = document.getElementById('page_adddocs_document_id').value;

            // Get the document content from the textarea
            const docContent = document.getElementById('page_adddocs_document_text').value;

            let metadata = {};

            // Get the metadata from the textarea and parse it as a JSON object
            if (metadataCheckbox.checked) {
                console.log(metadataCheckbox.checked); // Debug: Check if checkbox is checked
                try {
                    metadata = JSON.parse(document.getElementById('page_adddocs_document_metadata').value);
                } catch (e) {
                    // Show notification for JSON parsing error
                    showNotification({
                        message: "Error parsing metadata JSON: " + e.message,
                        backgroundColor: "#e74c3c", // Red background for error
                        opacity: 90,
                        duration: 8000,
                        stackFromTop: false
                    });
                    return;
                } 
            }

            // Check if the required fields are provided
            if (!collectionName || !docId || !docContent) {
                // Show notification for missing required fields
                showNotification({
                    message: "Please fill in all required fields.",
                    backgroundColor: "#e74c3c", // Red background for error
                    opacity: 90,
                    duration: 8000,
                    stackFromTop: false
                });
                return;
            }

            // 3. Embedding Model & Context Window
            const embeddingModel = document.getElementById('page_settings_embed_model_input').value;
            const embeddingModelContextWindow = document.getElementById('page_settings_embed_context_window_input').value;
            const embeddingModelDimension = document.getElementById('page_settings_embed_dimension_input').value;
             
            if (metadataCheckbox.checked) {
                // Additional Metadata Fields
                // 1. UUID (Unique Identifier)
                //const uuid = crypto.randomUUID();
                const docHash = await generateHashFromString(docContent);

                // 2. Modified Date (Current Date-Time in ISO format)
                const createdDate = new Date().toISOString();
                const modifiedDate = new Date().toISOString();

                var language = ""
                      
                // firstly, need to check if passed metadata contains a language key, if not we'll use one from settings, if so but its empty we'll also use from settings, but if it has value, retain it. 
                if (metadata != null && "language" in metadata) {
                    const passedMetaLanguageKey = metadata.language;
                    //console.log("troubleshooting 3 \n\n language key present\n\n value: \n" + passedMetaLanguageKey);
                    //alert("troubleshooting 3 \n\n language key present\n\n value: \n" + passedMetaLanguageKey);
                    
                    if (passedMetaLanguageKey == "") {
                        language = document.getElementById('page_settings_app_language_input').value.trim().toLowerCase();
                    } else {
                        language = passedMetaLanguageKey;
                    }
                    
                } else {
                    console.log("troubleshooting 4 \n\n no language key present");
                    //alert("troubleshooting 4 \n\n no language key present");
                }
                

                if (language == ""){
                    // Add these fields to metadata if checked
                    metadata = {
                        ...metadata,
                        "hash": docHash,
                        "date_created": createdDate,
                        "date_modified": modifiedDate
                    };
                } else {
                    // Add these fields to metadata if checked
                    metadata = {
                        ...metadata,
                        "hash": docHash,
                        "date_created": createdDate,
                        "date_modified": modifiedDate,
                        "language": language
                    };
                }
                    

            } 
             
            // Add these fields to metadata if checked
            metadata = {
                ...metadata,
                "embedding_model": embeddingModel,
                "embedding_model_context_window": embeddingModelContextWindow,
                "embedding_model_dimension": embeddingModelDimension
            };
             
            //alert("troubleshooting 2 metadata before send\n\n" + JSON.stringify(metadata, null, 2));

            // Prepare the body to be sent in the POST request
            const body = {
                collection_name: collectionName,
                id: docId,
                document: docContent,
                metadata: metadata
            };

            // Debug: Check the body before sending
            //console.log(body);

            // Call the fetchData function to send the data to the server
            const endpoint = '/api/add-document';
            const response = await fetchData(endpoint, 'POST', body);

            if (response) {
                // Check if the response code is 543 (Document ID already exists)
                if (response.error && response.error.includes('543')) {
                    showNotification({
                        message: "Document ID already exists",
                        backgroundColor: "#e74c3c", // Red background for error
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                } else if (response.error) {
                    // If there is another error, show it
                    showNotification({
                        message: "Error: " + response.error,
                        backgroundColor: "#e74c3c", // Red background for error
                        opacity: 90,
                        duration: 8000,
                        stackFromTop: false
                    });
                } else {
                    // Handle success case
                    showNotification({
                        message: "Document added successfully",
                        backgroundColor: "#2ecc71", // Green background for success
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });

                    document.getElementById('page_adddocs_autogen_uuid_button').click();
                    setTimeout(function() {
                        window.scrollTo({
                            top: 0,
                            behavior: 'smooth' // Optional: adds smooth scrolling
                        });
                        updateVariousLabels();
                        updateCollectionDocumentCount();
                    }, 500);
                }
            }
        }




        
        
        
        function loadDocuments(){
            showLoading(true);
            
            loadCollections();
            
            setTimeout(function() {
                showLoading(true);
                
                showNotification({
                    message: "Loading Documents... Please Wait...",
                    backgroundColor: "#3498db", // Green background for success
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
                
                getAllDocuments();
                updateVariousLabels();
            }, 600); // 1000ms delay
        }
        
        
        
        
        
        
        
        async function getAllDocuments() {

            showLoading(true);

            // Get the collection name from the dropdown
            var collectionName = "";

            var tempselect = document.getElementById('page_collections_collection_dropdown');
            // Check if a valid selection exists
            if (tempselect.selectedIndex >= 0) {
                collectionName = tempselect.options[tempselect.selectedIndex].text;
            }

            if (collectionName == "") {
                // Show notification for missing collection name
                showNotification({
                    message: "No Collections in Database - Create one",
                    backgroundColor: "#e74c3c", // Red background color for error
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
                console.error('No Collections in Database - Create one');
                setTimeout(function() {
                    showLoading(false);
                }, 1600);
                return;
            }

            // Get the selected value from the 'page_documents_results_to_return_selecttag' dropdown
            var resultLimit = 100; // Default to 10 if no valid selection
            var selectLimit = document.getElementById('page_documents_results_to_return_selecttag');
            if (selectLimit.selectedIndex >= 0) {
                resultLimit = parseInt(selectLimit.options[selectLimit.selectedIndex].value);
            }

            const response = await fetch('/api/get-all-documents', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ collection_name: collectionName })
            });

            const data = await response.json();

            showLoading(true);

            if (data.error) {
                alert(`Error: ${data.error}`);
                return;
            }

            const tableBody = document.getElementById('page_documents_table').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';  // Clear any existing rows

            if (data.documents && data.documents.length > 0) {
                // Limit the number of documents based on the selected value from the dropdown
                const documentsToDisplay = data.documents.slice(0, resultLimit);

                documentsToDisplay.forEach((doc, index) => {
                    const row = tableBody.insertRow();

                    // Row count column (cell 0)
                    const cell0 = row.insertCell(0);
                    cell0.textContent = index + 1;  // Displaying row number (index starts at 0, so +1 for user-friendly numbering)

                    // ID column (cell 1)
                    const cell1 = row.insertCell(1);
                    cell1.textContent = doc.id;

                    // Document column (cell 2)
                    const cell2 = row.insertCell(2);
                    const documentContainer = document.createElement('div');
                    documentContainer.classList.add('document-container');
                    documentContainer.textContent = doc.document;
                    cell2.appendChild(documentContainer);

                    // Metadata column (cell 3)
                    const cell3 = row.insertCell(3);
                    const metadataContainer = document.createElement('div');
                    metadataContainer.classList.add('metadata-container');
                    metadataContainer.textContent = JSON.stringify(doc.metadata, null, 2);
                    cell3.appendChild(metadataContainer);

                    // Embedding column (cell 4)
                    const cell4 = row.insertCell(4);
                    const embeddingContainer = document.createElement('div');
                    embeddingContainer.classList.add('embedding-container');
                    embeddingContainer.textContent = JSON.stringify(doc.embedding);
                    cell4.appendChild(embeddingContainer);

                    // Actions column (cell 5)
                    const cell5 = row.insertCell(5);
                    const actionContainer = document.createElement('div');
                    actionContainer.classList.add('action-buttons');

                    // Edit button (if needed)
                    const editButton = document.createElement('button');
                    editButton.textContent = 'Edit';
                    editButton.classList.add('colourGreen');
                    editButton.onclick = () => feedUpdateDocumentPage(doc.id, doc.document, JSON.stringify(doc.metadata));
                    actionContainer.appendChild(editButton);

                    // Delete button
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Delete';
                    deleteButton.classList.add('colourRed');
                    deleteButton.onclick = (event) => confirmDeleteSingleDocument(doc.id, event.target.closest('tr'));
                    actionContainer.appendChild(deleteButton);

                    // Append the action container to the actions cell
                    cell5.appendChild(actionContainer);
                });

                // Update row count display after data is populated
                updateRowCountViewDocuments();

                setTimeout(function() {
                    showLoading(false);
                }, 1600);
            } else {
                const row = tableBody.insertRow();
                const cell = row.insertCell(0);
                cell.colSpan = 6;
                cell.textContent = "No documents found.";
                showLoading(false);
            }
        }



        
        
        

        
        

        
    
        // Helper function to confirm deletion of a single document
        async function confirmDeleteSingleDocument(docId, rowElement) {
            // Ask the user to confirm the deletion
            const confirmDelete = confirm(`Are you sure you want to delete the document with ID:\n${docId}?`);

            // If the user confirms, call deleteDocument function
            if (confirmDelete) {
                await deleteDocument(docId, rowElement);
            }
        }
        
        

        // Helper function to confirm deletion of all documents
        async function confirmDeleteAllDocuments() {
            // Ask the user to confirm the deletion of all documents
            const confirmDeleteAll = confirm("Are you sure you want to delete ALL documents\nin the ENTIRE Collection?\nThis action CANNOT be undone.");

            // If the user confirms, call deleteAllDocuments function
            if (confirmDeleteAll) {
                await deleteAllDocumentsAtOnce();
            }
        }

        
        

        // Helper function to confirm deletion of all documents
        async function confirmDeleteShownDocuments() {
            // Ask the user to confirm the deletion of all documents
            const confirmDeleteAll = confirm("Are you sure you want to delete all documents\nshown in the table currently?\n\nThis action cannot be undone.");

            // If the user confirms, call deleteAllDocuments function
            if (confirmDeleteAll) {
                await deleteAllDocuments();
            }
        }

        
        
        
        // Modified deleteDocument function (unchanged)
        async function deleteDocument(docId, rowElement) {
            showLoading(true);
            
            // Get the collection name from the dropdown
            var collectionName = "";

            var tempselect = document.getElementById('page_documents_collection_dropdown');
            // Check if a valid selection exists
            if (tempselect.selectedIndex >= 0) {
                collectionName = tempselect.options[tempselect.selectedIndex].text;
            }

            // Ensure that collection name and document ID are available
            if (!collectionName || !docId) {
                alert("Please select a collection and provide a document ID.");
                return;
            }

            // Prepare the body to send in the POST request
            const body = {
                id: docId,
                collection_name: collectionName // Add the collection name to the request
            };

            try {

                // Send the delete request to the backend
                const response = await fetch('/api/delete-document', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });

                const data = await response.json();

                if (response.ok) {
                    // If the document was successfully deleted, remove the row from the table
                    rowElement.remove();

                    // Show success notification
                    showNotification({
                        message: `Document with ID: ${docId} has been deleted.`,
                        backgroundColor: "#3498db",
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    
                    loadDocuments();
                    updateVariousLabels();
                    updateRowCountViewDocuments();
                    
                } else {
                    alert(`Error deleting document: ${data.error}`);
                }
            } catch (error) {
                console.error("Error during document deletion:", error);
                alert("There was an error deleting the document.");
            }
        }
        
        
        

        
        
        
        // Original Delete all - runs the delete individual function in a loop 
        async function deleteAllDocuments() {
            showLoading(true);

            // Get all table rows (excluding the header row)
            const rows = document.querySelectorAll('#page_documents_table tbody tr'); 

            if (rows.length === 0) {
                alert("There are no documents to delete.");
                return;
            }

            // Loop through each row and delete only if it is visible
            for (let i = 0; i < rows.length; i++) {
                const rowElement = rows[i]; // Get the row element

                // Check if the row is visible after filtering
                if (rowElement.style.display !== 'none') {
                    const docId = rowElement.querySelector('td:nth-child(2)').innerText; // Get the document ID from the second column

                    // Call the delete function for each document
                    await deleteDocument(docId, rowElement);

                    // Add a delay between deletions for smooth UI experience
                    await new Promise(resolve => setTimeout(resolve, 500));  // Wait for 500ms between each delete
                }
            }

            showLoading(false);
        }


        
        
        
        // New function to delete all documents from a collection and recreate it
        async function deleteAllDocumentsAtOnce() {
            showLoading(true);  // Show loading indicator

            // Get the collection name from the dropdown
            var collectionName = "";
            var tempselect = document.getElementById('page_collections_collection_dropdown');
            if (tempselect.selectedIndex >= 0) {
                collectionName = tempselect.options[tempselect.selectedIndex].text;
            }

            // Ensure collection name is selected
            if (!collectionName) {
                showNotification({
                    message: "Please select a collection name.",
                    backgroundColor: "#e74c3c", // Red for failure
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
                showLoading(false);  // Hide loading indicator
                return;
            }

            try {
                // Call the Flask API to delete the documents
                const result = await fetchData('/api/delete-all-documents', 'POST', { collection_name: collectionName });

                // Handle the response
                if (result && result.message) {
                    // Assuming message is returned when deletion and recreation is successful
                    showNotification({
                        message: `Documents deleted and collection recreated for '${collectionName}' successfully.`,
                        backgroundColor: "#2ecc71", // Green for success
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    
                    
                    loadDocuments();
                    setTimeout(function() {
                        updateCollectionDocumentCount();
                        forceCollectionSelection(name);
                        handleCollectionChange('page_collections_collection_dropdown');
                        window.scrollTo({
                            top: 0,
                            behavior: 'smooth' // Optional: adds smooth scrolling
                        });

                        updateVariousLabels();
                    }, 500);
                    
                }
            } catch (error) {
                // Handle error responses
                showNotification({
                    message: `Error: ${error.message}`,
                    backgroundColor: "#e74c3c", // Red for failure
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
            } finally {
                showLoading(false);  // Hide loading indicator
            }
        }
        
        
        
        
        
        
        

        function addFilterDocument() {
            documentFilterCount++;  // Increment the group count to track which group we're adding

            const container = document.getElementById('groups-container');

            // Create the new group div
            const groupDiv = document.createElement('div');
            groupDiv.classList.add('group');

            // Create the "contains" / "notcontains" select
            const selectContains = document.createElement('select');
            const optionContains = document.createElement('option');
            optionContains.value = 'contains';
            optionContains.text = 'contains';
            const optionNotContains = document.createElement('option');
            optionNotContains.value = 'notcontains';
            optionNotContains.text = 'notcontains';
            selectContains.appendChild(optionContains);
            selectContains.appendChild(optionNotContains);

            // Create the input text box
            const inputText = document.createElement('input');
            inputText.type = 'text';
            inputText.placeholder = 'Enter value';

            // If it's the first group, only append "contains/notcontains" and the input
            if (documentFilterCount === 1) {
                groupDiv.appendChild(selectContains);  // "contains/notcontains" select
                groupDiv.appendChild(inputText);  // Input box
            } else {
                // If it's not the first group, add the "and/or" select first
                const selectAndOr = document.createElement('select');
                const optionAnd = document.createElement('option');
                optionAnd.value = 'and';
                optionAnd.text = 'and';
                const optionOr = document.createElement('option');
                optionOr.value = 'or';
                optionOr.text = 'or';
                selectAndOr.appendChild(optionAnd);
                selectAndOr.appendChild(optionOr);

                groupDiv.appendChild(selectAndOr);  // "and/or" select
                groupDiv.appendChild(selectContains);  // "contains/notcontains" select
                groupDiv.appendChild(inputText);  // Input box
            }

            // Append the group div to the container
            container.appendChild(groupDiv);
        }

        
        
        // Function to remove the last group (in reverse order)
        function removeFilterDocument() {
            const container = document.getElementById('groups-container');

            // Check if there are any groups to remove
            if (documentFilterCount > 0) {
                const lastGroup = container.lastElementChild;  // Get the last group
                container.removeChild(lastGroup);  // Remove the last group
                documentFilterCount--;  // Decrease the group count
            }
        }


         function clearAllFiltersDocument() {
            // Show a confirmation dialog
            const isConfirmed = confirm("Are you sure you want to clear all document filters?");

            // If the user clicks "OK", clear all groups
            if (isConfirmed) {
                const container = document.getElementById('groups-container');

                // Remove all children (groups) from the container
                container.innerHTML = '';

                // Reset the group count to zero
                documentFilterCount = 0;
            }
        }
        
        

        
        
        function addFilterMetadata() {
            metadataFilterCount++;  // Increment the group count to track which group we're adding

            const container = document.getElementById('metadata-groups-container');

            // Create the new group div
            const groupDiv = document.createElement('div');
            groupDiv.classList.add('group');

            // Create the first text input
            const inputText1 = document.createElement('input');
            inputText1.type = 'text';
            inputText1.placeholder = 'Enter value';

            // Create the select element for comparison operators (equal, not equal, etc.)
            const selectComparison = document.createElement('select');
            const options = [
                "equal", "not equal", "greater", "lesser", 
                "greater or equal", "lesser or equal", "in", "not in"
            ];
            options.forEach(optionText => {
                const option = document.createElement('option');
                option.value = optionText;
                option.text = optionText;
                selectComparison.appendChild(option);
            });

            // Create the second text input
            const inputText2 = document.createElement('input');
            inputText2.type = 'text';
            inputText2.placeholder = 'Enter value';

            // If it's the first group, add only the two text inputs and the comparison select
            if (metadataFilterCount === 1) {
                groupDiv.appendChild(inputText1);  // First text input
                groupDiv.appendChild(selectComparison);  // Comparison select
                groupDiv.appendChild(inputText2);  // Second text input
            } else {
                // If it's not the first group, add "and/or" select first
                const selectAndOr = document.createElement('select');
                const optionAnd = document.createElement('option');
                optionAnd.value = 'and';
                optionAnd.text = 'and';
                const optionOr = document.createElement('option');
                optionOr.value = 'or';
                optionOr.text = 'or';
                selectAndOr.appendChild(optionAnd);
                selectAndOr.appendChild(optionOr);

                // Append "and/or" select, then text input, comparison select, and second text input
                groupDiv.appendChild(selectAndOr);  // "and/or" select
                groupDiv.appendChild(inputText1);   // First text input
                groupDiv.appendChild(selectComparison);  // Comparison select
                groupDiv.appendChild(inputText2);   // Second text input
            }

            // Append the group div to the container
            container.appendChild(groupDiv);
        }



        // Function to remove the last metadata group (in reverse order)
        function removeFilterMetadata() {
            const container = document.getElementById('metadata-groups-container');

            // Check if there are any groups to remove
            if (metadataFilterCount > 0) {
                const lastGroup = container.lastElementChild;  // Get the last group
                container.removeChild(lastGroup);  // Remove the last group
                metadataFilterCount--;  // Decrease the group count
            }
        }



        // Function to clear all groups
        function clearAllFiltersMetadata() {
            const isConfirmed = confirm("Are you sure you want to clear all metadata filters?");

            if (isConfirmed) {
                const container = document.getElementById('metadata-groups-container');

                // Remove all children (groups) from the container
                container.innerHTML = '';

                // Reset the group count to zero
                metadataFilterCount = 0;
            }
        }

        
        
        
        
        
        
        
        

         function queryDocuments() {
             showLoading(true);
             
            // Get the collection name from the dropdown
            var collectionName = "";

            var tempselect = document.getElementById('page_search_collection_dropdown');
            // Check if a valid selection exists
            if (tempselect.selectedIndex >= 0) {
                collectionName = tempselect.options[tempselect.selectedIndex].text;
            }

            var numOfResults = document.getElementById('page_search_num_of_results').value;
            var queryText = document.getElementById('page_search_similarity').value.trim();

            // Validate the inputs
            if (!collectionName || !numOfResults || !queryText) {
                alert("Please fill in all the fields.");
                showLoading(false);
                return;
            }

            console.log("Collection Name:", collectionName);
            console.log("Number of Results:", numOfResults);
            console.log("Query Text:", queryText);

            var exampleChromaPythonCodeString = ""
             
            // Prepare the filters if enabled
            var documentFilters = {};

            // Check if the filters checkbox is enabled
            var enableFiltersCheckbox = document.getElementById('page_search_checkbox_enable_filter');
            var isGUIRadioButtonSelected = document.getElementById('search_filters_choice_gui_radio_button');
             
            //var conditions = []; // Array to store conditions which will be joined by $or or $and
            if (enableFiltersCheckbox.checked == true && isGUIRadioButtonSelected.checked == true) {

                var jsonObjectWhereDocumentFilters = query_getWhereDocumentFilters();
                
                if (Object.keys(jsonObjectWhereDocumentFilters).length === 0) {
                    // EMPTY FILTERS 
                    console.log("JSON Object for where_document Filters is empty:\n" + JSON.stringify(jsonObjectWhereDocumentFilters, null, 2));
                    
                    exampleChromaPythonCodeString = `results = pycollection.query(
    query_texts=[query_text],
    n_results=num_of_returned_results                                             
)`;
                   
                    
                    exampleChromaPythonExpandedString = `results = pycollection.query(
    query_texts=["${queryText}"],
    n_results=${numOfResults}                                             
)`;
                    
                    exampleChromaPythonCodeStringFull = `import chromadb
from chromadb.utils import embedding_functions

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"

TestCollectionName = "${collectionName}"

persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

pycollection = persistentChromaClient.get_or_create_collection(
    TestCollectionName, embedding_function=pyEmbedFunction
)

num_of_returned_results = ${numOfResults}
usersQueryText = "${queryText}"

results = pycollection.query(
    query_texts=[query_text],
    n_results=num_of_returned_results                                             
)

print(f"{results}")`;
                    

                    console.log("exampleChromaString\n\n" + exampleChromaPythonCodeString);
                    
                    // Set Python Code Element NO FILTERS
                    document.getElementById('page_search_python_code_query_structure').innerHTML = exampleChromaPythonCodeString;
                
                    
                    // Set Expanded Python Code Element NO FILTERS
                    document.getElementById('page_search_python_code_expanded_structure').innerHTML = exampleChromaPythonExpandedString;
                    
                    // Set Full Example Python Code Element NO FILTERS
                    document.getElementById('page_search_python_code_fullexample_structure').innerHTML = exampleChromaPythonCodeStringFull;
                    
                } else {
                    // FILTERS HAVE SOMETHING
                    console.log("Found where_document Filters:\n" + JSON.stringify(jsonObjectWhereDocumentFilters, null, 2));
                    documentFilters["where_document"] = jsonObjectWhereDocumentFilters; // Assign to a key like "filter"
                    
                    exampleChromaPythonCodeString = `results = pycollection.query(
    query_texts=[query_text],
    n_results=num_of_returned_results,                                             
    where_document=`;
                    
                    exampleChromaPythonExpandedString = `results = pycollection.query(
    query_texts=["${queryText}"],
    n_results=${numOfResults},                                          
    where_document=`;
                    
                    exampleChromaPythonCodeStringFull = `import chromadb
from chromadb.utils import embedding_functions

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"

TestCollectionName = "${collectionName}"

persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

pycollection = persistentChromaClient.get_or_create_collection(
    TestCollectionName, embedding_function=pyEmbedFunction
)

num_of_returned_results = ${numOfResults}
usersQueryText = "${queryText}"

results = pycollection.query(
    query_texts=[query_text],
    n_results=num_of_returned_results,                                          
    where_document=`;                                            

     
                    // Set Python Code Element when theres filters
                    document.getElementById('page_search_python_code_query_structure').innerHTML = exampleChromaPythonCodeString + JSON.stringify(jsonObjectWhereDocumentFilters, null, 2) + '\n)';
                
                    // Set Expanded Python Code Element when theres filters
                    document.getElementById('page_search_python_code_expanded_structure').innerHTML = exampleChromaPythonExpandedString + JSON.stringify(jsonObjectWhereDocumentFilters, null, 2) + '\n)';
                    
                    // Set Expanded Python Code Element when theres filters
                    document.getElementById('page_search_python_code_fullexample_structure').innerHTML = exampleChromaPythonCodeStringFull + JSON.stringify(jsonObjectWhereDocumentFilters, null, 2) + '\n)\n\nprint(f"{results}")';
                    
                }
                
                
            } else {
                    // Filter Checkbox NOT ticked
                
                    exampleChromaPythonCodeString = `results = pycollection.query(
    query_texts=[query_text],
    n_results=num_of_returned_results                                             
)`;
                   
                    
                    exampleChromaPythonExpandedString = `results = pycollection.query(
    query_texts=["${queryText}"],
    n_results=${numOfResults}                                             
)`;
                    
                    exampleChromaPythonCodeStringFull = `import chromadb
from chromadb.utils import embedding_functions

CHROMA_DATA_PATH = "C:\\Program Files\\ChromaDB\\Data\\TestDB"
EMBEDMODEL = "all-MiniLM-L6-v2"

TestCollectionName = "${collectionName}"

persistentChromaClient = chromadb.PersistentClient(path=CHROMA_DATA_PATH)
pyEmbedFunction = embedding_functions.SentenceTransformerEmbeddingFunction(EMBEDMODEL)

pycollection = persistentChromaClient.get_or_create_collection(
    TestCollectionName, embedding_function=pyEmbedFunction
)

num_of_returned_results = ${numOfResults}
usersQueryText = "${queryText}"

results = pycollection.query(
    query_texts=[query_text],
    n_results=num_of_returned_results                                             
)

print(f"{results}")`;
                    

                    console.log("exampleChromaString\n\n" + exampleChromaPythonCodeString);
                    
                    // Set Python Code Element NO FILTERS
                    document.getElementById('page_search_python_code_query_structure').innerHTML = exampleChromaPythonCodeString;
                
                    
                    // Set Expanded Python Code Element NO FILTERS
                    document.getElementById('page_search_python_code_expanded_structure').innerHTML = exampleChromaPythonExpandedString;
                    
                    // Set Full Example Python Code Element NO FILTERS
                    document.getElementById('page_search_python_code_fullexample_structure').innerHTML = exampleChromaPythonCodeStringFull;
            }

             
             
        
             
            // Prepare the data to send
            var requestData = {
                collection_name: collectionName,
                query_text: queryText,
                num_of_results: parseInt(numOfResults) // Ensure it's an integer
            };

            // If documentFilters exist, add them to the request
            if (Object.keys(documentFilters).length > 0) {
                requestData = {
                    ...requestData,
                    ...documentFilters
                };
            }

           console.log("From queryDocuments()function, Request Data to be sent:", JSON.stringify(requestData, null, 2));

            // Send POST request to the Flask server
            fetch('/api/query-documents', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.results) {
                    // Handle the response here
                    console.log("Query Results:", data.results);
                    displayResults(data.results); // Assuming a function to display the results

                    // Example usage
                    showNotification({
                      message: "Query Results Returned - Table Populated",
                      backgroundColor: "#2ecc71",
                      opacity: 90,
                      duration: 4000,
                      stackFromTop: false
                    });

                } else {
                    console.error("Error:", data.error);

                    // Check if the error message contains the specific string
                    if (data.error && data.error.includes("Expected where document to be a dictionary")) {
                        // If the error message contains the specific text
                        showNotification({
                          message: "One or More Filters has an 'and/or' group with only 1 condition. Add a 2nd Condition to each, or Remove the Filter",
                          backgroundColor: "#e74c3c",
                          opacity: 90,
                          duration: 10000,
                          stackFromTop: false
                        });
                    } else {
                        // Default error message if the specific error isn't found
                        showNotification({
                          message: "Error: " + data.error,
                          backgroundColor: "#e74c3c",
                          opacity: 90,
                          duration: 4000,
                          stackFromTop: false
                        });
                    }
                }
            })
            .catch(error => {
                console.error('Error querying documents:', error);

                // Example usage
                showNotification({
                  message: "Error: " + error,
                  backgroundColor: "#e74c3c",
                  opacity: 90,
                  duration: 10000,
                  stackFromTop: false
                });
            });
             
             showLoading(false);
        }



        
        
        
        

         function queryDocumentsNew() {
             showLoading(true);
             
            // Get the collection name from the dropdown
            var collectionName = "";

            var tempselect = document.getElementById('page_search_collection_dropdown');
            // Check if a valid selection exists
            if (tempselect.selectedIndex >= 0) {
                collectionName = tempselect.options[tempselect.selectedIndex].text;
            }

            var numOfResults = document.getElementById('page_search_num_of_results').value;
            var queryText = document.getElementById('page_search_similarity').value.trim();

            // Validate the inputs
            if (!collectionName || !numOfResults || !queryText) {
                alert("Please fill in all the fields.");
                showLoading(false);
                return;
            }

            console.log("Collection Name:", collectionName);
            console.log("Number of Results:", numOfResults);
            console.log("Query Text:", queryText);
             
            // Prepare Object for Filters 
            var documentFilters= {};
            var metadataFilters= {};
             
            // Prepare the Inital data to send
            var requestData = {
                collection_name: collectionName,
                query_text: queryText,
                num_of_results: parseInt(numOfResults) // Ensure it's an integer
            };
             
            // Check if Filters are enabled, and which ones
            var enableFiltersCheckbox = document.getElementById('page_search_checkbox_enable_filter');
            var GUIRadioButton = document.getElementById('search_filters_choice_gui_radio_button');
            var fallbackRadioButton = document.getElementById('search_filters_choice_gui_radio_button');
            var fallbackEnableWhereDocumentsCheckbox = document.getElementById('fallback_enable_where_document_json_checkbox');
            var fallbackEnableWhereMetadataCheckbox = document.getElementById('fallback_enable_where_metadata_json_checkbox');
             
            // If Filters are used, calculate them, and append to the request data 
            if (enableFiltersCheckbox.checked == true) {

                if (GUIRadioButton.checked == true) {
                    // If GUI Filters were Chosen
                    // -----------------------------
                    // Run different function
                    // NEED TO AMEND TO DO THE GUI FILTERS 
                    //runGUIFunctionFilters();

                } else {
                    // If Fallback Method was Chosen
                    // -----------------------------
                    if (fallbackEnableWhereDocumentsCheckbox.checked == true) {
                        // convert textarea content to json 
                        try {
                            documentFilters = JSON.parse(document.getElementById('fallback_enable_where_document_json_textarea').value);
                        } catch (e) {
                            console.error("Invalid JSON in document filter textarea", e);
                        }

                        if (Object.keys(documentFilters).length > 0) {
                            // Merge filters into requestData
                            requestData = {
                                ...requestData,
                                where_document: documentFilters
                            };
                        }
                    }

                    if (fallbackEnableWhereMetadataCheckbox.checked == true) {
                        // convert textarea content to json 
                        try {
                            metadataFilters = JSON.parse(document.getElementById('fallback_enable_where_metadata_json_textarea').value);
                        } catch (e) {
                            console.error("Invalid JSON in metadata filter textarea", e);
                        }

                        if (Object.keys(metadataFilters).length > 0) {
                            // Merge filters into requestData
                            requestData = {
                                ...requestData,
                                where: metadataFilters
                            };
                        }
                    }
                } 
            }

             
            // DEBUG to see whats going to be sent to flask
           console.log("From queryDocuments()function, Request Data to be sent:", JSON.stringify(requestData, null, 2));

            // Send POST request to the Flask server
            fetch('/api/query-documents', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.results) {
                    // Handle the response here
                    console.log("Query Results:", data.results);
                    displayResults(data.results); // Assuming a function to display the results

                    // Example usage
                    showNotification({
                      message: "Query Results Returned - Table Populated",
                      backgroundColor: "#2ecc71",
                      opacity: 90,
                      duration: 4000,
                      stackFromTop: false
                    });

                } else {
                    console.error("Error:", data.error);

                    // Check if the error message contains the specific string
                    if (data.error && data.error.includes("Expected where document to be a dictionary")) {
                        // If the error message contains the specific text
                        showNotification({
                          message: "One or More Filters has an 'and/or' group with only 1 condition. Add a 2nd Condition to each, or Remove the Filter",
                          backgroundColor: "#e74c3c",
                          opacity: 90,
                          duration: 10000,
                          stackFromTop: false
                        });
                    } else {
                        // Default error message if the specific error isn't found
                        showNotification({
                          message: "Error: " + data.error,
                          backgroundColor: "#e74c3c",
                          opacity: 90,
                          duration: 4000,
                          stackFromTop: false
                        });
                    }
                }
            })
            .catch(error => {
                console.error('Error querying documents:', error);

                // Example usage
                showNotification({
                  message: "Error: " + error,
                  backgroundColor: "#e74c3c",
                  opacity: 90,
                  duration: 10000,
                  stackFromTop: false
                });
            });
             
             showLoading(false);
        
         }
        
        
        
        
        

        
        
        
        
        
        
        
        
        
        
        

       function displayResults(results) {
        // Get the table body element
        var tableBody = document.getElementById('page_search_table').getElementsByTagName('tbody')[0];

        // Clear any existing rows in the table
        tableBody.innerHTML = '';

        // Flatten the results
        var flattenedResults = [];
        results.forEach(result => {
            // Assuming the result structure has arrays nested inside
            var tempScoreArray = result.similarity_score;
            var tempIdArray = result.doc_id;
            var tempDocumentArray = result.document;
            var tempMetadataArray = result.metadata;

            // Flattening the data and pushing it to the new array
            tempScoreArray.forEach((score, index) => {
                flattenedResults.push({
                    result_id: flattenedResults.length + 1, // This will give each row a unique ResultID starting from 1
                    similarity_score: score,
                    doc_id: tempIdArray[index],
                    document: tempDocumentArray[index],
                    metadata: tempMetadataArray[index]
                });
            });
        });

            // Check if there are any results
            if (flattenedResults.length === 0) {
                // Create a single row with a message indicating no results
                var row = tableBody.insertRow(); // Insert a new row at the end of the table body
                var cell = row.insertCell(0);
                cell.colSpan = 5; // Span across all columns
                cell.textContent = "No results found"; // Display a message

                // Show notification if no results
                showNotification({
                    message: "No Documents Found matching your Query - try again without Filters",
                    backgroundColor: "#f39c12", // Red background for error
                    opacity: 90,
                    duration: 4000, // Notification duration
                    stackFromTop: false // Stack from bottom
                });

                return; // Exit the function early if no results
            }

            // Loop through the flattened results and create a table row for each
            flattenedResults.forEach(result => {
                var row = tableBody.insertRow(); // Insert a new row at the end of the table body

                // Insert ResultID cell (Column 1)
                var resultIdCell = row.insertCell(0);
                resultIdCell.textContent = result.result_id;

                // Insert DocID cell (Column 2) wrapped in a div
                var docIdCell = row.insertCell(1);
                var docIdDiv = document.createElement('div');
                docIdDiv.textContent = result.doc_id;
                docIdCell.appendChild(docIdDiv);

                // Insert Document cell (Column 3) wrapped in a div
                var documentCell = row.insertCell(2);
                var documentDiv = document.createElement('div');
                documentDiv.textContent = result.document;
                documentCell.appendChild(documentDiv);

                // Insert Metadata cell (Column 4) wrapped in a pre tag
                var metadataCell = row.insertCell(3);
                var metadataPre = document.createElement('pre'); // Use 'pre' tag to maintain formatting
                metadataPre.textContent = JSON.stringify(result.metadata, null, 2); // Beautify the metadata JSON with indentation
                metadataCell.appendChild(metadataPre);

                // Log the beautified metadata from the pre tag to the console
                //console.log("Beautified Metadata:\n", metadataPre.textContent);

                // Insert Similarity cell (Column 5)
                var similarityCell = row.insertCell(4);
                similarityCell.textContent = result.similarity_score;
            });
        }
     
   
        
        
        
        function feedUpdateDocumentPage(passedDocID, passedDocContent, passedDocMetadata){
            
            //alert('troubleshooting - passeed doc ID\n\n' + passedDocID);
            
            // Auto Update the Doc ID on Update document Page 
            document.getElementById("page_updatedocs_document_id").value = passedDocID;
            
            // Auto Update the document Text 
            document.getElementById("page_updatedocs_document_text").value = passedDocContent;
            
            // just assume metadata is always going to be on the document, as it should, really, always have "something" and its no issue to enable this if theres no metadata still. 
            document.getElementById('page_updatedocs_checkbox_include_metadata').checked = true;
            // run function to enable the metadata textarea
            toggleTextarea('page_updatedocs_checkbox_include_metadata', 'page_updatedocs_document_metadata');
            /*
            // Auto Update the Document Metadata
            document.getElementById("page_updatedocs_document_metadata").value = passedDocMetadata;
            */
            
            // Beautify the JSON object for document metadata content
            var beautifiedMetadata = JSON.stringify(JSON.parse(passedDocMetadata), null, 4);

            // Auto Update the Document Metadata with beautified content
            document.getElementById("page_updatedocs_document_metadata").value = beautifiedMetadata;
    
            // Navigate to the Update Document Page
            showPage('updatedocuments');
            
            // Finally, focus on the Document Text / content Textarea, but delay it to give time for the elements to render, due to css transitions
            setTimeout(function() {
                document.getElementById("page_updatedocs_document_text").focus();
            }, 1000); // 1000ms delay
            
        }  
        
        
        
        
        
        
        
        async function updateDocument() {
            // Select the <select> element
            var selectElement = document.getElementById("page_updatedocs_collection_dropdown");

            // Check if the <select> element is empty
            if (selectElement && selectElement.options.length === 0) {
                console.log("No Collection Selected - Create/Select Collection first");
                
                showNotification({
                    message: "No Collection Selected - Create/Select a Collection first",
                    backgroundColor: "#e74c3c", // Red background for error
                    opacity: 90,
                    duration: 8000,
                    stackFromTop: false
                });
                
                return;
            } 
            
            // Get metadata (if exists) and checkbox status
            const metadataCheckbox = document.getElementById('page_updatedocs_checkbox_include_metadata');

            // Get the collection name from the dropdown
            var collectionName = "";
            var tempselect = document.getElementById('page_search_collection_dropdown');
            // Check if a valid selection exists
            if (tempselect.selectedIndex >= 0) {
                collectionName = tempselect.options[tempselect.selectedIndex].text;
            }

            // Get the document ID from the input field
            const docId = document.getElementById('page_updatedocs_document_id').value;

            // Get the document content from the textarea
            const documentContent = document.getElementById('page_updatedocs_document_text').value;

            // Validate required fields (collectionName, docId, documentContent)
            if (!collectionName || !docId || !documentContent) {
                showNotification({
                    message: "Please fill in all required fields.",
                    backgroundColor: "#e74c3c", // Red for error
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
                return;
            }

            // Get the existing document metadata (if any)
            const documentMetadata = document.getElementById('page_updatedocs_document_metadata') ? document.getElementById('page_updatedocs_document_metadata').value : null;
            let parsedMetadata = null;

            // If the checkbox is ticked and metadata is provided, validate the JSON
            if (metadataCheckbox.checked && documentMetadata) {
                try {
                    parsedMetadata = JSON.parse(documentMetadata); // Parse string to JSON object
                } catch (e) {
                    showNotification({
                        message: "Invalid JSON format in metadata. Please correct it and try again.",
                        backgroundColor: "#e74c3c", // Red for error
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    return; // Stop further execution
                }
            }

            // Define metadata object
            let metadata = parsedMetadata || {}; // If there's existing metadata, keep it, otherwise start with an empty object

            // Common metadata fields
            const modifiedDate = new Date().toISOString(); // Current date-time

            
            // 3. Embedding Model & Context Window
            const embeddingModel = document.getElementById('page_settings_embed_model_input').value;
            const embeddingModelContextWindow = document.getElementById('page_settings_embed_context_window_input').value;
            const embeddingModelDimension = document.getElementById('page_settings_embed_dimension_input').value;
            
            
            // If checkbox is checked, add more metadata fields
            if (metadataCheckbox.checked) {
                  
                //const uuid = crypto.randomUUID(); // New UUID
                const docHash = await generateHashFromString(documentContent);
                
                var language = ""
                      
                // firstly, need to check if passed metadata contains a language key, if not we'll use one from settings, if so but its empty we'll also use from settings, but if it has value, retain it. 
                if (metadata != null) {
                    if ("language" in metadata) {
                            const passedMetaLanguageKey = metadata.language;
                            console.log("troubleshooting 3 \n\n language key present\n\n value: \n" + passedMetaLanguageKey);
                            //alert("troubleshooting 3 \n\n language key present\n\n value: \n" + passedMetaLanguageKey);

                            if (passedMetaLanguageKey == "") {
                                language = document.getElementById('page_settings_app_language_input').value.trim().toLowerCase();
                            } else {
                                language = passedMetaLanguageKey;
                            }
                    } else {
                            console.log("troubleshooting 3 \n\n language key missing - creating one from settings");
                            language = document.getElementById('page_settings_app_language_input').value.trim().toLowerCase();
                    }

                } else {
                    console.log("troubleshooting 4 \n\n no language key present");
                    //alert("troubleshooting 4 \n\n no language key present");
                }
                
                //const language = document.getElementById('page_settings_app_language_input')?.innerText.trim().toLowerCase() || '';

                // Add or overwrite fields in metadata
                metadata = {
                    ...metadata, // Spread any existing metadata
                    "hash": docHash,
                    "date_modified": modifiedDate, 
                    "embedding_model": embeddingModel,
                    "embedding_model_context_window": embeddingModelContextWindow,
                    "embedding_model_dimension": embeddingModelDimension,
                    language: language
                };
            } else {
                // If the checkbox is not checked
                metadata = {
                    ...metadata,
                    "date_modified": modifiedDate,
                    "embedding_model": embeddingModel,
                    "embedding_model_context_window": embeddingModelContextWindow,
                    "embedding_model_dimension": embeddingModelDimension
                };
            }
        
            var requestData = "";
            
            //var wipeCheckbox = document.getElementById('page_updatedocs_checkbox_wipe_on_update');
            //if (wipeCheckbox.checked){
            //    // Create the data object to send
            //    requestData = {
            //        collection_name: collectionName,
            //        doc_id: docId,
            //        document_content: documentContent,
            //        metadata: null 
            //    };
           //} else {
                // Create the data object to send
                requestData = {
                    collection_name: collectionName,
                    doc_id: docId,
                    document_content: documentContent,
                    metadata: metadata // Send the updated metadata
                };
            //}


            try {
                // Send the request using fetch
                const response = await fetch('/api/update-document', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData),
                });

                const result = await response.json();

                if (response.ok) {
                    // Success Notification
                    showNotification({
                        message: result.message || "Document updated successfully!",
                        backgroundColor: "#2ecc71", // Green for success
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });

                    setTimeout(function() {
                        window.scrollTo({
                            top: 0,
                            behavior: 'smooth' // Optional: adds smooth scrolling
                        });
                        updateVariousLabels();
                        updateCollectionDocumentCount();
                    }, 500);

                } else {
                    const tempErrorMessage = result.message;

                    // Error Notification
                    showNotification({
                        message: tempErrorMessage || "Failed to update document. Please try again.",
                        backgroundColor: "#e74c3c", // Red for error
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                }
            } catch (error) {
                console.error('Error during fetch:', error);
                // Generic error notification
                showNotification({
                    message: 'An error occurred while updating the document.',
                    backgroundColor: "#e74c3c", // Red for error
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
            }
        }



        
        


        
        
        
        function updateVariousLabels(){
            // update various labels
            document.getElementById("page_dashboard_flask_server").innerHTML =  document.getElementById('page_settings_flask_endpoint_input').value;
            document.getElementById("page_dashboard_web_app_version").innerHTML =  webAppVersion;
            document.getElementById("page_help_app_version").innerHTML =  webAppVersion;
            document.getElementById("page_setting_app_version").innerHTML =  webAppVersion;
            
            
            // update lables
            getFlaskVersion();
            
            // Update labels showing the chromaServer Version
            getChromaServerVersion();
            updateDbPath();
            updateEmbeddingModelInfo();
            
            updateTotalCollectionCount();
            updateTotalDocumentCount();
            updateCollectionDocumentCount();
        }
        
        
        
        

        // by llama 3.2 this one
        function refreshSystemStats(interval) {
            if (statsIntervalId !== null) {
                clearInterval(statsIntervalId);
            }

            // Use setInterval to refresh data at the given interval
            statsIntervalId = setInterval(async function() {
                try {
                    // Call the fetchData function to get the system stats
                    const data = await fetchData('/system-stats');

                    // Check if data is received
                    if (data) {
                        // Update the HTML elements with the new CPU and RAM usage
                        document.getElementById('page_dashboard_stats_cpu').innerHTML = `CPU Usage: ${data.cpu}%`;
                        document.getElementById('page_dashboard_stats_ram').innerHTML = `RAM Usage: ${data.ram}%`;
                    }
                } catch (error) {
                    console.error("Error refreshing system stats:", error);
                }
            }, interval + 200); // Interval in milliseconds
        }
        
        
        
        
        function stopRefreshingSystemStats() {
            // Check if an interval is running before clearing it
            //if (statsIntervalId !== null) {
                //alert("stopping");
                clearInterval(statsIntervalId);
            
            //}
        }


        
        
        function toggleCPURAMInterval() {
            var elem = document.getElementById('page_settings_enable_cpuram_checkbox');
            if (elem.checked) {
                updateCPURamInterval();
            } else {
                stopRefreshingSystemStats();
            }
        }


        
        function saveSettings(){
            updateVariousLabels();
            
            //updateCPURamInterval();
            
            // Example usage
            showNotification({
              message: "Settings Saved",
              backgroundColor: "#2ecc71",
              opacity: 90,
              duration: 4000,
              stackFromTop: false
            });
        }
        
        
        
        
        
        
        
        function setTitleText() {
          // Set the content of the <div> with id "titleText"
          var titleElement = document.getElementById("titleText");
          titleElement.innerHTML = "Chroma Flow Studio";

          // Set the content of the <title> tag in the <head>
          document.title = "Chroma Flow Studio";
        }

        
        
        
        function toggleTextarea(checkboxId, textareaId) {
            var checkbox = document.getElementById(checkboxId);
            var textarea = document.getElementById(textareaId);

            // Enable or disable textarea based on checkbox state
            if (checkbox.checked) {
                textarea.disabled = false;
                // Remove any visual indication of being disabled
                textarea.style.backgroundColor = ''; // reset to normal state
                textarea.style.opacity = '1'; // fully visible
                textarea.style.color = ''; // reset text color
            } else {
                textarea.disabled = true;
                // Add a visual indication that the textarea is disabled
                textarea.style.backgroundColor = '#e0e0e0'; // light gray background
                textarea.style.opacity = '0.6'; // slightly transparent
                textarea.style.color = '#a0a0a0'; // light gray text color
            }
        }


        
        

        // Apply filter function
        function applyFilter() {
            const filterText = document.getElementById('page_documents_filter_input').value.toLowerCase().trim();
            const table = document.getElementById('page_documents_table');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            let matchFound = false;

            // Loop through all table rows
            for (let row of rows) {
                let rowMatch = false;

                // Check if filter text matches any of the first three columns (ID, Document, Metadata)
                for (let i = 1; i < 4; i++) {
                    const cell = row.getElementsByTagName('td')[i];
                    if (cell && cell.textContent.toLowerCase().includes(filterText)) {
                        rowMatch = true;
                        break;
                    }
                }

                // Show or hide row based on whether it matches the filter text
                if (rowMatch) {
                    row.style.display = '';
                    matchFound = true;
                } else {
                    row.style.display = 'none';
                }
            }

            // Show notification based on filter result
            if (matchFound && filterText) {
                showNotification({
                    message: "Filter applied: matching documents found.",
                    backgroundColor: "#2ecc71", // Success color
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
                updateRowCountViewDocuments();
                
            } else if (!filterText) {
                // Optional: Show a notification if no filter is applied
                showNotification({
                    message: "Please enter a filter text to search for documents.",
                    backgroundColor: "#f39c12", // Warning color
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
            } else {
                showNotification({
                    message: "No documents match your filter criteria.",
                    backgroundColor: "#e74c3c", // Error color
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
            }
        }
        
        
        

        // Clear filter function
        function clearFilter() {
            // Clear the input field
            document.getElementById('page_documents_filter_input').value = '';

            // Show all rows
            const table = document.getElementById('page_documents_table');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');

            for (let row of rows) {
                row.style.display = '';
            }

            // Show a success notification after clearing the filter
            showNotification({
                message: "Filter has been cleared successfully!",
                backgroundColor: "#9b59b6",  // Success green
                opacity: 90,
                duration: 4000,
                stackFromTop: false
            });
            
            updateRowCountViewDocuments();
        }

        

        
        
        // REstart the Flask Server so you dont have to manually kill and reload the file
        function restartServer() {
            // Show a confirmation dialog
            //const isConfirmed = confirm("Are you sure you want to restart the server?");

            // If the user confirms, proceed with restarting the server
            //if (isConfirmed) {
            
            
            if (checkEmbedModelFieldsArentEmpty() == false){
               console.log("One ore more Embedding Model input Fields are empty");
                
                showNotification({
                    message: "One ore more Embedding Model input Fields are empty",
                    backgroundColor: "#e74c3c", // Red background for error
                    opacity: 90,
                    duration: 8000,
                    stackFromTop: false
                }); 
                
                return;
            }
            
            
            showLoading(true);

            // save settings first
            saveAppSettingsJSON();

            setTimeout(() => {

                // Show a success notification
                showNotification({
                    message: "Server is restarting...",
                    backgroundColor: "#3498db", // Green for success
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });

                fetch('/restart', {
                    method: 'GET', // or 'POST' if you prefer
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.text())  // Handle the response as text
                .then(data => {
                    console.log('Server Restart Complete:', data);

                    // Show a success notification
                    showNotification({
                        message: "Server Restart Complete",
                        backgroundColor: "#2ecc71", // Green for success
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });

                    showPage('dashboard');
                })
                .catch(error => {
                    console.error('Error restarting the server:', error);

                    // Show an error notification
                    showNotification({
                        message: "Failed to restart the server.",
                        backgroundColor: "#e74c3c", // Red for error
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                });
                
                
            }, 20);  // Delay of 500 milliseconds to give time for settings to have saved first 
            
            /*
            } else {
                console.log('Server restart canceled.');

                // Optionally show a cancellation notification
                showNotification({
                    message: "Server restart canceled.",
                    backgroundColor: "#f39c12", // Yellow for cancel
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
            }
            */
                
            showLoading(false);
        }
        


        
        

        function copyToClipboardById(elementId) {
            // Try to get the element by the given ID
            const element = document.getElementById(elementId);

            if (!element) {
                console.error('Element with the provided ID not found.');

                // Show error notification
                showNotification({
                    message: "Failed to find the element with the provided ID.",
                    backgroundColor: "#e74c3c",
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });

                return;
            }

            // Check if the element is a textarea, and get the text accordingly
            let textToCopy;
            
            // Check if the element is a form element (like input, textarea, select, etc.)
            if (element.tagName.toLowerCase() === 'textarea' || element.tagName.toLowerCase() === 'input' || element.tagName.toLowerCase() === 'select') {
                // For form elements, use element.value
                textToCopy = element.value;
            } else {
                // For non-form elements (like div, span), use innerText
                textToCopy = element.innerText;
            }

            // Create a temporary textarea element to hold the text for copying
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = textToCopy; // Set the text content to the value
            document.body.appendChild(tempTextArea);

            // Select the content of the temporary textarea
            tempTextArea.select();
            tempTextArea.setSelectionRange(0, 99999); // For mobile devices

            // Copy the selected content to the clipboard
            try {
                document.execCommand('copy');
                console.log('Content copied to clipboard.');

                // Show success notification
                showNotification({
                    message: elementId + " Copied to Clipboard",
                    backgroundColor: "#9b59b6",
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
            } catch (err) {
                console.error('Failed to copy to clipboard: ', err);

                // Show error notification
                showNotification({
                    message: "Failed to copy content to clipboard.",
                    backgroundColor: "#e74c3c",
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
            }

            // Clean up by removing the temporary textarea
            document.body.removeChild(tempTextArea);
        }


        
        
        

        
        
    


        
        // by llama 3.2
        function updateCPURamInterval() {
            // Stop the current refresh function if it's running
            
            var checkboxelem = document.getElementById('page_settings_enable_cpuram_checkbox');
            if (checkboxelem.checked) {
                clearInterval(statsIntervalId);

                // Get the interval value from the UI
                var intervalSettingUI = document.getElementById('page_settings_cpu_ram_interval_input').value;
                var intervalMilliseconds = parseInt(intervalSettingUI);

                // Start the refresh function with the new interval
                //alert("updating");
                refreshSystemStats(parseInt(intervalMilliseconds));
            }

        }
        
        
    
        
        
        
        function setPageLanguage() {
            // Get the input element by its ID
            var inputElement = document.getElementById('page_settings_app_language_input');
            
            // Set the value of the input element to "en-GB"
            if (inputElement) {
                inputElement.value = 'en-GB';
                
                // Show a success notification
                showNotification({
                    message: "Language set to Default Successfully!",
                    backgroundColor: "#2ecc71",
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
            } else {
                console.error('Input element not found with ID page_settings_app_language_input');
                
                // Show an error notification
                showNotification({
                    message: "Failed to set language. Input element not found!",
                    backgroundColor: "#e74c3c",
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
            }
        }
        
        
        
        
        

        function fetchAppSettingsJSON() {
            const baseUrl = window.location.origin;  // Dynamically get the base URL of the site

            fetch(`${baseUrl}/read-settings`)  // Use the base URL + /read-settings
                .then(response => response.json())  // Parse the JSON response
                .then(data => {
                    if (data.status === 'success') {
                        // Log settings to the console
                        console.log("Settings fetched successfully:");
                        console.log(data.settings);

                        // Populate the HTML elements with the fetched settings
                        //alert("DEBUG CPURAMIntervalEnabled: " + data.settings.CPURAMIntervalEnabled);
                        document.getElementById("page_settings_enable_cpuram_checkbox").checked = data.settings.CPURAMIntervalEnabled || false;

                        //alert("DEBUG CPURAMInterval: " + data.settings.CPURAMInterval);
                        document.getElementById("page_settings_cpu_ram_interval_input").value = data.settings.CPURAMInterval || '';

                        //alert("DEBUG Language: " + data.settings.language);
                        document.getElementById("page_settings_app_language_input").value = data.settings.language || '';

                        // Update Flask server endpoint (corrected key)
                        //alert("DEBUG Flask Address: " + data.settings.flask_server_endpoint);
                        document.getElementById("page_settings_flask_endpoint_input").value = data.settings.flask_server_endpoint || '';

                        // Update Chroma DB path (corrected key)
                        //alert("DEBUG CHROMA Data Path: " + data.settings.chromaDB_path);
                        document.getElementById("page_settings_chromadb_path_input").value = data.settings.chromaDB_path || '';

                        // Update Embed model Selected Preset
                        //alert(data.settings.embedding_model_selected_preset);
                        document.getElementById("page_settings_embed_model_preset_selecttag").value = data.settings.embedding_model_selected_preset || '';
                        
                        // Update Embed model (corrected key)
                        //alert("DEBUG Embed Model: " + data.settings.embedding_model);
                        document.getElementById("page_settings_embed_model_input").value = data.settings.embedding_model || '';

                        // Update Embed context window (corrected key)
                        //alert("DEBUG Embed Context Window: " + data.settings.embedding_context_window);
                        document.getElementById("page_settings_embed_context_window_input").value = data.settings.embedding_context_window || '';
                        
                        // Update Embed dimensionality
                        //alert("DEBUG Embed Context Window: " + data.settings.embedding_context_window);
                        document.getElementById("page_settings_embed_dimension_input").value = data.settings.embedding_model_dimension || '';

                        // Update Embed model path (corrected key)
                        //alert("DEBUG Embed Model Path: " + data.settings.embedding_model_path);
                        document.getElementById("page_settings_embed_model_path_input").value = data.settings.embedding_model_path || '';

                        // Update Proxy URL (corrected key)
                        //alert("DEBUG Proxy URL: " + data.settings.proxy_endpoint);
                        document.getElementById("page_settings_proxy_server_input").value = data.settings.proxy_endpoint || '';
                        
                        // Update Proxy URL (corrected key)
                        //alert("DEBUG Proxy URL: " + data.settings.proxy_endpoint);
                        document.getElementById("page_settings_autogen_colname_input").value = data.settings.autoGenCollectionName || '';                        
                        
                        // Update BUG FIX 100 Documents Batch Size Settings
                        document.getElementById("page_settings_enable_bugix_batch_sizes_checkbox").checked = data.settings.bugFix100DocumentsEnabled || false;
                        document.getElementById("page_settings_bugfix_batch_sizes_selecttag").value = data.settings.bugFix100DocumentsBatchSize || '';

                        bugFIX100Docs_DisbaleBatchSizes();
                        
                        if (appHasBootedUp == true) {
                            
                            // comment out, as i had to include it for the bugfix settings to persist, but now it comes up on every page change, you dont want that
                            /*
                            showNotification({
                                message: "Settings fetched successfully!",
                                backgroundColor: "#2ecc71",  // Green for success
                                opacity: 90,
                                duration: 4000,
                                stackFromTop: false
                            });
                            */
                        }

                    } else {
                        console.error("Error fetching settings:", data.message);

                        // Show error notification
                        showNotification({
                            message: `Error fetching settings: ${data.message}`,
                            backgroundColor: "#e74c3c",  // Red for error
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });
                    }
                })
                .catch(error => {
                    console.error("Error:", error);

                    // Show error notification for network or other issues
                    showNotification({
                        message: `Error: ${error.message}`,
                        backgroundColor: "#e74c3c",  // Red for error
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                });
        }
        
        

        
        function saveAppSettingsJSON() {
            const baseUrl = window.location.origin;  // Dynamically get the base URL of the site

            // Gather updated values from the HTML elements
            const updatedSettings = {
                flask_server_endpoint: document.getElementById("page_settings_flask_endpoint_input").value,
                proxy_endpoint: document.getElementById("page_settings_proxy_server_input").value,
                chromaDB_path: document.getElementById("page_settings_chromadb_path_input").value,
                embedding_model_selected_preset: document.getElementById("page_settings_embed_model_preset_selecttag").value,
                embedding_model: document.getElementById("page_settings_embed_model_input").value,
                embedding_context_window: parseInt(document.getElementById("page_settings_embed_context_window_input").value),
                embedding_model_dimension: parseInt(document.getElementById("page_settings_embed_dimension_input").value),
                embedding_model_path: document.getElementById("page_settings_embed_model_path_input").value,
                language: document.getElementById("page_settings_app_language_input").value,
                CPURAMIntervalEnabled: document.getElementById("page_settings_enable_cpuram_checkbox").checked,
                CPURAMInterval: parseInt(document.getElementById("page_settings_cpu_ram_interval_input").value),
                autoGenCollectionName: document.getElementById("page_settings_autogen_colname_input").value,
                bugFix100DocumentsEnabled: document.getElementById("page_settings_enable_bugix_batch_sizes_checkbox").checked,
                bugFix100DocumentsBatchSize: document.getElementById("page_settings_bugfix_batch_sizes_selecttag").value
            };

            // Send the updated settings to the server
            fetch(`${baseUrl}/save-settings`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(updatedSettings)  // Send the updated settings as JSON
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    console.log("Settings saved successfully!");
                    // Show success notification
                    showNotification({
                        message: "Settings saved successfully!",
                        backgroundColor: "#2ecc71",  // Green for success
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    
                    compareEmbedModelsSystemAndCollection();
                    
                    setTimeout(function() {
                        updateVariousLabels();
                        
                    }, 500);
                    
                } else {
                    console.error("Error saving settings:", data.message);
                    // Show error notification
                    showNotification({
                        message: `Error saving settings: ${data.message}`,
                        backgroundColor: "#e74c3c",  // Red for error
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                }
            })
            .catch(error => {
                console.error("Error:", error);
                // Show error notification for network or other issues
                showNotification({
                    message: `Error: ${error.message}`,
                    backgroundColor: "#e74c3c",  // Red for error
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
            });
        }
        
        
        
        function setDefaultCPURAMInterval(){
            document.getElementById("page_settings_cpu_ram_interval_input").value = 2000;
        }
        
        
        
        function setDefaultSettingsFields() {
            // Ask for confirmation before setting default settings
            if (window.confirm("Set Default Settings?")) {
                document.getElementById("page_settings_enable_cpuram_checkbox").checked = false;
                document.getElementById("page_settings_cpu_ram_interval_input").value = 2000;
                document.getElementById("page_settings_app_language_input").value = 'en-GB';
                document.getElementById("page_settings_flask_endpoint_input").value = 'http://127.0.0.1:5000';
                document.getElementById("page_settings_chromadb_path_input").value = 'C:\\Program Files\\ChromaDB\\Data\\TestDB';
                document.getElementById("page_settings_embed_model_input").value = 'all-MiniLM-L6-v2';
                document.getElementById("page_settings_embed_context_window_input").value = 512;
                document.getElementById("page_settings_embed_model_path_input").value = 'C:\\Program Files\\ChromaDB\\Data\\models\\all-MiniLM-L6-v2';
                document.getElementById("page_settings_proxy_server_input").value = '';
                document.getElementById("page_settings_autogen_colname_input").value = 'testCollection';
                document.getElementById("page_settings_embed_dimension_input").value = '384';
                
                document.getElementById("page_settings_enable_bugix_batch_sizes_checkbox").checked = true;
                setDefaultBatchsizeBUGFIX100Docs();
            }
        }


        
        function reloadSettingsFromFile() {
            // Ask for confirmation before setting default settings
            if (window.confirm("Reload values from appSettings.json?")) {
                fetchAppSettingsJSON();
            }
        }
        
        
        
        
        
        // Function to call the Flask route and handle the response
        function writeDefaultConfig() {
            // Ask for user confirmation before proceeding
            if (confirm("Are you sure you want overwrite appSettings.json with Default Config?")) {
                // Prepare the POST request
                fetch('/write-default-config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                })
                .then(response => response.json()) // Parse JSON response
                .then(data => {
                    // Check if the message indicates success or error
                    if (data.message.includes("successfully") || data.message.includes("already exists")) {
                        // Success or informational message
                        showNotification({
                            message: data.message,
                            backgroundColor: "#2ecc71",  // Green for success
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });
                    } else {
                        // Error message
                        showNotification({
                            message: data.message,
                            backgroundColor: "#e74c3c",  // Red for errors
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });
                    }
                })
                .catch(error => {
                    // Handle fetch errors
                    showNotification({
                        message: "Network error: Unable to reach server.",
                        backgroundColor: "#e74c3c",  // Red for errors
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    console.error('Error:', error);
                });
            } else {
                // If the user cancels, log or notify that the action was canceled
                console.log("Action canceled by user.");
            }
        }
        
        
        


        async function addManyTestDocuments() {
            showLoading(true);

            // Get the collection name from the dropdown
            var collectionName = "";
            var tempselect = document.getElementById('page_search_collection_dropdown');

            // Check if a valid selection exists
            if (tempselect.selectedIndex >= 0) {
                collectionName = tempselect.options[tempselect.selectedIndex].text;
            }
            
            // Ask for confirmation before proceeding
            const confirmAction = window.confirm("Add Multiple Test Documents\nto collection '" + collectionName + "'?");

            // If user clicks "Cancel", exit the function
            if (!confirmAction) {
                console.log("Action cancelled by user.");
                return;
            }
            
            //alert("troubleshooting 7 \n\nCollection name being passed: " + collectionName);

            // Get the base endpoint URL from the input element
            const baseEndpoint = document.getElementById('page_settings_flask_endpoint_input').value;

            // Combine the base endpoint with the specific API endpoint
            const url = `${baseEndpoint}/api/add-many-test-document`;

            // Create the payload for the request
            const payload = {
                collection_name: collectionName
            };

            //alert("troubleshooting 8 \n\nCollection name being passed: " + collectionName + '\n\nendpoint:\n' + url);
            
            try {
                // Call the fetchData function
                const result = await fetchData(url, 'POST', payload);

                // Handle the result
                if (result) {
                    
                    // Success notification
                    showNotification({
                        message: `Updating documents...Please Wait...`,
                        backgroundColor: "#3498db", // Green
                        opacity: 90,
                        duration: 3000,
                        stackFromTop: false
                    });
                    
                    setTimeout(function() {
                        
                        window.scrollTo({
                            top: 0,
                            behavior: 'smooth' // Optional: adds smooth scrolling
                        });
                        
                        // Success notification
                        showNotification({
                            message: `Success: ${result.message}`,
                            backgroundColor: "#2ecc71", // Green
                            opacity: 90,
                            duration: 5000,
                            stackFromTop: false
                        });
                        console.log("Success:", result.message);
                        updateVariousLabels();
                    }, 1000);
                    
                    
                } else {
                    throw new Error("Unknown error or failed request");
                }
            } catch (error) {
                // Error notification
                showNotification({
                    message: `Error: ${error.message}`,
                    backgroundColor: "#e74c3c", // Red
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
                console.error("Error:", error);
            }
            showLoading(false);
        }

        
        
        
        

        async function setElementHashById(elementId, inputElementId = null) {
          let inputText = null;

          // If an inputElementId is provided, get the value from that element
          if (inputElementId) {
            const inputElement = document.getElementById(inputElementId);
            if (!inputElement) {
              console.error("Element not found with ID:", inputElementId);

              // Show error notification
              showNotification({
                message: `Element with ID '${inputElementId}' not found.`,
                backgroundColor: "#e74c3c",  // Red color for error
                opacity: 90,
                duration: 4000,
                stackFromTop: false
              });
              return;
            }

            // Get the value from the specified input element
            inputText = inputElement.value || inputElement.innerText;
          }

          // If no inputText from inputElementId, fallback to the element's content
          if (!inputText) {
            const element = document.getElementById(elementId);
            if (!element) {
              console.error("Element not found with ID:", elementId);

              // Show error notification
              showNotification({
                message: `Element with ID '${elementId}' not found.`,
                backgroundColor: "#e74c3c",  // Red color for error
                opacity: 90,
                duration: 4000,
                stackFromTop: false
              });
              return;
            }

            // Get the content of the element (you can modify this to grab innerText, value, etc.)
            inputText = element.value || element.innerText;
          }

          // Check if inputText is empty, show notification error and exit if true
          if (inputText.trim() === "") {
            showNotification({
              message: "Please input some text to generate a hash.",
              backgroundColor: "#e74c3c",  // Red color for error
              opacity: 90,
              duration: 4000,
              stackFromTop: false
            });
            return;  // Exit the function if input text is empty
          }

          // Generate hash of the input text (either from the input element or the element content)
          try {
            const encoder = new TextEncoder();
            const data = encoder.encode(inputText);  // Convert input string to Uint8Array
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);  // Generate SHA-256 hash
            const hashArray = Array.from(new Uint8Array(hashBuffer));  // Convert ArrayBuffer to byte array
            const hashHex = hashArray.map(byte => byte.toString(16).padStart(2, '0')).join('');  // Convert byte array to hex string

            // Get the element by ID and set the hash
            const element = document.getElementById(elementId);
            if (element) {
              // Check the element type (tagName) and set value or innerText accordingly
              if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                // For input fields or textareas, use value
                element.value = hashHex;
              } else {
                // For other elements (e.g., div, span), use innerText
                element.innerText = hashHex;
              }
            }

            console.log("Hash set to element:", hashHex);  // For debugging purposes

            // Show success notification
            showNotification({
              message: `Hash Generated`,
              backgroundColor: "#f1c40f",  // Yellow color for success
              opacity: 90,
              duration: 4000,
              stackFromTop: false
            });

          } catch (error) {
            console.error("Error generating hash:", error);

            // Show error notification
            showNotification({
              message: "Error generating hash. Please try again.",
              backgroundColor: "#e74c3c",  // Red color for error
              opacity: 90,
              duration: 4000,
              stackFromTop: false
            });
          }
        }


        
        
        
        

        function calculateTokensFromText(text) {
            if (typeof text !== 'string') {
                return 0; // If the input is not a string, return 0 tokens
            }

            // Tokenize by matching words, punctuation, and special characters
            const tokenPattern = /\w+|[.,!?;(){}\[\]<>":]/g;

            // Trim and match all tokens using the pattern
            const tokens = text.trim().match(tokenPattern);

            if (!tokens) {
                return 0; // If no tokens are found, return 0
            }

            let tokenCount = 0;

            // Iterate through each token
            for (let token of tokens) {
                // If the token's length is greater than 8 characters
                if (token.length > 8) {
                    // Simulate subword tokenization: Split the token into chunks of 8 characters
                    let subwords = [];
                    while (token.length > 8) {
                        subwords.push(token.slice(0, 8)); // Take the first 8 characters
                        token = token.slice(8); // Remove the first 8 characters
                    }
                    if (token.length > 0) {
                        subwords.push(token); // Add the remaining part (if any)
                    }
                    tokenCount += subwords.length; // Count each chunk as a separate token
                } else {
                    tokenCount++; // Otherwise, count the token normally
                }
            }

            return tokenCount;
        }
        
        
        

        function calculateTokens(passedTextID, passedLabelID) {
            // Get the HTML elements
            var passedText = document.getElementById(passedTextID);
            var passedLabel = document.getElementById(passedLabelID);

            // Get the text content from passedText (assuming it's an input or textarea element)
            var textContent = passedText.value || passedText.innerText; // This handles both input/textarea and other elements

            // Strip leading/trailing spaces and normalize text (optional)
            textContent = textContent.trim();

            // Tokenizer: Split the text into tokens (words + punctuation)
            var tokens = tokenizeText(textContent);

            // Add 5% to the token count and round up
            var adjustedTokenCount = Math.ceil(tokens.length * 1.05);

            // Update the label with the adjusted token count
            passedLabel.innerText = adjustedTokenCount;

            // Return the label element (optional)
            return passedLabel;
        }

        
        function tokenizeText(text) {
            // A basic tokenizer that splits on words, punctuation, and special cases
            var tokens = [];

            // First, handle the repeated character cases
            var repeatCharRegex = /([a-zA-Z])\1{1,}/g; // Match repeated characters like "mmm", "aaaa", etc.
            text = text.replace(repeatCharRegex, function(match) {
                // Split the repeated characters into pairs (or single if odd number of chars)
                var charPairs = [];
                for (var i = 0; i < match.length; i += 2) {
                    charPairs.push(match.substring(i, i + 2)); // Create pairs of 2 characters
                }
                return charPairs.join(' '); // Join pairs with space to treat each pair as a token
            });

            // Next, handle long words (longer than 8 characters), which need to be split into chunks of 8 characters
            var longWordRegex = /\b\w{9,}\b/g; // Match words longer than 8 characters
            text = text.replace(longWordRegex, function(match) {
                // Split the word into chunks of 8 characters
                var chunks = [];
                for (var i = 0; i < match.length; i += 4) {
                    chunks.push(match.substring(i, i + 4)); // Split into chunks of 8 characters
                }
                return chunks.join(' '); // Join chunks with space to treat each chunk as a token
            });

            // Now, split the text into tokens (words, punctuation, and spaces)
            var wordTokenRegex = /\w+|[^\w\s]/g; // Match words and punctuation
            var splitTokens = text.match(wordTokenRegex) || []; // Return array of tokens

            // Add the resulting tokens to our tokens array
            tokens = tokens.concat(splitTokens);

            return tokens;
        }

        
        
        
        
        function clearToolsTokenCounter() {
            // Ask the user for confirmation before clearing the counter
            const confirmClear = confirm("Are you sure you want to clear the token counter?");

            if (confirmClear) {
                // If the user confirms, clear the counter
                document.getElementById('page_tools_token_counter_textarea').value = '';
                document.getElementById('page_tools_token_counter_label').innerHTML = '0';
            }
            // If the user cancels, nothing happens
        }

        
        
        

        
        function generateEmbedding() {
            // Step 1: Get the text from the textarea element
            const inputText = document.getElementById("page_tools_embedding_textarea_text").value;

            // Step 2: Send the text to the server via a POST request
            fetch('/generate-embedding', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ text: inputText }), // Send the input text as JSON
            })
            .then(response => response.json())  // Parse the JSON response
            .then(data => {
                if (data.embedding) {
                    // Step 3: Display the embedding in the designated textarea
                    document.getElementById("page_tools_embedding_textarea_embedding").value = JSON.stringify(data.embedding);

                    // Show a success notification
                    showNotification({
                        message: "Embedding generated successfully!",
                        backgroundColor: "#2ecc71",  // Green for success
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                } else if (data.error) {
                    // Handle any errors from the server
                    alert("Error: " + data.error);

                    // Show an error notification
                    showNotification({
                        message: "Error: " + data.error,
                        backgroundColor: "#e74c3c",  // Red for error
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                }
            })
            .catch(error => {
                // Handle any network or other errors
                console.error("Error occurred:", error);
                alert("An error occurred while communicating with the server.");

                // Show an error notification for the network error
                showNotification({
                    message: "An error occurred while communicating with the server.",
                    backgroundColor: "#e74c3c",  // Red for error
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
            });
        }


        
        
        
        function clearToolsEmbeddingText() {
            var textarea = document.getElementById('page_tools_embedding_textarea_text');
            if (textarea) {
                // Ask for confirmation before clearing the text
                var confirmClear = confirm("Are you sure you want to clear the text?");
                if (confirmClear) {
                    textarea.value = '';  // Clear the text if user confirms
                }
            }
        }
        
        
        
        
        
        function clearToolsEmbedding() {
            var textarea = document.getElementById('page_tools_embedding_textarea_embedding');
            if (textarea) {
                // Ask for confirmation before clearing the text
                var confirmClear = confirm("Are you sure you want to clear the embedding?");
                if (confirmClear) {
                    textarea.value = '';  // Clear the text if user confirms
                }
            }
        }



        
        
        function toggleWrapperVisibility() {
            var radioButton = document.getElementById('search_filters_choice_gui_radio_button');
            var wrapperGUI = document.getElementById('page_search_document_filters_gui_wrapper');
            var wrapperFallback = document.getElementById('page_search_document_filters_fallback_wrapper');

            // Check if the checkbox is checked
            if (radioButton.checked) {
              wrapperGUI.style.display = 'block';  // Show the wrapper
              wrapperFallback.style.display = 'none';  // Show the wrapper
            } else {
              wrapperGUI.style.display = 'none';  // Hide the wrapper
              wrapperFallback.style.display = 'block';  // Hide the wrapper
            }
          }



        function clearToolsHashText() {
            var textarea = document.getElementById('page_tools_hash_text_textarea');
            if (textarea) {
                // Ask for confirmation before clearing the text
                var confirmClear = window.confirm('Are you sure you want to clear the text?');
                if (confirmClear) {
                    textarea.value = ''; // Clears the content of the textarea
                }
            }
        }
        
        



        function initializeCheckboxesForMetadata(){
            document.getElementById('page_collections_checkbox_include_metadata').checked = false;
            document.getElementById('page_adddocs_checkbox_include_metadata').checked = false;
            document.getElementById('page_updatedocs_checkbox_include_metadata').checked = false;
            
            toggleTextarea('page_collections_checkbox_include_metadata', 'page_collections_create_metadata');
            toggleTextarea('page_adddocs_checkbox_include_metadata', 'page_adddocs_document_metadata');
            toggleTextarea('page_updatedocs_checkbox_include_metadata', 'page_updatedocs_document_metadata');
        }

        
        
        
        
        
        
        

        function addGroupDocument() {
            const documentFilterParentContainer = document.getElementById('filter-parent-container-where-document');
            const newGroup = createGroupDocument(   );
            documentFilterParentContainer.appendChild(newGroup);
        }

        function createGroupDocument(){
            const group = document.createElement('div');
            group.classList.add('document-group');
            group.setAttribute('id', `document-group-${groupId++}`);
            
            // Use the same structure for both first and subsequent groups
            group.innerHTML = `
                <select class="document-operator-and-or">
                    <option value="$and">and</option>
                    <option value="$or">or</option>
                </select>
                <div class="document-nested-group-container"></div>
                <br>
                <button class="addNestedButton colourGreen">Add</button>
                <button class="clearNestedButton colourRed">Clear</button>
                <button class="addNestedGroupButton colourGreen">Add Group</button>
                <button class="removeGroupButton colourRed">Remove Group</button>
            `;
            
            // Add event listeners for nested actions
            const addNestedButton = group.querySelector('.addNestedButton');
            const addNestedGroupButton = group.querySelector('.addNestedGroupButton');
            const clearNestedButton = group.querySelector('.clearNestedButton');
            const removeGroupButton = group.querySelector('.removeGroupButton');

            addNestedButton.addEventListener('click', () => addNestedCondition(group));
            addNestedGroupButton.addEventListener('click', () => addNestedGroup(group));
            clearNestedButton.addEventListener('click', () => clearNestedConditions(group));
            removeGroupButton.addEventListener('click', () => removeGroup(group));
            
            return group;
        }

        // Function to add a nested condition (contains/not_contains with a string input)
        function addNestedCondition(group) {
            const nestedContainer = group.querySelector('.document-nested-group-container');
            const nestedCondition = document.createElement('div');
            nestedCondition.classList.add('condition-wrapper');
            nestedCondition.innerHTML = `
                <select class="operator document-operator-contains">
                    <option value="$contains">contains</option>
                    <option value="$not_contains">not_contains</option>
                </select>
                <input type="text" class="string-value" placeholder="Enter string">
                <button class="removeNestedButton">x</button>
            `;

            nestedContainer.appendChild(nestedCondition);

            nestedCondition.querySelector('.removeNestedButton').addEventListener('click', () => {
                nestedContainer.removeChild(nestedCondition);
            });
        }

        // Function to clear nested conditions with confirmation
        function clearNestedConditions(group) {
            // Ask the user for confirmation before clearing the nested conditions
            const confirmation = confirm("Are you sure you want to clear ALL nested conditions for this group?")

            // If the user confirms, clear the nested conditions
            if (confirmation) {
                const nestedContainer = group.querySelector('.document-nested-group-container');
                nestedContainer.innerHTML = '';
            }
        }

        // Function to add a nested group (with $and or $or operator)
        function addNestedGroup(group) {
            const nestedContainer = group.querySelector('.document-nested-group-container');
            const nestedGroup = createGroupDocument();
            nestedContainer.appendChild(nestedGroup);
        }

        // Function to remove a group with confirmation
        function removeGroup(group) {
            // Ask the user for confirmation before proceeding
            const confirmation = confirm("Are you sure you want to remove this group?");

            // If the user confirms, remove the group
            if (confirmation) {
                group.parentElement.removeChild(group);
            }
        }

        

        
        

        
        function query_getWhereDocumentFilters() {
            const groups = document.querySelectorAll('.document-group');
            const result = [];

            groups.forEach(group => {
                const operator = group.querySelector('.document-operator-and-or')?.value;
                if (operator) {
                    const nestedConditions = group.querySelector('.document-nested-group-container');
                    const nestedArray = [];

                    nestedConditions.querySelectorAll('.condition-wrapper').forEach(nestedCondition => {
                        const nestedOperator = nestedCondition.querySelector('.operator.document-operator-contains')?.value;
                        const nestedValue = nestedCondition.querySelector('.string-value')?.value;
                        if (nestedOperator && nestedValue) {
                            nestedArray.push({ [nestedOperator]: nestedValue });
                        }
                    });

                    nestedConditions.querySelectorAll('.document-group').forEach(nestedGroup => {
                        const nestedGroupOperator = nestedGroup.querySelector('.document-operator-and-or')?.value;
                        const nestedGroupConditions = [];

                        nestedGroup.querySelectorAll('.condition-wrapper').forEach(nestedCondition => {
                            const nestedOperator = nestedCondition.querySelector('.operator.document-operator-contains')?.value;
                            const nestedValue = nestedCondition.querySelector('.string-value')?.value;
                            if (nestedOperator && nestedValue) {
                                nestedGroupConditions.push({ [nestedOperator]: nestedValue });
                            }
                        });

                        if (nestedGroupOperator && nestedGroupConditions.length) {
                            nestedArray.push({ [nestedGroupOperator]: nestedGroupConditions });
                        }
                    });

                    if (nestedArray.length) {
                        result.push({ [operator]: nestedArray });
                    }
                }
            });

            // Simplify the result
            const simplifiedResult = simplifyWhereDocument(result);
            /*
            // Directly check if the simplified result has a $and or $or operator with only one condition
            if (simplifiedResult.length === 1) {
                const firstItem = simplifiedResult[0];
                const operator = Object.keys(firstItem)[0]; // This should be $and or $or
                const conditions = firstItem[operator];
                
                // If it's $and or $or with only one condition, log a warning
                if ((operator === '$and' || operator === '$or') && conditions.length === 1) {
                    console.warn(`Warning: The operator "${operator}" has only one condition, which may cause an error or unexpected behavior.`, firstItem);
                }
            }
            */
        
            // If simplifiedResult is an array with just one item, remove the array
            let simplifiedResultWithoutArrayWrap = simplifiedResult;
            if (Array.isArray(simplifiedResult) && simplifiedResult.length === 1) {
                simplifiedResultWithoutArrayWrap = simplifiedResult[0]; // Get the first item from the array
            }
        
            //console.log("where_document Filters simplifiedResult WITH array wrap:\n" + JSON.stringify(simplifiedResult, null, 2));
            console.log("where_document Filters WITHOUT array wrap:\n" + JSON.stringify(simplifiedResultWithoutArrayWrap, null, 2));
        
            return  simplifiedResultWithoutArrayWrap;  // Return the simplified result
        }
        
        
        
        
        
        
        
        function simplifyWhereDocument(result) {
            // Perform simplification first
            if (result.length === 1) {
                const firstItem = result[0];
                const operator = Object.keys(firstItem)[0]; // This should be $and or $or
                const conditions = firstItem[operator];

                // Check if the operator is either $and or $or and the condition list has only one item
                if ((operator === '$and' || operator === '$or') && conditions.length === 1) {
                    const firstCondition = conditions[0];

                    // Check if the child condition has only a single key-value pair (either $contains or $not_contains)
                    const conditionKeys = Object.keys(firstCondition);
                    if (conditionKeys.length === 1 && (conditionKeys[0] === '$contains' || conditionKeys[0] === '$not_contains')) {
                        // Return simplified result by returning the condition directly instead of wrapping it in an array
                        return firstCondition;
                    }
                }
            }

            
            // Check if any operator has only 1 child, if so, duplicate it
            if (result.length >= 1) {
                for (let i = 0; i < result.length; i++) {
                    const rootItem = result[i];
                    const operator = Object.keys(rootItem)[0]; // This should be $and or $or
                    const conditions = rootItem[operator];

                    if (conditions && conditions.length === 1) {
                        // If there's only one child, duplicate it
                        const singleCondition = conditions[0];
                        conditions.push(JSON.parse(JSON.stringify(singleCondition))); // Duplicate the condition
                    }
                }
            }

            // If no simplification occurred, return the result as is
            return result;
        }

        
        
        function handleArrayWrapper(input) {
            // Parse the input string back into an object (or array of objects)
            const parsedInput = JSON.parse(input);

                // If it's an array with one element, return that element
                return parsedInput[0];
    
        }


        
        
        function toggleCheckboxBasedOnDisplay() {
            // Get the checkbox element by ID
            const checkbox = document.getElementById('page_search_checkbox_enable_filter');

            // Get the wrapper element by ID
            //const wrapper = document.getElementById('page_search_document_filters_gui_wrapper');
            const wrapper = document.getElementById('page_search_document_filters_fallback_wrapper');

            // Check the display style of the wrapper
            if (wrapper.style.display === 'block') {
                // If display is block, tick the checkbox
                checkbox.checked = true;
            } else if (wrapper.style.display === 'none') {
                // If display is none, untick the checkbox
                checkbox.checked = false;
            }
        }
        
        
        
        
        
        
    function updateChosenFilenameAndExt(){
        const fileInput = document.getElementById('file_upload_input_tag');
        const file = fileInput.files[0];

        const filenameLabel = document.getElementById('data_file_upload_info_label_file_value');
        filenameLabel.textContent = file.name;

        const fileExtension = file.name.split('.').pop().toLowerCase();
        const extensionLabel = document.getElementById('data_file_upload_info_label_extension_value');
        extensionLabel.textContent = fileExtension;
    }
      

      
    function clickHiddenFileInput(){
        const progressBar = document.getElementById('data_file_upload_progress_bar');
        progressBar.style.width = '0%'; // Reset progress bar
        document.getElementById('file_upload_input_tag').click();
    }
      
      
    function handleFileUpload() {
      const fileInput = document.getElementById('file_upload_input_tag');
      const file = fileInput.files[0];
      const errorMessage = document.getElementById('data_file_upload_error_message');
      const filenameLabel = document.getElementById('data_file_upload_info_label_file_value');
      const extensionLabel = document.getElementById('data_file_upload_info_label_extension_value');
      const recordCountLabel = document.getElementById('imported_record_count_label_value');
      const progressBar = document.getElementById('data_file_upload_progress_bar');
      const progressContainer = document.getElementById('data_file_upload_progress_container');

      progressBar.style.width = '0%'; // Reset progress bar

      // Reset error message
      errorMessage.textContent = '';
      errorMessage.classList.remove('show');

      if (!file) {
        errorMessage.textContent = 'Please select a file to upload.';
        errorMessage.classList.add('show');
        return;
      }

      const allowedExtensions = ['csv', 'json', 'txt'];
      const fileExtension = file.name.split('.').pop().toLowerCase();

      if (allowedExtensions.includes(fileExtension)) {
        // Update labels with file information
        filenameLabel.textContent = file.name;
        extensionLabel.textContent = fileExtension;

        // Show progress bar
        progressContainer.style.display = 'block';
        progressBar.style.width = '0%'; // Reset progress bar

        // Read and parse the file based on its extension
        if (fileExtension === 'txt') {
          readTextFile(file, progressBar);
        } else if (fileExtension === 'csv') {
          parseCSV(file, progressBar);
        } else if (fileExtension === 'json') {
          parseJSON(file, progressBar);
        }

      } else {
        errorMessage.textContent = 'Invalid file type. Only .json files are allowed.';
        errorMessage.classList.add('show');
      }
    }

      
      /*
    function readTextFile(file, progressBar) {
      const reader = new FileReader();
      const errors = []; // Array to track any error lines

      reader.onload = function(event) {
        const content = event.target.result;
        const lines = content.split('\n').filter(line => line.trim() !== '');

        // Update record count
        document.getElementById('imported_record_count_label_value').textContent = lines.length;

        // Populate the table with data
        const tableBody = document.getElementById('file-data-table').getElementsByTagName('tbody')[0];
        tableBody.innerHTML = ''; // Clear existing table data

        let currentLine = 1; // Line counter for progress bar
        lines.forEach((line, index) => {
          try {
            // Handle each line (add ID and Metadata columns)
            const row = tableBody.insertRow();
            row.innerHTML = 
              `<td>${index + 1}</td>
              <td>txtdoc_id_${index + 1}</td>
              <td>${line}</td>
              <td>No Metadata</td>`;

            // Update progress bar based on the current line
            const progress = ((currentLine++) / lines.length) * 100;
            progressBar.style.width = progress + '%';
          } catch (error) {
            errors.push(`Error processing line ${index + 1}: ${line}`);
          }
        });

        // Re-enable scrolling once the import is done
        document.body.classList.remove('no-scroll');

        // Log any errors if they occurred
        if (errors.length > 0) {
          alert('There were errors processing the following lines:\n' + errors.join('\n'));
        }
      };

      // Start reading the file
      reader.readAsText(file);
    }

      
      
    function parseCSV(file, progressBar) {
      const reader = new FileReader();
      const errors = []; // Array to track any error lines

      // Disable page scrolling during import
      document.body.classList.add('no-scroll');

      reader.onload = function(event) {
        const fileContent = event.target.result;
        const lines = fileContent.split('\n').filter(line => line.trim() !== ''); // Remove empty lines

        // Ensure there are lines to process
        if (lines.length === 0) {
          alert("ERROR: The CSV file is empty or cannot be read properly.");
          return;
        }

        const headers = lines[0].split(',').map(header => header.trim());

        // Validate headers
        if (headers.length !== 3 || headers[0].toLowerCase() !== 'id' || headers[1].toLowerCase() !== 'document' || headers[2].toLowerCase() !== 'metadata') {
          alert('ERROR: Invalid CSV format.\nExpected headers:\nid, document, metadata.\nReceived headers:\n' + 
                (headers[0] || 'undefined') + ', ' + 
                (headers[1] || 'undefined') + ', ' + 
                (headers[2] || 'undefined'));
          return;
        }

        // Count records (excluding header)
        const recordCount = lines.length - 1; // minus 1 for the header row
        document.getElementById('imported_record_count_label_value').textContent = recordCount;

        // Populate the table with data
        const tableBody = document.getElementById('file-data-table').getElementsByTagName('tbody')[0];
        tableBody.innerHTML = ''; // Clear existing table data

        let currentLine = 1; // Line counter starts from the second line (after headers)

        lines.slice(1).forEach((line, index) => {
          const fields = line.split(',').map(item => item.trim());

          // Skip lines that don't have exactly 3 fields or are empty
          if (fields.length !== 3) {
            errors.push(`Invalid record at line ${index + 2}: ${line}`);
            return;
          }

          const [id, document, metadata] = fields;

          // Insert the row into the table
          const row = tableBody.insertRow();
          row.innerHTML = 
            `<td>${index + 1}</td>
            <td>${id}</td>
            <td>${document}</td>
            <td>${metadata}</td>`;

          // Update progress bar based on number of lines processed
          const progress = (currentLine/ recordCount) * 100;
          progressBar.style.width = progress + '%';
          currentLine++; // Increment line counter
        });

        // Re-enable scrolling once the import is done
        document.body.classList.remove('no-scroll');

        // Log errors if there are any
        if (errors.length > 0) {
          alert('There were errors in the following lines:\n' + errors.join('\n'));
        }
      };

      // Start reading the file
      reader.readAsText(file);
    }
*/
        
        
        
        
    function parseJSON(file, progressBar) {
      const reader = new FileReader();
      const errors = []; // Array to track any error lines

      reader.onload = function(event) {
        try {
          const fileContent = event.target.result;
          const jsonData = JSON.parse(fileContent);

          if (!Array.isArray(jsonData)) {
            alert('ERROR: Invalid JSON format.\nExpected an array of records.\nReceived: ' + typeof jsonData);
            return;
          }

          const recordCount = jsonData.length;
          document.getElementById('imported_record_count_label_value').textContent = recordCount;

          // Populate the table with data
          const tableBody = document.getElementById('file-data-table').getElementsByTagName('tbody')[0];
          tableBody.innerHTML = ''; // Clear existing table data

          let currentLine = 1; // Line counter for progress bar
          jsonData.forEach((record, index) => {
            try {
              // Convert all keys to lowercase
              const lowerCaseRecord = Object.fromEntries(
                Object.entries(record).map(([key, value]) => [key.toLowerCase(), value])
              );

              // Handle each record with lowercase keys
              const row = tableBody.insertRow();
              row.innerHTML = 
                `<td>${index + 1}</td>
                 <td>${lowerCaseRecord.id}</td>
                 <td>${lowerCaseRecord.document}</td>
                 <td>${JSON.stringify(lowerCaseRecord.metadata)}</td>`;

              // Update the progress bar based on records processed
              const progress = (currentLine++ / recordCount) * 100;
              progressBar.style.width = progress + '%';
            
                
            } catch (error) {
              errors.push(`Error processing record at index ${index + 1}: ${JSON.stringify(record)}`);
            }
          });

            showNotification({
                message: `${recordCount} rows Loaded into Table`,
                backgroundColor: "#2ecc71",
                opacity: 90,
                duration: 4000,
                stackFromTop: false
            });
            
          // Log any errors if they occurred
          if (errors.length > 0) {
            alert('There were errors processing the following records:\n' + errors.join('\n'));
          }

        } catch (error) {
          alert('ERROR: Error parsing JSON file. Please ensure it is a valid JSON format.');
        }
      };

      // Start reading the file
      reader.readAsText(file);
    }
        
        
        


    function checkImportedRecordCount() {
        // Get the value of the imported_record_count_label element
        var recordCountText = document.getElementById('imported_record_count_label').textContent.trim();

        // Clean up the value by removing any non-numeric characters if necessary (just in case)
        var cleanedText = recordCountText.replace(/[^0-9]/g, ''); // removes any non-digit characters

        // Try to parse the cleaned value as an integer
        var recordCount = parseInt(cleanedText, 10);

        // Check if the parsed value is a valid integer and equals zero
        if (isNaN(recordCount) || recordCount === 0) {
            return false; // Return false when no valid records
        } else {
            return true; // Return true when records are valid
        }
    }

      
      

    function resetTableAndFileInput() {
        
        if (checkImportedRecordCount() == false){
            // Show an error notification if something goes wrong
            showNotification({
                message: "No records to clear - Upload a File, then retry",
                backgroundColor: "#f39c12", // Red for error
                opacity: 90,
                duration: 2000,
                stackFromTop: false
            });
            
            return;
        }
        
        // Show a confirmation dialog before proceeding
        const isConfirmed = confirm("Are you sure you want to reset then 'Table' and 'Input File'?");

        if (!isConfirmed) {
            return; // Exit the function if the user cancels
        }

        try {
             // Reset Progress Bar
            const progressBar = document.getElementById('data_file_upload_progress_bar');
            progressBar.style.width = '0%'; // Reset progress bar

            // Assuming you reset the table and file input here
            const table = document.querySelector('#file-data-table tbody');
            const fileInput = document.querySelector('#file-input');  // Modify the selector to match your file input element

            // Clear the table rows
            table.innerHTML = '';

            // Reset the file input
            if (fileInput) {
                fileInput.value = ''; // Clear file input field
            }

            // Show a success notification
            showNotification({
                message: "Table and Data File have been reset",
                backgroundColor: "#3498db", 
                opacity: 90,
                duration: 4000,
                stackFromTop: false
            });

            document.getElementById('data_file_upload_info_label_file_value').innerHTML = "None";
            document.getElementById('data_file_upload_info_label_extension_value').innerHTML = "None";
            document.getElementById('imported_record_count_label_value').innerHTML = "0";

            console.log('Table and file input reset successfully.');
        } catch (error) {
            // Show an error notification if something goes wrong
            showNotification({
                message: "Error occurred while resetting table and file input.",
                backgroundColor: "#e74c3c", // Red for error
                opacity: 90,
                duration: 4000,
                stackFromTop: false
            });

            console.error('Error during table and file input reset:', error);
        }
    }





     async function importDataToChroma(){
            // Select the <select> element
            var selectElement = document.getElementById("page_import_collection_dropdown");

            // Check if the <select> element is empty
            if (selectElement && selectElement.options.length === 0) {
                console.log("No Collection Selected to add Document to - Create Collection first");
                
                showNotification({
                    message: "No Collection Selected - Create/Select a Collection first",
                    backgroundColor: "#e74c3c", // Red background for error
                    opacity: 90,
                    duration: 8000,
                    stackFromTop: false
                });
                
                return;
            } 
         
           if (checkImportedRecordCount() == false){

                // Show an error notification if something goes wrong
                showNotification({
                    message: "No records to Import - Upload a JSON first",
                    backgroundColor: "#f39c12", // Red for error
                    opacity: 90,
                    duration: 2000,
                    stackFromTop: false
                });

                return;

            } else {
            // If records are found, proceed with import
                
                // Show an error notification if something goes wrong
                showNotification({
                    message: "Importing... Please Wait...",
                    backgroundColor: "#3498db", 
                    opacity: 90,
                    duration: 5000,
                    stackFromTop: false
                });
                
                showLoading(true);
                await submitTableData();
           }
      }




        async function submitTableData() {
            
            // Get collection Batch Limit 
            var collectionBatchLimitElem = document.getElementById('page_import_labels_batch_size_window').textContent.trim();
            let numberString = collectionBatchLimitElem.split(':')[1].trim(); // Extract the number after the colon
            var collectionBatchLimit = parseInt(numberString, 10);

            // Get Import Batch Number 
            var importBatchLimit = parseInt(document.getElementById('page_import_batch_size_dropdown').value, 10);


            // Check if Import Batch Limit is greater than Collection Batch Limit
            if (importBatchLimit > collectionBatchLimit) {
                console.log("Import batch limit is greater than collection batch limit. Checking user's decision...");

                var userResponse = confirm("The import batch size is greater than the collection batch limit.\nContinue anyway?");
                console.log("User response to continue: " + userResponse);

                if (!userResponse) {
                    // Ask if they want to reduce the batch size
                    console.log("User selected 'No'. Asking if they want to reduce batch size...");
                    var reduceBatchSizeResponse = confirm("How about reducing the import batch size\nand continue with those settings instead?");
                    console.log("User response to reduce batch size: " + reduceBatchSizeResponse);

                    if (reduceBatchSizeResponse) {
                        
                      showNotification({
                            message: "Import Batch size Reduced.",
                            backgroundColor: "#2ecc71", 
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });
                        
                        // If user selects "Yes", adjust the value to the nearest value in the dropdown
                        console.log("User wants to reduce batch size. Finding the closest valid value...");
                        var options = Array.from(document.getElementById('page_import_batch_size_dropdown').options);
                        var closestValue = null;

                        // Loop through options to find the largest value <= collectionBatchLimit
                        for (var i = options.length - 1; i >= 0; i--) {
                            var optionValue = parseInt(options[i].value, 10);
                            console.log("Checking option value: " + optionValue);
                            if (optionValue <= collectionBatchLimit) {
                                closestValue = optionValue;
                                console.log("Found closest value: " + closestValue);
                                break;
                            }
                        }

                        // If we found a valid closest value, update the dropdown value
                        if (closestValue !== null) {
                            console.log("Updating dropdown value to closest value: " + closestValue);
                            document.getElementById('page_import_batch_size_dropdown').value = closestValue;
                            importBatchLimit = closestValue;  // Update importBatchLimit
                        } else {
                            console.log("No valid value found to reduce to.");
                        }
                    } else {
                        // If the user says "No" to reducing batch size, abort everything
                        console.log("User declined to reduce batch size. Aborting process.");
                        showNotification({
                            message: "Data Import was Cancelled.",
                            backgroundColor: "#e74c3c", // Red for error/aborted
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });
                        return; // Exit and stop further execution
                    }
                }
            } else {
                var userConfirmBeforeImport = confirm("Are you sure you want to Import the uploaded Data?");
                if (!userConfirmBeforeImport) {

                    showNotification({
                        message: "Data Import was Cancelled.",
                        backgroundColor: "#e74c3c", // Red for error/aborted
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    
                    return
                }
            }
            
            
            // Get the collection name from the dropdown at the top of the function
            var collectionName = "";
            var tempselect = document.getElementById('page_search_collection_dropdown');

            // Check if a valid selection exists
            if (tempselect.selectedIndex >= 0) {
                collectionName = tempselect.options[tempselect.selectedIndex].text;
            }

            // If collectionName is null or empty, show an error notification and exit early
            if (!collectionName) {
                showNotification({
                    message: "Please select a valid collection!",
                    backgroundColor: "#e74c3c", // Red for error
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
                console.error("Collection name is required but was not selected.");
                return; // Exit the function early if no collection name is selected
            }

            // Get all rows of the table except the header
            const rows = document.querySelectorAll('#file-data-table tbody tr');
            const records = [];

            // Loop through each row and collect the data
            rows.forEach(row => {
                const id = row.querySelector('td:nth-child(2)').textContent.trim();
                const document = row.querySelector('td:nth-child(3)').textContent.trim();
                const metadata = row.querySelector('td:nth-child(4)').textContent.trim();

                // Handle metadata and convert to an object if it's a valid JSON string
                let metadataObject = {};
                if (metadata) {
                    try {
                        // Try parsing the metadata as JSON
                        metadataObject = JSON.parse(metadata);
                    } catch (e) {
                        // If parsing fails, log an error and handle the case where it's not valid JSON
                        console.error("Invalid metadata JSON:", metadata);
                        // Optionally, handle the invalid JSON case (e.g., use empty object, notify user, etc.)
                        metadataObject = {};  // Fallback to an empty object if parsing fails
                    }
                }

                // Create the record
                const record = {
                    id: id,
                    document: document,
                    metadata: Object.keys(metadataObject).length > 0 ? metadataObject : {} // Ensure non-empty dict
                };

                records.push(record);
            });
            
            // Re-get the import batch size, in case its cahnges up until now 
            var confirmedImportBatchLimit  = parseInt(document.getElementById('page_import_batch_size_dropdown').value, 10)

            // Construct the final JSON object with the collection name
            const jsonData = {
                records: records,
                collection_name: collectionName,
                batch_limit: importBatchLimit 
            };

            // Print the JSON object to the console (for debugging purposes)
            //console.log(jsonData);

            try {
                // Send the data to the Flask API using your fetchData function
                const response = await fetchData('/import-data-file', 'POST', jsonData);

                // Check the response and show the appropriate notification
                if (response && response.message) {
                    
                    // THIS IS WHEN DATA HAS FINISHED IMPORTING 
                    showNotification({
                        message: "Data Import Successful",
                        backgroundColor: "#2ecc71", // Green for success
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    console.log('Success:', response.message);
                    showLoading(false);
                    updateCollectionDocumentCount();
                    window.scrollTo({
                      top: 0,
                      left: 0,
                      behavior: 'smooth'
                    });
                    
                }
            } catch (error) {
                // Show an error notification
                showNotification({
                    message: "Error during data submission. Please try again!",
                    backgroundColor: "#e74c3c", // Red for error
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
                console.error('Error during data submission:', error);
            }
            
            
        }

        
        
        
        
        function setDefaultBatchsizeBUGFIX100Docs(){
            document.getElementById("page_settings_enable_bugix_batch_sizes_checkbox").checked = true;
            document.getElementById("page_settings_bugfix_batch_sizes_selecttag").value = 50000;
        }
        
        
        
        function confirmSaveChangesOnBugFixCheckbox(){
            if (confirm("Save changes to Settings?")) {
                // Code to save changes
                console.log("Changes saved.");
                bugFIX100Docs_DisbaleBatchSizes();
                saveAppSettingsJSON();
            } else {
                // Code if changes are not saved
                console.log("Changes not saved.");
                bugFIX100Docs_DisbaleBatchSizes();
            }
        }
        
        

        function bugFIX100Docs_DisbaleBatchSizes() {
            // Get the input element, select element, and checkbox element by their IDs
            var inputElement = document.getElementById('page_collections_create_batch_size');
            var selectElement = document.getElementById('page_settings_bugfix_batch_sizes_selecttag');
            var checkboxElement = document.getElementById('page_settings_enable_bugix_batch_sizes_checkbox');
            var disabledBatchSizeLabelBUGFIX100Docs = document.getElementById('bugfix100docDisabledLabel');

            // Check if the checkbox is checked
            if (checkboxElement.checked) {
                // Disable the input element to prevent user interaction
                inputElement.disabled = true;
                
                // show the disabled label
                disabledBatchSizeLabelBUGFIX100Docs.style.display = "inline-block";

                // Set the value of the input to the selected value of the select element
                inputElement.value = selectElement.value;

                // Add visual indication that the input is disabled
                inputElement.style.backgroundColor = '#e0e0e0'; // light gray background
                inputElement.style.opacity = '0.6'; // slightly transparent
                inputElement.style.color = '#a0a0a0'; // light gray text color
            } else {
                // Enable the input element to allow user interaction
                inputElement.disabled = false;
                

                // hide the disabled label
                disabledBatchSizeLabelBUGFIX100Docs.style.display = "none";
                
                // Remove the visual indication of being disabled
                inputElement.style.backgroundColor = ''; // reset to normal state
                inputElement.style.opacity = '1'; // fully visible
                inputElement.style.color = ''; // reset text color
            }
        }


        
        
        
        function clearViewDocumentsTableBody(){
            // Get the table body using its parent table's ID
            var tableBody = document.querySelector('#page_documents_table tbody');

            // If the tbody exists, remove all its child rows
            if (tableBody) {
                tableBody.innerHTML = ''; // This clears all rows inside tbody
            }   
        }
        
        
        
        
        
        function pressEnterToApplyDocFilter(){
            // Check if the pressed key is Enter (key code 13)
            if (event.key === 'Enter') {
              // Prevent the default action (form submission or other)
              event.preventDefault();

              // Call the applyFilter function
              applyFilter();
            }
        }






        async function fetchCollectionOverview() {
            try {
                // Fetch collection overview data from Flask endpoint
                const data = await fetchData('/get-collection-overview');

                // Get the table element where we will populate the rows
                const tableBody = document.querySelector('.collection_overview_table tbody');

                // Clear any existing rows in the table
                tableBody.innerHTML = '';

                // Check if the data is valid
                if (data.status === 'success' && data.collections.length > 0) {
                    // Sort collections by name in alphabetical order
                    data.collections.sort((a, b) => a.name.localeCompare(b.name));

                    let rowIndex = 1; // Row counter to show row number
                    data.collections.forEach((collection) => {
                        // Create a new row
                        const row = document.createElement('tr');

                        // Create the row cells and fill them with data
                        const cellRow = document.createElement('td');
                        cellRow.textContent = rowIndex++; // Row number
                        row.appendChild(cellRow);

                        const cellId = document.createElement('td');
                        cellId.textContent = collection.id; // Collection ID
                        row.appendChild(cellId);

                        const cellName = document.createElement('td');
                        cellName.textContent = collection.name; // Collection Name
                        row.appendChild(cellName);

                        const cellDocCount = document.createElement('td');
                        cellDocCount.textContent = collection.document_count; // Document Count
                        row.appendChild(cellDocCount);

                        // Append the row to the table body
                        tableBody.appendChild(row);
                    });

                    // Show a success notification
                    /*
                    showNotification({
                        message: "Collection Overview Table Populated",
                        backgroundColor: "#3498db", // Green success color
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    */
                } else {
                    // If there are no collections or an error occurred in the data
                    const row = document.createElement('tr');
                    const cell = document.createElement('td');
                    cell.colSpan = 4; // Span across all columns
                    cell.textContent = 'No collections found or error retrieving data.';
                    row.appendChild(cell);
                    tableBody.appendChild(row);

                }
            } catch (error) {
                console.error("Error fetching collection overview:", error);

                // Handle errors (clear the table and show error message)
                const tableBody = document.querySelector('.collection_overview_table tbody');
                tableBody.innerHTML = ''; // Clear any existing rows
                const row = document.createElement('tr');
                const cell = document.createElement('td');
                cell.colSpan = 4;
                cell.textContent = 'Error loading data. Please try again later.';
                row.appendChild(cell);
                tableBody.appendChild(row);

            }
        }


        
        
        
        // DATA GENERATOR FUNCTIONS - START
        // =================================================================
        function generateSyntheticData() {
            
            const startRecord = parseInt(startRecordInput.value, 10);
            const endRecord = parseInt(endRecordInput.value, 10);
            let output = '';
            output = generateSyntheticJSON(startRecord, endRecord);
            outputTextarea.value = output;
            
            showNotification({
              message: "Synthetic JSON Generated",
              backgroundColor: "#2ecc71",
              opacity: 90,
              duration: 4000,
              stackFromTop: false
            });
        }
        
        

        function generateSyntheticText(start, end) {
            let text = '';
            const filename = document.getElementById('generate_data_filename_input').value; // Get filename input
            for (let i = start; i <= end; i++) {
                text += `this is generated test text ${i}\n`; // Append the data
            }
            return text;
        }



        function generateSyntheticCSV(start, end) {
            let csv = '';
            const filename = document.getElementById('generate_data_filename_input').value; // Get filename input
            for (let i = start; i <= end; i++) {
                csv += `${i}, this is generated csv text, this is generated csv metadata ${i}\n`; // Append the data
            }
            return csv;
        }

        
        
        function generateSyntheticJSON(start, end) {
            var jsonDocumentTextString = document.getElementById('document_text_for_autogen_json').value;
            var jsonIDString = document.getElementById('document_id_for_autogen_json').value;
            const jsonArray = [];
            for (let i = start; i <= end; i++) {
                const jsonObject = {
                    id: `${jsonIDString}${i}`,
                    document: `${jsonDocumentTextString}${i}`,
                    metadata: {
                        key: `value ${i}`,
                        additionalInfo: `info for ${i}`,
                    },
                };
                jsonArray.push(jsonObject);
            }
            return JSON.stringify(jsonArray, null, 2);
        }

        
        
        
        function copyGeneratedTextToClipboard() {
            outputTextarea.select();
            document.execCommand('copy');
            
            showNotification({
              message: "Copied Generated JSON to Clipboard",
              backgroundColor: "#9b59b6",
              opacity: 90,
              duration: 4000,
              stackFromTop: false
            });
            
        }
        
        

        
        function saveGeneratedDataToFile() {
            // Check if the output textarea is empty
            const outputContent = outputTextarea.value;
            if (!outputContent.trim()) {
                alert("There is no content to save! Please generate some data first.");
                return; // Stop execution if there's no content
            }

            // Re-generate data first just in case (optional, could be skipped if data is already generated)
            generateSyntheticData();

            const recordCount = getGeneratedDataCount();
            const filenameInput = document.getElementById('generate_data_filename_input').value; // Get filename input
            let fileExtension;
            let mimeType;

            fileExtension = '.json';
            mimeType = 'application/json';

            // Create a Blob from the content
            const blob = new Blob([outputContent], { type: mimeType });
            const url = URL.createObjectURL(blob);

            // Create an anchor element to trigger the download
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filenameInput}_rows_${recordCount}${fileExtension}`; // Use the filename input

            // Append the anchor element to the document and trigger the click to start the download
            document.body.appendChild(a);
            a.click();

            // Clean up the created URL object
            URL.revokeObjectURL(url);
        }

        
        
        function setInitialValuesForDataGenerator(){
            // Select .txt to start / 1st option
            document.querySelector('input[name="data-type"]').checked = true;

            // set filename text 
            document.getElementById('generate_data_filename_input').value = 'auto_gen_data';

            const recordFrom = document.getElementById('start-record');
            const recordTo = document.getElementById('end-record');
            recordFrom.value = 1;
            recordTo.value = 5;
            document.getElementById('recordCountLabel').innerHTML = 0;

            // clear textarea
            document.getElementById('generatedJSONOutputTextarea').value = "";

            // resetID
            document.getElementById('document_id_for_autogen_json').value = "";

            // resetID
            document.getElementById('document_text_for_autogen_json').value = "auto Generated text for Json Data Testing";
        }



        
        
        function getGeneratedDataCount() {
            const recordFrom = document.getElementById('start-record');
            const recordTo = document.getElementById('end-record');
            fromNum = parseInt(recordFrom.value, 10);
            toNum = parseInt(recordTo.value, 10);
            
            if (toNum - fromNum <= 0){
                document.getElementById('recordCountLabel').innerHTML = 0;
                return 0
            } else {
                document.getElementById('recordCountLabel').innerHTML = toNum - fromNum;
                return toNum - fromNum;
            }
        }
        
        // DATA GENERATOR FUNCTIONS - END
        // =================================================================
        
        
        
        
        
        

        function showCloneCollectionModal() {
            const modal = document.getElementById('clone_collection_modal_wrap');
            modal.style.display = 'block';  // Ensure it's in the flow of the page before starting the fade
            setTimeout(() => {
                modal.classList.add('show');  // Trigger the fade-in
            }, 10);  // Small delay to ensure the browser renders the display change first
        }

        function hideCloneCollectionModal() {
            const modal = document.getElementById('clone_collection_modal_wrap');
            modal.classList.remove('show');  // Trigger the fade-out
            setTimeout(() => {
                modal.style.display = 'none';  // Hide the modal after the fade-out transition
            }, 500);  // Match this time to the fade-out duration
        }

        
        

        
        // Function to handle the cloning of the collection
        async function cloneCollection() {
            
            showLoading(true);

            // Get the current collection name from the dropdown
            var collectionName = "";
            var tempselect = document.getElementById('page_search_collection_dropdown');

            // Check if a valid selection exists
            if (tempselect.selectedIndex >= 0) {
                collectionName = tempselect.options[tempselect.selectedIndex].text;
            }

            // Get the new collection name from the input field
            var newCollectionName = document.getElementById('page_collections_clone_collection_new_name_input').value.trim();

            // Ensure both the collection names are provided
            if (!collectionName || !newCollectionName) {
                showNotification({
                    message: "Please select a collection and enter a new name.",
                    backgroundColor: "#e74c3c",
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
                return;
            }
            
            
            var cloneBatchSize = parseInt(document.getElementById('page_collections_clone_batch_size_dropdown').value, 10);

            
            // Show confirmation dialog before proceeding
            var confirmClone = confirm(`Are you sure you want to clone all data and configuration from:\n'${collectionName}'\n\nInto a new collection called:\n'${newCollectionName}'`);

            // If user cancels, stop the function execution
            if (!confirmClone) {
                showNotification({
                    message: "User cancelled Clone Operation",
                    backgroundColor: "#3498db", 
                    opacity: 90,
                    duration: 2000,
                    stackFromTop: false
                });
                return;
            }
            
            
            // Prepare the data to send in the POST request
            const requestData = {
                collection_name: collectionName,
                new_collection_name: newCollectionName,
                batch_limit: cloneBatchSize
            };

            try {
                
                showNotification({
                    message: "Cloning... Please Wait...",
                    backgroundColor: "#3498db",
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
                
                // Make the POST request to clone the collection
                const response = await fetchData('/clone-new-collection', 'POST', requestData);
                
                if (response && response.message) {
            
                        // General success message
                        showNotification({
                            message: response.message,
                            backgroundColor: "#2ecc71", // Green for success
                            opacity: 90,
                            duration: 4000,
                            stackFromTop: false
                        });
                        showLoading(false);
                        loadCollections();
                        setTimeout(function() {
                            updateCollectionDocumentCount();
                            forceCollectionSelection(newCollectionName);
                            handleCollectionChange('page_collections_collection_dropdown');
                            window.scrollTo({
                                top: 0,
                                behavior: 'smooth' // Optional: adds smooth scrolling
                            });
                            updateVariousLabels();
                            hideCloneCollectionModal();
                        }, 500);
                    

                } else {
                
                    // Default error handling
                    showNotification({
                        message: "Failed to clone collection.",
                        backgroundColor: "#e74c3c", // Red for failure
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    
                    showLoading(false);
                }
            } catch (error) {

                // Handle any network or unexpected errors
                showNotification({
                    message: "An unexpected error occurred. Please try again.",
                    backgroundColor: "#e74c3c", // Red for failure
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
                
                showLoading(false);
            }
            
            showLoading(false);
            
            
        }



        
        function updateRowCountViewDocuments() {
            const table = document.getElementById('page_documents_table');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            const rowCount = rows.length;

            // Update row count in the table header or somewhere else on the page
            const rowCountElement = document.getElementById('row_count_display'); // Assume there's an element with this id
            if (rowCountElement) {
                rowCountElement.textContent = `Row Count: ${rowCount}`;
            }
            
            document.getElementById('showing_document_count').innerHTML = rowCount;
        }

        
        
        
        
        
        function toggleSearchPageFilterChoices() {
            var element = document.getElementById("page_search_document_filters_choices_wrapper");
            var checkbox = document.getElementById("page_search_checkbox_enable_filter");

            // Check current display style and toggle between 'block' and 'none'
            if (checkbox.checked) {
                element.style.display = "block";
            } else {
                element.style.display = "none";
            }
        }

        
        
        
        
        
        // FILTER QUICK POPULATE BUTTONS - DOCUMENT
        // =========================================
        
        function fallBackFiltersDocument_Contains() {
          // Get the textarea element by ID
          var textarea = document.getElementById('fallback_enable_where_document_json_textarea');
            
          // Get the example input field element 
          var exampleInput = document.getElementById('fallback_where_document_example_value_input').value;
          if (exampleInput == "") {
              exampleInput = "value";
          }

          var stringValue = `{
   "$contains": "${exampleInput}"
}`;
          // Check if the textarea element exists
          if (textarea) {
            // Set the value of the textarea to "Hello World"
            textarea.value = stringValue;
          } 
        }
        
        
        
        function fallBackFiltersDocument_NotContains() {
          // Get the textarea element by ID
          var textarea = document.getElementById('fallback_enable_where_document_json_textarea');
            
          // Get the example input field element 
          var exampleInput = document.getElementById('fallback_where_document_example_value_input').value;
          if (exampleInput == "") {
              exampleInput = "value";
          }

          var stringValue = `{
   "$not_contains": "${exampleInput}"
}`;
          // Check if the textarea element exists
          if (textarea) {
            // Set the value of the textarea to "Hello World"
            textarea.value = stringValue;
          } 
        }
        
        
        function fallBackFiltersDocument_AndContains() {
          // Get the textarea element by ID
          var textarea = document.getElementById('fallback_enable_where_document_json_textarea');
            
          // Get the example input field element 
          var exampleInput = document.getElementById('fallback_where_document_example_value_input').value;
          if (exampleInput == "") {
              exampleInput = "value";
          }

          var stringValue = `{
   "$and": [
      {"$contains": "${exampleInput}"}, 
      {"$contains": "${exampleInput}"} 
   ]
}`;
          // Check if the textarea element exists
          if (textarea) {
            // Set the value of the textarea to "Hello World"
            textarea.value = stringValue;
          } 
        }
        
        
        
        
        function fallBackFiltersDocument_OrContains() {
          // Get the textarea element by ID
          var textarea = document.getElementById('fallback_enable_where_document_json_textarea');
            
          // Get the example input field element 
          var exampleInput = document.getElementById('fallback_where_document_example_value_input').value;
          if (exampleInput == "") {
              exampleInput = "value";
          }

          var stringValue = `{
   "$or": [
      {"$contains": "${exampleInput}"}, 
      {"$contains": "${exampleInput}"} 
   ]
}`;
          // Check if the textarea element exists
          if (textarea) {
            // Set the value of the textarea to "Hello World"
            textarea.value = stringValue;
          } 
        }
        
        
        
        
        function fallBackFiltersDocument_AndNotContains() {
          // Get the textarea element by ID
          var textarea = document.getElementById('fallback_enable_where_document_json_textarea');
            
          // Get the example input field element 
          var exampleInput = document.getElementById('fallback_where_document_example_value_input').value;
          if (exampleInput == "") {
              exampleInput = "value";
          }

          var stringValue = `{
   "$and": [
      {"$not_contains": "${exampleInput}"}, 
      {"$not_contains": "${exampleInput}"} 
   ]
}`;
          // Check if the textarea element exists
          if (textarea) {
            // Set the value of the textarea to "Hello World"
            textarea.value = stringValue;
          } 
        }
        
        
        
        function fallBackFiltersDocument_OrNotContains() {
          // Get the textarea element by ID
          var textarea = document.getElementById('fallback_enable_where_document_json_textarea');
            
          // Get the example input field element 
          var exampleInput = document.getElementById('fallback_where_document_example_value_input').value;
          if (exampleInput == "") {
              exampleInput = "value";
          }

          var stringValue = `{
   "$or": [
      {"$not_contains": "${exampleInput}"}, 
      {"$not_contains": "${exampleInput}"} 
   ]
}`;
          // Check if the textarea element exists
          if (textarea) {
            // Set the value of the textarea to "Hello World"
            textarea.value = stringValue;
          } 
        }
        
        
        
        
        
        function fallBackFiltersDocument_Nested() {
          // Get the textarea element by ID
          var textarea = document.getElementById('fallback_enable_where_document_json_textarea');
            
          // Get the example input field element 
          var exampleInput = document.getElementById('fallback_where_document_example_value_input').value;
          if (exampleInput == "") {
              exampleInput = "value";
          }

          var stringValue = `{
   "$and": [
      {"$contains": "${exampleInput}"}, 
      {"$or": [ 
            {"$contains": "${exampleInput}"}, 
            {"$not_contains": "${exampleInput}"}
         ]
      },
      {"$contains": "${exampleInput}"}, 
      {"$contains": "${exampleInput}"}, 
      {"$and": [ 
            {"$contains": "${exampleInput}"}, 
            {"$not_contains": "${exampleInput}"}
         ]
      },
      {"$contains": "${exampleInput}"}, 
      {"$contains": "${exampleInput}"}
   ]
}`;
          // Check if the textarea element exists
          if (textarea) {
            // Set the value of the textarea to "Hello World"
            textarea.value = stringValue;
          } 
        }
        
        
        
        
        
        // FILTER QUICK POPULATE BUTTONS - METADATA
        // =========================================
        function fallBackFiltersMetadata_Equals() {
          // Get the textarea element by ID
          var textarea = document.getElementById('fallback_enable_where_metadata_json_textarea');

            
          // Get the example Key field element 
          var exampleKeyInput = document.getElementById('fallback_where_metadata_example_key_input').value;
          var exampleValueInput = document.getElementById('fallback_where_metadata_example_value_input').value;
            
          if (exampleKeyInput == "") {
              exampleKeyInput = "metadatafield";
          }          
            
          if (exampleValueInput == "") {
              exampleValueInput = "value";
          }
            
          var stringValue = `{
   "${exampleKeyInput}": {"$eq": "${exampleValueInput}"}
}`;
          // Check if the textarea element exists
          if (textarea) {
            // Set the value of the textarea to "Hello World"
            textarea.value = stringValue;
          } 
        }
        
        
        
        
        
        
        function fallBackFiltersMetadata_NotEquals() {
          // Get the textarea element by ID
          var textarea = document.getElementById('fallback_enable_where_metadata_json_textarea');

            
          // Get the example Key field element 
          var exampleKeyInput = document.getElementById('fallback_where_metadata_example_key_input').value;
          var exampleValueInput = document.getElementById('fallback_where_metadata_example_value_input').value;
            
          if (exampleKeyInput == "") {
              exampleKeyInput = "metadatafield";
          }          
            
          if (exampleValueInput == "") {
              exampleValueInput = "value";
          }

          var stringValue = `{
   "${exampleKeyInput}": {"$ne": "${exampleValueInput}"}
}`;
          // Check if the textarea element exists
          if (textarea) {
            // Set the value of the textarea to "Hello World"
            textarea.value = stringValue;
          } 
        }
        
        
        
        
        function fallBackFiltersMetadata_Or() {
          // Get the textarea element by ID
          var textarea = document.getElementById('fallback_enable_where_metadata_json_textarea');

            
          // Get the example Key field element 
          var exampleKeyInput = document.getElementById('fallback_where_metadata_example_key_input').value;
          var exampleValueInput = document.getElementById('fallback_where_metadata_example_value_input').value;
            
          if (exampleKeyInput == "") {
              exampleKeyInput = "metadatafield";
          }          
            
          if (exampleValueInput == "") {
              exampleValueInput = "value";
          }

          var stringValue = `{
   "$or": [
      {"${exampleKeyInput}": {"$ne": "${exampleValueInput}"}}, 
      {"${exampleKeyInput}": {"$ne": "${exampleValueInput}"}}
   ]
}`;
          // Check if the textarea element exists
          if (textarea) {
            // Set the value of the textarea to "Hello World"
            textarea.value = stringValue;
          } 
        }
        
        
        
        
        
        function fallBackFiltersMetadata_And() {
          // Get the textarea element by ID
          var textarea = document.getElementById('fallback_enable_where_metadata_json_textarea');

            
          // Get the example Key field element 
          var exampleKeyInput = document.getElementById('fallback_where_metadata_example_key_input').value;
          var exampleValueInput = document.getElementById('fallback_where_metadata_example_value_input').value;
            
          if (exampleKeyInput == "") {
              exampleKeyInput = "metadatafield";
          }          
            
          if (exampleValueInput == "") {
              exampleValueInput = "value";
          }

          var stringValue = `{
   "$and": [
      {"${exampleKeyInput}": {"$ne": "${exampleValueInput}"}}, 
      {"${exampleKeyInput}": {"$ne": "${exampleValueInput}"}}
   ]
}`;
          // Check if the textarea element exists
          if (textarea) {
            // Set the value of the textarea to "Hello World"
            textarea.value = stringValue;
          } 
        }
        
        
        
        
        
        
        function fallBackFiltersMetadata_Nested() {
          // Get the textarea element by ID
          var textarea = document.getElementById('fallback_enable_where_metadata_json_textarea');

            
          // Get the example Key field element 
          var exampleKeyInput = document.getElementById('fallback_where_metadata_example_key_input').value;
          var exampleValueInput = document.getElementById('fallback_where_metadata_example_value_input').value;
            
          if (exampleKeyInput == "") {
              exampleKeyInput = "metadatafield";
          }          
            
          if (exampleValueInput == "") {
              exampleValueInput = "value";
          }

          var stringValue = `{
   "$and": [
      {"${exampleKeyInput}": "${exampleValueInput}"}, 
      {"$or": [ 
            {"${exampleKeyInput}": "${exampleValueInput}"}, 
            {"${exampleKeyInput}": "${exampleValueInput}"}
         ]
      }
   ]
}`;
          // Check if the textarea element exists
          if (textarea) {
            // Set the value of the textarea to "Hello World"
            textarea.value = stringValue;
          } 
        }
        
        
        
        
        
        
        
        function setDefaultExportOptions() {
            // Set all Content Options checkboxes to checked
            document.getElementById('page_export_choices_content_options_ids').checked = true;
            document.getElementById('page_export_choices_content_options_documents').checked = true;
            document.getElementById('page_export_choices_content_options_metadata').checked = true;
            document.getElementById('page_export_choices_content_options_embeddings').checked = true;
            
            document.getElementById('export_list_of_ids_input').value = "";
            document.getElementById('export_from_record_input').value = 1;
            document.getElementById('export_to_record_input').value = 100;

            // Set Record Options radio button to "All Documents"
            document.getElementById('page_export_choices_record_options_all_documents').checked = true;

            // Set Output Options radio button to "One File"
            document.getElementById('page_export_choices_output_options_one_file').checked = true;
            
            // reset the exported filename 
            document.getElementById('page_export_choices_output_filename_input').value = "chromaflow_export_data.json";            
            
            // clear the exported output directory
            document.getElementById('page_export_choices_output_folder_input').value = "";
        }


        
        

        
        function toggleNestedExportOptions() {
            const selectedOption = document.querySelector('input[name="record_options"]:checked').value;
            const listOfIdsOption = document.getElementById('list_of_ids_options');
            const fromToRecordOption = document.getElementById('from_to_record_options');

            // Hide all nested options by default
            listOfIdsOption.style.display = 'none';
            fromToRecordOption.style.display = 'none';

            // Show the relevant nested option based on the selected radio button
            if (selectedOption === 'list_of_ids') {
                listOfIdsOption.style.display = 'block';
            } else if (selectedOption === 'from_to_record') {
                fromToRecordOption.style.display = 'block';
            }
        }

        
        
        
        
        function gatherExportOptions() {
            const selectedOptions = {};

            // Gather Content Options (Checkboxes)
            // Only append options if checked (i.e., .checked is true)
            selectedOptions.contentOptions = {};

            if (document.getElementById('page_export_choices_content_options_ids').checked) {
                selectedOptions.contentOptions.ids = true;
            }

            if (document.getElementById('page_export_choices_content_options_documents').checked) {
                selectedOptions.contentOptions.documents = true;
            }

            if (document.getElementById('page_export_choices_content_options_metadata').checked) {
                selectedOptions.contentOptions.metadata = true;
            }

            if (document.getElementById('page_export_choices_content_options_embeddings').checked) {
                selectedOptions.contentOptions.embeddings = true;
            }

            // Gather Record Options (Radio Buttons)
            selectedOptions.recordOptions = document.querySelector('input[name="record_options"]:checked').value;

            // Gather Output Options (Radio Buttons)
            selectedOptions.outputOptions = document.querySelector('input[name="output_options"]:checked').value;

            // Gather additional nested options if applicable (based on selected Record Options)
            if (selectedOptions.recordOptions === 'list_of_ids') {
                const idListInput = document.getElementById('export_list_of_ids_input').value;
                selectedOptions.listOfIds = idListInput; // Comma-separated list of IDs
            } else if (selectedOptions.recordOptions === 'from_to_record') {
                const fromRecord = document.getElementById('export_from_record_input').value;
                const toRecord = document.getElementById('export_to_record_input').value;
                selectedOptions.fromToRecord = {
                    from: fromRecord,
                    to: toRecord
                };
            }

            //alert(JSON.stringify(selectedOptions, null, 2));
            return selectedOptions;
        }

        
        
        
        
        

         async function sendExportOptionsToFlask() {
             showLoading(true);
             
            showNotification({
                message: `Gathering Data...Please Wait...`,
                backgroundColor: "#3498db",
                opacity: 90,
                duration: 4000,
                stackFromTop: false
            });
             
            try {
                // Gather the export options and collection name
                const selectedOptions = gatherExportOptions(); // Assuming this function already exists and returns the necessary options

                // Get the collection name from the dropdown
                var collectionName = "";
                var tempselect = document.getElementById('page_search_collection_dropdown');

                // Check if a valid selection exists
                if (tempselect.selectedIndex >= 0) {
                    collectionName = tempselect.options[tempselect.selectedIndex].text;
                }

                // Prepare the payload
                const payload = {
                    collectionName: collectionName,
                    exportOptions: selectedOptions
                };

                // Send the data to Flask using fetchData
                const endpoint = '/gather-export-data';
                const response = await fetchData(endpoint, 'POST', payload);

                // If the response is successful
                if (response && response.documents) {
                    // Clear any existing rows in the table
                    const table = document.getElementById('file_data_export_table');
                    const tableBody = table.querySelector('tbody');
                    tableBody.innerHTML = ''; // Clear existing rows
                    var rowCount = 1;

                    // Loop through the documents and insert rows
                    response.documents.forEach(doc => {
                        // Create a new row
                        const row = document.createElement('tr');

                        // Create and append the Row Count cell (always present)
                        const rowCountCell = document.createElement('td');
                        rowCountCell.textContent = rowCount;
                        row.appendChild(rowCountCell);
                        rowCount++;

                        // Create and append the ID cell (always present)
                        const idCell = document.createElement('td');
                        idCell.textContent = doc.id;
                        row.appendChild(idCell);

                        // Create and append the Document cell (if available, otherwise 'N/A')
                        const documentCell = document.createElement('td');
                        if (doc.document) {
                            const documentDiv = document.createElement('div');
                            documentDiv.textContent = doc.document;
                            documentCell.appendChild(documentDiv);
                        } else {
                            documentCell.textContent = 'N/A'; // Fallback if 'document' is missing
                        }
                        row.appendChild(documentCell);

                        // Create and append the Metadata cell (if available, otherwise 'N/A')
                        const metadataCell = document.createElement('td');
                        if (doc.metadata) {
                            const metadataPre = document.createElement('pre');
                            metadataPre.textContent = JSON.stringify(doc.metadata);
                            metadataCell.appendChild(metadataPre);
                        } else {
                            metadataCell.textContent = 'N/A'; // Fallback if 'metadata' is missing
                        }
                        row.appendChild(metadataCell);

                        // Create and append the Embedding cell (if available, otherwise 'N/A')
                        const embeddingCell = document.createElement('td');
                        if (doc.embedding) {
                            const embeddingDiv = document.createElement('div');
                            embeddingDiv.textContent = JSON.stringify(doc.embedding);
                            embeddingCell.appendChild(embeddingDiv);
                        } else {
                            embeddingCell.textContent = 'N/A'; // Fallback if 'embedding' is missing
                        }
                        row.appendChild(embeddingCell);

                        // Append the row to the table body
                        tableBody.appendChild(row);
                    });

                    // Optionally, display a success notification
                    showNotification({
                        message: `Export options successfully sent for collection: ${collectionName}`,
                        backgroundColor: "#2ecc71", // Green for success
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    
                    showLoading(false);
                }
            } catch (error) {
                // Show a notification on error
                showNotification({
                    message: `Failed to send export options: ${error.message}`,
                    backgroundColor: "#e74c3c", // Red for failure
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });

                console.error("Error while sending export options to Flask:", error);
                showLoading(false);
            }
             
        }


      
        
        
        
        
        async function exportDataToJson() {
            
            // Select the <select> element
            var selectElement = document.getElementById("page_export_collection_dropdown");

            // Check if the <select> element is empty
            if (selectElement && selectElement.options.length === 0) {
                console.log("No Collection Selected to add Document to - Create Collection first");
                
                showNotification({
                    message: "No Collection Selected - Create/Select a Collection first",
                    backgroundColor: "#e74c3c", // Red background for error
                    opacity: 90,
                    duration: 8000,
                    stackFromTop: false
                });
                
                return;
            } 
            
            // Display a confirmation dialog
            var userResponse = confirm("Are you sure you want to Export this Data to JSON?");
            if (!userResponse) {
                return;
            }

            showLoading(true);
            
            showNotification({
                message: `Exporting Data...Please Wait...`,
                backgroundColor: "#3498db",
                opacity: 90,
                duration: 4000,
                stackFromTop: false
            });
            
            try {
                // Gather the export options and collection name
                const selectedOptions = gatherExportOptions(); // Assuming this function already exists and returns the necessary options

                // Get the collection name from the dropdown
                var collectionName = "";
                var tempselect = document.getElementById('page_search_collection_dropdown');

                // Check if a valid selection exists
                if (tempselect.selectedIndex >= 0) {
                    collectionName = tempselect.options[tempselect.selectedIndex].text;
                }

                // Get the output filename and folder path
                var outputFilename = document.getElementById('page_export_choices_output_filename_input').value;
                var outputFolder = document.getElementById('page_export_choices_output_folder_input').value;

                // Check if filename or folder path are empty
                if (!outputFilename) {
                    alert("Please specify a filename.");
                    return;
                }
                
                var payload = {};
            
                if (!outputFolder) {
                    payload = {
                        collectionName: collectionName,
                        exportOptions: selectedOptions,
                        outputFilename: outputFilename
                    };
                } else {
                    payload = {
                        collectionName: collectionName,
                        exportOptions: selectedOptions,
                        outputFilename: outputFilename,
                        outputFolder: outputFolder
                    };
                }

                // Prepare the payload with the collection name, export options, filename, and folder

                // Send the data to Flask using fetchData
                const endpoint = '/export-data-to-json';  // Updated route to match your Flask route
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                // Check if the response is successful
                if (response.ok) {
                    // Parse the JSON response
                    const jsonResponse = await response.json();

                    // Show a success notification with the response message
                    const message = jsonResponse.message || "Data successfully exported.";

                    showNotification({
                        message: `Export data successfully sent for collection: ${collectionName}. ${message}`,
                        backgroundColor: "#2ecc71", // Green for success
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    
                    showLoading(false);
                    
                } else {
                    // Handle failure response (e.g., 400, 500 errors)
                    const errorResponse = await response.json(); // Assuming the error is also a JSON object
                    const errorMessage = errorResponse.error || "An unknown error occurred";

                    showNotification({
                        message: `Failed to send export data: ${errorMessage}`,
                        backgroundColor: "#e74c3c", // Red for failure
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    
                    showLoading(false);
                }
            } catch (error) {
                // Show a notification on error
                showNotification({
                    message: `Error while sending export data: ${error.message}`,
                    backgroundColor: "#e74c3c", // Red for failure
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });

                showLoading(false);
                console.error("Error while sending export data to Flask:", error);
            }
        }
        

        
        
        
        
        
        
        

        function settingsUpdateEmbedModelChangeSelection() {
            // Get the selected value from the dropdown
            const selectTagChoice = document.getElementById("page_settings_embed_model_preset_selecttag").value;

            // Update the model input field
            document.getElementById("page_settings_embed_model_input").value = selectTagChoice;

            // Update the path input field based on the selected model
            updateModelPath(selectTagChoice);

            // Update the dimension input field based on the selected model
            updateModelDimension(selectTagChoice);

            // Update the max token limit input field based on the selected model
            updateMaxTokenLimit(selectTagChoice);
        }

        function updateModelPath(selectTagChoice) {
            const pathInput = document.getElementById("page_settings_embed_model_path_input");
            let pathValue = pathInput.value;

            // Look for the substring 'models' (case insensitive) and modify everything after it
            const modelsIndex = pathValue.toLowerCase().indexOf("models");

            if (modelsIndex !== -1) {
                // Replace everything after "models" with the selected model value
                pathValue = pathValue.substring(0, modelsIndex + 6) + "\\" + selectTagChoice;
            } else {
                // If "models" not found, just append the model name
                pathValue = pathValue + "\\" + selectTagChoice;
            }

            // Set the updated path value
            pathInput.value = pathValue;
        }

        function updateModelDimension(selectTagChoice) {
            const dimensionInput = document.getElementById("page_settings_embed_dimension_input");

            // Define a mapping for the dimensions based on the selected model
            const dimensions = {
                "TaylorAI/bge-micro-v2": 384,
                "Mihaiii/gte-micro-v4": 384,
                "all-MiniLM-L6-v2": 384,
                "GIST-all-MiniLM-L6-v2": 384,
                "sentence-transformers/all-MiniLM-L12-v2": 384,
                "avsolatorio/GIST-small-Embedding-v0": 384,
                "BAAI/bge-small-en-v1.5": 384,
                "infgrad/stella-base-en-v2": 768,
                "sentence-transformers/all-mpnet-base-v2": 768,
                "thenlper/gte-large": 1024,
                "HIT-TMG/KaLM-embedding-multilingual-mini-instruct-v1": 896,
                "dunzhang/stella_en_1.5B_v5": 8192
            };

            // Get the dimension based on the selected model
            const dimension = dimensions[selectTagChoice];

            // Set the updated dimension value
            dimensionInput.value = dimension;
        }

        function updateMaxTokenLimit(selectTagChoice) {
            const tokenLimitInput = document.getElementById("page_settings_embed_context_window_input");

            // Define a mapping for the max token limits based on the selected model
            const maxTokenLimits = {
                "TaylorAI/bge-micro-v2": 512,
                "Mihaiii/gte-micro-v4": 512,
                "all-MiniLM-L6-v2": 512,
                "GIST-all-MiniLM-L6-v2": 512,
                "sentence-transformers/all-MiniLM-L12-v2": 512,
                "avsolatorio/GIST-small-Embedding-v0": 512,
                "BAAI/bge-small-en-v1.5": 512,
                "infgrad/stella-base-en-v2": 512,
                "sentence-transformers/all-mpnet-base-v2": 512,
                "thenlper/gte-large": 512,
                "HIT-TMG/KaLM-embedding-multilingual-mini-instruct-v1": 131072,
                "dunzhang/stella_en_1.5B_v5": 131072
            };

            // Get the max token limit based on the selected model
            const tokenLimit = maxTokenLimits[selectTagChoice];

            // Set the updated max token limit value
            tokenLimitInput.value = tokenLimit;
        }


        
        

        function setttingsSetDefaultEmbeddingModel() {
            var selectElement = document.getElementById('page_settings_embed_model_preset_selecttag');
            var defaultEmbedModelName = 'all-MiniLM-L6-v2';
            
             if (selectElement.value == defaultEmbedModelName) {
                 // already the default value
                 alert("Already using the default embedding model\n'" + defaultEmbedModelName + "'");
                 return;
             }
            
            // Prompt the user for confirmation before setting the default model
            var isConfirmed = window.confirm('Use the default embedding model?\n"' + defaultEmbedModelName + '"?');

            if (isConfirmed) {
                

                if (selectElement) {
                    // Set the default value
                    selectElement.value = 'all-MiniLM-L6-v2';

                    // Create a new 'change' event
                    var event = new Event('change', {
                        'bubbles': true, // Allows the event to bubble up the DOM
                        'cancelable': true // Allows the event to be canceled
                    });

                    // Dispatch the event to trigger the onchange handler
                    selectElement.dispatchEvent(event);
                } else {
                    console.error('Select element not found!');
                }
            } else {
                console.log('Operation canceled. Default embedding model was not changed.');
            }
        }



        

        
        
        function jumpToSettings_EmbedModel(){
            showPage('settings');
            myScrollTo('page_settings_app_language_input');
        }



        

        function compareEmbedModelsSystemAndCollection() {
            // Set a 1000 millisecond delay
            setTimeout(function() {
                // Get the innerHTML of the two elements
                var model1 = document.getElementById('page_collections_system_embed_model').innerText;
                model1 = model1.replace("System Embed Model:", "").trim();
                var model2 = document.getElementById('page_collections_details_embed_model').innerHTML.trim();

                // Get the label element
                var warningLabel = document.getElementById('toolstrip_WarningNotification');

                // Troubleshooting
                //alert("comparing\n\n" + model1 + "\n\n" + model2);

                if (model2 == "?"){
                    return;
                }
                
                // Compare the innerHTML values
                if (model1 !== model2) {
                    // If they don't match, display the warning label
                    warningLabel.style.display = 'inline-block';
                } else {
                    // If they match, hide the warning label
                    warningLabel.style.display = 'none';
                }
            }, 700);  // 1000 milliseconds delay
        }


        
        
        
        
        
        
        function resetCollectionLabels(){
            // Update the HTML elements with the fetched data
            document.getElementById("page_collections_details_id").textContent = "?";
            document.getElementById("page_collections_details_name").textContent = "?";
            document.getElementById("page_collections_details_tenant").textContent = "?";
            document.getElementById("page_collections_details_database").textContent = "?";

            // Update configuration details (no need to reference 'hnsw_configuration' anymore)
            document.getElementById("page_collections_config_name").textContent = "?";
            document.getElementById("page_collections_config_space").textContent = "?";
            document.getElementById("page_collections_config_ef_construction").textContent = "?";
            document.getElementById("page_collections_config_ef_search").textContent = "?";
            document.getElementById("page_collections_config_num_of_threads").textContent = "?";
            document.getElementById("page_collections_config_m").textContent = "?";
            document.getElementById("page_collections_config_resize_factor").textContent = "?";"?";
            document.getElementById("page_collections_config_batch_size").textContent = "?";
            document.getElementById("page_collections_config_batch_size").textContent = "?";

            document.getElementById('page_collections_details_embed_model').innerHTML = "?";
            document.getElementById('page_collections_details_embed_dimension').innerHTML = "?";

            // If metadata exists, populate the textarea
            document.getElementById("page_collections_config_metadata").textContent = "";
        }
        
        
        
        
        
        
        
        function jumpToHelp_BugFix100Docs(){
            showPage('help');
            myScrollTo('scrollToHereBugFix100Docs');
        }
        
                
        function jumpToHelp_BugFix166BatchLimit(){
            showPage('help');
            myScrollTo('scrollToThisForBugFix166BatchLimit');
        }
        
        
        
        function jumpToSettings_BugFix100Docs(){
            showPage('settings');
            myScrollTo('scrollToThisForBugFix100DocsSetting');
        }
        
        
        
        






        function visualizeCollection() {
            
            var docCountElem = document.getElementById('page_visualize_labels_doc_count');
            var countString = docCountElem.innerText.replace("Document Count: ", "").trim();
            var countInt = parseInt(countString);
            if (countInt < 50){
                 showNotification({
                    message: "Collection must contain at least 50 x Documents to Visualise",
                    backgroundColor: "#e74c3c", // Red for failure
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
                return;
            }
            
            showLoading(true);

            // Get the collection name from the dropdown
            var collectionName = "";
            var tempselect = document.getElementById('page_collections_collection_dropdown');

            // Check if a valid selection exists
            if (tempselect.selectedIndex >= 0) {
                collectionName = tempselect.options[tempselect.selectedIndex].text;
            }

            // Make sure a valid collection name is selected
            if (!collectionName) {
                showNotification({
                    message: "Please select a valid collection name.",
                    backgroundColor: "#e74c3c", // Red for failure
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
                return;
            }

            // Prepare the body for the POST request
            const body = {
                collection_name: collectionName
            };

            // Send the collection name to the server
            try {
                const response = fetchData('/visualize-collection', 'POST', body);

                // Check if the response contains an error or success message
                if (response.error) {
                    showNotification({
                        message: response.error,
                        backgroundColor: "#e74c3c", // Red for failure
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });
                    showLoading(false);

                } else {
                    // If the response contains a success message
                    showNotification({
                        message: response.message || "Collection successfully visualized.",
                        backgroundColor: "#2ecc71", // Green for success
                        opacity: 90,
                        duration: 4000,
                        stackFromTop: false
                    });

                    setTimeout(function() {
                        showLoading(false);
                        var currentUrl = window.location.href;
                        var currentPort = parseInt(getPort(currentUrl));
                        var currentHost = getHost(currentUrl);
                        var chromaVizPort = currentPort + 1;
                        var chromaVizHost = currentHost.replace(currentPort, chromaVizPort);
                        //alert(currentHost);
                        //alert(chromaVizHost);
                        window.open(`http://${chromaVizHost}`, '_blank');
                    }, 1000);  // 1000 milliseconds delay

                }
            } catch (error) {
                // If an error occurs, show the notification
                showNotification({
                    message: `Error: ${error.message}`,
                    backgroundColor: "#e74c3c", // Red for failure
                    opacity: 90,
                    duration: 4000,
                    stackFromTop: false
                });
                showLoading(false);
            }

        }




        
        
        function encodeURL(url) {
            return encodeURIComponent(url);
        }
        
        
        
        
        

        
        function getPort(url) {
            let parsedUrl = new URL(url);
            return parsedUrl.port;  // Default to '80' if no port is specified
        }


        
        
        function getHost(url) {
            let parsedUrl = new URL(url);
            return parsedUrl.host;  // This will return domain:port, if a port is specified
        }


        
        
        
        
        function clearConsoleFlask() {
            // Show confirmation dialog
            const userConfirmed = confirm("Are you sure you want to clear the server console?");

            // If the user clicks "OK", proceed with clearing the console
            if (userConfirmed) {
                fetch('/clear-console')
                    .then(response => response.text())
                    .then(data => {
                        console.log(data); // You can log the response if you'd like
                        alert("Console cleared!");
                    })
                    .catch(error => console.error('Error clearing console:', error));
            } else {
                alert("Action cancelled. The console was not cleared.");
            }
        }


        

        function checkEmbedModelFieldsArentEmpty() {
            // Array of input IDs to check
            const inputIds = [
                "page_settings_embed_model_input",
                "page_settings_embed_context_window_input",
                "page_settings_embed_model_path_input",
                "page_settings_embed_dimension_input"
            ];

            // Loop through each ID and check if the corresponding input is empty
            for (let i = 0; i < inputIds.length; i++) {
                const inputElement = document.getElementById(inputIds[i]);

                // Check if the input is empty
                if (!inputElement || inputElement.value.trim() === "") {
                    // Alert the user and return early
                    alert("Please fill out all fields.");
                    return false;
                }
            }

            // All fields are filled, you can continue processing
            console.log("All fields are filled.");
            return true;
        }



        

        async function generateHashFromString(inputText) {
          // Check if the input string is empty, and return an error message if it is
          if (!inputText || inputText.trim() === "") {
            console.error("Input text is empty.");
            return null;  // Return null to indicate failure
          }

          try {
            // Convert the input string to a Uint8Array
            const encoder = new TextEncoder();
            const data = encoder.encode(inputText);

            // Generate SHA-256 hash
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);

            // Convert the hash from ArrayBuffer to a hex string
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(byte => byte.toString(16).padStart(2, '0')).join('');

            // Return the resulting hash
            return hashHex;
          } catch (error) {
            console.error("Error generating hash:", error);
            return null;  // Return null if an error occurred
          }
        }
        
        
        
        
        
        function emptyAllCollectionDropDowns() {
            var dropdowns = [
                'page_search_collection_dropdown',
                'page_collections_collection_dropdown',
                'page_adddocs_collection_dropdown',
                'page_documents_collection_dropdown',
                'page_updatedocs_collection_dropdown',
                'page_tools_collection_dropdown',
                'page_import_collection_dropdown',
                'page_collections_clone_collection_dropdown',
                'page_export_collection_dropdown',
                'page_visualize_collection_dropdown',
                'page_rag_collection_dropdown'
            ];

            // Empty dropdowns
            dropdowns.forEach(function(id) {
                var dropdown = document.getElementById(id);
                if (dropdown) {
                    dropdown.innerHTML = '';  // Remove all options
                }
            });

            // Empty the table
            var table = document.querySelector('.collection_overview_table tbody');
            if (table) {
                table.innerHTML = '';  // Remove all rows from tbody
            }
        }


        
        
        
        // =========================================================
        // SCRIPT START
        // =========================================================

        // WHEN DOM HAS FINISHED LOADING
        document.addEventListener("DOMContentLoaded", function() {

            // Set title App Text
            setTitleText()
            
            fetchAppSettingsJSON();
            
            // Set the Default Start Page to the Dashboard, hide all the other pages
            showPage('dashboard');

            // update labels
            updateVariousLabels();            
            
            // Set Default Fields for a New Collection, if you're going to create one
            defaultCollectionFields();
            defaultAddDocumentFields();
            updateEmbeddingModelInfo();
            
            // Set the checkbox states
            initializeCheckboxesForMetadata();
 
            
            // Populate the Select Tag with Collection Names - but delay by 500 milliseconds to allow it to connect first, give it 3 tries. 
            setTimeout(function() {
                loadCollections();
            }, 1000); // Delay of 500 milliseconds

            setTimeout(function() {
                loadCollections();
            }, 2000); // Delay of 500 milliseconds
            
            setTimeout(function() {
                getCollectionDetailsFlask();
            }, 3000); // Delay of 500 milliseconds
            
            // fresh the CPU and RAM updates every 2000 milliseconds
            updateCPURamInterval();

            setTimeout(function() {
                appHasBootedUp = true;
                console.log("App has booted up: ", appHasBootedUp);
                
                
                /*updateCollectionDocumentCount();
                fetchCollectionOverview();
                
                try {
                    getCollectionDetailsFlask(); // Ensure this function exists and works as expected
                } catch (error) {
                    console.error("Error in getCollectionDetailsFlask:", error);
                }

                try {
                    updateCollectionDocumentCount(); // Ensure this function exists and works as expected
                } catch (error) {
                    console.error("Error in updateCollectionDocumentCount:", error);
                }

                compareEmbedModelsSystemAndCollection();
                */
            }, 4000);
            
            // for the 100 Doc Crashes Bug Fix 
            bugFIX100Docs_DisbaleBatchSizes();
            
            setDefaultExportOptions();
            

        });
    
    </script>
</body>
</html>